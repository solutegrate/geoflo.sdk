

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Source: src/Layers.js | Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-jsdoc.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/tui-doc.css">

    
        
            <link type="text/css" rel="stylesheet" href="./styles/custom.css">
        
    
</head>
<body>
<nav class="lnb" id="lnb">
    <div class="logo" style="">
        
            <a href="https://docs.geoflo.pro" rel="noopener noreferrer" target="_blank">
                <img src="https://geoflo.s3.amazonaws.com/logos/logo_full_white.png" width="100%" height="100%">
            </a>
        
    </div>
    <div class="title">
        <h1><a href="index.html" class="link">Documentation</a></h1>
        
            <span class="version">v1.1.0</span>
        
    </div>
    <div class="search-container" id="search-container">
        <input type="text" placeholder="Search">
        <ul></ul>
    </div>
    
        <ol class="lnb-tab">
            <li id="api-tab">
                <a href="#"><h4>SDK</h4></a>
            </li>
            <li id="examples-tab">
                <a href="#"><h4>Examples</h4></a>
            </li>
        </ol>
    
    <div class="lnb-examples hidden"><h3>Examples</h3><ul><li><a href="tutorial-basic.html">Version 1.1.0</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="basic_sub"></div></li></ul></div><div class="lnb-api hidden"><h3>Modules</h3><ul><li><a href="module-geoflo.html">geoflo</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.html#.activateExploring">activateExploring</a></li><li><a href="module-geoflo.html#.activatePainting">activatePainting</a></li><li><a href="module-geoflo.html#.activatePinning">activatePinning</a></li><li><a href="module-geoflo.html#.activateRouting">activateRouting</a></li><li><a href="module-geoflo.html#.activateSnapping">activateSnapping</a></li><li><a href="module-geoflo.html#.addControl">addControl</a></li><li><a href="module-geoflo.html#.addControls">addControls</a></li><li><a href="module-geoflo.html#.addFeatures">addFeatures</a></li><li><a href="module-geoflo.html#.addFeaturesToMesh">addFeaturesToMesh</a></li><li><a href="module-geoflo.html#.addFeaturesToSelected">addFeaturesToSelected</a></li><li><a href="module-geoflo.html#.cancelEdit">cancelEdit</a></li><li><a href="module-geoflo.html#.combineSelectedFeatures">combineSelectedFeatures</a></li><li><a href="module-geoflo.html#.createPolygon">createPolygon</a></li><li><a href="module-geoflo.html#.deactivateExploring">deactivateExploring</a></li><li><a href="module-geoflo.html#.deactivatePainting">deactivatePainting</a></li><li><a href="module-geoflo.html#.deactivatePinning">deactivatePinning</a></li><li><a href="module-geoflo.html#.deactivateRouting">deactivateRouting</a></li><li><a href="module-geoflo.html#.deactivateSnapping">deactivateSnapping</a></li><li><a href="module-geoflo.html#.deleteMeshData">deleteMeshData</a></li><li><a href="module-geoflo.html#.deleteUserData">deleteUserData</a></li><li><a href="module-geoflo.html#.disable">disable</a></li><li><a href="module-geoflo.html#.editFeature">editFeature</a></li><li><a href="module-geoflo.html#.enable">enable</a></li><li><a href="module-geoflo.html#.fire">fire</a></li><li><a href="module-geoflo.html#.forEachSelectedFeature">forEachSelectedFeature</a></li><li><a href="module-geoflo.html#.getButtons">getButtons</a></li><li><a href="module-geoflo.html#.getColors">getColors</a></li><li><a href="module-geoflo.html#.getCommonGeometryType">getCommonGeometryType</a></li><li><a href="module-geoflo.html#.getControlIds">getControlIds</a></li><li><a href="module-geoflo.html#.getDrawnFeatures">getDrawnFeatures</a></li><li><a href="module-geoflo.html#.getFeatureById">getFeatureById</a></li><li><a href="module-geoflo.html#.getFeaturesByLayer">getFeaturesByLayer</a></li><li><a href="module-geoflo.html#.getHotFeature">getHotFeature</a></li><li><a href="module-geoflo.html#.getMap">getMap</a></li><li><a href="module-geoflo.html#.getMode">getMode</a></li><li><a href="module-geoflo.html#.getModes">getModes</a></li><li><a href="module-geoflo.html#.getRenderedDrawnFeatures">getRenderedDrawnFeatures</a></li><li><a href="module-geoflo.html#.getRenderedFeatures">getRenderedFeatures</a></li><li><a href="module-geoflo.html#.getRenderedSnapFeatures">getRenderedSnapFeatures</a></li><li><a href="module-geoflo.html#.getSelectedFeatureIds">getSelectedFeatureIds</a></li><li><a href="module-geoflo.html#.getSelectedFeatures">getSelectedFeatures</a></li><li><a href="module-geoflo.html#.getSelectedFeaturesBbox">getSelectedFeaturesBbox</a></li><li><a href="module-geoflo.html#.getSelectedPropertyNames">getSelectedPropertyNames</a></li><li><a href="module-geoflo.html#.getSelectedPropertyValues">getSelectedPropertyValues</a></li><li><a href="module-geoflo.html#.getSnapFeatures">getSnapFeatures</a></li><li><a href="module-geoflo.html#.hasControls">hasControls</a></li><li><a href="module-geoflo.html#.hasSelection">hasSelection</a></li><li><a href="module-geoflo.html#.hasSingleSelection">hasSingleSelection</a></li><li><a href="module-geoflo.html#.hideFeatures">hideFeatures</a></li><li><a href="module-geoflo.html#.hideSelectedFeatures">hideSelectedFeatures</a></li><li><a href="module-geoflo.html#.init">init</a></li><li><a href="module-geoflo.html#.loadFeatures">loadFeatures</a></li><li><a href="module-geoflo.html#.moveFeature">moveFeature</a></li><li><a href="module-geoflo.html#.moveMapAlongLine">moveMapAlongLine</a></li><li><a href="module-geoflo.html#.moveSelectedFeatures">moveSelectedFeatures</a></li><li><a href="module-geoflo.html#.off">off</a></li><li><a href="module-geoflo.html#.on">on</a></li><li><a href="module-geoflo.html#.once">once</a></li><li><a href="module-geoflo.html#.redraw">redraw</a></li><li><a href="module-geoflo.html#.refresh">refresh</a></li><li><a href="module-geoflo.html#.refreshMeshData">refreshMeshData</a></li><li><a href="module-geoflo.html#.removeControl">removeControl</a></li><li><a href="module-geoflo.html#.removeControls">removeControls</a></li><li><a href="module-geoflo.html#.removeEventListeners-Removeseventlistenersfromthemapandotherelements.">removeEventListeners - Removes event listeners from the map and other elements.</a></li><li><a href="module-geoflo.html#.removeFeature">removeFeature</a></li><li><a href="module-geoflo.html#.removeFeatures">removeFeatures</a></li><li><a href="module-geoflo.html#.removePopup">removePopup</a></li><li><a href="module-geoflo.html#.removeSelection">removeSelection</a></li><li><a href="module-geoflo.html#.saveEdit">saveEdit</a></li><li><a href="module-geoflo.html#.saveFeatures">saveFeatures</a></li><li><a href="module-geoflo.html#.selectFeature">selectFeature</a></li><li><a href="module-geoflo.html#.setActiveButton">setActiveButton</a></li><li><a href="module-geoflo.html#.setButtons">setButtons</a></li><li><a href="module-geoflo.html#.setCenterMarker">setCenterMarker</a></li><li><a href="module-geoflo.html#.setColors">setColors</a></li><li><a href="module-geoflo.html#.setIcon">setIcon</a></li><li><a href="module-geoflo.html#.setLayers">setLayers</a></li><li><a href="module-geoflo.html#.setMapClass">setMapClass</a></li><li><a href="module-geoflo.html#.setMeshFeatures">setMeshFeatures</a></li><li><a href="module-geoflo.html#.setMode">setMode</a></li><li><a href="module-geoflo.html#.setOpacity">setOpacity</a></li><li><a href="module-geoflo.html#.setOptions">setOptions</a></li><li><a href="module-geoflo.html#.setSelectedFeatures">setSelectedFeatures</a></li><li><a href="module-geoflo.html#.setTheme">setTheme</a></li><li><a href="module-geoflo.html#.updateFeatures">updateFeatures</a></li><li><a href="module-geoflo.html#.updateMeshData">updateMeshData</a></li><li><a href="module-geoflo.html#.updateOrientation">updateOrientation</a></li><li><a href="module-geoflo.html#.updateSelectedProperties">updateSelectedProperties</a></li><li><a href="module-geoflo.html#.zoomToFeatures">zoomToFeatures</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Mixins</h3><ul><li><a href="module-geoflo.Control.html">Control</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Control_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Control.html#.disable">disable</a></li><li><a href="module-geoflo.Control.html#.enable">enable</a></li><li><a href="module-geoflo.Control.html#.getButtons">getButtons</a></li><li><a href="module-geoflo.Control.html#.getControl">getControl</a></li><li><a href="module-geoflo.Control.html#.hideControl">hideControl</a></li><li><a href="module-geoflo.Control.html#.onAdd">onAdd</a></li><li><a href="module-geoflo.Control.html#.onRemove">onRemove</a></li><li><a href="module-geoflo.Control.html#.setAttribution">setAttribution</a></li><li><a href="module-geoflo.Control.html#.setControl">setControl</a></li><li><a href="module-geoflo.Control.html#.setMode">setMode</a></li><li><a href="module-geoflo.Control.html#.showControl">showControl</a></li></ul></div></li><li><a href="module-geoflo.Draw.html">Draw</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Draw_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Draw.html#.activate">activate</a></li><li><a href="module-geoflo.Draw.html#.canHandle">canHandle</a></li><li><a href="module-geoflo.Draw.html#.cancelEdit">cancelEdit</a></li><li><a href="module-geoflo.Draw.html#.deactivate">deactivate</a></li><li><a href="module-geoflo.Draw.html#.deleteVertex">deleteVertex</a></li><li><a href="module-geoflo.Draw.html#.getFeature">getFeature</a></li><li><a href="module-geoflo.Draw.html#.handleClick">handleClick</a></li><li><a href="module-geoflo.Draw.html#.handleContext">handleContext</a></li><li><a href="module-geoflo.Draw.html#.handleDown">handleDown</a></li><li><a href="module-geoflo.Draw.html#.handleDrag">handleDrag</a></li><li><a href="module-geoflo.Draw.html#.handleHistory">handleHistory</a></li><li><a href="module-geoflo.Draw.html#.handleIcon">handleIcon</a></li><li><a href="module-geoflo.Draw.html#.handleMove">handleMove</a></li><li><a href="module-geoflo.Draw.html#.handleOffMap">handleOffMap</a></li><li><a href="module-geoflo.Draw.html#.handleOnMap">handleOnMap</a></li><li><a href="module-geoflo.Draw.html#.handlePainting">handlePainting</a></li><li><a href="module-geoflo.Draw.html#.handleRectangle">handleRectangle</a></li><li><a href="module-geoflo.Draw.html#.handleRedo">handleRedo</a></li><li><a href="module-geoflo.Draw.html#.handleText">handleText</a></li><li><a href="module-geoflo.Draw.html#.handleTouch">handleTouch</a></li><li><a href="module-geoflo.Draw.html#.handleUndo">handleUndo</a></li><li><a href="module-geoflo.Draw.html#.handleUp">handleUp</a></li><li><a href="module-geoflo.Draw.html#.saveEdit">saveEdit</a></li><li><a href="module-geoflo.Draw.html#.selectFeature">selectFeature</a></li><li><a href="module-geoflo.Draw.html#.updateHotSource">updateHotSource</a></li></ul></div></li><li><a href="module-geoflo.Exploring.html">Exploring</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Exploring_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Exploring.html#.activate">activate</a></li><li><a href="module-geoflo.Exploring.html#.deactivate">deactivate</a></li><li><a href="module-geoflo.Exploring.html#.getFeatures">getFeatures</a></li><li><a href="module-geoflo.Exploring.html#.getMatch">getMatch</a></li><li><a href="module-geoflo.Exploring.html#.getRoute">getRoute</a></li><li><a href="module-geoflo.Exploring.html#.setFeature">setFeature</a></li><li><a href="module-geoflo.Exploring.html#.setFeatures">setFeatures</a></li></ul></div></li><li><a href="module-geoflo.Features.html">Features</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Features_sub"></div></li><li><a href="module-geoflo.Gaming.html">Gaming</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Gaming_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Gaming.html#.init">init</a></li><li><a href="module-geoflo.Gaming.html#.refresh">refresh</a></li><li><a href="module-geoflo.Gaming.html#.remove">remove</a></li><li><a href="module-geoflo.Gaming.html#.setBearing">setBearing</a></li><li><a href="module-geoflo.Gaming.html#.setCenter">setCenter</a></li><li><a href="module-geoflo.Gaming.html#.setContainer">setContainer</a></li><li><a href="module-geoflo.Gaming.html#.setGamepad">setGamepad</a></li><li><a href="module-geoflo.Gaming.html#.setLocation">setLocation</a></li><li><a href="module-geoflo.Gaming.html#.setMap">setMap</a></li><li><a href="module-geoflo.Gaming.html#.setMarker">setMarker</a></li><li><a href="module-geoflo.Gaming.html#.setPitch">setPitch</a></li><li><a href="module-geoflo.Gaming.html#.setSpeed">setSpeed</a></li><li><a href="module-geoflo.Gaming.html#.setZoom">setZoom</a></li><li><a href="module-geoflo.Gaming.html#.trigger">trigger</a></li></ul></div></li><li><a href="module-geoflo.Layers.html">Layers</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Layers_sub"></div></li><li><a href="module-geoflo.Locate.html">Locate</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Locate_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Locate.html#.bearing">bearing</a></li><li><a href="module-geoflo.Locate.html#.build">build</a></li><li><a href="module-geoflo.Locate.html#.follow">follow</a></li><li><a href="module-geoflo.Locate.html#.getButton">getButton</a></li><li><a href="module-geoflo.Locate.html#.heading">heading</a></li><li><a href="module-geoflo.Locate.html#.init">init</a></li><li><a href="module-geoflo.Locate.html#.locate">locate</a></li><li><a href="module-geoflo.Locate.html#.onAdd">onAdd</a></li><li><a href="module-geoflo.Locate.html#.onControlEvent">onControlEvent</a></li><li><a href="module-geoflo.Locate.html#.onLocate">onLocate</a></li><li><a href="module-geoflo.Locate.html#.onMapMove">onMapMove</a></li><li><a href="module-geoflo.Locate.html#.ready">ready</a></li><li><a href="module-geoflo.Locate.html#.relocate">relocate</a></li><li><a href="module-geoflo.Locate.html#.removeClasses">removeClasses</a></li><li><a href="module-geoflo.Locate.html#.state">state</a></li><li><a href="module-geoflo.Locate.html#.unlocate">unlocate</a></li><li><a href="module-geoflo.Locate.html#.update">update</a></li></ul></div></li><li><a href="module-geoflo.Mesh.html">Mesh</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Mesh_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Mesh.html#.addNewFeatures">addNewFeatures</a></li><li><a href="module-geoflo.Mesh.html#.getFeatureById">getFeatureById</a></li><li><a href="module-geoflo.Mesh.html#.getFeatures">getFeatures</a></li><li><a href="module-geoflo.Mesh.html#.getFeaturesByParentId">getFeaturesByParentId</a></li><li><a href="module-geoflo.Mesh.html#.getFeaturesFromIndex">getFeaturesFromIndex</a></li><li><a href="module-geoflo.Mesh.html#.removeFeature">removeFeature</a></li><li><a href="module-geoflo.Mesh.html#.splitSegmentAtPoint">splitSegmentAtPoint</a></li></ul></div></li><li><a href="module-geoflo.Options.html">Options</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Options_sub"></div></li><li><a href="module-geoflo.Painting.html">Painting</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Painting_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Painting.html#.activate">activate</a></li><li><a href="module-geoflo.Painting.html#.deactivate">deactivate</a></li><li><a href="module-geoflo.Painting.html#.handleUp">handleUp</a></li><li><a href="module-geoflo.Painting.html#.setFeature">setFeature</a></li><li><a href="module-geoflo.Painting.html#.updateFeature">updateFeature</a></li></ul></div></li><li><a href="module-geoflo.Pinning.html">Pinning</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Pinning_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Pinning.html#.activate">activate</a></li><li><a href="module-geoflo.Pinning.html#.deactivate">deactivate</a></li><li><a href="module-geoflo.Pinning.html#.getFeatures">getFeatures</a></li><li><a href="module-geoflo.Pinning.html#.getNearByFeatures">getNearByFeatures</a></li><li><a href="module-geoflo.Pinning.html#.resetFeatures">resetFeatures</a></li><li><a href="module-geoflo.Pinning.html#.setBuffer">setBuffer</a></li><li><a href="module-geoflo.Pinning.html#.setFeatures">setFeatures</a></li><li><a href="module-geoflo.Pinning.html#.updateFeatures">updateFeatures</a></li></ul></div></li><li><a href="module-geoflo.Routing.html">Routing</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Routing_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Routing.html#.activate">activate</a></li><li><a href="module-geoflo.Routing.html#.deactivate">deactivate</a></li><li><a href="module-geoflo.Routing.html#.getClosest">getClosest</a></li><li><a href="module-geoflo.Routing.html#.getFeatures">getFeatures</a></li><li><a href="module-geoflo.Routing.html#.getMatch">getMatch</a></li><li><a href="module-geoflo.Routing.html#.getRoute">getRoute</a></li></ul></div></li><li><a href="module-geoflo.Select.html">Select</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Select_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Select.html#.activate">activate</a></li><li><a href="module-geoflo.Select.html#.addPopup">addPopup</a></li><li><a href="module-geoflo.Select.html#.canHandle">canHandle</a></li><li><a href="module-geoflo.Select.html#.deactivate">deactivate</a></li><li><a href="module-geoflo.Select.html#.deselectCurrentFeature">deselectCurrentFeature</a></li><li><a href="module-geoflo.Select.html#.handleClick">handleClick</a></li><li><a href="module-geoflo.Select.html#.handleDrag">handleDrag</a></li><li><a href="module-geoflo.Select.html#.handleMove">handleMove</a></li><li><a href="module-geoflo.Select.html#.removePopup">removePopup</a></li><li><a href="module-geoflo.Select.html#.selectFeature">selectFeature</a></li></ul></div></li><li><a href="module-geoflo.Snapping.html">Snapping</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Snapping_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Snapping.html#.activate">activate</a></li><li><a href="module-geoflo.Snapping.html#.addFeature">addFeature</a></li><li><a href="module-geoflo.Snapping.html#.deactivate">deactivate</a></li><li><a href="module-geoflo.Snapping.html#.getClosest">getClosest</a></li><li><a href="module-geoflo.Snapping.html#.setClosest">setClosest</a></li><li><a href="module-geoflo.Snapping.html#.setFeature">setFeature</a></li><li><a href="module-geoflo.Snapping.html#.setVertex">setVertex</a></li><li><a href="module-geoflo.Snapping.html#.updateFeature">updateFeature</a></li></ul></div></li><li><a href="module-geoflo.Styles.html">Styles</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Styles_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Styles.html#.closeModal">closeModal</a></li><li><a href="module-geoflo.Styles.html#.getDefaultPosition">getDefaultPosition</a></li><li><a href="module-geoflo.Styles.html#.hide">hide</a></li><li><a href="module-geoflo.Styles.html#.init">init</a></li><li><a href="module-geoflo.Styles.html#.onAdd">onAdd</a></li><li><a href="module-geoflo.Styles.html#.onRemove">onRemove</a></li><li><a href="module-geoflo.Styles.html#.openModal">openModal</a></li><li><a href="module-geoflo.Styles.html#.select">select</a></li><li><a href="module-geoflo.Styles.html#.show">show</a></li></ul></div></li><li><a href="module-geoflo.Utilities.html">Utilities</a><button type="button" class="hidden toggle-subnav btn btn-link">  <span class="glyphicon glyphicon-plus"></span></button><div class="hidden" id="module:geoflo.Utilities_sub"><div class="member-type">Methods</div><ul class="inner"><li><a href="module-geoflo.Utilities.html#.assignDeep">assignDeep</a></li><li><a href="module-geoflo.Utilities.html#.clone">clone</a></li><li><a href="module-geoflo.Utilities.html#.cloneDeep">cloneDeep</a></li><li><a href="module-geoflo.Utilities.html#.combineSameTypeFeatures">combineSameTypeFeatures</a></li><li><a href="module-geoflo.Utilities.html#.compareDeep">compareDeep</a></li><li><a href="module-geoflo.Utilities.html#.consumableArray">consumableArray</a></li><li><a href="module-geoflo.Utilities.html#.degrees2meters">degrees2meters</a></li><li><a href="module-geoflo.Utilities.html#.extend">extend</a></li><li><a href="module-geoflo.Utilities.html#.getLastIndexCoords">getLastIndexCoords</a></li><li><a href="module-geoflo.Utilities.html#.getRandomColor">getRandomColor</a></li><li><a href="module-geoflo.Utilities.html#.isEmptyLineString">isEmptyLineString</a></li><li><a href="module-geoflo.Utilities.html#.isLastIndex">isLastIndex</a></li><li><a href="module-geoflo.Utilities.html#.isLineString">isLineString</a></li><li><a href="module-geoflo.Utilities.html#.isPoint">isPoint</a></li><li><a href="module-geoflo.Utilities.html#.isPointEqual">isPointEqual</a></li><li><a href="module-geoflo.Utilities.html#.isPolygon">isPolygon</a></li><li><a href="module-geoflo.Utilities.html#.isValidLineString">isValidLineString</a></li><li><a href="module-geoflo.Utilities.html#.meters2degrees">meters2degrees</a></li><li><a href="module-geoflo.Utilities.html#.reducePrecision">reducePrecision</a></li><li><a href="module-geoflo.Utilities.html#.setProperties">setProperties</a></li><li><a href="module-geoflo.Utilities.html#.setProperty">setProperty</a></li><li><a href="module-geoflo.Utilities.html#.stringToDOM">stringToDOM</a></li></ul></div></li></ul></div><div class="lnb-api hidden"><h3>Global</h3><ul><li><a href="global.html#addLayer">addLayer</a></li><li><a href="global.html#addLayers">addLayers</a></li><li><a href="global.html#addSource">addSource</a></li><li><a href="global.html#addSources">addSources</a></li><li><a href="global.html#addTextLayer">addTextLayer</a></li><li><a href="global.html#init">init</a></li><li><a href="global.html#moveLayers">moveLayers</a></li><li><a href="global.html#onClusterClick">onClusterClick</a></li><li><a href="global.html#onLayerMouseout">onLayerMouseout</a></li><li><a href="global.html#onLayerMouseover">onLayerMouseover</a></li><li><a href="global.html#refresh">refresh</a></li><li><a href="global.html#removeCustomLayers">removeCustomLayers</a></li><li><a href="global.html#removeLayer">removeLayer</a></li><li><a href="global.html#removeLayers">removeLayers</a></li><li><a href="global.html#removeSource">removeSource</a></li><li><a href="global.html#removeSources">removeSources</a></li><li><a href="global.html#removeTextLayer">removeTextLayer</a></li></ul></div>
</nav>
<div id="resizer"></div>

<div class="main" id="main">
    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @mixin
 * @memberof module:geoflo
 * @name Layers
 * @description This module provides the layer functionality for the Geoflo application.
 *              Refactored to use ES6 Maps for caching and optimized for performance.
 * @param {Object} options - The options object to configure the object.
 * @returns {Object} Returns the Layers object.
 */
const Layers = function () {
    const geoflo = this.geoflo;
    if (!geoflo.map) throw new Error('No map object provided!');

    const map = geoflo.map;
    const id = geoflo.id;

    const layerTypes = {
        Polygon: ['-fill', '-border'],
        Polyline: ['-line', '-dash', '-buffer'],
        Point: ['-circle', '-icon', '-cluster-circle', '-cluster-icon', '-count-icon', '-count-text'],
        Image: ['-image'],
        All: ['-fill', '-border', '-line', '-dash', '-buffer', '-circle', '-icon', '-cluster-circle', '-cluster-icon', '-count-icon', '-count-text', '-image']
    };

    this.options = {};

    // Use Maps for O(1) lookups.
    this.layersMap = new Map();
    this.customLayersMap = new Map();
    this.sourcesMap = new Map();

    /**
     * Initializes the object with provided options and refreshes it.
     */
    this.init = function (options = {}) {
        this.options = { ...this.options, ...options };

        this.defaultLayers = [
            {
                source: geoflo.statics.constants.sources.COLD,
                id: id + '-fill-cold',
                type: 'fill',
                layout: {},
                filter: ["==", "$type", "Polygon"],
                paint: {
                    'fill-color': geoflo.options.colors.secondaryCold,
                    'fill-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 0.3]
                }
            },
            {
                source: geoflo.statics.constants.sources.COLD,
                id: id + '-line-cold',
                type: 'line',
                layout: { 'line-cap': 'round', 'line-join': 'miter' },
                paint: {
                    'line-color': geoflo.options.colors.primaryCold,
                    'line-width': 4,
                    'line-gap-width': ["match", ["get", "type"], "Polygon", 0, 0],
                    'line-offset': ['case', ["boolean", ["has", "offset"], true], ["get", "offset"], 0],
                    'line-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 1]
                }
            },
            {
                source: geoflo.statics.constants.sources.COLD,
                id: id + '-circle-cold',
                filter: ['all', ['==', ['get', 'type'], 'Circle'], ["!=", ["geometry-type"], "Polygon"]],
                type: 'circle',
                paint: {
                    'circle-radius': { base: 6, stops: [[10, 8], [14, 10]] },
                    'circle-stroke-width': 2,
                    'circle-color': geoflo.options.colors.primaryCold,
                    'circle-stroke-color': geoflo.options.colors.secondaryCold,
                    'circle-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 1],
                    'circle-stroke-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 1]
                }
            },
            {
                source: geoflo.statics.constants.sources.COLD,
                id: id + '-icon-cold',
                type: 'symbol',
                filter: ['==', ['get', 'type'], 'Icon'],
                layout: {
                    visibility: 'visible',
                    'icon-optional': true,
                    'text-field': ['get', 'primaryIcon', ['get', 'style', ['properties']]],
                    'text-size': { base: 16, stops: [[10, 16], [14, 12]] },
                    'text-line-height': 1,
                    'text-padding': 0,
                    'text-offset': [0, 0.2],
                    'text-justify': 'auto',
                    'text-anchor': 'center',
                    'text-allow-overlap': true,
                    'text-font': ['Font Awesome 6 Pro Solid'],
                    'text-ignore-placement': true
                },
                paint: {
                    'text-translate-anchor': 'viewport',
                    'text-halo-width': 0,
                    'text-halo-color': geoflo.options.colors.primaryCold,
                    'text-color': geoflo.options.colors.secondaryBackground,
                    'text-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 1]
                }
            },
            {
                source: geoflo.statics.constants.sources.COLD,
                id: id + '-text-cold',
                type: 'symbol',
                filter: ["==", "$type", "Point"],
                layout: {
                    "symbol-placement": "point",
                    'text-field': ['get', 'text'],
                    'text-font': ['DIN Pro Regular', 'DIN Pro Italic', 'Arial Unicode MS Regular', 'DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                    'text-keep-upright': true,
                    'text-size': 18,
                    'text-justify': ['get', 'justify'],
                    'text-letter-spacing': 0.05,
                    'text-line-height': 1.2,
                    'text-max-angle': 10,
                    'text-offset': [0, 0],
                    'text-padding': 2,
                    'text-rotate': 0,
                    'text-transform': ['get', 'transform']
                },
                paint: {
                    'text-color': geoflo.options.colors.primaryCold,
                    'text-halo-color': geoflo.options.colors.primaryBackground,
                    'text-halo-width': 0.5,
                    'text-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 1]
                }
            },
            {
                source: geoflo.statics.constants.sources.COLD,
                id: id + '-text-icon-cold',
                type: 'symbol',
                filter: ['==', ['get', 'type'], 'Text'],
                layout: {
                    visibility: 'visible',
                    'icon-optional': true,
                    'text-field': ['get', 'primaryIcon', ['get', 'style', ['properties']]],
                    'text-size': { base: 16, stops: [[10, 16], [14, 12]] },
                    'text-line-height': 1,
                    'text-padding': 0,
                    'text-offset': [0, 0.2],
                    'text-justify': 'auto',
                    'text-anchor': 'center',
                    'text-allow-overlap': true,
                    'text-font': ['Font Awesome 6 Pro Solid'],
                    'text-ignore-placement': true
                },
                paint: {
                    'text-translate-anchor': 'viewport',
                    'text-halo-width': 0,
                    'text-halo-color': geoflo.options.colors.primaryCold,
                    'text-color': geoflo.options.colors.secondaryBackground,
                    'text-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 1]
                }
            },
            {
                id: geoflo.statics.constants.layers.MESH + '-line',
                source: geoflo.statics.constants.sources.MESH,
                type: "line",
                paint: {
                    "line-color": geoflo.options.colors.primaryBase,
                    "line-width": 2,
                    "line-opacity": 0.3
                }
            },
            {
                id: geoflo.statics.constants.layers.MESH + '-circle',
                source: geoflo.statics.constants.sources.MESH,
                type: 'circle',
                paint: {
                    'circle-radius': 2,
                    'circle-color': geoflo.options.colors.primaryBase,
                    'circle-opacity': 0.3
                }
            },
            // ... (other default layers continue)
        ];

        this.selectLayers = [
            {
                source: geoflo.statics.constants.sources.SELECT,
                id: id + '-line-select-background',
                type: 'line',
                layout: { visibility: 'visible', 'line-cap': 'round', 'line-join': 'round' },
                paint: { 'line-color': geoflo.options.colors.primarySelect, 'line-width': 6, 'line-opacity': 0.4 },
                metadata: { types: ['Polyline', 'Polygon', 'Rectangle'] }
            },
            {
                source: geoflo.statics.constants.sources.SELECT,
                id: id + '-line-select',
                type: 'line',
                layout: { visibility: 'visible', 'line-cap': 'round', 'line-join': 'round' },
                paint: { 'line-color': geoflo.options.colors.secondarySelect, 'line-width': 6, 'line-dasharray': [0, 4, 3] },
                metadata: { types: ['Polyline', 'Polygon', 'Rectangle'] }
            },
            {
                source: geoflo.statics.constants.sources.SELECT,
                id: id + '-fill-select',
                type: 'fill',
                layout: {},
                filter: ["==", "$type", "Polygon"],
                paint: { 'fill-color': geoflo.options.colors.primarySelect, 'fill-opacity': 0.4 },
                metadata: { types: ['Polygon', 'Rectangle'] }
            },
            {
                source: geoflo.statics.constants.sources.SELECT,
                id: id + '-point-select',
                filter: ['all', ['!=', ['get', 'type'], 'Text'], ["==", ["geometry-type"], "Point"]],
                type: 'circle',
                layout: { visibility: 'visible' },
                paint: {
                    'circle-radius': 10,
                    'circle-stroke-width': 3,
                    'circle-color': geoflo.options.colors.primarySelect,
                    'circle-stroke-color': geoflo.options.colors.secondarySelect,
                    'circle-stroke-opacity': 1,
                    'circle-opacity': 0.8
                },
                metadata: { types: ['Point', 'Circle', 'Marker', 'Icon'] }
            },
            {
                source: geoflo.statics.constants.sources.SELECT,
                id: id + '-symbol-select',
                filter: ['==', ['get', 'type'], 'Icon'],
                type: 'symbol',
                layout: {
                    visibility: 'visible',
                    'icon-optional': true,
                    'symbol-placement': 'point',
                    'text-rotation-alignment': 'viewport',
                    'text-field': ['get', 'primaryIcon', ['get', 'style', ['properties']]],
                    'text-rotate': ['get', 'rotate', ['get', 'style', ['properties']]],
                    'text-size': 14,
                    'text-line-height': 1,
                    'text-padding': 0,
                    'text-offset': [0, 0.2],
                    'text-justify': 'auto',
                    'text-anchor': 'center',
                    'text-allow-overlap': true,
                    'text-font': ['Font Awesome 6 Pro Solid'],
                    'text-ignore-placement': true
                },
                paint: {
                    'text-translate-anchor': 'viewport',
                    'text-halo-color': geoflo.options.colors.secondarySelect,
                    'text-halo-width': 2,
                    'text-color': geoflo.options.colors.primaryBackground
                },
                metadata: { types: ['Icon'] }
            },
            {
                source: geoflo.statics.constants.sources.SELECT,
                id: id + '-text-point-select',
                filter: ['==', ['get', 'type'], 'Text'],
                type: 'circle',
                layout: { visibility: 'visible' },
                paint: {
                    'circle-radius': 4,
                    'circle-stroke-width': 1,
                    'circle-color': geoflo.options.colors.primaryColor,
                    'circle-stroke-color': geoflo.options.colors.primaryBackground,
                    'circle-stroke-opacity': 1,
                    'circle-opacity': 1
                },
                metadata: { types: ['Text'] }
            },
            {
                source: geoflo.statics.constants.sources.SELECT,
                id: id + '-text-select',
                filter: ['==', ['get', 'type'], 'Text'],
                type: 'symbol',
                layout: {
                    visibility: 'visible',
                    "symbol-placement": "point",
                    'text-rotation-alignment': 'viewport',
                    'text-field': ['get', 'text'],
                    'text-font': ['DIN Pro Regular', 'DIN Pro Italic', 'Arial Unicode MS Regular', 'DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                    'text-keep-upright': true,
                    'text-allow-overlap': true,
                    'text-size': 18,
                    'text-justify': ['get', 'justify'],
                    'text-letter-spacing': 0.13,
                    'text-line-height': 1.2,
                    'text-max-angle': 10,
                    'text-offset': [0, -1],
                    'text-padding': 2,
                    'text-rotate': 0,
                    'text-transform': ['get', 'transform']
                },
                paint: {
                    'text-color': geoflo.options.colors.primaryColor,
                    'text-halo-color': geoflo.options.colors.primaryBackground,
                    'text-halo-width': 2,
                    'text-opacity': 1
                },
                metadata: { types: ['Text'] }
            },
            {
                source: geoflo.statics.constants.sources.SELECT,
                id: id + '-image-select',
                filter: ['==', ['get', 'type'], 'Image'],
                type: 'symbol',
                layout: {
                    visibility: 'visible',
                    'icon-image': ['get', 'primaryImage', ['get', 'style', ['properties']]],
                    'icon-size': ['interpolate', ['linear'], ['zoom'], 1, 0.4, 15, 1],
                    'icon-allow-overlap': true,
                    'icon-anchor': 'bottom'
                },
                metadata: { types: ['Image'] }
            }
        ];

        return this.refresh({ init: true });
    };

    /**
     * Refreshes the map by removing and re-adding layers and sources.
     */
    this.refresh = async (options = {}) => {
        if (options.select) {
            // Instead of referencing a non-existent selectLayersMap, use the selectLayers array.
            const selectIds = this.selectLayers.map(layer => layer.id);
            const selectLayers = selectIds
                .map(id => this.layersMap.get(id))
                .filter(Boolean);
            this.moveLayers(selectLayers);
            return selectLayers;
        }
        if (!options.init) return this.init(options);

        // Backup current custom layers and then clear them.
        const customLayersBackup = Array.from(this.customLayersMap.values());

        this.removeEventListeners();
        this.removeCustomLayers();
        // Remove default and select layers (provided as an array of IDs)
        this.removeLayers(this.defaultLayers.map(l => l.id));
        this.removeLayers(this.selectLayers.map(l => l.id));

        // Remove and then re-add all sources.
        const allSources = Object.values(geoflo.statics.constants.sources);
        this.removeSources(allSources);
        this.addSources(allSources);

        // Add default layers.
        this.addLayers(this.defaultLayers, this.options);

        // Re-add custom layers, if any.
        if (customLayersBackup.length) await this.setCustomLayers(customLayersBackup, this.options);

        // Add select layers.
        this.addLayers(this.selectLayers, this.options);
        await this.refresh({ select: true });
        this.addEventListeners();

        return this.getLayers();
    };



    this.addEventListeners = (options = {}) => buildEvents.call(this, { on: true, ...options });

    this.removeEventListeners = (options = {}) => buildEvents.call(this, { off: true, ...options });

    this.hasCustomLayers = () => this.customLayersMap.size;



    this.getCustomLayers = () => Array.from(this.customLayersMap.values());

    this.getCustomLayer = (id) => (id ? this.customLayersMap.get(id) : false);

    this.getSources = () => Array.from(this.sourcesMap.values());

    this.getSource = (id) => (id ? this.sourcesMap.get(id) : false);

    this.getSourceIds = () => Array.from(this.sourcesMap.keys());

    this.getLayers = () => Array.from(this.layersMap.values());

    this.getLayer = (id, custom = false) => id ? (custom ? this.customLayersMap.get(id) : this.layersMap.get(id)) : false;

    this.getLayerIds = (layers) => Array.isArray(layers) ? layers.map(l => (typeof l === 'object' ? l.id : l)) : Array.from(this.layersMap.keys());

    this.getLayerType = (id) => this.getLayer(id, true)?.details?.type || '';

    this.getLayerTypes = () => Array.from(this.layersMap.values()).map(l => l.details?.type || '');

    this.getLayerTypesBySource = (source) => Array.from(this.layersMap.values()).filter(l => l.source === source).map(l => l.details?.type || '');

    this.getLayerByType = (type) => Array.from(this.layersMap.values()).filter(l => l.details?.type === type);

    this.getLayerBySource = (source) => Array.from(this.layersMap.values()).filter(l => l.source === source);

    this.getLayerById = (id) => this.layersMap.get(id);

    this.getFeatures = (id) => this.getSource(id)?._data?.features || [];

    this.getFeature = (id) => this.getSource(id)?._data?.features?.find(f => f.id === id) || false;

    this.getSelection = (features = [], coords) => {
        if (features[0]?.properties?.cluster) {
            this.onClusterClick(features[0], coords);
            return false;
        }
        return true;
    };

    this.getType = (type) => {
        if (['Polygon', 'Rectangle'].includes(type)) return 'Polygon';
        if (['Polyline', 'LineString', 'Line'].includes(type)) return 'Polyline';
        if (['Point', 'Circle', 'Marker', 'Icon', 'Text'].includes(type)) return 'Point';
        if (type === 'Image') return 'Image';
        return false;
    };




    this.setCustomLayers = async (layers, options = {}) => {
        this.removeCustomLayers();
        if (!layers || layers.length === 0) return [];
        return await buildLayers.call(this, layers, options);
    };




    /**
     * Adds multiple sources to the map.
     */
    this.addSources = (sources = []) => {
        sources.forEach(sourceId => {
            if (!this.sourcesMap.has(sourceId)) {
                this.addSource(sourceId);
            }
        });
        geoflo.fire('sources.add', { sources: this.getSources() });
    };

    /**
     * Adds a single source to the map and caches it.
     */
    this.addSource = (id, type, options = {}) => {
        if (!id) throw new Error('No source was provided!');
        const existingSource = map.getSource(id);

        if (existingSource) {
            this.sourcesMap.set(id, this.getSource(id) || existingSource);
            return this.getSource(id);
        }
        
        let opts = {
            type: options.type || 'geojson',
            data: turf.featureCollection(options.features || []),
            promoteId: options.promoteId || 'id',
            cluster: false
        };

        if ((type === 'Point' || type === 'Image') &amp;&amp; !options.noCluster) {
            opts = { ...opts, cluster: true, clusterMaxZoom: options.clusterMaxZoom || 14, clusterRadius: options.clusterRadius || 50 };
        }

        map.addSource(id, opts);
        const newSource = map.getSource(id);
        this.sourcesMap.set(id, newSource);
        geoflo.fire('source.add', { id, source: newSource });
        return newSource;
    };

    /**
     * Adds multiple layers to the map.
     */
    this.addLayers = (layers = [], options = {}, customLayer) => {
        requestAnimationFrame(() => {
            layers.forEach(layer => this.addLayer(layer, options));
            if (customLayer) this.customLayersMap.set(customLayer.id, customLayer);
            geoflo.fire('layers.add', { layers: this.getLayers() });
            buildEvents.call(this);
        });
        return this.getLayers();
    };

    /**
     * Adds a single layer to the map.
     */
    this.addLayer = (layer, options = {}) => {
        if (!layer || !layer.id) return false;
        layer.metadata = layer.metadata || options;
        if (map.getLayer(layer.id)) {
            layer.layer = map.getLayer(layer.id);
            if (!this.layersMap.has(layer.id)) this.layersMap.set(layer.id, layer);
            return this.getLayer(layer.id);
        }
        map.addLayer(layer);
        layer.layer = map.getLayer(layer.id);
        this.layersMap.set(layer.id, layer);
        geoflo.fire('layer.add', { id: layer.id, layer: layer });
        return layer;
    };

    /**
     * Adds text layers for labeling.
     * (Currently disabled – remove the "return;" to enable.)
     */
    this.addTextLayer = (options = {}) => {
        return; // Disabled for now.
        const layers = options.select
            ? this.getLayer(geoflo.statics.constants.sources.SELECT)
            : this.getCustomLayers();
        const field = options.field || 'text';

        this.removeTextLayer(options);

        layers.forEach(layer => {
            const id = `${layer.id}-Text`;
            let filter = ['all', ['==', ["geometry-type"], 'Point'], ["has", field]];
            if (options.filter) filter = options.filter;
            if (!options.select &amp;&amp; options.ids) filter = ['in', 'id', ...options.ids];

            const layout = {
                visibility: options.visibility || 'visible',
                'symbol-placement': 'point',
                'text-rotation-alignment': 'viewport',
                'text-field': ['get', field],
                'text-keep-upright': true,
                'text-allow-overlap': true,
                'text-anchor': 'top',
                'text-size': 12,
                'text-justify': 'center',
                'text-letter-spacing': 0.25,
                'text-line-height': 1.2,
                'text-max-angle': 10,
                'text-offset': [0, 0.5],
                'text-padding': 2,
                'text-rotate': 0,
                'text-transform': 'none',
                'text-font': ['Arial Unicode MS Regular', 'DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                'text-ignore-placement': false,
                'text-max-width': 15,
                ...(layer.text?.layout || {}),
                ...(options.layout || {})
            };

            const paint = {
                'text-translate-anchor': 'viewport',
                'text-halo-color': ['get', 'primaryColor', ['get', 'style', ['properties']]],
                'text-halo-width': 1.2,
                'text-color': ['get', 'secondaryColor', ['get', 'style', ['properties']]],
                'text-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, ['get', 'opacity', ['get', 'style', ['properties']]]],
                ...(layer.text?.paint || {}),
                ...(options.paint || {})
            };

            const textLayer = {
                id,
                type: 'symbol',
                source: layer.source || layer.details?.source || id,
                slot: 'top',
                filter,
                layout,
                paint,
                metadata: { text: true, name: id }
            };

            if (!map.getLayer(id)) map.addLayer(textLayer);
            this.layersMap.set(id, textLayer);
        });

        this.showTextLayers = true;
    };




    /**
     * Removes sources from the map.
     */
    this.removeSources = (ids = []) => {
        ids.forEach(id => { if (this.sourcesMap.has(id)) this.removeSource(id); });
        geoflo.fire('sources.remove', { removed: true });
    };

    /**
     * Removes a single source from the map.
     */
    this.removeSource = (id) => {
        if (!id) return false;
        if (map.getSource(id)) map.removeSource(id);
        this.sourcesMap.delete(id);
        geoflo.fire('source.remove', { removed: id });
        return id;
    };

    /**
     * Removes multiple layers. Accepts an array of layer objects or IDs.
     */
    this.removeLayers = (layers) => {
        const ids = Array.isArray(layers)
            ? layers.map(l => (typeof l === 'object' ? l.id : l))
            : [];
        this.removeTextLayer();
        ids.forEach(id => this.removeLayer(id));
        geoflo.fire('layers.remove', { removed: ids });
        return ids;
    };

    /**
     * Removes a single layer from the map.
     */
    this.removeLayer = (id) => {
        if (!id) return false;
        if (map.getLayer(id)) map.removeLayer(id);
        this.layersMap.delete(id);
        this.customLayersMap.delete(id);
        geoflo.fire('layer.remove', { removed: id });
        return id;
    };

    /**
     * Removes text layers (layers with metadata.text).
     */
    this.removeTextLayer = (options = {}) => {
        for (const [id, layer] of this.layersMap.entries()) {
            if (layer.metadata &amp;&amp; layer.metadata.text &amp;&amp; map.getLayer(id)) {
                map.removeLayer(id);
                this.layersMap.delete(id);
            }
        }
        this.showTextLayers = false;
    };

    /**
     * Removes all custom layers.
     */
    this.removeCustomLayers = () => {
        for (const [id, layer] of this.customLayersMap.entries()) {
            this.removeLayer(id);
            this.removeSource(layer.source);
        }
        this.customLayersMap.clear();
        return true;
    };



    /**
     * Moves the specified layers on the map.
     */
    this.moveLayers = (layers) => {
        const targetLayers = layers || this.getLayers();
        targetLayers.forEach(layer => {
            if (map.getLayer(layer.id)) {
                map.moveLayer(layer.id);
            }
        });
    };

    /**
     * Handles cluster clicks by expanding clusters.
     */
    this.onClusterClick = (feature) => {
        if (!feature.source) return false;
        const source = map.getSource(feature.source);
        if (!source) return false;
        source.getClusterExpansionZoom(feature.properties.cluster_id, (err, zoom) => { if (!err) map.easeTo({ center: feature.geometry.coordinates, zoom: zoom + 2 }); });
        return false;
    };

    /**
     * Handles mouseover events for layers.
     * (Currently commented out – remove comments to enable.)
     */
    this.onLayerMouseover = function (event) {
        // Uncomment below to enable highlighting on mouseover:
        // const MapObj = app.Map;
        // if (MapObj.getActions().editing || MapObj.getActions().drawing || MapObj.getActions().viewing) return false;
        // if (app[app.ns('layer')]._importing) return false;
        // if (!event.features.length) return false;
        // MapObj.setHighlight({ clear: true, features: event.features });
    };

    /**
     * Handles mouseout events for layers.
     * (Currently commented out – remove comments to enable.)
     */
    this.onLayerMouseout = function (event) {
        // Uncomment below to enable removing highlights on mouseout:
        // const MapObj = app.Map;
        // if (MapObj.getActions().editing || MapObj.getActions().drawing || MapObj.getActions().viewing) return false;
        // if (app[app.ns('layer')]._importing) return false;
        // MapObj._removeHighlight();
    };

    // --- Helper functions for building layers ---

    async function buildLayers(layers = [], options = {}) {
        await buildText.call(this);
        if (!layers.length) return false;
        await Promise.all(layers.map(layer => buildLayer.call(this, layer, options)));
        setTimeout(() => { this.moveLayers(); }, 250);
        return this.getLayers();
    }

    async function buildLayer(layer, opts) {
        let error;
        const details = !layer.details &amp;&amp; layer.id ? layer : layer.details || {};
        const layerOptions = layer.options || {};
        let layersArr = layer.layers || [];
        const features = layer.features || [];
        const hasFeatures = features &amp;&amp; features.length;
        let style = layer.style || false;

        if (!details.id || !details.type) error = true;

        const type = details.type === 'ALL' ? 'ALL' : this.getType(details.type);
        if (!type) error = true;

        const metadata = { type: details.type };
        details.default ? (metadata.default = true) : (metadata.custom = true);
        if (details.name) metadata.name = details.name;

        const source = details.source || details.id;
        metadata.source = source;

        if (details.style) delete details.style;

        const settings = {
            type,
            source,
            id: details.id,
            types: layerTypes[type],
            style: style || {},
            filter: layer.filter,
            images: layer.images,
            details,
            options: layerOptions,
            layers: layersArr
        };

        if (settings.images) await addImages(settings.images);

        if (type === 'ALL') {
            const promises = Object.keys(layerTypes)
                .filter(key => key !== 'All')
                .map(async key => {
                    const layerConfig = { ...settings, type: key, types: layerTypes[key] };
                    if (key === 'Image') return buildImage.call(this, layerConfig, layerOptions);
                    else if (key === 'Polygon') return buildPolygon.call(this, layerConfig, layerOptions);
                    else if (key === 'Polyline') return buildPolyline.call(this, layerConfig, layerOptions);
                    else if (key === 'Point') return buildPoint.call(this, layerConfig, layerOptions);
                    else return [];
                });
            const results = await Promise.all(promises);
            layersArr = results.flat();
        } else {
            layersArr =
                type === 'Image'
                    ? await buildImage.call(this, settings, layerOptions)
                    : type === 'Polygon'
                        ? await buildPolygon.call(this, settings, layerOptions)
                        : type === 'Polyline'
                            ? await buildPolyline.call(this, settings, layerOptions)
                            : type === 'Point'
                                ? await buildPoint.call(this, settings, layerOptions)
                                : [];
        }

        settings.metadata = metadata;
        this.addSource(source, type, layerOptions);
        this.addLayers(layersArr, metadata, settings);

        if (hasFeatures) {
            geoflo.Features.addFeatures(features.map(feature => ({ ...feature, source })));
        }

        return new Promise((resolve, reject) => {
            if (error) return resolve(error);
            const ready = setInterval(() => {
                const feats = geoflo.Layers.getFeatures(source);
                if (hasFeatures &amp;&amp; !feats.length) return;
                if (!map.getSource(source)) return;
                clearInterval(ready);
                resolve({ layer: settings, features: feats });
            }, 1);
        });
    }

    async function buildText() {
        return new Promise((resolve, reject) => {
            const url = 'https://docs.mapbox.com/mapbox-gl-js/assets/popup.png';
            if (map.hasImage('text-marker')) return resolve(true);
            map.loadImage(url, (error, image) => {
                if (error) return reject(error);
                if (map.hasImage('text-marker')) return resolve(image);
                map.addImage('text-marker', image, {
                    content: [25, 25, 115, 100],
                    stretchX: [[25, 115]],
                    stretchY: [[25, 100]],
                    pixelRatio: 2,
                    sdf: false
                });
                resolve(image);
            });
        });
    }

    async function buildImage(settings = {}, options = {}) {
        if (!settings.source) return [];
        const layersArr = [];
        const source = settings.source;
        for (const type of settings.types) {
            let style = settings.style;
            const id = settings.id + type;
            let layout = {
                visibility: options.visibility || 'visible',
                'icon-image': ['get', 'primaryImage', ['get', 'style', ['properties']]],
                'icon-size': ['interpolate', ['linear'], ['zoom'], 1, 0.6, 10, 0.8, 15, 1],
                'icon-allow-overlap': true,
                'icon-anchor': 'bottom'
            };
            layout = { ...layout, ...(style.image?.layout || {}) };
            let paint = {
                'icon-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                    ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                        ['get', 'opacity', ['get', 'style', ['properties']]]]]
            };
            paint = { ...paint, ...(style.image?.paint || {}) };
            style = {
                id,
                type: 'symbol',
                source,
                slot: style.slot || 'top',
                filter: settings.filter || ['==', "$type", "Point"],
                layout,
                paint
            };
            if (style.minzoom) style.minzoom = style.minzoom;
            if (style.maxzoom) style.maxzoom = style.maxzoom;
            layersArr.push(style);
        }
        return layersArr;
    }

    async function buildPolygon(settings = {}, options = {}) {
        if (!settings.source) return [];
        const layersArr = [];
        const source = settings.source;
        for (const type of settings.types) {
            let style = settings.style;
            const id = settings.id + type;
            let layout, paint;
            if (type.includes('border')) {
                layout = { visibility: options.visibility || 'visible', ...((style.border &amp;&amp; style.border.layout) || {}) };
                paint = {
                    'line-color': ['get', 'primaryColor', ['get', 'style', ['properties']]],
                    'line-width': ['case', ["boolean", ['has', 'width', ['get', 'style', ['properties']]], true],
                        ['get', 'width', ['get', 'style', ['properties']]], 2],
                    'line-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 0.8],
                    ...((style.border &amp;&amp; style.border.paint) || {})
                };
                style = {
                    id,
                    type: 'line',
                    source,
                    slot: style.slot || 'bottom',
                    filter: (style.border &amp;&amp; style.border.filter) || ['==', "$type", "Polygon"],
                    layout,
                    paint
                };
            } else if (type.includes('fill')) {
                layout = { visibility: options.visibility || 'visible', ...((style.fill &amp;&amp; style.fill.layout) || {}) };
                paint = {
                    'fill-color': ['get', 'secondaryColor', ['get', 'style', ['properties']]],
                    'fill-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 0.5],
                    ...((style.fill &amp;&amp; style.fill.paint) || {})
                };
                style = {
                    id,
                    type: 'fill',
                    source,
                    slot: style.slot || 'bottom',
                    filter: (style.fill &amp;&amp; style.fill.filter) || ['==', "$type", "Polygon"],
                    layout,
                    paint
                };
            }
            if (settings.style.minzoom) style.minzoom = settings.style.minzoom;
            if (settings.style.maxzoom) style.maxzoom = settings.style.maxzoom;
            layersArr.push(style);
        }
        return layersArr;
    }

    async function buildPolyline(settings = {}, options = {}) {
        if (!settings.source) return [];
        const layersArr = [];
        const source = settings.source;
        for (const type of settings.types) {
            let style = settings.style;
            const id = settings.id + type;
            let layout, paint;
            if (type.includes('line')) {
                layout = {
                    visibility: options.visibility || 'visible',
                    'line-miter-limit': 2,
                    'line-join': 'round',
                    'line-cap': 'round',
                    ...((style.line &amp;&amp; style.line.layout) || {})
                };
                paint = {
                    'line-color': ['get', 'primaryColor', ['get', 'style', ['properties']]],
                    'line-width': ['case', ["boolean", ['has', 'width', ['get', 'style', ['properties']]], true],
                        ['get', 'width', ['get', 'style', ['properties']]], 4],
                    'line-offset': ['case', ["boolean", ["has", "offset"], true], ["get", "offset"], 0],
                    'line-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0, 1],
                    ...((style.line &amp;&amp; style.line.paint) || {})
                };
                style = {
                    id,
                    type: 'line',
                    source,
                    slot: style.slot || 'middle',
                    filter: (style.line &amp;&amp; style.line.filter) || ['==', "$type", "LineString"],
                    layout,
                    paint
                };
            }
            if (settings.style.minzoom) style.minzoom = settings.style.minzoom;
            if (settings.style.maxzoom) style.maxzoom = settings.style.maxzoom;
            layersArr.push(style);
        }
        return layersArr;
    }

    async function buildPoint(settings = {}, options = {}) {
        if (!settings.source) return [];
        const layersArr = [];
        const source = settings.source;
        const dontRender = false;

        for (const type of settings.types) {
            let style = settings.style;
            const id = settings.id + type;
            let layout, paint;

            if (type.includes('circle')) {
                if (options.noCircle) continue;
                layout = { visibility: options.visibility || 'visible', ...((style.circle &amp;&amp; style.circle.layout) || {}) };
                paint = {
                    'circle-radius': 10,
                    'circle-stroke-width': 2,
                    'circle-color': ['get', 'secondaryColor', ['get', 'style', ['properties']]],
                    'circle-stroke-color': ['get', 'primaryColor', ['get', 'style', ['properties']]],
                    'circle-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                        ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                            ['get', 'opacity', ['get', 'style', ['properties']]]]],
                    'circle-stroke-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                        ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                            ['get', 'opacity', ['get', 'style', ['properties']]]]],
                    ...((style.circle &amp;&amp; style.circle.paint) || {})
                };
                style = {
                    id,
                    type: 'circle',
                    source,
                    slot: style.slot || 'top',
                    filter: (style.circle &amp;&amp; style.circle.filter) || ['==', "$type", "Point"],
                    layout,
                    paint
                };
                if (type.includes('cluster')) {
                    if (options.noCluster) continue;
                    style.filter = ['has', 'point_count'];
                    style.paint['circle-color'] = options.secondaryColor || geoflo.options.colors.secondaryColor;
                    style.paint['circle-stroke-color'] = options.primaryColor || geoflo.options.colors.primaryColor;
                }
            } else if (type.includes('icon')) {
                if (dontRender) continue;
                layout = {
                    visibility: options.visibility || 'visible',
                    'icon-optional': true,
                    'text-field': ['get', 'primaryIcon', ['get', 'style', ['properties']]],
                    'text-rotate': ['get', 'rotate', ['get', 'style', ['properties']]],
                    'text-rotation-alignment': 'viewport',
                    'text-size': 14,
                    'text-line-height': 1,
                    'text-padding': 0,
                    'text-offset': [0, 0.2],
                    'text-justify': 'auto',
                    'text-anchor': 'center',
                    'text-allow-overlap': true,
                    'text-font': ['Font Awesome 6 Pro Solid'],
                    'text-ignore-placement': true,
                    ...((style.icon &amp;&amp; style.icon.layout) || {})
                };
                paint = {
                    'text-translate-anchor': 'viewport',
                    'text-halo-color': ['get', 'primaryColor', ['get', 'style', ['properties']]],
                    'text-halo-width': 0,
                    'text-color': ['get', 'primaryColor', ['get', 'style', ['properties']]],
                    'text-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                        ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                            ['get', 'opacity', ['get', 'style', ['properties']]]]],
                    ...((style.icon &amp;&amp; style.icon.paint) || {})
                };
                style = {
                    id,
                    type: 'symbol',
                    source,
                    slot: style.slot || 'top',
                    filter: (style.icon &amp;&amp; style.icon.filter) || ['==', "$type", "Point"],
                    layout,
                    paint
                };
                if (type.includes('cluster')) {
                    if (options.noCluster) continue;
                    style.filter = ['has', 'point_count'];
                    style.layout['text-field'] = options.primaryIcon || '';
                    style.paint['text-halo-color'] = options.secondaryColor || geoflo.options.colors.secondaryCold;
                    style.paint['text-color'] = options.primaryColor || geoflo.options.colors.secondaryText;
                } else if (type.includes('count')) {
                    if (options.noCluster) continue;
                    style.filter = ['has', 'point_count'];
                    style.layout = {
                        visibility: options.visibility || 'visible',
                        'icon-optional': true,
                        'text-field': options.countIcon || '',
                        'text-size': { base: 14, stops: [[10, 16], [14, 14]] },
                        'text-line-height': 1,
                        'text-padding': 0,
                        'text-offset': [0.5, -0.6],
                        'text-justify': 'auto',
                        'text-anchor': 'center',
                        'text-allow-overlap': true,
                        'text-font': ['Font Awesome 6 Pro Solid'],
                        'text-ignore-placement': true
                    };
                    style.paint = {
                        'text-translate-anchor': 'viewport',
                        'text-color': options.countIconColor || geoflo.options.colors.primaryText,
                        'text-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                            ['get', 'opacity', ['get', 'style', ['properties']]]]
                    };
                }
            } else if (type.includes('text')) {
                if (dontRender) continue;
                if (type.includes('count')) {
                    if (options.noCluster) continue;
                    layout = {
                        'text-field': ['get', 'point_count_abbreviated'],
                        'text-font': ['DIN Offc Pro Medium', 'Arial Unicode MS Bold'],
                        'text-size': { base: 14, stops: [[10, 14], [14, 12]] },
                        'text-offset': [0.55, -0.9],
                        ...((style.text &amp;&amp; style.text.layout) || {})
                    };
                    paint = {
                        'text-color': options.countTextColor || geoflo.options.colors.secondaryText,
                        'text-opacity': ['case', ["boolean", ["feature-state", "hidden"], true], 0,
                            ['get', 'opacity', ['get', 'style', ['properties']]]],
                        ...((style.text &amp;&amp; style.text.paint) || {})
                    };
                    style = {
                        id,
                        type: 'symbol',
                        source,
                        slot: style.slot || 'top',
                        filter: ['has', 'point_count'],
                        layout,
                        paint
                    };
                }
            }

            if (!style) continue;
            if (settings.style.minzoom) style.minzoom = settings.style.minzoom;
            if (settings.style.maxzoom) style.maxzoom = settings.style.maxzoom;
            layersArr.push(style);
        }

        return layersArr;
    }

    async function addImages(images = []) {
        for (const image of images) {
            if (!image) continue;
            if (!map.hasImage(image.id)) {
                const img = await loadImage(image);
                if (img) map.addImage(image.id, img, { pixelRatio: 2 });
            }
        }
    }

    async function loadImage(options = {}) {
        if (!options.url || !options.id) return false;
        return new Promise((resolve, reject) => {
            const url = options.url + '?' + new Date().getTime();
            map.loadImage(url, (error, image) => error ? reject(error) : resolve(image));
        });
    }

    function loadImageAsDataURL(imageUrl, callback) {
        const img = new Image();
        img.setAttribute('crossOrigin', 'anonymous');
        img.onload = () => {
            const canvas = document.createElement("canvas");
            canvas.width = img.width;
            canvas.height = img.height;
            const ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);
            const dataURL = canvas.toDataURL("image/png");
            callback(dataURL);
        };
        img.src = imageUrl + '?' + new Date().getTime();
    }

    function createSVGMarker(options = {}) {
        const svgNS = "http://www.w3.org/2000/svg";
        const data = options.data;
        const width = options.width;
        const height = options.height;
        const borderWidth = options["stroke-width"] || 5;
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("width", width);
        svg.setAttribute("height", height);
        svg.setAttribute("viewBox", `0 0 ${width + 2 * borderWidth} ${height + 2 * borderWidth}`);
        const marker = document.createElementNS(svgNS, "ellipse");
        marker.setAttribute("cx", (width + 2 * borderWidth) / 2);
        marker.setAttribute("cy", (height + 2 * borderWidth) / 2);
        marker.setAttribute("rx", width / 2);
        marker.setAttribute("ry", height / 2);
        marker.setAttribute("fill", 'transparent');
        marker.setAttribute("stroke", options.stroke || geoflo.getColors().secondaryBackground);
        marker.setAttribute("stroke-width", borderWidth);
        const image = document.createElementNS(svgNS, "image");
        image.setAttributeNS("http://www.w3.org/1999/xlink", "href", data);
        image.setAttribute("x", borderWidth);
        image.setAttribute("y", borderWidth);
        image.setAttribute("width", width);
        image.setAttribute("height", height);
        image.setAttribute("preserveAspectRatio", "xMidYMid slice");
        image.setAttribute("clip-path", "ellipse()");
        svg.appendChild(marker);
        svg.appendChild(image);
        return svg;
    }

    function svgToImage(svgElement, callback) {
        const svgData = new XMLSerializer().serializeToString(svgElement);
        const svgBlob = new Blob([svgData], { type: "image/svg+xml;charset=utf-8" });
        const url = URL.createObjectURL(svgBlob);
        const img = new Image();
        img.onload = () => { URL.revokeObjectURL(url); callback(img); };
        img.src = url;
    }

    function buildEvents(options = {}) {
        const ids = this.getLayerIds();
        if (!ids.length) return;
        ids.forEach(id => {
            if (options.off) {
                map.off('mousemove', id, this.onLayerMouseover);
                map.off('mouseleave', id, this.onLayerMouseout);
            } else if (options.on) {
                map.on('mousemove', id, this.onLayerMouseover);
                map.on('mouseleave', id, this.onLayerMouseout);
            }
        });
    }

    this.init();
};

export default Layers;
</code></pre>
        </article>
    </section>




</div>

<footer>
    <img class="logo" src="https://geoflo.s3.amazonaws.com/logos/logo_full_white.png" style="">
    <div class="footer-text">Solutegrate/GeoFlo © 2025</div>
</footer>
<script>prettyPrint();</script>
<script src="scripts/jquery.min.js"></script>
<script src="scripts/tui-doc.js"></script>
<script src="scripts/linenumber.js"></script>

    <script>
        var id = '_sub'.replace(/"/g, '_');
        var selectedApi = document.getElementById(id); // do not use jquery selector
        var $selectedApi = $(selectedApi);

        $selectedApi.removeClass('hidden');
        $selectedApi.parent().find('.glyphicon').removeClass('glyphicon-plus').addClass('glyphicon-minus');
        showLnbApi();
    </script>

</body>
</html>
