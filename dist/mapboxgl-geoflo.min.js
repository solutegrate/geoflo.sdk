/*! For license information please see mapboxgl-geoflo.min.js.LICENSE.txt */
(()=>{"use strict";var t={805:(t,e,i)=>{i.d(e,{A:()=>n}),t=i.hmd(t);const n=function(e){if(!e)throw new Error("Omnivore is required!");return function(e){if("object"==typeof exports)t.exports=e();else if("function"==typeof define&&i.amdO)define([],e);else{("undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:this).togpx=e()}}((function(){return function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,(function(t){var i=e[s][1][t];return o(i||t)}),u,u.exports,t,e,i,n)}return i[s].exports}for(var r=void 0,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){var n=t("jxon");n.config({attrPrefix:"@"}),e.exports=function(t,e){if("string"==typeof(e=function(t,e){for(var i in t)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}({creator:"togpx",metadata:void 0,featureTitle:function t(e){if(!e)return"";if("object"==typeof e.tags){var i=t(e.tags);if(""!==i)return i}return e.name?e.name:e.ref?e.ref:e.id?e.id:""},featureDescription:function t(e){if(!e)return"";if("object"==typeof e.tags)return t(e.tags);var i="";for(var n in e)"object"!=typeof e[n]&&(i+=n+"="+e[n]+"\n");return i.substr(0,i.length-1)},featureLink:void 0,featureCoordTimes:function(t){return t.properties&&(t.properties.times||t.properties.coordTimes)||null}},e||{})).featureCoordTimes){var i=e.featureCoordTimes;e.featureCoordTimes=function(t){return t.properties[i]}}function o(t,i){e.featureLink&&(t.link={"@href":e.featureLink(i.properties)})}var r={gpx:{"@xmlns":"http://www.topografix.com/GPX/1/1","@xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","@xsi:schemaLocation":"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd","@version":"1.1",metadata:null,wpt:[],trk:[]}};return e.creator&&(r.gpx["@creator"]=e.creator),e.metadata?r.gpx.metadata=e.metadata:delete e.metadata,("FeatureCollection"===t.type?t.features:"Feature"===t.type?[t]:[{type:"Feature",properties:{},geometry:t}]).forEach((function t(i){var n;switch(i.geometry.type){case"Point":case"MultiPoint":var s=i.geometry.coordinates;"Point"==i.geometry.type&&(s=[s]),s.forEach((function(t){n={"@lat":t[1],"@lon":t[0],name:e.featureTitle(i.properties),desc:e.featureDescription(i.properties)},void 0!==t[2]&&(n.ele=t[2]),o(n,i),r.gpx.wpt.push(n)}));break;case"LineString":case"MultiLineString":s=i.geometry.coordinates;var a=e.featureCoordTimes(i);"LineString"==i.geometry.type&&(s=[s]),o(n={name:e.featureTitle(i.properties),desc:e.featureDescription(i.properties)},i),n.trkseg=[],s.forEach((function(t){var e={trkpt:[]};t.forEach((function(t,i){var n={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(n.ele=t[2]),a&&a[i]&&(n.time=a[i]),e.trkpt.push(n)})),n.trkseg.push(e)})),r.gpx.trk.push(n);break;case"Polygon":case"MultiPolygon":o(n={name:e.featureTitle(i.properties),desc:e.featureDescription(i.properties)},i),n.trkseg=[];s=i.geometry.coordinates,a=e.featureCoordTimes(i);"Polygon"==i.geometry.type&&(s=[s]),s.forEach((function(t){t.forEach((function(t){var e={trkpt:[]},i=0;t.forEach((function(t){var n={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(n.ele=t[2]),a&&a[i]&&(n.time=a[i]),i++,e.trkpt.push(n)})),n.trkseg.push(e)}))})),r.gpx.trk.push(n);break;case"GeometryCollection":i.geometry.geometries.forEach((function(e){var n={properties:i.properties,geometry:e};t(n)}))}})),n.stringify(r)}},{jxon:2}],2:[function(t,e,i){var n,o;n=this,o=function(t,e){var i,n={valueKey:"_",attrKey:"$",attrPrefix:"$",lowerCaseTags:!1,trueIsEmpty:!1,autoDate:!1,ignorePrefixedNodes:!1,parseValues:!1},o=[],r=/^\s*$/,s=/^(?:true|false)$/i;return new function(){function a(t){return n.parseValues?r.test(t)?null:s.test(t)?"true"===t.toLowerCase():isFinite(t)?parseFloat(t):n.autoDate&&isFinite(Date.parse(t))?new Date(t):t:t}function c(){}function u(t,e,i,r){var s,l,d=o.length,p=t.hasChildNodes(),h=t.nodeType===t.ELEMENT_NODE&&t.hasAttributes(),f=Boolean(2&e),g=0,m="",y=f?{}:!!n.trueIsEmpty||"";if(p)for(var v,b=0;b<t.childNodes.length;b++)4===(v=t.childNodes.item(b)).nodeType?m+=v.nodeValue:3===v.nodeType?m+=v.nodeValue.trim():1!==v.nodeType||n.ignorePrefixedNodes&&v.prefix||o.push(v);var x,E=o.length,C=a(m);f||!p&&!h||(y=0===e?null===(x=C)?new c:x instanceof Object?x:new x.constructor(x):{});for(var M=d;M<E;M++)s=o[M].nodeName,n.lowerCaseTags&&(s=s.toLowerCase()),l=u(o[M],e,i,r),y.hasOwnProperty(s)?(y[s].constructor!==Array&&(y[s]=[y[s]]),y[s].push(l)):(y[s]=l,g++);if(h){for(var w,L,S=t.attributes.length,T=r?"":n.attrPrefix,F=r?{}:y,O=0;O<S;g++,O++)L=(w=t.attributes.item(O)).name,n.lowerCaseTags&&(L=L.toLowerCase()),F[T+L]=a(w.value.trim());r&&(i&&Object.freeze(F),y[n.attrKey]=F,g-=S-1)}return 3===e||(2===e||1===e&&g>0)&&m?y[n.valueKey]=C:!f&&0===g&&m&&(y=C),i&&(f||g>0)&&Object.freeze(y),o.length=d,y}function l(t,i,o){var r,s,a;if(o.constructor===String||o.constructor===Number||o.constructor===Boolean){if(i.appendChild(t.createTextNode(o.toString())),o===o.valueOf())return}else o.constructor===Date&&i.appendChild(t.createTextNode(o.toISOString()));for(var c in o)if(void 0!==(r=o[c])&&(null===r&&(r={}),!(isFinite(c)||r instanceof Function)))if(c===n.valueKey)null!==r&&!0!==r&&i.appendChild(t.createTextNode(r.constructor===Date?r.toISOString():String(r)));else if(c===n.attrKey)for(var u in r)i.setAttribute(u,r[u]);else if(c===n.attrPrefix+"xmlns")e&&i.setAttribute(c.slice(1),r);else if(c.charAt(0)===n.attrPrefix)i.setAttribute(c.slice(1),r);else if(r.constructor===Array)for(var d in r)r.hasOwnProperty(d)&&(s=(a=r[d]&&r[d][n.attrPrefix+"xmlns"]||i.namespaceURI)?t.createElementNS(a,c):t.createElement(c),l(t,s,r[d]||{}),i.appendChild(s));else s=(a=(r||{})[n.attrPrefix+"xmlns"]||i.namespaceURI)?t.createElementNS(a,c):t.createElement(c),r instanceof Object?l(t,s,r):null===r||!0===r&&n.trueIsEmpty||s.appendChild(t.createTextNode(r.toString())),i.appendChild(s)}this.config=function(e){for(var o in e)n[o]=e[o];n.parserErrorHandler&&(i=new t.DOMParser({errorHandler:n.parserErrorHandler,locator:{}}))},c.prototype.toString=function(){return"null"},c.prototype.valueOf=function(){return null},this.xmlToJs=this.build=function(t,e,i,n){var o=arguments.length>1&&"number"==typeof e?3&e:1;return u(t,o,i||!1,arguments.length>3?n:3===o)},this.jsToXml=this.unbuild=function(e,i,n,o){var r=(t.document&&t.document.implementation||new t.DOMImplementation).createDocument(i||null,n||"",o||null);return l(r,r.documentElement||r,e),r},this.stringToXml=function(e){return i||(i=new t.DOMParser),i.parseFromString(e,"application/xml")},this.xmlToString=function(e){return void 0!==e.xml?e.xml:(new t.XMLSerializer).serializeToString(e)},this.stringToJs=function(t){var e=this.stringToXml(t);return this.xmlToJs(e)},this.jsToString=this.stringify=function(t,e,i,n){return this.xmlToString(this.jsToXml(t,e,i,n))},this.each=function(t,e,i){t instanceof Array?t.forEach(e,i):[t].forEach(e,i)}}},"object"==typeof i?"object"==typeof window&&window.DOMImplementation&&window.XMLSerializer&&window.DOMParser?e.exports=o(window):e.exports=o(t("xmldom"),!0):n.JXON=o(window)},{xmldom:3}],3:[function(t,e,i){},{}]},{},[1])(1)})),function(e){"object"==typeof exports?t.exports=e():"function"==typeof define&&i.amdO?define([],e):("undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:this).tokml=e()}((function(){return function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){if(r)return r(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[s]={exports:{}};e[s][0].call(u.exports,(function(t){return o(e[s][1][t]||t)}),u,u.exports,t,e,i,n)}return i[s].exports}for(var r=void 0,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){function n(t,e){return function(i){if(!i.properties||!l.valid(i.geometry))return"";var n=l.any(i.geometry);if(!n)return"";var o="",a="";if(t.simplestyle){var d=function(t){var e="";return t["marker-symbol"]&&(e=e+"ms"+t["marker-symbol"]),t["marker-color"]&&(e=e+"mc"+t["marker-color"].replace("#","")),t["marker-size"]&&(e=e+"ms"+t["marker-size"]),t.stroke&&(e=e+"s"+t.stroke.replace("#","")),t["stroke-width"]&&(e=e+"sw"+t["stroke-width"].toString().replace(".","")),t["stroke-opacity"]&&(e=e+"mo"+t["stroke-opacity"].toString().replace(".","")),t.fill&&(e=e+"f"+t.fill.replace("#","")),t["fill-opacity"]&&(e=e+"fo"+t["fill-opacity"].toString().replace(".","")),e}(i.style);d&&(l.isPoint(i.geometry)&&function(t){return!!(t["marker-size"]||t["marker-symbol"]||t["marker-color"])}(i.style)?(-1===e.indexOf(d)&&(o=function(t,e){return c("Style",c("IconStyle",c("Icon",c("href",function(t){var e=t["marker-size"]||"medium",i=t["marker-symbol"]?"-"+t["marker-symbol"]:"",n=(t["marker-color"]||"7e7e7e").replace("#","");return"https://api.tiles.mapbox.com/v3/marker/pin-"+e.charAt(0)+i+"+"+n+".png"}(t))))+c("hotSpot","",[["xunits","fraction"],["yunits","fraction"],["x",.5],["y",.5]]),[["id",e]])}(i.style,d),e.push(d)),a=c("styleUrl","#"+d)):(l.isPolygon(i.geometry)||l.isLine(i.geometry))&&function(t){for(var e in t)if({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0}[e])return!0}(i.style)&&(-1===e.indexOf(d)&&(o=function(t,e){var i=c("LineStyle",[c("color",s(t.stroke,t["stroke-opacity"])||"ff555555")+c("width",void 0===t["stroke-width"]?2:t["stroke-width"])]),n="";return(t.fill||t["fill-opacity"])&&(n=c("PolyStyle",[c("color",s(t.fill,t["fill-opacity"])||"88555555")])),c("Style",i+n,[["id",e]])}(i.style,d),e.push(d)),a=c("styleUrl","#"+d)))}return o+c("Placemark",function(t,e){return t[e.name]?c("name",u(t[e.name])):""}(i.properties,t)+function(t,e){return t[e.description]?c("description",u(t[e.description])):""}(i.properties,t)+function(t){return c("ExtendedData",function(t){var e=[];for(var i in t)e.push([i,t[i]]);return e}(t).map(r).join(""))}(i.properties)+function(t,e){return t[e.timestamp]?c("TimeStamp",c("when",u(t[e.timestamp]))):""}(i.properties,t)+n+a)}}function o(t){return t.map((function(t){return t.join(",")})).join(" ")}function r(t){return c("Data",c("value",u(t[1])),[["name",u(t[0])]])}function s(t,e){if("string"!=typeof t)return"";if(3===(t=t.replace("#","").toLowerCase()).length)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];else if(6!==t.length)return"";var i=t[0]+t[1],n=t[2]+t[3],o=t[4]+t[5],r="ff";return"number"==typeof e&&e>=0&&e<=1&&((r=(255*e).toString(16)).indexOf(".")>-1&&(r=r.substr(0,r.indexOf("."))),r.length<2&&(r="0"+r)),r+o+n+i}var a=t("strxml"),c=a.tag,u=a.encode;e.exports=function(t,e){return'<?xml version="1.0" encoding="UTF-8"?>'+c("kml",c("Document",function(t){return void 0!==t.documentName?c("name",t.documentName):""}(e=e||{documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,timestamp:"timestamp"})+function(t){return void 0!==t.documentDescription?c("description",t.documentDescription):""}(e)+function(t,e){if(!t.type)return"";var i=[];switch(t.type){case"FeatureCollection":return t.features?t.features.map(n(e,i)).join(""):"";case"Feature":return n(e,i)(t);default:return n(e,i)({type:"Feature",geometry:t,properties:{}})}}(t,e)),[["xmlns","http://www.opengis.net/kml/2.2"]])};var l={Point:function(t){return c("Point",c("coordinates",t.coordinates.join(",")))},LineString:function(t){return c("LineString",c("coordinates",o(t.coordinates)))},Polygon:function(t){if(!t.coordinates.length)return"";var e=t.coordinates[0],i=t.coordinates.slice(1),n=c("outerBoundaryIs",c("LinearRing",c("coordinates",o(e)))),r=i.map((function(t){return c("innerBoundaryIs",c("LinearRing",c("coordinates",o(t))))})).join("");return c("Polygon",n+r)},MultiPoint:function(t){return t.coordinates.length?c("MultiGeometry",t.coordinates.map((function(t){return l.Point({coordinates:t})})).join("")):""},MultiPolygon:function(t){return t.coordinates.length?c("MultiGeometry",t.coordinates.map((function(t){return l.Polygon({coordinates:t})})).join("")):""},MultiLineString:function(t){return t.coordinates.length?c("MultiGeometry",t.coordinates.map((function(t){return l.LineString({coordinates:t})})).join("")):""},GeometryCollection:function(t){return c("MultiGeometry",t.geometries.map(l.any).join(""))},valid:function(t){return t&&t.type&&(t.coordinates||"GeometryCollection"===t.type&&t.geometries&&t.geometries.every(l.valid))},any:function(t){return l[t.type]?l[t.type](t):""},isPoint:function(t){return"Point"===t.type||"MultiPoint"===t.type},isPolygon:function(t){return"Polygon"===t.type||"MultiPolygon"===t.type},isLine:function(t){return"LineString"===t.type||"MultiLineString"===t.type}}},{strxml:2}],2:[function(t,e,i){function n(t){return t&&t.length?" "+t.map((function(t){return t[0]+'="'+t[1]+'"'})).join(" "):""}e.exports.attr=n,e.exports.tagClose=function(t,e){return"<"+t+n(e)+"/>"},e.exports.tag=function(t,e,i){return"<"+t+n(i)+">"+e+"</"+t+">"},e.exports.encode=function(t){return(null===t?"":t.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},{}]},{},[1])(1)})),e.toGPX=window.togpx,e.toKML=window.tokml,e}(window.omnivore)}},e={};function i(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={id:n,loaded:!1,exports:{}};return t[n](r,r.exports,i),r.loaded=!0,r.exports}i.amdO={},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=function(t){if(!t)throw new Error("MapboxGL is required!");const e=function(t,e,i){const n=window.document.createElement(t);return void 0!==e&&(n.className=e),i&&i.appendChild(n),n};return t.Map.prototype._setupContainer=function(){const t=this._container;t.classList.add("mapboxgl-map");(this._missingCSSCanary=e("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=e("div","mapboxgl-canvas-container",t);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=e("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=e("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","top-center","bottom-left","bottom-right"].forEach((t=>{o[t]=e("div",`mapboxgl-ctrl-${t}`,n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},t}(window.mapboxgl),e=function(t){if(!t)throw new Error("TurfJS is required!");return t}(window.turf);var n=i(805);const o="geoflo",r={developer:"solutegrate",id:o,logo:{full:`https://${o}.s3.amazonaws.com/logos/logo_full_white.png`,icon:`https://${o}.s3.amazonaws.com/logos/logo_icon_white.svg`,fullClass:o+"-logo",iconClass:o+"-icon"},controls:[[{type:"utils",enable:!0,position:"top-center",group:"action",divider:!0,show:!0,buttons:{zoom:!0,refresh:!0,locate:!0}},{type:"modes",enable:!0,group:"control",divider:!0,show:!0,buttons:{select:!0,edit:!0,save:!0}},{type:"options",enable:!0,group:"action",divider:!1,show:!0,buttons:{import:!0,export:!0,clear:!0,undo:!0,redo:!0,cancel:!0}}],[{type:"types",enable:!0,position:"top-center",group:"control",divider:!0,show:!0,buttons:{polyline:!0,polygon:!0,rectangle:!0,circle:!0,text:!0}},{type:"actions",enable:!0,group:"control",divider:!1,show:!0,buttons:{snapping:!0,pinning:!0,routing:!0,exploring:!0,painting:!0}}]],constants:{classes:{PREDEFINED_CONTROL_BASE:"mapboxgl-ctrl",PREDEFINED_CONTROL_GROUP:"mapboxgl-ctrl-group",CONTROL_PREFIX:"mapboxgl-ctrl-",ACTION_BUTTON:o+"-action-btn",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_RECTANGLE:"mapbox-gl-draw_rectangle",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TEXT:"mapbox-gl-draw_text",CONTROL_BUTTON_ICON:"mapbox-gl-draw_icon",CONTROL_BUTTON_CLEAR:o+"-delete-data",CONTROL_BUTTON_DELETE_SNAP:o+"-delete-snap-data",CONTROL_BUTTON_LOCATE:o+"-locate",CONTROL_BUTTON_ZOOM_IN_FEATURES:o+"-zoom-in-features",CONTROL_BUTTON_HIDE_SELECTED:o+"-hide-selected",CONTROL_BUTTON_ADD_FEATURE_TO_GRID:o+"-add-feature-to-grid",CONTROL_BUTTON_CREATE_POLYGON:o+"-create-polygon",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_BUTTON_GROUP_FEATURES:o+"-group-features",CONTROL_BUTTON_UNGROUP_FEATURES:o+"-ungroup-features",CONTROL_BUTTON_DOWNLOAD_WAYS:o+"-download-ways",CONTROL_BUTTON_DOWNLOAD_BUILDINGS:o+"-download-buildings",CONTROL_BUTTON_REFRESH:o+"-refresh",CONTROL_BUTTON_EDIT:o+"-edit",CONTROL_BUTTON_CUT:o+"-cut",CONTROL_BUTTON_SELECT:o+"-select",CONTROL_BUTTON_DOWNLOAD_DATA:o+"-download-data",CONTROL_BUTTON_EXPORT:o+"-export",CONTROL_BUTTON_SAVE_AS_GIST:o+"-save-as-gist",CONTROL_BUTTON_SAVE_AS_GEOJSON:o+"-save-as-geojson",CONTROL_BUTTON_SAVE_AS_KML:o+"-save-as-kml",CONTROL_BUTTON_EXPAND_EDITOR:o+"-expand-editor",CONTROL_BUTTON_IMPORT:o+"-import",CONTROL_BUTTON_FINSIH:o+"-finish",CONTROL_BUTTON_CANCEL:o+"-cancel",CONTROL_BUTTON_UNDO:o+"-undo",CONTROL_BUTTON_REDO:o+"-redo",CONTROL_GROUP:o+"-ctrl-group",DROPDOWN_GROUP:o+"-dropdown-group",DIVIDER:o+"-divider",ACTION_GROUP:o+"-action-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources:{SELECT:o+"-select",SNAP:o+"-snap",ROUTE:o+"-route",HOT:o+"-hot",COLD:o+"-cold",MESH:o+"-mesh",VERTEX:o+"-vertex",HOTTEXT:o+"-text",COLDTEXT:o+"-coldtext",GAMEPAD:o+"-gamepad"},layers:{MESH:o+"-mesh"},cursors:{ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types:{POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes:{FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes:{DRAW:"draw",CUT:"cut",SELECT:"select",DELETE:"delete",EDIT:"edit"},events:{CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions:{MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},meta:{FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates:{ACTIVE:"true",INACTIVE:"false"},LAT_MIN:-90,LAT_RENDERED_MIN:-85,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270,MIN_SEGMENT_LENGTH:1e-6,MIN_DISTANCE:1e-5,CIRCUM:40075017}},s={theme:"dark",controls:{options:!0,modes:!0,utils:!0,types:!0,actions:!0},map:{container:"map",center:[-95.52816680236892,39.56431143986035],zoom:3.5,maxPitch:50,projection:"mercator",hash:!0,extent:[[[-127.3638459,49.6212752],[-73.7295136,49.6212752],[-73.7295136,24.7473201],[-127.3638459,24.7473201],[-127.3638459,49.6212752]]]},keys:{import:"u",export:"d",delete:"Delete",cancel:"Escape",select:"Escape",edit:"Enter",refresh:"q",zoom:"z",locate:"l",snapping:"!",pinning:"@",routing:"#",exploring:"$",painting:"%",LineString:"1",Polygon:"2",Rectangle:"3",Circle:"4",Text:"5",Icon:"6"},commands:[{key:".",modifier:!1,command:function(t,e,i){var n={lngLat:e.map.getCenter()};"draw"===e.currentMode.id?(e.currentMode.handleUp(n),e.currentMode.handleClick(n)):e.currentMode.handleClick(n)}}],units:{Polyline:"feet",Polygon:"acres",Rectangle:"acres",Icon:"feature",Circle:"feature",Marker:"feature"},colors:{error:"#ff7676",primaryColor:"#d7ef7e",primaryBackground:"#5a5a5a",primaryText:"#c5c5c5",primaryBorder:"#6fafdb",secondaryColor:"#6fafdb",secondaryBackground:"#333333",secondaryText:"#333333",secondaryBorder:"#404040",primarySelect:"#333333",primaryEdit:"#d7ef7e",primaryHot:"#d7ef7e",primaryCold:"#6fafdb",primarySnap:"#c5c5c5",primaryBase:"#c5c5c5",primaryDebug:"#ff7676",primaryVertex:"#c5c5c5",secondarySelect:"#d7ef7e",secondaryEdit:"#c5c5c5",secondaryHot:"#333333",secondaryCold:"#c5c5c5",secondarySnap:"#d7ef7e",secondaryBase:"#242424",secondaryDebug:"#d7ef7e",secondaryVertex:"#333333"},select:{popup:!1,multiple:!1},snapping:{enable:!1,pixels:!1,distance:321.8688,tolerance:.002},routing:{enable:!1,precision:15e-7},pinning:{enable:!1,buffer:50/5280*1.609344,idle:20},exploring:{enable:!1,minZoom:12,buffer:1.5240000000000002,tolerance:1e-5},moving:{enable:!1,distance:9144e-7},painting:{enable:!1,tolerance:5e-6}},a=function(t){this.pointInCoordinates=function(t,e){var i=[];return t.geometry.coordinates.forEach((function(n,o){0!==o&&o!==t.geometry.coordinates.length-1&&n[0]===e[0]&&n[1]===e[1]&&i.push(o)})),i},this.sameBorders=function(t,e){return!(!t||!e)&&(t.border1[0]===e.border1[0]&&t.border1[1]===e.border1[1]&&t.border2[0]===e.border2[0]&&t.border2[1]===e.border2[1]||t.border1[0]===e.border2[0]&&t.border1[1]===e.border2[1]&&t.border2[0]===e.border1[0]&&t.border2[1]===e.border1[1])},this.getRandomColor=function(){for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t},this.createRandomStroke=function(){return{stroke:this.getRandomColor()}},this.createLineAndSaveLength=function(t,e){var i=Object.assign({},e,this.createRandomStroke()),n=turf.lineString(t,i);return i.length=turf.lineDistance(n),n},this.lineSplit=function(t,e){var i=t.properties,n=[].concat(c(t.geometry.coordinates)),o=[],r=0;return e.forEach((function(t){if((t-=r)<n.length-1){var e=n.splice(t,n.length-t);n.length>0&&(n.push(e[0]),o.push(this.createLineAndSaveLength(n,i))),n=e,r+=t}}),this),n.length>0&&o.push(this.createLineAndSaveLength(n,i)),o},this.splitLines=function(t,e){var i=[],n=[];if(t.geometry.coordinates.forEach((function(t,o){var r=this.pointInCoordinates(e,t);r.length>0&&(n.push.apply(n,c(r)),i.push(o))}),this),0===i.length&&0===n.length)return null;var o=[];return o.push.apply(o,c(this.lineSplit(t,i))),o.push.apply(o,c(this.lineSplit(e,n))),o},this.createSimpleMesh=function(t){var e=[];return t.forEach((function(t){for(var i=t.properties,n=t.geometry.coordinates,o=n[0],r=null,s=1;s<n.length;s++)r=n[s],e.push(this.createLineAndSaveLength([o,r],i)),o=r}),this),e},this.createMesh=function(t){var e=[];return t.forEach((function(e){var i=e.properties.cutPoints;i||(i=[],e.properties.cutPoints=i),t.forEach((function(t){if(e!==t){var n=t.properties.cutPoints;n||(n=[],t.properties.cutPoints=n),e.geometry.coordinates.forEach((function(o,r){var s=this.pointInCoordinates(t,o);s.length>0&&(s.forEach((function(t){-1===n.indexOf(t)&&n.push(t)})),0!==r&&r!==e.geometry.coordinates.length-1&&-1===i.indexOf(r)&&i.push(r))}),this)}}),this)}),this),t.forEach((function(t){t.properties.cutPoints.sort((function(t,e){return t-e})),e.push.apply(e,c(this.lineSplit(t,t.properties.cutPoints)))}),this),e},this.setProperty=function(t,e,i){if(!t)return!1;var n=t.properties;n||(n={},t.properties=n),e.includes(".")?(n[(e=e.split("."))[0]]||(n[e[0]]={}),n[e[0]][e[1]]=i):n[e]=i},this.setProperties=function(t,e){t.properties=Object.assign(t.properties||{},e)},this.findClosestFeatures=function(t,e,i){var n=t.pointIndex.within(e.lng,e.lat,i),o={},r=[];return n.forEach((function(e){var i=t.pointFeatureMap[e];o[i]||(r.push(t.featureById[i]),o[i]=!0)})),r},this.isPointEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]},this.isPoint=function(t){return!!t&&"Point"===t.geometry.type},this.isPolygon=function(t){var e=t.geometry.coordinates,i=e[0],n=e[e.length-1];return this.isPointEqual(i,n)},this.isLineString=function(t){return!!t&&"LineString"===t.geometry.type},this.isValidLineString=function(t){return!!this.isLineString(t)&&!(t.geometry.coordinates.length<2)},this.isLastIndex=function(t,e){return!!e&&(this.isLineString(e)?t==e.geometry.coordinates.length-1:this.isPolygon(e)?t==e.geometry.coordinates[0].length-1:0==t)},this.getLastIndexCoords=function(t){return this.isLineString(t)?t.geometry.coordinates[t.geometry.coordinates.length-1]:this.isPolygon(t)?t.geometry.coordinates[0][t.geometry.coordinates.length-1]:t.geometry.coordinates},this.isEmptyLineString=function(t){if("LineString"===t.geometry.type){var e=t.geometry.coordinates;if(2===e.length){var i=e[0],n=e[e.length-1];return this.isPointEqual(i,n)}}return!1},this.isPointAtVertex=function(t,e){var i=t[0],n=t[t.length-1];return this.isPointEqual(i,e)||this.isPointEqual(n,e)},this.isPointNotTooClose=function(t,e){var i=turf.lineString([t,e]);return turf.lineDistance(i)>=statics.constants.MIN_DISTANCE&&!(t[0]===e[0]&&t[1]===e[1])},this.isOverlapping=function(t,e){var i=t.geometry.coordinates,n=e.geometry.coordinates;if(2===i.length&&2===n.length){var o=this.createBbox(i),r=this.createBbox(n);return!(o.east<r.west||o.west>r.east)&&!(o.north<r.south||o.south>r.north)}throw new Error("wrong number of coordinates, expected 2")},this.createLineWithLength=function(t){var e=turf.lineString(t),i=turf.lineDistance(e);return this.setProperties(e,{length:i}),e},this.reducePrecision=function(t){return t[0]=Number(Number(t[0]).toFixed(7)),t[1]=Number(Number(t[1]).toFixed(7)),t},this.createBbox=function(t){var e={};return t[0][0]<t[1][0]?(e.west=t[0][0],e.east=t[1][0]):(e.west=t[1][0],e.east=t[0][0]),t[0][1]<t[1][1]?(e.south=t[0][1],e.north=t[1][1]):(e.south=t[1][1],e.north=t[0][1]),e},this.stringToDOM=function(t){return(new DOMParser).parseFromString(t,"text/xml")},this.processFiles=function(t,e){t.forEach((function(t){var i=t.name,n=i.substring(i.lastIndexOf(".")+1,i.length).toLowerCase(),o=new FileReader;o.onloadend=function(){if(o.readyState===FileReader.DONE)try{e(o.result,i,n)}catch(t){}},o.readAsText(t)}))},this.combineSameTypeFeatures=function(t){var e=[];return t.forEach((function(t){if(0===e.length)e.push.apply(e,c(t.geometry.coordinates));else{var i=e[0],n=e[e.length-1],o=t.geometry.coordinates[0],r=t.geometry.coordinates[t.geometry.coordinates.length-1];if(this.isPointEqual(n,o))e.push.apply(e,c(t.geometry.coordinates.slice(1,t.geometry.coordinates.length)));else if(this.isPointEqual(n,r))e.push.apply(e,c(t.geometry.coordinates.slice(0,t.geometry.coordinates.length-1).reverse()));else if(this.isPointEqual(i,r))e.splice.apply(e,[0,0].concat(c(t.geometry.coordinates.slice(0,t.geometry.coordinates.length-1))));else if(this.isPointEqual(i,o))e.splice.apply(e,[0,1].concat(c(t.geometry.coordinates.reverse())));else{turf.distance(n,o)<turf.distance(n,r)?e.push.apply(e,c(t.geometry.coordinates)):e.push.apply(e,c([].concat(c(t.geometry.coordinates)).reverse()))}}}),this),e},this.degrees2meters=function(t){const e=20037508.34*t[0]/180;let i=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return i=20037508.34*i/180,[e,i]},this.meters2degrees=function(t){return[180*t[0]/20037508.34,360*Math.atan(Math.exp(t[1]*Math.PI/20037508.34))/Math.PI-90]},this.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},this.clone=function(t,e){var i={};return t instanceof Array?t.map((function(t){return this.clone(t,e)}),this):t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t):t instanceof Function?e&&e.newFns?new Function("return "+t.toString())():t:t instanceof Object?(Object.keys(t).forEach((function(n){i[n]=this.clone(t[n],e)}),this),i):[void 0,null].indexOf(t)>-1?t:"Symbol"===t.constructor.name?Symbol(t.toString().replace(/^Symbol\(/,"").slice(0,-1)):t.__proto__.constructor(t)},this.cloneDeep=function(t,e){var i=Object.prototype.hasOwnProperty,n=Object.prototype.toString;function o(t,e){switch(a(t)){case"object":return function(t,e){if(r(t)){var n={};return function(t,e,n){s(t,(function(o,r){if(i.call(t,r))return e.call(n,t[r],r,t)}))}(t,(function(t,i){this[i]=o(t,e)}),n),n}return e?e(t):t}(t,e);case"array":return function(t,e){var i=t.length,n=[],r=-1;for(;++r<i;)n[r]=o(t[r],e);return n}(t,e);default:return l(t)}}function r(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)}function s(t,e,i){for(var n in t)if(!1===e.call(i,t[n],n,t))break}function a(t){if(void 0===t)return"undefined";if(null===t)return"null";if(!0===t||!1===t||t instanceof Boolean)return"boolean";if("string"==typeof t||t instanceof String)return"string";if("number"==typeof t||t instanceof Number)return"number";if("function"==typeof t||t instanceof Function)return"function";if(void 0!==Array.isArray&&Array.isArray(t))return"array";if(t instanceof RegExp)return"regexp";if(t instanceof Date)return"date";var e=n.call(t);return"[object RegExp]"===e?"regexp":"[object Date]"===e?"date":"[object Arguments]"===e?"arguments":"[object Error]"===e?"error":c(t)?"buffer":"[object Set]"===e?"set":"[object WeakSet]"===e?"weakset":"[object Map]"===e?"map":"[object WeakMap]"===e?"weakmap":"[object Symbol]"===e?"symbol":"[object Int8Array]"===e?"int8array":"[object Uint8Array]"===e?"uint8array":"[object Uint8ClampedArray]"===e?"uint8clampedarray":"[object Int16Array]"===e?"int16array":"[object Uint16Array]"===e?"uint16array":"[object Int32Array]"===e?"int32array":"[object Uint32Array]"===e?"uint32array":"[object Float32Array]"===e?"float32array":"[object Float64Array]"===e?"float64array":"object"}function c(t){return null!=t&&(function(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&c(t.slice(0,0))}(t)||!!t._isBuffer)}function u(t){return null!=t&&("object"==typeof t||"function"==typeof t)}function l(t){var e=a(t);return l.hasOwnProperty(e)?l[e](t):t}return l.array=function(t){return t.slice()},l.date=function(t){return new Date(+t)},l.object=function(t){return u(t)?function(t,e){if(!u(t))throw new TypeError("mixin-object expects the first argument to be an object.");for(var i=arguments.length,n=0;++n<i;){var o=arguments[n];u(o)&&s(o,copy,t)}return t}({},t):t},l.regexp=function(t){var e="";return e+=t.multiline?"m":"",e+=t.global?"g":"",e+=t.ignorecase?"i":"",new RegExp(t.source,e)},o(t,e)},this.assignDeep=function(t,e,{isMutatingOk:i=!1,isStrictlySafe:n=!1}={}){t=i?t:this.cloneDeep(t);for(const[i,n]of Object.entries(e))null!==n&&"object"==typeof n?(void 0===t[i]&&(t[i]={}),t[i]=this.assignDeep(t[i],n,{isMutatingOk:!0})):t[i]=n;return t},this.compareDeep=function(){var t,e,i,n;function o(t,e){var r;if(isNaN(t)&&isNaN(e)&&"number"==typeof t&&"number"==typeof e)return!0;if(t===e)return!0;if("function"==typeof t&&"function"==typeof e||t instanceof Date&&e instanceof Date||t instanceof RegExp&&e instanceof RegExp||t instanceof String&&e instanceof String||t instanceof Number&&e instanceof Number)return t.toString()===e.toString();if(!(t instanceof Object&&e instanceof Object))return!1;if(t.isPrototypeOf(e)||e.isPrototypeOf(t))return!1;if(t.constructor!==e.constructor)return!1;if(t.prototype!==e.prototype)return!1;if(i.indexOf(t)>-1||n.indexOf(e)>-1)return!1;for(r in e){if(e.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(typeof e[r]!=typeof t[r])return!1}for(r in t){if(e.hasOwnProperty(r)!==t.hasOwnProperty(r))return!1;if(typeof e[r]!=typeof t[r])return!1;switch(typeof t[r]){case"object":case"function":if(i.push(t),n.push(e),!o(t[r],e[r]))return!1;i.pop(),n.pop();break;default:if(t[r]!==e[r])return!1}}return!0}if(arguments.length<1)return!0;for(t=1,e=arguments.length;t<e;t++)if(i=[],n=[],!o(arguments[0],arguments[t]))return!1;return!0},this.consumableArray=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}};function c(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}const u=function(t,e){this.init=function(e={}){return this.options=t.Utilities.extend({},e),this.mapbox=new t.Mapbox.Map(this.options),this.sdk=!(!window.mapboxSdk||!this.options.sdkToken)&&window.mapboxSdk({accessToken:this.options.sdkToken}),this.viewport=document.createElement("div"),this.viewportHeightOffset=110,this.viewportWidthOffset=20,this.viewportLeft="10px",this.viewportBottom="5%",this.mapbox.on("load",this.onLoad.bind(this)),this},this.getMap=function(){return this.map},this.getContainer=function(){return this.container},this.getViewport=function(){return this.viewport},this.setStyle=function(t){return!!t&&(this.map.setStyle(t,{}),this.map.getStyle())},this.setExtent=function(e,i,n={}){var o=!e||!e.length,r=n.center;if(!r&&n.isPoint&&(r=!0),i?(this.preventDefault=!0,e=this.options.extent?[turf.polygon(this.options.extent)]:[]):o&&(e=t.getRenderedDrawnFeatures()),!e)return this.map.jumpTo({bearing:this.options.bearing||this.map.getBearing(),center:this.options.center||this.map.getCenter(),zoom:this.options.zoom||this.map.getZoom(),pitch:this.options.pitch||this.map.getPitch()});var s=turf.bbox(turf.featureCollection(e)),a=turf.bboxPolygon(s),c=turf.centroid(a),u={lat:c.geometry.coordinates[1],lng:c.geometry.coordinates[0]};return this.setViewport(),r?u&&u.lng&&this.map.jumpTo({center:u}):this.map.fitBounds(s),t.fire("features.zoom",{features:e,center:this.map.getCenter(),bbox:s}),this.map},this.setViewport=function(e){var i=e||{position:"absolute",margin:"auto",top:"",left:this.viewportLeft,bottom:this.viewportBottom};this.map.resize();var n=this.container.getBoundingClientRect().height,o=this.container.getBoundingClientRect().width;return i.height=Number.parseInt(n)-this.viewportHeightOffset+"px",i.width=Number.parseInt(o)-this.viewportWidthOffset+"px",t.Utilities.extend(this.viewport.style,i),this.setPadding(),this.viewport},this.setOptions=function(t){(t=t||this.options).maxPitch&&this.map.setMaxPitch(t.maxPitch),t.maxZoom&&this.map.setMaxZoom(t.maxZoom),t.minPitch&&this.map.setMinPitch(t.minPitch),t.minZoom&&this.map.setMinZoom(t.minZoom)},this.setPadding=function(){var t=this.container.getBoundingClientRect().left-this.viewport.getBoundingClientRect().left,e=this.container.getBoundingClientRect().right-this.viewport.getBoundingClientRect().right,i=this.container.getBoundingClientRect().top-this.viewport.getBoundingClientRect().top,n=this.container.getBoundingClientRect().bottom-this.viewport.getBoundingClientRect().bottom,o=this.container.getBoundingClientRect().width<20;return this.padding={left:o?0:Math.abs(t),right:o?0:Math.abs(e),top:o?0:Math.abs(i),bottom:o?0:Math.abs(n)},this.map.setPadding(this.padding),this.padding},this.onEvent=function(t){},this.onLoad=function(e){if(!e.target||!e.target.getContainer)throw new Error("MapboxGL map object is required!");return this.map=e.target,this.container=this.map._container,this.container.insertBefore(this.viewport,this.container.firstChild),this.setOptions(),this.map.off("style.load",this.onStyleLoad.bind(this)),this.map.on("style.load",this.onStyleLoad.bind(this)),t.load()},this.onStyleLoad=function(e){this.map.style&&this.map.style.glyphManager&&this.map.style.glyphManager.setURL(`mapbox://fonts/${t.dev}/{fontstack}/{range}.pbf`,t.dev),setTimeout((function(){t.redraw()}),500)},this.onMapMove=function(t){},this.init(e)},l=function(t){if(!t.map)throw new Error("No map object provided!");const e=this,i=t.map,n=t.id,o=t.statics,r={Polygon:["-fill","-border"],Polyline:["-line","-dash","-buffer"],Point:["-circle","-icon","-cluster-circle","-cluster-icon","-count-icon","-count-text"]};async function s(t=[],e={}){if(!t.length)return!1;for(const i of t)await a.call(this,i,e);return this.moveLayers(),this.getLayers()}async function a(e,i){var n,o=e.details||{},s=e.options||{},a=e.features||[],d=a&&a.length;o.id&&o.type||(n=!0);const h=this.getType(o.type);h||(n=!0);var f={};o.default?f.default=!0:f.custom=!0,o.name&&(f.name=o.name);var g=o.source||o.id;f.source=g;var m="Polygon"===h?c.call(this,g,o,r[h],s):"Polyline"===h?u.call(this,g,o,r[h],s):"Point"===h?l.call(this,g,o,r[h],s):[];return this.removeLayers(m),this.removeSource(g),this.addSource(g,h,s),this.addLayers(m,f),p.call(this,{layer:o.id,source:g}),this._layers.push({id:o.id,details:o,options:s}),this._sources.push({id:g,type:h,options:s}),d&&t.Features.addFeatures(a),new Promise((async function(i,o){if(n)return i(n);var r=setInterval((function(){var n=t.Layers.getFeatures(g);if(!d||n.length)return clearInterval(r),i({layer:e,features:n})}),1)}))}function c(t,e,i,n={}){if(!t)return[];var o=[];return i.forEach((function(i){var r,s=e.id+i;i.includes("border")?r={id:s,type:"line",slot:n.slot||"middle",source:t,filter:["==","$type","Polygon"],layout:{visibility:n.visibility||"visible"},paint:{"line-color":["get","primaryColor",["get","style",["properties"]]],"line-width":["case",["boolean",["has","width",["get","style",["properties"]]],!0],["get","width",["get","style",["properties"]]],2],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.8]}}:i.includes("fill")&&(r={id:s,type:"fill",source:t,filter:["==","$type","Polygon"],layout:{visibility:n.visibility||"visible"},paint:{"fill-color":["get","secondaryColor",["get","style",["properties"]]],"fill-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.5]}}),r&&o.push(r)}),this),o}function u(t,e,i,n={}){if(!t)return[];var o=[];return i.forEach((function(i){var r,s=e.id+i;i.includes("line")&&(r={id:s,type:"line",slot:n.slot||"middle",source:t,filter:["==","$type","LineString"],layout:{visibility:n.visibility||"visible","line-miter-limit":2,"line-join":"round","line-cap":"round"},paint:{"line-color":["get","primaryColor",["get","style",["properties"]]],"line-width":["case",["boolean",["has","width",["get","style",["properties"]]],!0],["get","width",["get","style",["properties"]]],4],"line-offset":["case",["boolean",["has","offset"],!0],["get","offset"],0],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}}),r&&o.push(r)}),this),o}function l(e,n,o,r={}){if(!e)return[];var s=[],a=i.getStyle(),c=a.imports&&a.imports.length;return o.forEach((function(i){var o,a=n.id+i;i.includes("circle")?(o={id:a,type:"circle",source:e,filter:["==","$type","Point"],layout:{visibility:r.visibility},paint:{"circle-radius":{base:12,stops:[[10,12],[14,10]]},"circle-stroke-width":1,"circle-color":["get","secondaryColor",["get","style",["properties"]]],"circle-stroke-color":["get","primaryColor",["get","style",["properties"]]],"circle-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1],"circle-stroke-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},i.includes("cluster")&&(o.filter=["has","point_count"],o.paint["circle-color"]=r.secondaryColor||t.options.colors.secondaryColor,o.paint["circle-stroke-color"]=r.primaryColor||t.options.colors.primaryColor)):!c&&i.includes("icon")?(o={id:a,type:"symbol",source:e,filter:["==","$type","Point"],layout:{visibility:r.visibility,"icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":["get","primaryColor",["get","style",["properties"]]],"text-halo-width":0,"text-color":t.options.colors.secondaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},i.includes("cluster")?(o.filter=["has","point_count"],o.layout["text-field"]=r.primaryIcon||"",o.paint["text-halo-color"]=r.secondaryColor||t.options.colors.secondaryCold,o.paint["text-color"]=r.primaryColor||t.options.colors.secondaryText):i.includes("count")&&(o.filter=["has","point_count"],o.layout={visibility:r.visibility,"icon-optional":!0,"text-field":r.countIcon||"","text-size":{base:14,stops:[[10,16],[14,14]]},"text-line-height":1,"text-padding":0,"text-offset":[.5,-.6],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},o.paint={"text-translate-anchor":"viewport","text-color":r.countIconColor||t.options.colors.primaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]})):!c&&i.includes("text")&&i.includes("count")&&(o={id:a,type:"symbol",source:e,filter:["has","point_count"],layout:{"text-field":["get","point_count_abbreviated"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":{base:14,stops:[[10,14],[14,12]]},"text-offset":[.55,-.9]},paint:{"text-color":r.countTextColor||t.options.colors.secondaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}}),o&&s.push(o)}),this),s}function d(t={}){var e=this.getLayerIds();e.length&&(t.off?(i.off("mousemove",e,this.onLayerMouseover),i.off("mouseleave",e,this.onLayerMouseout)):t.on?(i.on("mousemove",e,this.onLayerMouseover),i.on("mouseleave",e,this.onLayerMouseout)):t||(d({off:!0}),d({on:!0})))}function p(t){if(!t)return!1;var e=this._layers.findIndex((e=>e.id===t.layer)),i=this._sources.findIndex((e=>e.id===t.source));-1!==e&&this._layers.splice(e,1),-1!==i&&this._sources.splice(i,1)}this.sources=[],this.layers=[],this._layers=[],this._sources=[],this.defaultLayers=[{source:o.constants.sources.COLD,id:n+"-fill-cold",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":t.options.colors.secondaryCold,"fill-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.3]}},{source:o.constants.sources.COLD,id:n+"-line-cold",type:"line",layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":t.options.colors.primaryCold,"line-width":4,"line-gap-width":["match",["get","type"],"Polygon",0,0],"line-offset":["case",["boolean",["has","offset"],!0],["get","offset"],0],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:o.constants.sources.COLD,id:n+"-circle-cold",filter:["all",["==",["get","type"],"Circle"],["!=",["geometry-type"],"Polygon"]],type:"circle",paint:{"circle-radius":{base:6,stops:[[10,6],[14,10]]},"circle-stroke-width":1,"circle-color":t.options.colors.primaryCold,"circle-stroke-color":t.options.colors.secondaryCold,"circle-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1],"circle-stroke-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:o.constants.sources.COLD,id:n+"-icon-cold",type:"symbol",filter:["==",["get","type"],"Icon"],layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-width":0,"text-halo-color":t.options.colors.primaryCold,"text-color":t.options.colors.secondaryBackground,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:o.constants.sources.COLD,id:n+"-text-cold",type:"symbol",filter:["==","$type","Point"],layout:{"symbol-placement":"point","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-size":18,"text-justify":["get","justify"],"text-letter-spacing":.05,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,0],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":t.options.colors.primaryCold,"text-halo-color":t.options.colors.primaryText,"text-halo-width":.5,"text-opacity":1,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{id:o.constants.layers.MESH+"-line",source:o.constants.sources.MESH,type:"line",paint:{"line-color":t.options.colors.primaryBase,"line-width":2,"line-opacity":.3}},{id:o.constants.layers.MESH+"-circle",source:o.constants.sources.MESH,type:"circle",paint:{"circle-radius":2,"circle-color":t.options.colors.primaryBase,"circle-opacity":.3}},{source:o.constants.sources.HOT,id:n+"-fill-hot",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":t.options.colors.secondaryHot,"fill-opacity":["case",["boolean",["has","new"],!0],.5,.1]}},{source:o.constants.sources.HOT,id:n+"-line-hot",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.primaryHot,"line-width":4,"line-dasharray":[1,2]}},{source:o.constants.sources.HOT,id:n+"-point-hot",filter:["==","$type","Point"],type:"circle",paint:{"circle-radius":["match",["get","type"],"Circle",8,4],"circle-stroke-width":1,"circle-color":t.options.colors.primaryHot,"circle-stroke-color":t.options.colors.secondaryHot}},{source:o.constants.sources.HOT,id:n+"-icon-hot",filter:["==",["get","type"],"Icon"],type:"symbol",layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":t.options.colors.primaryHot,"text-halo-width":0,"text-color":t.options.colors.secondaryHot}},{source:o.constants.sources.HOTTEXT,id:n+"-text-hot",type:"symbol",layout:{"symbol-placement":"point","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-anchor":["get","anchor"],"text-size":14,"text-justify":["get","justify"],"text-letter-spacing":0,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,0],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":t.options.colors.primaryText,"text-halo-color":t.options.colors.primaryBackground,"text-halo-width":0,"text-opacity":1}},{source:o.constants.sources.SNAP,id:n+"-point-snap",type:"circle",filter:["==","$type","Point"],paint:{"circle-radius":["match",["get","type"],"Circle",6,"Icon",0,6],"circle-stroke-width":2,"circle-color":t.options.colors.primarySnap,"circle-stroke-color":t.options.colors.secondarySnap}},{source:o.constants.sources.SNAP,id:n+"-icon-snap",type:"symbol",filter:["==",["get","type"],"Icon"],layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:18,stops:[[10,18],[14,16]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":t.options.colors.primarySnap,"text-halo-width":0,"text-color":t.options.colors.secondarySnap}},{source:o.constants.sources.SNAP,id:n+"-line-snap",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.secondarySnap,"line-width":4,"line-dasharray":[1,2]}},{source:o.constants.sources.ROUTE,id:n+"-line-route",type:"line",filter:["==","$type","LineString"],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.error,"line-width":4,"line-dasharray":[]}},{source:o.constants.sources.SELECT,id:n+"-line-select",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.secondarySelect,"line-width":4}},{source:o.constants.sources.SELECT,id:n+"-fill-select",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":t.options.colors.primarySelect,"fill-opacity":.4}},{source:o.constants.sources.SELECT,id:n+"-point-select",filter:["all",["!=",["get","type"],"Text"],["!=",["get","type"],"Icon"],["==",["geometry-type"],"Point"]],type:"circle",paint:{"circle-radius":{base:6,stops:[[10,6],[14,10]]},"circle-stroke-width":2,"circle-color":t.options.colors.secondarySelect,"circle-stroke-color":t.options.colors.primarySelect}},{source:o.constants.sources.SELECT,id:n+"-symbol-select",filter:["==",["get","type"],"Icon"],type:"symbol",layout:{"icon-optional":!0,"text-field":["get","secondaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":t.options.colors.primaryBackground,"text-halo-width":0,"text-color":t.options.colors.secondarySelect}},{source:o.constants.sources.SELECT,id:n+"-text-select",filter:["==",["get","type"],"Text"],type:"symbol",layout:{"symbol-placement":"point","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-size":18,"text-justify":["get","justify"],"text-letter-spacing":.05,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,0],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":t.options.colors.secondarySelect,"text-halo-color":t.options.colors.secondaryText,"text-halo-width":.5,"text-opacity":1}},{source:o.constants.sources.VERTEX,id:n+"-point-vertex",type:"circle",filter:["==","$type","LineString"],paint:{"circle-radius":4,"circle-stroke-width":3,"circle-color":t.options.colors.primaryVertex,"circle-stroke-color":t.options.colors.secondaryVertex}},{source:o.constants.sources.GAMEPAD,id:n+"-gamepad",type:"symbol",layout:{"icon-image":"gamepad","icon-size":.25}}],this.init=function(t={}){return this.options=t,this.refresh()},this.refresh=async function(e={}){var i=t.Utilities.cloneDeep(this._layers);return this._layers=[],this._sources=[],this.removeEventListeners(),this.removeLayers(this.defaultLayers),this.removeSources(Object.values(t.statics.constants.sources)),this.addEventListeners(),this.addSources(Object.values(t.statics.constants.sources)),this.addLayers(this.defaultLayers,this.options),await s.call(this,i),setTimeout((function(){t.Layers.moveLayers(),t.zoomToFeatures(t.getRenderedDrawnFeatures())}),250),this.getLayers()},this.setCustomLayers=async function(t,e){if(!t)return[];return await s.call(this,t,e)},this.getCustomLayers=function(){return this._layers},this.hasCustomLayers=function(){return this.getCustomLayers().length},this.getFeatures=function(t){var e=this.getSource(t);return e&&e._data?e._data.features:[]},this.getSelection=function(t=[],i){var n=!(!t||!t.length)&&t[0];return!!n&&(!n.properties.cluster||(e.onClusterClick(n,i),!1))},this.getType=function(t){return"Polygon"===t||"Rectangle"===t?"Polygon":"Polyline"===t||"LineString"===t||"Line"===t?"Polyline":("Point"===t||"Circle"===t||"Marker"===t||"Icon"===t||"Text"===t)&&"Point"},this.getSources=function(){return this.sources},this.getSource=function(t){return!!t&&this.getSources().find((function(e){return e.id===t}))},this.getSourceIds=function(){return this.getSources().map((function(t){return t.id}))},this.getLayers=function(){return this.layers},this.getLayer=function(t){if(!t)return!1;var e=this.getLayers(),i=e.find((function(e){return e.id===t}));return i||(i=e.filter((function(e){return e.source===t}))),i},this.getLayerIds=function(t){return(t||this.getLayers()).map((function(t){return t.id}))},this.addSources=function(e=[],i={}){return e.forEach((function(t){this.addSource(t,!1,i)}),this),t.fire("sources.add",{sources:this.getSources()}),this.getSources()},this.addSource=function(e,n,o={}){if(!e)throw new Error("No source was provided!");var r={type:o.type||"geojson",data:turf.featureCollection(o.features||[]),promoteId:o.promoteId||"id"};return n&&"Point"===n&&(r=Object.assign(r,{cluster:!0,clusterMaxZoom:o.clusterMaxZoom||14,clusterRadius:o.clusterRadius||50})),i.addSource(e,r),this.sources.push(i.getSource(e)),t.fire("source.add",{id:e,source:this.getSource(e)}),this.getSource(e)},this.addLayers=function(e=[],i={}){return e.forEach((function(t){this.addLayer(t,i)}),this),t.fire("layers.add",{layers:this.getLayers()}),d.call(this),this.getLayers()},this.addLayer=function(e,n={}){return!(!e||!e.id)&&(e.metadata=n,i.addLayer(e),(e=i.getLayer(e.id))?(this.layers.push(e),t.fire("layer.add",{id:e.id,layer:this.getLayer(e.id)}),this.getLayer(e.id)):void 0)},this.removeSources=function(e){(e=e||this.getSourceIds()).forEach((function(t){this.removeSource(t)}),this),t.fire("sources.remove",{removed:!0})},this.removeSource=function(e){if(!e)return!1;i.getSource(e)&&i.removeSource(e);var n;return(n=this.sources.findIndex((function(t){return t.id===e})))>-1&&this.sources.splice(n,1),t.fire("source.remove",{removed:e}),e},this.removeLayers=function(e){var i=this.getLayerIds(e);return i.forEach((function(t){this.removeLayer(t)}),this),t.fire("layers.remove",{removed:i}),i},this.removeLayer=function(e){if(!e)return!1;i.getLayer(e)&&i.removeLayer(e);var n;return(n=this.layers.findIndex((function(t){return t.id===e})))>-1&&this.layers.splice(n,1),t.fire("layer.remove",{removed:e}),e},this.moveLayers=function(e){(e=e||this.defaultLayers).forEach((function(e){t.map.moveLayer(e.id)}))},this.addEventListeners=function(t={}){return d.call(this,{on:!0})},this.removeEventListeners=function(t={}){return d.call(this,{off:!0})},this.onClusterClick=function(t){if(!t.source)return!1;i.getSource(t.source).getClusterExpansionZoom(t.properties.cluster_id,(function(e,n){e||i.easeTo({center:t.geometry.coordinates,zoom:n+2})}))},this.onLayerMouseover=function(t){},this.onLayerMouseout=function(t){},this.init()},d=function(t){if(!t.map)throw new Error("No map object provided!");const e=[];function i(i){var n=e.find((t=>t.id===i||t.properties.id===i));return n=n||t.getSelectedFeatures().find((t=>t.id===i||t.properties.id===i))}function n(i=[]){var n={},o=[];return t.map.getSource(t.statics.constants.sources.COLDTEXT).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.COLD).setData(turf.featureCollection([])),e.forEach((t=>{delete t.properties.new,delete t.properties.offset;var e=t.source;if(!i.length||i.includes(e)){if(!e)return o.push(t);n[e]||(n[e]=[]),n[e].push(t)}})),Object.entries(n).forEach((e=>{var i=e[0],n=e[1];if(!t.map.getSource(i))return o.push(n);r(n,i)})),r(o.flat(),t.statics.constants.sources.COLD),setTimeout((()=>{this.setFeaturesState(e,{hidden:!1})}),100),t.fire("features.update",{features:e}),n=null,o=null,e}function o(e){(e=t.Utilities.cloneDeep(e)).properties.type=this.currentType;var i=turf.point(e.geometry.coordinates[1]),n=this.getUnits(e),o="feet";return n=this.convertUnits(e,n,o),i.properties.units=n,i.properties.unit=o,i.properties.text=`${n} ${o}`,i.properties.transform="uppercase",i.properties.anchor="bottom-left",this.textFeatures.push(i),i}function r(e,i){if(!e||!e.length||!i)return!1;if(!t.options.offsetOverlappingLines)return t.map.getSource(i).setData(turf.featureCollection(e));var n=new t.Mesh(e,!0),o=n.getFeatures();o.forEach((function(n){var r=e.find((function(t){return t.id===n.parent}));r&&(n.source=i,n.properties.style=r.properties.style||n.properties.style,function(e,i){if(!t.options.offsetOverlappingLines)return!1;if(!s(i))return!1;if(i.properties.offset)return!1;var n=6,o=[];e.forEach((function(t){return!!s(t)&&(t.parent!==i.parent&&(!t.properties.offset&&(!(!turf.booleanOverlap(t,i)&&!turf.booleanWithin(t,i))&&void o.push(t))))}),this),o.forEach((function(t){t.properties.offset=n,n*=2}),this)}(o,n))})),t.map.getSource(i).setData(turf.featureCollection(o)),t.fire("features.offset",{features:e,offset:o,source:i}),n=null,o=null}function s(t){return!!t&&"LineString"===turf.getType(t)}this.offsetLines=this.getColdFeatures=function(){return e},this.getFeatureById=function(t){return Array.isArray(t)&&t.length>1?this.getFeaturesById(t):("object"==typeof t&&(t=t.parent||t.properties.parent||t.id||t.properties.id),i(t))},this.getFeaturesById=function(t){const e=[],i=[];return t.forEach((t=>{const n=this.getFeatureById(t);n&&!e.includes(t)&&(e.push(t),i.push(n))}),this),i},this.getType=function(t){return function(t){return t?function(t){return!!t&&("Polygon"===turf.getType(t)&&"Rectangle"===t.properties.type)}(t)?"Rectangle":function(t){return!!t&&("Polygon"===turf.getType(t)||"Polygon"===t.properties.type)}(t)?"Polygon":s(t)?"Polyline":function(t){return!!t&&("Point"===turf.getType(t)&&"Text"===t.properties.type)}(t)?"Text":function(t){return!!t&&("Point"===turf.getType(t)&&"Text"===t.properties.type)}(t)?"Icon":function(t){return!!t&&(!("Point"!==turf.getType(t)||t.properties.type&&"Circle"!==t.properties.type)||"Point"===turf.getType(t)&&"Text"!==t.properties.type&&"Icon"!==t.properties.type)}(t)?"Circle":null:null}(t)},this.getUnit=function(e){if(!e)return!1;var i=e.properties.type;return!!i&&(!(!t.options.units||!t.options.units[i])&&t.options.units[i])},this.getUnits=function(t){if(!this.getUnit(t)||!t)return!1;var e=1,i=t.properties.type;return"Polyline"===i?e=turf.length(t,{units:"meters"}):("Polygon"===i||"Rectangle"===i)&&(e=turf.area(t)),e},this.setFeaturesState=function(e=[],i){return i&&e.length?(e.forEach((function(e){var n=e.id||e.properties.id;t.hotFeature&&t.hotFeature.id===n||this.setFeatureState(n,i)}),this),e):[]},this.setFeatureState=function(e,n){if(!n||!e)return!1;var o=function(e){var n="object"==typeof e&&e.id?e:i(e);if(!n||!n.source)return[];var o=t.options.offsetOverlappingLines?"parent":"id",r=t.map.getSource(n.source)._data.features.filter((function(t){return t[o]===e||t.properties[o]===e}));return r}(e);return o.forEach((function(e){var i=e.id||e.properties.id;t.map.setFeatureState({source:e.source,id:i},n)})),o},this.setText=function(e){var i=t.statics.constants.sources.HOTTEXT;return this.textFeatures=[],t.map.getSource(i).setData(turf.featureCollection(this.textFeatures)),!!e&&(e.features&&(e=e.features),Array.isArray(e)||(e=[e]),!!e.length&&(e.forEach((function(e){var i=e.properties.type;i&&(this.currentType=i,"Polyline"===i&&t.Utilities.isValidLineString(e)&&turf.segmentEach(e,o.bind(this)))}),this),t.map.getSource(i).setData(turf.featureCollection(this.textFeatures)),delete this.textFeatures,void delete this.currentType))},this.addFeature=function(e,i={}){return!(!e||!e.properties)&&(e=turf.cleanCoords(e),(e=turf.truncate(e,{precision:6,coordinates:3,mutate:!0})).properties=t.Utilities.assignDeep(i,e.properties),e.source=e.source||e.properties.source||t.statics.constants.sources.COLD,delete e.properties.source,delete e.properties.painting,delete e.properties.edit,delete e.properties.new,delete e.properties.selected,delete e.properties.hidden,delete e.properties.offset,e.properties.style=e.properties.style||{},this.addUnits(e),this.addFeatures([e]),e)},this.addFeatures=function(t,i){var n,o=[];return t.forEach((t=>{t.id=t.id||t.properties.id||URL.createObjectURL(new Blob([])).slice(-36),t.properties.id=t.id,t.properties.type=t.properties.type||this.getType(t);var r=e.findIndex((function(e){if(e.id===t.id||e.properties.id===t.id)return e}));r>-1?(this.setFeatureState(t.id,{hidden:!i}),e[r]=t,n=!i):(n=!0,e.push(t)),n&&!o.includes(t.source)&&o.push(t.source)}),this),n&&this.updateSource(o),t},this.addUnits=function(t,e){var i=e||this.getUnit(t);if(!i)return!1;var n=this.convertUnits(t,null,e);return t.geometry.units=n,t.geometry.unit=i,t},this.updateFeatures=function(t,e){if(!e)return!1;var i=[];t.forEach((function(t){var n=t.id||t.properties.id;if(!n)return!1;var o=this.getFeatureById(n);if(!o||void 0===o)return!1;i.includes(o.source)||i.push(o.source),"Point"===o.geometry.type?o.geometry.coordinates=e:"Polygon"===o.geometry.type?o.geometry.coordinates[0][t.index]=e:"LineString"===o.geometry.type&&(o.geometry.coordinates[t.index]=e),this.addUnits(o)}),this),this.updateSource(i)},this.updateSource=function(t){return n.call(this,t)},this.removeFeatures=function(t,i){const n=[];var o,r;return Array.isArray(t)&&i?(r=t.map((function(t){return t.details?t.details.id:t.id?t.id:t})),e.forEach((t=>{if(r.includes(t.source)){var i=e.findIndex((e=>t.id===e.id||t.properties.id===e.id));i>-1&&n.push(...e.splice(i,1))}})),this.updateSource(r)):(o=i?e.findIndex((e=>e.id===t||e.properties.id===t)):e.find((e=>e.id===t||e.properties.id===t)),i?(o>-1&&(n.push(...e.splice(o,1)),r=[n[0].source]),this.updateSource(r)):(n.push(o),this.setFeatureState(t,{hidden:!0}))),n},this.deleteFeatures=function(){e.splice(0,e.length),this.updateSource()},this.convertUnits=function(t,e,i){var n=t.properties.type,o=i||this.getUnit(t);return e=e||this.getUnits(t),"Polyline"===n?e=Math.round(turf.convertLength(e,"meters",o)):("Polygon"===n||"Rectangle"===n)&&(e=Math.round(turf.convertArea(e,"meters",o))),e=e?Number(e.toFixed(2)):0}},p=function(t,e){var i=1,n=[],o={};const r=this.geoflo;function s(t,e){return!o[i]&&!h(i)&&(o[i]=t,t.id=i,t.parent=e,r.Utilities.setProperty(t,"id",i),r.Utilities.setProperty(t,"parent",e),i++,!0)}function a(t,e,i){for(var n=turf.truncate(turf.point(t[0]),{precision:7,coordinates:2,mutate:!0}),o=null,a=1;a<t.length;a++){if(o=turf.truncate(turf.point(t[a]),{precision:7,coordinates:2,mutate:!0}),!r.Utilities.isPointEqual(n.geometry.coordinates,o.geometry.coordinates)){var c=turf.lineString([n.geometry.coordinates,o.geometry.coordinates]);s(c,i)&&e.push(c)}n=o}}function c(t){var i=[];return t&&t.length?(t.forEach((function(t){var n=t.geometry.type,o=t.parent||t.properties.parent||t.id||t.properties.id;if(e&&"LineString"!==n&&!t.properties.unfill)return!!s(t=r.Utilities.cloneDeep(t),o)&&i.push(t);"MultiPolygon"===n?t.geometry.coordinates.forEach((function(t){t.forEach((function(t){a(t,i,o)}))})):"Polygon"===n||"MultiLineString"===n?t.geometry.coordinates.forEach((function(t){a(t,i,o)})):"LineString"===n?a(t.geometry.coordinates,i,o):"Point"===n&&s(t=r.Utilities.cloneDeep(t),o)&&i.push(t)})),i):i}function u(t,e,i){var n=e.id||e.properties.id,o=t[n];void 0===o&&(o=[],t[n]=o),i.forEach((function(t){var e=r.Utilities.reducePrecision(t.geometry.coordinates);-1===o.findIndex((function(t){return t[0]===e[0]&&t[1]===e[1]}))&&o.push(e)}))}function l(t,e){for(var i={},o=function(t,e,n){var o=t.geometry.coordinates,s=e.geometry.coordinates,a=n.geometry.coordinates,c=!1,l=!1,d=!1;if(!r.Utilities.isPointEqual(o,s[0])&&!r.Utilities.isPointEqual(o,s[1])){var p=turf.point(s[0]),h=turf.point(s[1]),f=turf.distance(t,p)<turf.distance(t,h)?p:h;turf.pointOnLine(n,f).properties.dist<r.statics.constants.MIN_DISTANCE?(u(i,n,[f]),d=!0):c=!0}if(!r.Utilities.isPointEqual(o,a[0])&&!r.Utilities.isPointEqual(o,a[1])){var g=turf.point(a[0]),m=turf.point(a[1]),y=turf.distance(t,g)<turf.distance(t,m)?g:m;turf.pointOnLine(e,y).properties.dist<r.statics.constants.MIN_DISTANCE?(u(i,e,[y]),d=!0):l=!0}d||(c&&u(i,e,[t]),l&&u(i,n,[t]))},s=function(t,e){var n=turf.pointOnLine(t,turf.point(e));return n.properties.dist<r.statics.constants.MIN_DISTANCE&&!r.Utilities.isPointAtVertex(t.geometry.coordinates,e)&&(u(i,t,[n]),!0)},a=t===e,c=0;c<t.length;c++)for(var l=t[c],d=l.geometry.type,p=a?c+1:0;p<e.length;p++){var f=e[p],g=f.geometry.type,m=f.id||f.properties.id;if("LineString"===d&&"LineString"===g){if(r.Utilities.isOverlapping(l,f)){var y=turf.lineIntersect(l,f).features;if(y.length>0){y.length,o(y[0],l,f)}else{var v=l.geometry.coordinates,b=f.geometry.coordinates;s(l,b[0]),s(l,b[1]),s(f,v[0]),s(f,v[1])}if(h(m)){var x=n.indexOf(h(m));n.splice(x,1)}}}else if("Point"===d||"Point"===g){if("Point"===g&&"Point"===g);else{var E="Point"===d?l:f,C="LineString"===d?l:f;m=E.id||E.properties.id,s(C,E.geometry.coordinates)&&(i[m]=[])}if(h(m)){x=n.indexOf(h(m));n.splice(x,1)}}}return i}function d(t,e){var i=[];return t.forEach((function(t){var n=t.id||t.properties.id;if("LineString"===t.geometry.type){var o=e[n];if(void 0!==o){var a=turf.lineSplit(t,turf.multiPoint(o));turf.featureEach(a,(function(t){var e=turf.lineDistance(t);e>r.statics.constants.MIN_SEGMENT_LENGTH&&(r.Utilities.setProperties(t,{length:e}),s(t),i.push(t))}))}else{var c=turf.lineDistance(t);c>r.statics.constants.MIN_SEGMENT_LENGTH&&(r.Utilities.setProperties(t,{length:c}),i.push(t))}}else{void 0===e[n]&&i.push(t)}})),i}function p(t){var i=c(t);return e?i:d(i,l(i,i))}function h(t){return n.find((function(e){return e.id===t||e.properties.id===t}))}function f(t){return n.filter((function(e){return e.parent===t||e.properties.parent===t}))}this.addNewFeatures=function(t){var e=c(p(t)),i=l(e,n);return n=[].concat(r.Utilities.consumableArray(d(n,i)),r.Utilities.consumableArray(d(e,i))),this.getFeatures()},this.getFeatures=function(){return n},this.splitSegmentAtPoint=function(t,e){var i=o[t];if(void 0!==i){var a=n.indexOf(i);n.splice(a,1);var c=r.Utilities.createLineWithLength([e,i.geometry.coordinates[0]]),u=r.Utilities.createLineWithLength([e,i.geometry.coordinates[1]]);s(c),s(u),n.push(c,u)}},this.getFeaturesFromIndex=function(t){var e=[];return t.forEach((function(t){var i=t.id||t.properties.id,n=o[i];void 0!==n&&e.push(n)})),e},this.getFeatureById=function(t){return h(t)},this.getFeaturesByParentId=function(t){return f(t)},this.removeFeature=function(t){return function(t){var e=f(t);e&&e.length&&(e.forEach((function(t){var e=n.indexOf(t);n.splice(e,1)})),r.updateMeshData());return n}(t)},t&&(n=p(t))},h=["map.enable","map.disable","map.ready","map.redraw","map.refresh","mode.change","theme.change","sources.add","source.add","source.hot","layers.add","layers.remove","layer.add","control.add","control.remove","features.zoom","features.add","features.delete","features.update","features.import","features.export","features.offset","feature.add","feature.delete","feature.select","feature.deselect","feature.update","feature.history","select.load","select.add","select.remove","select.activate","select.deactivate","draw.activate","draw.deactivate","draw.start","draw.finish","draw.cancel","mesh.load","text.add","icon.add","vertex.find","vertex.on","vertex.off","vertex.add","vertex.drag","vertex.dragsnap","vertex.delete","overpass.add","snapping.activate","snapping.deactivate","snapping.add","snapping.refresh","snapping.delete","pinning.activate","pinning.deactivate","pinning.add","pinning.update","routing.activate","routing.deactivate","routing.add","painting.activate","painting.deactivate","painting.start","painting.update","gamepad.init","gamepad.add","gamepad.remove","gamepad.hold","gamepad.press","gamepad.release","gamepad.connect","gamepad.disconnect"],f=function(t,e,i){var n=["mouse"],o={mode:null,feature:null,mouse:null},r={mode:null,feature:null,mouse:null};const s=function(e){if(!t.currentMode)return!1;t.currentMode.handleOffMap&&t.currentMode.handleOffMap(e)},a=function(e){if(!t.currentMode)return!1;t.currentMode.handleOnMap&&t.currentMode.handleOnMap(e)},c=function(t){};return function(e){var n=document.createElement("img"),o=i.icon?"icon":"",r=i.rotate;n.className="mapboxgl-ctrl-logo "+t.id,o&&(n.className+=`-${o}`),n.setAttribute("target","_blank"),n.setAttribute("src",i.attribution),r&&(n.style.rotate=r+"deg"),e.appendChild(n),e.style.display=i.show?i.position.includes("center")?"flex":"block":"none",e.addEventListener("click",c),e.addEventListener("mouseover",a),e.addEventListener("mouseleave",s)}(e),{queueMapClasses:function(e){r=t.Utilities.extend(r,e)},updateMapClasses:function(){if(t.container){var e,i,s=[],a=[];if(n.forEach((function(t){r[t]!==o[t]&&(s.push(t+"-"+o[t]),null!==r[t]&&a.push(t+"-"+r[t]))})),s.length>0)(e=t.container.classList).remove.apply(e,s);if(a.length>0)(i=t.container.classList).add.apply(i,a);o=t.Utilities.extend(o,r)}},position:i.position}},g=function(t,e,i){if(!i||!e)return!1;var n,o,r=["mode","feature","mouse"],s={},a={},c=null,u={mode:null,feature:null,mouse:null},l={mode:null,feature:null,mouse:null};const d=function(e){if(!t.currentMode)return!1;t.currentMode.handleOffMap&&t.currentMode.handleOffMap(e)},p=function(e){if(!t.currentMode)return!1;t.currentMode.handleOnMap&&t.currentMode.handleOnMap(e)};return i.forEach((function(i){(function(e){if(!e)return!1;var i=t.options.controls&&"object"==typeof t.options.controls,n=!!i&&!t.options.controls[e.type];return!(n||e.dontShow||!t.options.controls)})(i)||(i.show=!1),function(t){if(!o){if(!t.position)throw new Error("The first control needs to have a position");o=t.position}}(i),function(e,i){var r=document.createElement("div"),s=(i.group?i.group.toUpperCase():i.attribution?"ATTR":"NONE")+"_GROUP";e.appendChild(r),r.className=t.statics.constants.classes[s]+" "+i.type,r.style.display=i.show?o.includes("center")?"flex":"block":"none",i.show&&i.divider&&e.appendChild(function(){var e=document.createElement("div");return e.className=""+t.statics.constants.classes.DIVIDER,e}()),r.addEventListener("mouseover",p),r.addEventListener("mouseleave",d),function(e,i){n=e,"modes"===e.type?(g("select",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_SELECT,key:"s",title:"Select Features",onAdd:function(){t.editMode||t.drawMode?(t.getButtons("edit").remove(),t.getButtons("save").add()):t.hasSelection()?(t.getButtons("save").remove(),t.getButtons("edit").add()):(t.getButtons("save").remove(),t.getButtons("edit").remove(),t.getButtons("undo").remove(),t.getButtons("cancel").remove(),t.getButtons("redo").remove(),t.getButtons("import").add(),t.getButtons("export").add(),t.getButtons("clear").add())},onActivate:function(){return t.noSelect=!1,t.setMode(),!0},onDeactivate:function(){t.noSelect=!0}}),g("edit",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_EDIT,key:"Enter",title:"Edit Feature",dontShow:!0,onAdd:function(){t.getButtons("select").remove(),this.button.classList.remove(t.statics.constants.classes.ACTIVE_BUTTON),this.button.style.display="flex",this.button.style["background-color"]=t.options.colors.secondaryBackground},onActivate:function(){t.editFeature(),t.getButtons("save").add()},onDeactivate:function(){t.currentMode.deactivate()},onRemove:function(e){!t.getButtons("save")&&createSelect(e)}}),g("save",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_FINSIH,key:"Enter",title:"Save Edit",dontShow:!0,onAdd:function(e){t.getButtons("select").remove(),t.getButtons("edit").remove(),t.getButtons("import").remove(),t.getButtons("export").remove(),t.getButtons("clear").remove(),t.getButtons("undo").add(),t.getButtons("cancel").add(),t.getButtons("redo").add(),this.button.style["background-color"]=t.options.colors.secondaryColor},onActivate:function(e){t.currentMode.handleClick({finish:!0})}})):"options"===e.type?(y("import",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_IMPORT,key:"u",title:"Import Features",onActivate:function(){return t.loadFeatures()}}),y("export",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_EXPORT,key:"d",title:"Export Features",onActivate:function(){return t.saveFeatures()}}),y("clear",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_CLEAR,key:"Delete",title:"Delete Selected or All Features",onActivate:function(){return t.deleteMeshData(),t.deleteUserData(),t.getButtons("select").add(),!0}}),y("undo",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_UNDO,key:"u",title:"Undo Edit",dontShow:!0,onActivate:function(){return t.currentMode.handleUndo()}}),y("redo",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_REDO,key:"r",title:"Redo Edit",dontShow:!0,onActivate:function(){return t.currentMode.handleRedo()}}),y("cancel",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_CANCEL,key:"Escape",title:"Cancel Edit",dontShow:!0,onActivate:function(){return t.cancelEdit()}})):"actions"===e.type?(m("snapping",{container:i,name:"snapping",title:"Enable/Disable Snapping",activeClass:t.id+"-snapping-enabled",inactiveClass:t.id+"-snapping-disabled",onActivate:function(){return t.activateSnapping()},onDeactivate:function(){return t.deactivateSnapping()}}),m("pinning",{container:i,name:"pinning",title:"Enable/Disable Pinning",activeClass:t.id+"-pinning-enabled",inactiveClass:t.id+"-pinning-disabled",onActivate:function(){return t.activatePinning()},onDeactivate:function(){return t.deactivatePinning()}}),m("routing",{container:i,name:"routing",title:"Enable/Disable Routing",activeClass:t.id+"-routing-enabled",inactiveClass:t.id+"-routing-disabled",onActivate:function(){return t.activateRouting()},onDeactivate:function(){return t.deactivateRouting()}}),m("exploring",{container:i,name:"exploring",title:"Enable/Disable Exploring",activeClass:t.id+"-exploring-enabled",inactiveClass:t.id+"-exploring-disabled",onActivate:function(){return t.activateExploring()},onDeactivate:function(){return t.deactivateExploring()}}),m("painting",{container:i,name:"painting",title:"Enable/Disable Painting",activeClass:t.id+"-painting-enabled",inactiveClass:t.id+"-painting-disabled",onActivate:function(){return t.activatePainting()},onDeactivate:function(){return t.deactivatePainting()}})):"types"===e.type?(g("polyline",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_LINE,key:"l",title:"Draw Polyline",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Polyline"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("polygon",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_POLYGON,key:"p",title:"Draw Polygon",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Polygon"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("rectangle",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_RECTANGLE,key:"r",title:"Draw Rectangle",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Rectangle"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("circle",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_POINT,key:"o",title:"Draw Circle",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Circle"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("text",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_TEXT,key:"t",title:"Draw Text",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Text"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("icon",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_ICON,key:"i",title:"Draw Icon",onActivate:async function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Icon"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}})):"utils"===e.type&&(y("zoom",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_ZOOM_IN_FEATURES,key:"x",title:"Zoom to Extent",onActivate:function(){return t.zoomToFeatures()}}),y("locate",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_LOCATE,key:"u",title:"Locate User",button:t.Locate.getButton(),onActivate:function(){t.Locate.onControlEvent(this)}}),y("refresh",{container:i,className:t.statics.constants.classes.CONTROL_BUTTON_REFRESH,key:"q",title:"Refresh",onActivate:function(){return t.refresh()}}))}(i,r)}(e,i)})),{setActiveButton:b,queueMapClasses:function(e){l=t.Utilities.extend(l,e)},updateMapClasses:function(){if(!t.container)return;var e,i,n=[],o=[];r.forEach((function(t){l[t]!==u[t]&&(n.push(t+"-"+u[t]),null!==l[t]&&o.push(t+"-"+l[t]))})),n.length>0&&(e=t.container.classList).remove.apply(e,n);o.length>0&&(i=t.container.classList).add.apply(i,o);u=t.Utilities.extend(u,l)},removeButtons:function(){Object.keys(s).forEach((function(t){var e=s[t];e.parentNode?e.parentNode.removeChild(e):e&&e.remove(),delete s[t],delete a[t]}))},getButtonOptions:function(){return a},getButtonElements:function(){return s},position:o};function h(t){return t.title+(t.key?" ("+t.key+")":"")}function f(e,i){if(!n||!n.buttons[e])return!1;var o=i.position,r=i.button||document.createElement("button");return i.key=t.options.keys&&t.options.keys[e]?t.options.keys[e]:i.key,i.title&&r.setAttribute("title",h(i)),i.container.appendChild(r),i.id=e,i.button=r,i.add=function(t={}){this.button.style.display="flex",this.onAdd&&this.onAdd(t)},i.remove=function(t={}){this.button.style.display="none",this.onRemove&&this.onRemove(t)},i.activate=function(){this.button.classList.remove(i.inactiveClass),this.button.classList.add(i.activeClass),this.button.classList.add(t.statics.constants.classes.ACTIVE_BUTTON)},i.deactivate=function(){r.classList.remove(i.activeClass),r.classList.remove(t.statics.constants.classes.ACTIVE_BUTTON),r.classList.add(i.inactiveClass)},i.dontShow&&(r.style.display="none"),s[e]=r,a[e]=i,o&&(o=o.includes("right")?"left":o.includes("left")?"right":o.includes("bottom")?"top":o.includes("top")?"bottom":"absolute"),i.container.tooltipPosition=o,t.addTooltip(i.container,r,h(i)),r}function g(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=f(e,i);return!!n&&(n.className=t.statics.constants.classes.CONTROL_BUTTON+" "+i.className,n.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),t.target===c?(v(),i.onDeactivate&&i.onDeactivate(i)):i.onActivate(i)&&b(e)}),!0),n)}function m(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=f(e,i);return!!n&&(n.className=""+t.statics.constants.classes.CONTROL_BUTTON,t.options[i.name]&&t.options[i.name].enable?(n.classList.add(i.activeClass),n.classList.add(t.statics.constants.classes.ACTIVE_BUTTON)):n.classList.add(i.inactiveClass),n.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),t.options[i.name]||(t.options[i.name]={}),t.options[i.name].enable?i.onDeactivate&&i.onDeactivate(i):i.onActivate(i)}),!0),n)}function y(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=f(e,i);return!!n&&(n.className=t.statics.constants.classes.ACTION_BUTTON+" "+i.className,"locate"===e&&t.Locate&&t.Locate.control&&t.Locate.control._container.remove(),n.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),i.onActivate(i)}),!0),n)}function v(){c&&(c.classList.remove(t.statics.constants.classes.ACTIVE_BUTTON),c=null)}function b(e){v();var i=!e&&t.editMode?s.edit:e?"edit"===e?s.select:s[e]:s.select;i&&i&&"trash"!==e&&(i.title.includes("Draw ")?i.title.includes(t.currentMode.type)&&(i.classList.add(t.statics.constants.classes.ACTIVE_BUTTON),c=i):i.classList.add(t.statics.constants.classes.ACTIVE_BUTTON))}},m=function(t,e,i={}){this.controls=e,this.options=i;var n=function(t,e){if((t=t.trim()).includes("rgba"))t=this.hex(t);else{if(!t||-1===[4,7].indexOf(t.length))return!1;3===(t=t.substr(1)).length&&(t=t.split("").map((function(t){return t+t+""})).join(""))}var i=parseInt(t.slice(0,2),16),n=parseInt(t.slice(2,4),16),o=parseInt(t.slice(4,6),16);return void 0!==e?"rgba("+i+" "+n+" "+o+" / "+e+"%)":"rgb("+i+" "+n+" "+o+")"};this.enable=function(e){if(!e)return null;this.position=e.position,t.map.addControl(this,e.position)},this.disable=function(){t.map.removeControl(this)},this.onAdd=function(e){return!!this.options&&(this.options.attribution?this.setAttribution(e):(this.setTheme(i.colors||t.options.colors),t.fire("control.add",{control:this,element:this.element}),this.element))},this.onRemove=function(){t.buttons.removeButtons(),t.fire("control.remove",{element:this.element}),t.disable()},this.setAttribution=function(){var e=f(t,this.control,i);return Object.assign(this,e),this.setTheme(i.colors||t.options.colors),t.fire("control.add",{control:this,element:this.element}),this.element},this.setMode=function(e){t.setActiveButton(e||"select")},this.setTheme=function(e){if(e)return e.primaryColor&&document.documentElement.style.setProperty("--"+t.id+"-primary-color",n(e.primaryColor)),e.primaryBackground&&document.documentElement.style.setProperty("--"+t.id+"-primary-background",n(e.primaryBackground)),e.primaryText&&document.documentElement.style.setProperty("--"+t.id+"-primary-text",n(e.primaryText)),e.primaryBorder&&document.documentElement.style.setProperty("--"+t.id+"-primary-border",n(e.primaryBorder)),e.secondaryColor&&document.documentElement.style.setProperty("--"+t.id+"-secondary-color",n(e.secondaryColor)),e.secondaryBackground&&document.documentElement.style.setProperty("--"+t.id+"-secondary-background",n(e.secondaryBackground)),e.secondaryText&&document.documentElement.style.setProperty("--"+t.id+"-secondary-text",n(e.secondaryText)),e.secondaryBorder&&document.documentElement.style.setProperty("--"+t.id+"-secondary-border",n(e.secondaryBorder)),t.fire("theme.change",{colors:e}),this.getTheme()},this.setControl=function(e){if(!e)return!1;var i;this.element=document.createElement("div"),this.element.className=t.id+"-control-wrap",this.control=document.createElement("div"),this.control.className=t.statics.constants.classes.PREDEFINED_CONTROL_BASE+" "+t.statics.constants.classes.PREDEFINED_CONTROL_GROUP,this.element.appendChild(this.control),Array.isArray(e)?(i=g(t,this.control,e),Object.assign(this,i)):e.attribution&&(i=f(t,this.control,e),Object.assign(this,i)),this.enable(i)},this.getTheme=function(){return t.options.colors},this.getButtons=function(){return this._buttons},this.getControl=function(t){var e,i=this.control.childNodes;if(i.length)return t&&i.forEach((function(i){i.classList.contains(t)&&(e=i)})),e},this.showControl=function(t){var e=this.getControl(t);return!!e&&(e.style.display=this.position.includes("center")?"flex":"block",e)},this.hideControl=function(t){var e=this.getControl(t);return!!e&&(e.style.display="none",e)},this.setControl(e)},y=function(t,e,i={}){this.options=i,this.init=function(i={}){return t.Utilities.extend(this.options,i),this.styles=e||[{title:"Dark",uri:"mapbox://styles/mapbox/dark-v11"},{title:"Light",uri:"mapbox://styles/mapbox/light-v11"},{title:"Outdoors",uri:"mapbox://styles/mapbox/outdoors-v11"},{title:"Satellite",uri:"mapbox://styles/mapbox/satellite-streets-v11"},{title:"Streets",uri:"mapbox://styles/mapbox/streets-v11"}],this.defaultStyle="Dark",this.onDocumentClick=this.onDocumentClick.bind(this),this.events=this.options.eventListeners,this},this.getDefaultPosition=function(){return"top-right"},this.onAdd=function(t){this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mapStyleContainer=document.createElement("div"),this.styleButton=document.createElement("button"),this.styleButton.type="button",this.mapStyleContainer.classList.add("mapboxgl-style-list");for(const t of this.styles){const e=document.createElement("button");e.type="button",e.classList.add(t.title.replace(/[^a-z0-9-]/gi,"_")),e.dataset.uri=JSON.stringify(t.uri),e.addEventListener("click",(t=>{const e=t.srcElement;if(this.closeModal(),e.classList.contains("active"))return;if(this.events&&this.events.onOpen&&this.events.onOpen(t))return;const i=JSON.parse(e.dataset.uri);this.map.setStyle(i);const n=this.mapStyleContainer.getElementsByClassName("active");for(;n[0];)n[0].classList.remove("active");e.classList.add("active"),this.events&&this.events.onChange&&this.events.onChange(t,i)})),t.title===this.defaultStyle&&e.classList.add("active"),this.mapStyleContainer.appendChild(e)}return this.styleButton.classList.add("mapboxgl-ctrl-icon"),this.styleButton.classList.add("mapboxgl-style-switcher"),this.styleButton.addEventListener("click",(t=>{this.events&&this.events.onSelect&&this.events.onSelect(t)||this.openModal()})),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.styleButton),this.controlContainer.appendChild(this.mapStyleContainer),this.closeModal(),this.controlContainer},this.onRemove=function(){this.controlContainer&&this.controlContainer.parentNode&&this.map&&this.styleButton&&(this.styleButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)},this.closeModal=function(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="none",this.styleButton.style.display="block")},this.openModal=function(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="block",this.styleButton.style.display="none")},this.onDocumentClick=function(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.closeModal()},this.init()},v={enable:!0,debug:!1,crosshairs:!0,joystick:{min:.2,max:.7},camera:{free:!0},pan:{speed:.001,min:.001,max:.05},bearing:{speed:.8},pitch:{speed:1.5,max:70},zoom:{speed:.008},rumble:{startDelay:0,duration:200,weakMagnitude:1,strongMagnitude:1},mapping:{Select:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&t.ctx.getButtons("clear").button.click()},Start:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type&&t.gamepad.hasJoysticks){var e="select"===t.mode.id?"edit":"select";t.ctx.getButtons(e).button.click()}},Power:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&t.ctx.getButtons("save").button.click()},Menu:function(t){"press"===t.type||"hold"===t.type||t.type},Misc:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type&&t.gamepad.hasJoysticks){t.ctx.getButtons("zoom").button.click();var e=setInterval((function(){ctx.mapMoving||(clearInterval(e),t.gamepad.map.center=t.ctx.map.getCenter(),t.gamepad.map.zoom=t.ctx.map.getZoom())}),1)}},A:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type)if(t.gamepad.hasJoysticks)t.ctx.getButtons("routing").button.click();else if(!t.gamepad.pressed.BumpLeft&&!t.gamepad.pressed.BumpRight)return this.JoyLeftClick(t)},B:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type)if(t.gamepad.hasJoysticks)t.ctx.getButtons("painting").button.click();else if(!t.gamepad.pressed.BumpLeft&&!t.gamepad.pressed.BumpRight)return this.JoyRightClick(t)},Y:function(t){"press"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft||t.gamepad.pressed.BumpRight)&&t.gamepad.setSpeed(t.value,!1):"hold"===t.type||"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("snapping").button.click()},X:function(t){"press"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft||t.gamepad.pressed.BumpRight)&&t.gamepad.setSpeed(t.value,!0):"hold"===t.type||"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("pinning").button.click()},JoyLeftMove:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setCenter(t.value,t.gamepad.options.camera.free):"release"===t.type&&t.gamepad.setCenter(!1,t.gamepad.options.camera.free))},JoyRightMove:function(t){"press"===t.type||("hold"===t.type?t.name.includes("Up")||t.name.includes("Down")?t.gamepad.setPitch(t.value,t.name.includes("Up")):(t.name.includes("Left")||t.name.includes("Right"))&&t.gamepad.setBearing(t.value,t.name.includes("Left")):t.type)},JoyLeftClick:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&"draw"===t.mode.id&&t.mode.deleteVertex()},JoyRightClick:function(t){if("press"===t.type){if("draw"===t.mode.id)return!!t.lngLat&&t.mode.handleDown(t)}else if("hold"===t.type);else if("release"===t.type){if(!t.lngLat)return!1;"draw"===t.mode.id?(t.mode.handleUp(t),t.mode.handleClick(t)):t.mode.handleClick(t)}},BumpLeft:function(t){if("press"===t.type){if(t.gamepad.hasJoysticks)return t.gamepad.setSpeed(t.value,!0);if(t.gamepad.pressed.BumpRight)return!1}else"hold"===t.type?t.gamepad.hasJoysticks:t.type},BumpRight:function(t){if("press"===t.type){if(t.gamepad.hasJoysticks)return t.gamepad.setSpeed(t.value,!1);if(t.gamepad.pressed.BumpLeft)return!1}else"hold"===t.type||t.type},TrigLeft:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setZoom(t.value,!0):t.type)},TrigRight:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setZoom(t.value,!1):t.type)},DpadUp:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setPitch(t.value,!0):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Polygon").button.click())},DpadDown:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setPitch(t.value,!1):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Circle").button.click())},DpadLeft:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setBearing(t.value,!0):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Polyline").button.click())},DpadRight:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setBearing(t.value,!1):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Rectangle").button.click())}}},b=function(t,e={}){function i(t,e=[]){t&&e.forEach((function(e){e&&t.classList.add(e)}))}this.options=e,this.init=function(e={}){return t.Utilities.extend(this.options,e),this.control=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!1}),this.control.on("geolocate",this.onControlEvent.bind(this)),t.map.addControl(this.control),this},this.ready=function(){var t=this,e=this.control,i=setInterval((function(){if(e._geolocateButton)return t.build(),clearInterval(i)}),1)},this.build=function(){this.marker=this.control._userLocationDotMarker,this.getButton().style.display="none"},this.update=function(e={}){e.alpha;const i=this.heading(),n=(this.bearing(),this.following);i&&n&&!t.mapMoving&&(t.map.setBearing(i-1),t.map.setCenter(this.marker._lngLat))},this.heading=function(){return this.control._heading},this.bearing=function(){return t.map.getBearing()},this.locate=function(){return this.locating=!0,this.unlocated=!1,this.control._follow=this.following=!1,i(this.button,["mapboxgl-ctrl-geolocate-waiting"]),this.control.trigger()},this.relocate=function(){return this.following&&this.state("ACTIVE_LOCK"),i(this.button,["mapboxgl-ctrl-geolocate-active"]),this.control.trigger()},this.unlocate=function(){return this.state("ACTIVE_LOCK"),this.control._follow=this.following=!1,t.map.dragPan.enable(),this.unlocated=!0,this.control.trigger()},this.follow=function(){return i(this.button,["mapboxgl-ctrl-geolocate-follow"]),t.map.dragPan.disable(),this.control._follow=this.following=!0},this.state=function(t){return t?this.control._watchState=t:this.control._watchState},this.getButton=function(){return this.control._geolocateButton},this.removeClasses=function(){var t=this.button;t&&(t.classList.remove("mapboxgl-ctrl-geolocate-waiting"),t.classList.remove("mapboxgl-ctrl-geolocate-active"),t.classList.remove("mapboxgl-ctrl-geolocate-active-error"),t.classList.remove("mapboxgl-ctrl-geolocate-background"),t.classList.remove("mapboxgl-ctrl-geolocate-background-error"),t.classList.remove("mapboxgl-ctrl-geolocate-follow"))},this.onAdd=function(t){},this.onControlEvent=function(e){if(this.button=this.button||e.button,this.marker=this.control._userLocationDotMarker,this.removeClasses(),e.coords)this.onLocate(e);else if(e.button){if(t.map.dragPan.enable(),"OFF"===this.state())return this.locate();if("BACKGROUND"===this.state()&&!this.following)return this.relocate();if("ACTIVE_LOCK"===this.state()&&!this.following)return this.follow();this.unlocate()}},this.onLocate=function(t){"ACTIVE_LOCK"===this.state()&&this.locating&&(this.locating=!1,this.currentLocation=t.coords,i(this.button,["mapboxgl-ctrl-geolocate-active"]))},this.onMapMove=function(t){if(this.button&&!this.following&&!this.unlocated)return"ACTIVE_LOCK"===this.state()?i(this.button,["mapboxgl-ctrl-geolocate-active"]):void i(this.button,["mapboxgl-ctrl-geolocate-background"])},this.options.init&&this.init(this.options)};function x(t){var e,i,n,o=[],r=[],s=[];function a(t,e){var i=document.createElement("tr");if(i.classList.add("popup-table-row"),t){var n=document.createElement("th");n.classList.add("popup-table-header"),n.appendChild(document.createTextNode(t)),i.appendChild(n)}var o=document.createElement("td");return o.classList.add("popup-table-data"),o.classList.add(t),o.appendChild(document.createTextNode(e)),i.appendChild(o),i}function c(e){s=e,o=void 0===o?[]:o,e.length>=o.length&&o.splice(0,e.length-o.length+1),n=e[0].id||e[0].properties.id,e.length>1&&e.forEach((t=>{const e=t.id||t.properties.id;-1===o.indexOf(e)&&(n=e)})),i||t.currentMode.deselectCurrentFeature(),t.currentMode.selectFeature(n)}this.id="select",this.activate=function(e={}){return!this.activated&&(t.currentMode.id!==this.id?(e.mode=this.id,t.setMode(e)):(this.activated=!0,t.map.dragPan.enable(),t.setButtons(),t.setActiveButton("select"),t.fire("select.activate",{activated:!0,options:e}),this.gamepad,void setTimeout((function(t){t.selectFeature(e.id?e.id:!!e.feature&&e.feature.id)}),5,this)))},this.deactivate=function(){if(!this.activated)return!1;this.activated=!1,this.deselectCurrentFeature(),t.setButtons(),t.fire("select.deactivate",{activated:!0})},this.canHandle=function(e){return t.statics.constants.modes.SELECT===e},this.selectFeature=function(e){const i=t.options.select.popup;return!!e&&(-1===o.indexOf(e)&&o.push(e),t.hasSelection()&&t.forEachSelectedFeature((t=>{})),r=t.Features.removeFeatures(e),t.addFeaturesToSelected(r),i&&this.addPopup(r),t.wantingToEdit?(1==r.length&&e===r[0].id&&(n=r[0],t.wantingToEdit=!1,t.setMode("edit",n.properties.type,n)),r):r);var n},this.deselectCurrentFeature=function(){t.removeSelection()},this.addPopup=function(i){this.popupElement=function(e){const i=document.createElement("div");i.classList.add("popup-table-holder");const n=function(e){var i=document.createElement("table"),n=["id","type"];i.style.width="100%",i.style.height="100%",i.setAttribute("border","1"),i.classList.add("popup-table");var o=document.createElement("tbody");return e.forEach((function(e,i){var r=e.properties.type;n.forEach((function(t){o.appendChild(a(t,e.properties[t]))})),o.appendChild(a("geometry",e.geometry.type)),"LineString"===e.geometry.type?(t.Features.addUnits(e,"feet"),o.appendChild(a("unit",e.geometry.unit)),o.appendChild(a("units",e.geometry.units))):"Text"===r?o.appendChild(a("content",e.properties.text)):"Polygon"===e.geometry.type&&(t.Features.addUnits(e,"acres"),o.appendChild(a("unit",e.geometry.unit)),o.appendChild(a("units",e.geometry.units)))})),i.appendChild(o),i}(e);if(i.appendChild(n),s.length>1){var o=document.createElement("div");o.classList.add("popup-table-button"),o.innerHTML="<button> Next </button>",o.addEventListener("click",c.bind(this)),i.appendChild(o)}return i}(i),this.popup=new mapboxgl.Popup({closeOnClick:!1}).setLngLat(e).setDOMContent(this.popupElement).addTo(t.map).setOffset(12),this.popup._container.style["margin-bottom"]="10px"},this.removePopup=function(){return!(!this.popup||!this.popup.remove)&&this.popup.remove()},this.handleMove=function(t){},this.handleClick=function(r){if(t.noSelect)return!1;var a=t.getRenderedDrawnFeatures(r.lngLat);if(e=[r.lngLat.lng,r.lngLat.lat],i=r.originalEvent&&r.originalEvent.shiftKey&&t.options.select.multiple,a.length>0){if(!t.Layers.getSelection(a,e))return;c.call(this,a)}else i||(o=[],s=[],e=!1,n=!1,this.deselectCurrentFeature())},this.handleDrag=function(t){}}function E(t){function e(e,n,o){var r,s=t.currentMode.cancelled;if(t.editMode&&!t.currentMode.savingEdit&&!s)return t.currentMode.saveEdit(n);if(s||!e)return i(),t.hotFeature&&(t.removeSelection(),t.removeFeature(t.hotFeature.id,!0),t.addFeatures([t.hotFeature],!0)),t.Pinning.resetFeatures(),t.editMode||t.fire("draw.cancel",{cancel:!0,feature:t.hotFeature}),!1;if("Text"===e&&!o)return a.call(t.currentMode,e,n);if(t.hotFeature){if(t.Utilities.isPoint(t.hotFeature,e)){var u=Array.isArray(t.hotFeature.geometry.coordinates[0])?t.hotFeature.geometry.coordinates[0]:[t.hotFeature.geometry.coordinates[0],t.hotFeature.geometry.coordinates[1]];r=n=t.Painting.enabled||t.currentMode.savingEdit?n:turf.point(u)}else t.Utilities.isPolygon(t.hotFeature,e)?(t.hotFeature.geometry.type="Polygon","Rectangle"===e?t.endPoint&&c(t.hotFeature,"0.2",t.endPoint[0],t.endPoint[1]):(t.hotFeature.geometry.coordinates.push(t.hotFeature.geometry.coordinates[0]),t.hotFeature.geometry.coordinates=[t.hotFeature.geometry.coordinates])):t.Utilities.isLineString(t.hotFeature,e)?"Polygon"===e?(t.hotFeature.geometry.type=e,t.hotFeature.geometry.coordinates.push(t.hotFeature.geometry.coordinates[0]),t.hotFeature.geometry.coordinates=[t.hotFeature.geometry.coordinates]):"Rectangle"===e&&t.endPoint&&c(t.hotFeature,"0.2",t.endPoint[0],t.endPoint[1]):n&&(r=n);if(t.Painting.enabled){var l=t.options.painting.tolerance;t.hotFeature="Circle"===e?t.hotFeature:turf.simplify(t.hotFeature,{mutate:!0,tolerance:"function"==typeof l?l(t.map):l,highQuality:!0}),t.startPoint&&(t.hotFeature.geometry.coordinates[0]=t.startPoint)}}else n&&(r=n);return(r=t.Exploring.currentFeature||r||t.hotFeature)&&t.currentMode.activated?(r=t.Features.addFeature(r,t.currentMode.properties),t.fire("draw.finish",{feature:r,pinned:t.Pinning.getFeatures(),type:e,editing:t.editMode}),t.currentMode.deactivate()):t.currentMode.deactivate()}function i(i,n,o){var r=t.textMarker;if(!r)return!1;var s=r.getElement(),c=s.value;if(!c.length||t.currentMode.cancelled)return r.remove(),t.textInput=!1,a.call(this,n,o);var u=[s.getAttribute("lng"),s.getAttribute("lat")];n=n||s.getAttribute("type"),t.currentMode.properties.text=c;o={type:"Feature",properties:{type:n,text:c},geometry:{type:"Point",coordinates:u}};r.remove(),e(n,o,c)}function n(e){var i,n=t.hotFeature;if(t.dragMoving)return!1;if(!n)return!1;var o=t.Snapping.getClosest(e.geometry.coordinates),r=o.coords,s=!!o.point&&o.point.type;if(!s)return!1;if(!r&&"linepoint"===s&&o.point.borders){var a=turf.lineString([o.point.border1,o.point.border2]);r=(i=turf.along(a,o.point.distance1)).geometry.coordinates}return!!r&&((i=t.Utilities.isLineString(n)&&"vertex"===s?turf.pointOnLine(n,turf.point(r)):turf.point(r)).properties.type=s,t.fire("vertex.find",{vertex:i,feature:t.hotFeature,closest:o}),i)}function o(e,i){var n;if(i&&e){var o=t.hotFeature.geometry.coordinates,r=turf.lineString(o),s=turf.point(o[0]),a=turf.lineSlice(s,e,r),c=a.geometry.coordinates.length-1,u=a.geometry.coordinates[c];e=turf.point(u),r.geometry.coordinates.splice.apply(r.geometry.coordinates,[c,0].concat([u])),r=turf.cleanCoords(r),n=turf.truncate(r,{precision:6,coordinates:2,mutate:!0}),t.hotFeature.geometry.coordinates=n.geometry.coordinates,t.hotFeature=t.Utilities.cloneDeep(t.hotFeature)}else e&&(t.canDragMove=!0,t.canAddVertex=e);return e}function r(e,i){var n,r=t.hotFeature;if(t.dragMoving)return s();if(!r||!e)return s();t.updateMeshData();var a=e.properties.type;if(n=e.properties.index||0==e.properties.index?e.properties.index:"Circle"===t.currentMode.type&&0,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([e])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),"linepoint"===a)return o(e);t.map.dragPan.disable(),t.dragIndex=n,t.addedVertexOnLine=!!i&&e,t.canAddVertex=!1,t.canDragMove=!0,t.snappedVertex=e.geometry.coordinates,t.Pinning.setFeatures(t.snappedVertex),t.fire("vertex.on",{vertex:e,index:n,feature:t.hotFeature})}function s(){if(t.hotFeature){if(t.mouseIsDown&&t.Painting.enabled)return!1;t.snappedVertex&&(t.lastIndex&&(t.lastClick={coords:t.snappedVertex}),t.fire("vertex.off",{vertex:!1,index:t.dragIndex,feature:t.hotFeature})),t.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.snappedVertex=null,t.dragIndex=-1,t.mouseIsDown=t.touchDown||!1,t.pinableFeatures=[],t.lastIndex=!1,t.canAddVertex=!1,t.addedVertexOnLine=!1}}function a(e,n){if(!(n=n||t.hotFeature))return!1;if(e=e||n.properties.type,n.properties.type=e,"Text"!==e)return t.Features.setText(n);if(t.textInput)return i(0,e,n);var o={lng:n.geometry.coordinates[0],lat:n.geometry.coordinates[1]},r=t.textInput=document.createElement("input");r.value=n.properties.text||"",r.className="text-marker",r.setAttribute("contenteditable","true"),r.setAttribute("autocorrect","off"),r.setAttribute("spellcheck","false"),r.setAttribute("placeholder","Press Enter or Select Button When Done..."),r.setAttribute("type",e),r.setAttribute("lng",o.lng),r.setAttribute("lat",o.lat),t.textMarker=new t.Mapbox.Marker(r).setLngLat(o).addTo(t.map),t.textMarker.setOffset([0,-25]),r.addEventListener("submit",i),r.addEventListener("keydown",(function(t){[32,37,38,39,40].indexOf(t.keyCode)>-1?t.stopPropagation():13===t.keyCode&&(t.preventDefault(),i())})),r.addEventListener("paste",(function(t){var e,i;t.stopImmediatePropagation(),t.preventDefault(),e=t.clipboardData||window.clipboardData,i=e.getData("text/plain").slice(0,CHAR_LIMIT),t.target.innerText=i})),r.focus(),t.fire("text.add",{feature:n,marker:t.textMarker,type:e})}function c(t,e,i,n){var o=e.split("."),r=parseInt(o[0],10),s=parseInt(o[1],10);void 0===t.geometry.coordinates[r]&&(t.geometry.coordinates[r]=[]),t.geometry.coordinates[r][s]=[i,n]}this.id="draw",this.canHandle=function(e){return t.statics.constants.modes.DRAW===e},this.activate=function(e={}){if(this.activated)return!1;if(t.currentMode.id!==this.id)return e.mode=this.id,t.setMode(e);this.activated=!0,this._handleHistory=this.handleHistory.bind(this),this.history=[],this.undo=[],e.feature&&(e.type=function(e){var i=t.Features.getType(e);if(!i)return alert("No Feature Type Found");t.currentMode.type=i,t.editMode=!0,t.hotFeature=e,t.Utilities.setProperty(t.hotFeature,"type",i),t.Utilities.setProperty(t.hotFeature,"edit",!0),t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),"Polygon"===i?t.hotFeature=turf.polygonToLine(t.hotFeature):"Circle"===i?t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])):"Text"===i?(t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([t.hotFeature])),a.call(t.currentMode,i,t.hotFeature)):(t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])));var n=t.Utilities.isPoint(t.hotFeature,i)?t.hotFeature.geometry.coordinates:t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1];return t.lastClick={coords:n},t.Features.removeFeatures(t.hotFeature.properties.id),t.refreshMeshData(),t.currentMode.type}(e.feature)),t.drawMode=!t.editMode;var i=e.lngLat;delete e.lngLat;var n=this.type=e.type,o=e.feature?e.feature.properties:e;this.properties=t.Utilities.cloneDeep(o),delete this.properties.mode;const r=e.id||o.id||URL.createObjectURL(new Blob([])).slice(-36);return this.properties.id=r,this.properties.type=n,this.properties.style={},t.setButtons(),t.setActiveButton(n),t.Utilities.isPoint(t.hotFeature,n)&&(this.isPoint=!0),t.fire("draw.activate",{id:r,type:n,activated:this.activated,editing:t.editMode,feature:t.hotFeature||e.feature,properties:this.properties}),t.on("source.hot",this._handleHistory),i&&this.handleMove({lngLat:i}),(t.options.painting.enable||t.mobile&&"Rectangle"===n)&&t.activatePainting(),this.updateHotSource(),this},this.deactivate=function(e,i,n){if(!this.activated)return!1;var o;e&&this.cancelEdit(i,n),o=this,t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([])),t.deleteMeshData(),o.history=[],o.undo=[],o.type=null,o.cancelled=!1,o.activated=!1,o.savingEdit=!1,t.editMode=!1,t.drawMode=!1,delete t.startPoint,delete t.lastClick,delete t.firstClick,delete t.endPoint,delete t.snapFeature,delete t.hotFeature,delete t.drawStarted,delete t.dragMoving,delete t.editing,delete t.textMarker,delete t.textInput,delete t.touchMoving,delete t.touchDown,delete t.pinningFeatures,delete t.pinnedFeatures,delete t.canDragMove,delete t.canAddVertex,delete t.dragIndex,delete t.addedVertexOnLine,delete t.snappedVertex,t.setButtons(),t.off("source.hot",this._handleHistory),t.fire("draw.deactivate",{activated:this.activated}),t.options.repeatDraw?this.activate(this.properties):t.setMode()},this.updateHotSource=function(e,i){if(e&&(t.hotFeature=e),t.hotFeature&&!t.overpassDownloading)return t.hotFeature.properties=t.Utilities.assignDeep(t.hotFeature.properties,i||{}),t.hotFeature.properties.style=t.hotFeature.properties.style||{},t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.hotFeature},this.deleteVertex=function(e){if(t.hotFeature){const i=t.hotFeature.geometry.coordinates;e=void 0!==e?e:i.length-1,i.length>1&&(i.splice(e,1),t.lastClick={coords:i[i.length-1]},i.length>0?t.snapFeature=turf.point(i[i.length-1]):t.snapFeature=null,i.length>1?t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])):(t.hotFeature=null,t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([]))),t.fire("vertex.delete",{coords:i,index:e,feature:t.hotFeature})),t.lastMouseEvent&&t.currentMode.handleMove&&t.currentMode.handleMove(t.lastMouseEvent)}else t.snapFeature&&(t.snapFeature=null,t.lastClick=null,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])))},this.getFeature=function(){return t.hotFeature},this.selectFeature=function(e){return!!e&&(t.setMode(),t.currentMode.selectFeature(e))},this.saveEdit=function(i){var n=t.hotFeature;if(!n)return!1;var o=n.properties.type||i.properties.type||this.type;return i=i||n,this.savingEdit=!0,e(o,i)},this.cancelEdit=function(i,n){return this.cancelled=!0,n&&n.properties.type?(this.standby=i,t.hotFeature=n,t.fire("draw.cancel",{feature:n}),e()):(t.hotFeature=null,e())},this.handleDown=function(e){if(t.mouseIsDown=[e.lngLat.lng,e.lngLat.lat],e.touch&&(t.touchDown=!0,r(n(turf.point(t.mouseIsDown)))),t.canAddVertex)return r(n(o(t.canAddVertex,e)),!0);t.Pinning.setFeatures(t.snappedVertex),function(){var e=setInterval((function(){t.mouseIsDown?(t.lastDragMove+=1,t.lastDragMove<t.options.pinning.idle?t.mouseIsIdle=!1:(t.mouseIsIdle=!0,t.Snapping.setVertex(),t.Pinning.updateFeatures())):(t.lastDragMove=0,t.mouseIsIdle=!1,clearInterval(e))}),1)}()},this.handleUp=function(i){if(t.mouseIsDown=!1,t.touchDown=!1,t.Painting.enabled)return t.Painting.handleUp(i);if(!t.addedVertexOnLine||t.dragMoving){if(i.touch&&t.touchMoving)return t.dragMoving=!1;if(t.Utilities.isPoint(t.hotFeature,this.type)&&t.snappedVertex)return t.editMode?this.saveEdit():e(this.type);if(t.snappedVertex&&t.dragMoving&&!t.mapMoving&&"Rectangle"!==this.type){t.gamepadDrag=i.gamepad;var o=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);o=o||!(!t.Utilities.isPolygon(t.hotFeature)||0!=t.dragIndex);var s=t.Utilities.getLastIndexCoords(t.hotFeature);r(n(turf.point(t.snappedVertex))),this.updateHotSource(),o&&setTimeout((function(){t.lastClick={coords:s}}),100)}t.pinableFeatures=[],t.mouseIsIdle=!1,a.call(this,this.type),t.refreshMeshData()}},this.handleClick=function(i){if(i.finish)return t.editMode?this.saveEdit():e(this.type);if(i.touch&&t.touchMoving)return t.touchMoving=!1,t.Snapping.setFeature(),this.updateHotSource();if(i.touch&&(t.touchClick=!0),t.addedVertexOnLine)return t.Snapping.setFeature(),this.updateHotSource(),r(n(t.addedVertexOnLine)),this.handleDrag(i),t.dragMoving=!1,t.gamepadDrag=!1,t.mouseIsIdle=!1,i;if(t.gamepadDrag)return t.gamepadDrag=!1;if(!t.editMode||"Polygon"!==this.type&&"Text"!==this.type){this.firstClick||t.drawStarted?t.fire("vertex.add",{type:this.type,coords:[i.lngLat.lng,i.lngLat.lat]}):(t.drawStarted=!0,t.fire("draw.start",{type:this.type,editing:t.editMode,coords:[i.lngLat.lng,i.lngLat.lat]}));var o,s,c,u=t.closestPoint||{coords:[i.lngLat.lng,i.lngLat.lat]},l=turf.point(u.coords);if(l.properties=this.properties,t.lastMove=u.coords.length>1&&{lat:u.coords[u.coords.length-1][1],lng:u.coords[u.coords.length-1][0]},!t.startPoint){if("Rectangle"===this.type)return t.startPoint=u.coords,t.hotFeature=turf.polygon([[t.startPoint,[i.lngLat.lng,i.lngLat.lat],[t.startPoint[0],i.lngLat.lat],t.startPoint]]),t.Utilities.setProperty(t.hotFeature,"type",this.type);"Polygon"===this.type&&(t.startPoint=u.coords)}return!t.snapFeature&&u&&(t.snapFeature=u),o=this.type,s=u.coords,c=["Circle","Icon","Text"],!o||c.includes(o)||("Rectangle"===o&&t.startPoint?(t.endPoint=s,1):"Polygon"===o&&t.snappedVertex&&t.startPoint&&t.Utilities.isPointEqual(t.startPoint,t.snappedVertex)||t.snappedVertex&&t.Utilities.isLastIndex(t.dragIndex,t.hotFeature)||t.lastClick&&t.Utilities.isPointEqual(t.lastClick.coords,s))?e(this.type,l):(this.firstClick=!t.firstClick&&{coords:u.coords},t.lastClick=u,t.firstClick=t.firstClick?t.firstClick:{coords:u.coords},t.Snapping.setFeature(),a.call(this,this.type),t.Exploring.setFeatures(u.coords,{set:!0}),delete t.touchClick,this.updateHotSource())}},this.handleMove=function(e){if(e.touch&&t.mouseIsDown&&(t.touchMoving=!0),t.overpassDownloading)return!1;if(t.mouseIsDown&&t.canAddVertex)return!1;if(t.canDragMove&&t.snappedVertex&&t.mouseIsDown)return this.handleDrag(e);if(t.mouseIsDown&&t.Painting.enabled)return this.handlePainting(e);if(e.touch&&t.touchMoving)return t.snapFeature=!1;if(1===(!!e.originalEvent&&(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which)))return!1;var i=t.Routing.enabled;e.originalEvent&&e.originalEvent.altKey&&(i=!1);var o=t.Snapping.enabled;e.originalEvent&&e.originalEvent.shiftKey&&(o=!1);var s=[e.lngLat.lng,e.lngLat.lat],a=t.Utilities.isPoint(t.hotFeature,this.type),c=t.editMode&&("Polygon"===this.type||"Rectangle"===this.type),u=turf.point(s),l=null;return c?l=u:o?l=t.Snapping.setClosest(s,a):a?a&&(l=u):l=t.Snapping.updateFeature(s),i&&(l=t.Routing.getClosest()||l),l||(l=u),t.Snapping.addFeature(l,this.properties,c),r(n(u)),!l&&this.isPoint&&delete this.isPoint,c&&i&&t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),"Rectangle"===this.type?this.handleRectangle(e):"Icon"===this.type?this.handleIcon(e,t.snapFeature):"Text"===this.type?this.handleText(e,t.snapFeature):void 0},this.handleDrag=function(e){if(!(t.dragIndex>-1))return s(),t.mouseIsDown&&t.Painting.enabled&&this.handlePainting(e),!1;!e.gamepad&&e.originalEvent.stopPropagation(),t.dragMoving=!0,t.lastDragMove=0,t.snappedVertex=[e.lngLat.lng,e.lngLat.lat],t.bypassRouting=!0,t.bypassSnapping=!e.gamepad&&e.originalEvent.shiftKey,t.lastIndex=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);var i=turf.point(t.snappedVertex);if(t.lastIndex&&(t.lastClick={coords:t.snappedVertex}),"Circle"===this.type||"Icon"===this.type)t.Painting.enabled||(t.hotFeature.geometry.coordinates=t.snappedVertex);else{var n=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);t.hotFeature.geometry.coordinates[t.dragIndex]=t.snappedVertex,"Polygon"===this.type&&(n&&(t.hotFeature.geometry.coordinates[0]=t.snappedVertex),0==t.dragIndex&&(t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1]=t.snappedVertex))}t.Utilities.setProperty(t.hotFeature,"type",this.type),t.Utilities.setProperty(i,"type",this.type),t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([i])),t.fire("vertex.drag",{type:this.type,coords:[e.lngLat.lng,e.lngLat.lat],feature:t.hotFeature,vertex:i}),t.Pinning.updateFeatures()},this.handleTouch=function(t){t.touch=!0,"touchstart"===t.type?this.handleDown(t):"touchend"===t.type?(this.handleUp(t),this.handleClick(t)):"touchmove"===t.type&&this.handleMove(t)},this.handleOffMap=function(e){t.map.getSource(t.statics.constants.sources.SNAP)&&t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))},this.handleOnMap=function(e){t.map.getSource(t.statics.constants.sources.SNAP)&&t.snapFeature&&t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([t.snapFeature]))},this.handlePainting=function(e){if(!t.mouseIsDown)return!1;t.map.dragPan.disable(),t.setMapClass("painting");var i=t.snapFeature&&!t.Painting.feature,n=!(!e.lngLat||!e.lngLat.lng)&&[e.lngLat.lng,e.lngLat.lat];return i&&(n=t.snapFeature.geometry.coordinates),!!n&&t.Painting.updateFeature(n)},this.handleRectangle=function(e){if(t.editMode&&t.hotFeature&&(t.startPoint=t.hotFeature.geometry.coordinates[0][0]),t.startPoint){t.dragMoving||t.Utilities.setProperty(t.hotFeature,"type",this.type),t.dragMoving=!0;var i=t.snapFeature?t.snapFeature.geometry.coordinates:[e.lngLat.lng,e.lngLat.lat];if(t.dragIndex>-1){var n=0==t.dragIndex||4==t.dragIndex?4:t.dragIndex,o=1==n?3:2==n?4:3==n?1:2,r=1==o?4:2==o?1:3==o?2:3,s=1==r?3:2==r?4:3==r?1:2;c(t.hotFeature,"0."+n,i[0],i[1]),c(t.hotFeature,"0."+r,i[0],t.startPoint[1]),c(t.hotFeature,"0."+s,t.startPoint[0],i[1]),c(t.hotFeature,"0."+o,t.startPoint[0],t.startPoint[1])}else c(t.hotFeature,"0.1",i[0],t.startPoint[1]),c(t.hotFeature,"0.2",i[0],i[1]),c(t.hotFeature,"0.3",t.startPoint[0],i[1]),c(t.hotFeature,"0.4",t.startPoint[0],t.startPoint[1]);t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature]))}},this.handleText=function(t,e){},this.handleIcon=function(t,e){},this.handleContext=function(e){t.canDragMove&&t.snappedVertex&&(t.dragIndex>-1&&(t.hotFeature.geometry.coordinates.splice(t.dragIndex,1),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))))},this.handleHistory=function(e){if(!t.dragMoving){var i=t.currentMode.history,n=new Date,o=e.detail.data.features;if(o&&o.length){var r=t.Utilities.cloneDeep(o[0]);r.historyDate=n,i.push(r),t.fire("feature.history",{type:t.currentMode.type,feature:r,history:i})}}},this.handleUndo=function(){return alert("UNDER DEVELOPMENT")},this.handleRedo=function(){return alert("UNDER DEVELOPMENT")}}function C(t){this.init=function(t){}}const M=function(t,e){function i(e,i,o,r){const s=function(t,e){const i=[],o={},r=function(t,e){function i(t,e){return new n(t,e)}function n(t,e){var i={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254};if(void 0===t)throw new Error("No latitude given.");if(e&&!i[e])throw new Error("Unknown unit "+e+". Use one of: "+Object.keys(i));var n=e?i[e]:1,o=Math.cos(t*Math.PI/180),r=2*o*o-1,s=2*o*r-o,a=2*o*s-r,c=2*o*a-s;this.kx=n*(111.41513*o-.09455*s+12e-5*c),this.ky=n*(111.13209-.56605*r+.0012*a)}return i.fromTile=function(t,e,i){var o=Math.PI*(1-2*(t+.5)/Math.pow(2,e));return new n(180*Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/Math.PI,i)},i.units={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},n.prototype={equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},interpolate:function(t,e,i){var n=e[0]-t[0],o=e[1]-t[1];return[t[0]+n*i,t[1]+o*i]},distance:function(t,e){var i=(t[0]-e[0])*this.kx,n=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+n*n)},bearing:function(t,e){var i=(e[0]-t[0])*this.kx,n=(e[1]-t[1])*this.ky;if(!i&&!n)return 0;var o=180*Math.atan2(-n,i)/Math.PI+90;return o>180&&(o-=360),o},destination:function(t,e,i){var n=(90-i)*Math.PI/180;return this.offset(t,Math.cos(n)*e,Math.sin(n)*e)},offset:function(t,e,i){return[t[0]+e/this.kx,t[1]+i/this.ky]},lineDistance:function(t){for(var e=0,i=0;i<t.length-1;i++)e+=this.distance(t[i],t[i+1]);return e},area:function(t){for(var e=0,i=0;i<t.length;i++)for(var n=t[i],o=0,r=n.length,s=r-1;o<r;s=o++)e+=(n[o][0]-n[s][0])*(n[o][1]+n[s][1])*(i?-1:1);return Math.abs(e)/2*this.kx*this.ky},along:function(t,e){var i=0;if(e<=0)return t[0];for(var n=0;n<t.length-1;n++){var o=t[n],r=t[n+1],s=this.distance(o,r);if((i+=s)>e)return this.interpolate(o,r,(e-(i-s))/s)}return t[t.length-1]},pointOnLine:function(t,e){for(var i,n,o,r,s=1/0,a=0;a<t.length-1;a++){var c=t[a][0],u=t[a][1],l=(t[a+1][0]-c)*this.kx,d=(t[a+1][1]-u)*this.ky;if(0!==l||0!==d){var p=((e[0]-c)*this.kx*l+(e[1]-u)*this.ky*d)/(l*l+d*d);p>1?(c=t[a+1][0],u=t[a+1][1]):p>0&&(c+=l/this.kx*p,u+=d/this.ky*p)}var h=(l=(e[0]-c)*this.kx)*l+(d=(e[1]-u)*this.ky)*d;h<s&&(s=h,i=c,n=u,o=a,r=p)}return{point:[i,n],index:o,t:r}},lineSlice:function(t,e,i){var n=this.pointOnLine(i,t),o=this.pointOnLine(i,e);if(n.index>o.index||n.index===o.index&&n.t>o.t){var r=n;n=o,o=r}var s=[n.point],a=n.index+1,c=o.index;!this.equals(i[a],s[0])&&a<=c&&s.push(i[a]);for(var u=a+1;u<=c;u++)s.push(i[u]);return this.equals(i[c],o.point)||s.push(o.point),s},lineSliceAlong:function(t,e,i){for(var n=0,o=[],r=0;r<i.length-1;r++){var s=i[r],a=i[r+1],c=this.distance(s,a);if((n+=c)>t&&0===o.length&&o.push(this.interpolate(s,a,(t-(n-c))/c)),n>=e)return o.push(this.interpolate(s,a,(e-(n-c))/c)),o;n>t&&o.push(a)}return o},bufferPoint:function(t,e){var i=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-i,t[0]+n,t[1]+i]},bufferBBox:function(t,e){var i=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-i,t[2]+n,t[3]+i]},insideBBox:function(t,e){return t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}},i(t,e)}(e[1]);return t.forEach((t=>{const s=t.id||t.properties.id;if(void 0===o[s]){o[s]=!0;const a=t.geometry.type;if("LineString"===a)t.geometry.coordinates&&n(r,t.geometry.coordinates,e).forEach((t=>{t.id=s,t.dist=r.distance(t.coords,e),i.push(t)}));else if("Point"===a){const n={id:s,type:"vertex",coords:t.geometry.coordinates,lineEdge:!0};n.dist=r.distance(n.coords,e),i.push(n)}else if("Polygon"===a){if(turf.booleanWithin(turf.point(e),t))return;t.geometry.coordinates.forEach(((t,o)=>{n(r,t,e).forEach((t=>{t.id=s,t.polygonCoordsArray=o,t.dist=r.distance(t.coords,e),i.push(t)}))}))}}})),i}(e,i);let a,c=null,u=null,l=t.id||"id";return s.forEach((t=>{const e=t.dist;null!==e&&("vertex"===t.type?null===c?c=t:void 0!==r?1e3*e<r&&c&&c.lineEdge&&(c=t):e<=c.dist&&(e===c.dist?c.lineEdge&&(c=t):c=t):e<o&&(null!==u&&e===u.dist&&u[l]!==t[l]&&"linepoint"===u.type&&(t.distance1<=u.distance1&&t.distance2<=u.distance2||t.distance2<=u.distance1&&t.distance1<=u.distance2)&&(u=t),(null===u||e<u.dist)&&(u=t,a=t.border1&&t.border2?{border1:t.border1,border2:t.border2,distance1:t.distance1,distance2:t.distance2}:null)))})),null!==c?null!==u?c.dist<o?Object.assign({borders:null},c):Object.assign({borders:a},u):Object.assign({borders:null},c):null!==u?Object.assign({borders:a},u):null}function n(t,e,i){const n=[],o=t.pointOnLine(e,i),r=o.point,s=o.index,a={type:"linepoint",coords:r},c=e[s],u=e[s+1],l=t.distance(c,i),d=t.distance(u,i);let p=!1,h=null;return l<d?(p=0===s,h=c):(p=s+1===e.length-1,h=u),a.border1=c,a.distance1=l,a.border2=u,a.distance2=d,n.push(a),n.push({type:"vertex",coords:h,lineEdge:p}),n}function o(e,i){return t.statics.constants.CIRCUM*Math.cos(e*(Math.PI/180))/Math.pow(2,i+8)}function r(e){return e?(t.Utilities.setProperty(e,"type",t.currentMode.type),t.Utilities.setProperty(e,"style",{primaryColor:t.options.colors.primarySnap,secondaryColor:t.options.colors.secondarySnap}),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([e])),e):(t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.snapFeature)}this.type=e.type,this.activate=function(){this.enabled=!0,t.options.snapping.enable=!0},this.deactivate=function(){this.enabled=!1,t.options.snapping.enable=!1,t.updateMeshData([],!0)},this.getClosest=function(e,n){var r=t.options.snapping.distance*Math.pow(2,Math.max(1,19-t.map.getZoom()))/1e5,s=!!t.options.snapping.pixels&&t.options.snapping.pixels*o(e[1],t.map.getZoom()),a=i(n=n?t.getRenderedSnapFeatures({lng:e[0],lat:e[1]},r):[t.hotFeature],e,r,s);return{point:a,coords:e=!!a&&((s||"vertex"===a.type&&a.dist<=r)&&a.coords)}},this.setClosest=function(e,n,r){var s,a=null,c=t.options.snapping.distance*Math.pow(2,Math.max(1,19-t.map.getZoom()))/1e5,u=!!t.options.snapping.pixels&&t.options.snapping.pixels*o(e[1],t.map.getZoom()),l=!(!t.pinableFeatures||!t.pinableFeatures.length)&&["case",["any",...t.pinableFeatures.map((t=>["==",["get","id"],t.id||t.properties.id]))],!1,!0],d=t.getRenderedFeatures({lng:e[0],lat:e[1]},c,l),p=!(!d||!d.length)&&i(d,e,c,u);if(t.closestPoint=p,!d&&!n||!p&&!n)return this.updateFeature(e);if(!p||!p.coords)return a;if(r||!t.lastClick)a=turf.point(p.coords);else{if(Array.isArray(t.lastClick.coords)&&Array.isArray(t.lastClick.coords[0])&&(t.lastClick.coords=t.lastClick.coords[0]),s=turf.distance(turf.point(e),turf.point(t.lastClick.coords)),t.Utilities.isPointEqual(t.lastClick.coords,p.coords)&&s>t.options.snapping.tolerance)return this.updateFeature(e);a=turf.lineString([t.lastClick.coords,p.coords])}return t.fire("snapping.add",{closest:p,snapped:a}),a},this.setFeature=function(e,i){if(t.touchClick)return null;if(!(e=e||t.snapFeature)&&i)return r(turf.point(i));if(!e)return t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),null;var n=e.geometry.coordinates,o=i||t.lastClick.coords,s=t.firstClick.coords,a="Polygon"===this.type;if(!("LineString"===e.geometry.type)||n.length<2)e=r(a?turf.lineString([s,o]):turf.point(o));else if(t.hotFeature){var c=t.hotFeature.geometry.coordinates;a&&n.pop(),c.splice.apply(c,[-1,1].concat(t.Utilities.consumableArray(n)))}else t.hotFeature=turf.lineString(n);return t.Utilities.setProperty(t.hotFeature,"type",this.type),t.Utilities.setProperty(t.hotFeature,"style",{primaryColor:t.options.colors.primaryHot,secondaryColor:t.options.colors.secondaryHot}),e=r(a?turf.lineString([s,o]):turf.point(o)),t.snapFeature=e,t.snapFeature},this.setVertex=function(){var e=t.Snapping.enabled;t.bypassSnapping&&(e=!1);var i=t.Routing.enabled;return t.bypassRouting&&(i=!1),!(!e||!t.snappedVertex)&&(t.snapFeature=this.setClosest(t.snappedVertex,!0,!0),i&&(t.snapFeature=t.Routing.getClosest()||t.snapFeature),t.snapFeature?(t.Utilities.setProperty(t.snapFeature,"type",t.currentMode.type),t.map.getSource(t.statics.constants.sources[i?"ROUTE":"SNAP"]).setData(turf.featureCollection([t.snapFeature])),t.hotFeature.geometry.coordinates[t.dragIndex]=t.snapFeature.geometry.coordinates,t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),void t.fire("vertex.dragsnap",{feature:t.hotFeature,vertex:turf.point(t.snappedVertex)})):t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])))},this.addFeature=function(e,i={},n){if(t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),!e||n)return!1;i&&(e.properties=t.Utilities.assignDeep(t.Utilities.cloneDeep(i),e.properties)),t.snapFeature=e,t.map.getSource(t.statics.constants.sources[e.properties.routing?"ROUTE":"SNAP"]).setData(turf.featureCollection([t.snapFeature]))},this.updateFeature=function(e){if(t.closestPoint=null,!t.lastClick)return null;if(!t.firstClick||t.mouseIsDown)return null;var i=t.Features.getType(t.hotFeature)||t.currentMode.type,n=t.hotFeature?t.Utilities.getLastIndexCoords(t.hotFeature):t.lastClick.coords,o=turf.point(e),r=i&&"Polygon"===i&&t.hotFeature?[n,e,t.firstClick.coords]:[n,e],s=turf.lineString(r);s.properties.type=i,s.properties.hint=!0,s.properties.style={primaryColor:t.options.colors.primarySnap,secondaryColor:t.options.colors.secondarySnap};var a="feet",c=t.Features.getUnits(s);return o=function(e,i={}){var n=t.map.getSource(t.statics.constants.sources.HOTTEXT)._data.features;n.length&&n[n.length-1].properties.mouseLine&&n.pop();return e.properties.units=i.units,e.properties.unit=i.unit,e.properties.text=`${i.units} ${i.unit}`,e.properties.transform="uppercase",e.properties.anchor="bottom-left",e.properties.mouseLine=!0,n.push(e),t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection(n)),e}(o,{units:c=t.Features.convertUnits(s,c,a),unit:a}),s},t.options.snapping.enable&&this.activate()},w=function(t,e){function i(e){if(!e||!e.length)return!1;e.forEach((function(e){this.updatedFeatures.find((function(t){return t.id===e.id}))||this.updatedFeatures.push(t.Utilities.cloneDeep(e.feature))}),this)}this.type=e.type,this.updatedFeatures=[],this.activate=function(){this.updatedFeatures=[],this.enabled=!0,t.options.pinning.enable=!0},this.deactivate=function(){this.enabled=!1,t.options.pinning.enable=!1,this.resetFeatures(),delete this.buffer,delete t.pinableFeatures,delete t.pinningFeatures,this.updatedFeatures=[]},this.getFeatures=function(){return t.pinnedFeatures&&t.pinnedFeatures.length?t.pinnedFeatures.map((function(t){return t.feature})):[]},this.setBuffer=function(e){if(delete this.buffer,!this.enabled)return!1;if(!e||!t.options.pinning.buffer)return!1;var i=turf.buffer(turf.point(e),t.options.pinning.buffer),n=turf.polygon(i.geometry.coordinates);return this.buffer={feature:i,radius:n,coords:e},this.buffer},this.setFeatures=function(e){return t.pinableFeatures=[],!(!this.enabled||!e)&&(t.pinableFeatures=this.getNearByFeatures(e),t.fire("pinning.add",{features:t.pinableFeatures,buffer:this.buffer}),t.pinableFeatures)},this.resetFeatures=function(){if(!this.updatedFeatures.length)return!1;t.addFeatures(this.updatedFeatures,!0)},this.updateFeatures=function(){return!!this.enabled&&(t.pinableFeatures&&t.pinableFeatures.length?(i.call(this,t.pinableFeatures),t.Features.updateFeatures(t.pinableFeatures,t.snappedVertex),t.pinnedFeatures=t.Utilities.cloneDeep(t.pinableFeatures),t.fire("pinning.update",{feature:t.hotFeature,vertex:turf.point(t.snappedVertex),features:t.pinnedFeatures}),t.pinningFeatures):(delete t.pinningFeatures,!1))},this.getNearByFeatures=function(e){if(!this.enabled||!e)return!1;var i=t.hotFeature,n=t.options.snapping.distance*Math.pow(2,Math.max(1,19-t.map.getZoom()))/1e5,o=this.setBuffer(e),r=t.getRenderedDrawnFeatures({lng:e[0],lat:e[1]},n),s=[];return r.forEach((function(e){turf.coordEach(e,(function(n,r){var a=!1;o.radius&&turf.booleanWithin(turf.point(n),o.radius)&&(a=!0),!a&&o.coords&&t.Utilities.isPointEqual(n,o.coords)&&(a=!0),a&&(i&&i.id===e.id||s.push({id:e.id||e.properties.id,type:e.properties.type,index:r,feature:e}))}))})),s},t.options.pinning.enable&&this.activate()},L=function(t,e){function i(t,e){if(e=e||{},t.compactedVertices||(t=function(t,e){var i;e=e||{};var n=e.weightFn||function(t,e){return turf.distance(turf.point(t),turf.point(e))};"FeatureCollection"===t.type?i=function(t,e){e=e||{};var i=e.keyFn||function(t){return t.join(",")},n=e.precision||1e-5,o=function(t,e){var i=[];"FeatureCollection"===t.type&&(i=i.concat(t.features.filter(e)));return{type:"FeatureCollection",features:i}}(t,a),c=turf.explode(o).features.reduce((function(t,o,s,a){var c=r(o.geometry.coordinates,n);return t[i(c)]=o.geometry.coordinates,s%1e3==0&&e.progress&&e.progress("topo:vertices",s,a.length),t}),{}),u=s(o,(function(t,o,s,a){return o.geometry.coordinates.forEach((function(e,s,a){if(s>0){var c=i(r(a[s-1],n)),u=i(r(e,n));t.push([c,u,o.properties])}})),s%1e3==0&&e.progress&&e.progress("topo:edges",s,a.length),t}),[]);return{vertices:c,edges:u}}(t,e):t.edges&&(i=t);t=i.edges.reduce((function(t,o,r,s){var a=o[0],c=o[1],u=o[2],l=n(i.vertices[a],i.vertices[c],u),d=function(i){t.vertices[i]||(t.vertices[i]={},e.edgeDataReduceFn&&(t.edgeData[i]={}))},p=function(i,n,o){t.vertices[i][n]=o,e.edgeDataReduceFn&&(t.edgeData[i][n]=e.edgeDataReduceFn(e.edgeDataSeed,u))};return l&&(d(a),d(c),l instanceof Object?(l.forward&&p(a,c,l.forward),l.backward&&p(c,a,l.backward)):(p(a,c,l),p(c,a,l))),r%1e3==0&&e.progress&&e.progress("edgeweights",r,s.length),t}),{edgeData:{},vertices:{}});var c=function(t,e,i,n){n=n||{};var r=n.progress,s=Object.keys(t).reduce((function(e,i,o,s){var a,c=t[i],u=Object.keys(c),l=u.length;if(!1===n.compact)a=!1;else if(1===l){a=!t[u[0]][i]}else a=2===l&&u.filter((function(e){return t[e][i]})).length===l;return a||(e[i]=c),o%1e3==0&&r&&r("compact:ends",o,s.length),e}),{});return Object.keys(s).reduce((function(a,c,u,l){var d=o(c,t,s,e,i,!1,n);return a.graph[c]=d.edges,a.coordinates[c]=d.coordinates,n.edgeDataReduceFn&&(a.reducedEdges[c]=d.reducedEdges),u%1e3==0&&r&&r("compact:nodes",u,l.length),a}),{graph:{},coordinates:{},reducedEdges:{}})}(t.vertices,i.vertices,t.edgeData,e);return{vertices:t.vertices,edgeData:t.edgeData,sourceVertices:i.vertices,compactedVertices:c.graph,compactedCoordinates:c.coordinates,compactedEdges:e.edgeDataReduceFn?c.reducedEdges:null}}(t,e)),this._graph=t,this._keyFn=e.keyFn||function(t){return t.join(",")},this._precision=e.precision||1e-5,this._options=e,0===Object.keys(this._graph.compactedVertices).filter((function(t){return"edgeData"!==t})).length)return null;this.findPath=function(t,e){var i=this._keyFn(r(t.coords,this._precision)),o=this._keyFn(r(e.coords,this._precision));if(!this._graph.vertices[i]||!this._graph.vertices[o])return null;this._createPhantom(i),this._createPhantom(o);var s=function(t,e,i){var o={};o[e]=0;var r=[0,[e],e],s=new n([r],(function(t,e){return t[0]-e[0]}));for(;s.length;){var a=s.pop(),c=a[0],u=a[2];if(u===i)return a.slice(0,2);var l=t[u];Object.keys(l).forEach((function(t){var e=c+l[t];if(!(t in o)||e<o[t]){o[t]=e;var i=[e,a[1].concat([t]),t];s.push(i)}}))}return null}(this._graph.compactedVertices,i,o);if(s){var a=s[0];return{fullPath:s=s[1],path:s.reduce(function(t,e,i,n){return i>0&&(t=t.concat(this._graph.compactedCoordinates[n[i-1]][e])),t}.bind(this),[]).concat([this._graph.sourceVertices[o]]),weight:a,edgeDatas:this._graph.compactedEdges?s.reduce(function(t,e,i,n){return i>0&&t.push({reducedEdge:this._graph.compactedEdges[n[i-1]][e]}),t}.bind(this),[]):void 0}}return null},this.serialize=function(){return this._graph},this._createPhantom=function(t){if(this._graph.compactedVertices[t])return null;var e=o(t,this._graph.vertices,this._graph.compactedVertices,this._graph.sourceVertices,this._graph.edgeData,!0,this._options);return this._graph.compactedVertices[t]=e.edges,this._graph.compactedCoordinates[t]=e.coordinates,this._graph.compactedEdges&&(this._graph.compactedEdges[t]=e.reducedEdges),Object.keys(e.incomingEdges).forEach(function(i){this._graph.compactedVertices[i][t]=e.incomingEdges[i],this._graph.compactedCoordinates[i][t]=[this._graph.sourceVertices[i]].concat(e.incomingCoordinates[i].slice(0,-1)),this._graph.compactedEdges&&(this._graph.compactedEdges[i][t]=e.reducedEdges[i])}.bind(this)),t},this._removePhantom=function(t){t&&(Object.keys(this._graph.compactedVertices[t]).forEach(function(e){delete this._graph.compactedVertices[e][t]}.bind(this)),Object.keys(this._graph.compactedCoordinates[t]).forEach(function(e){delete this._graph.compactedCoordinates[e][t]}.bind(this)),this._graph.compactedEdges&&Object.keys(this._graph.compactedEdges[t]).forEach(function(e){delete this._graph.compactedEdges[e][t]}.bind(this)),delete this._graph.compactedVertices[t],delete this._graph.compactedCoordinates[t],this._graph.compactedEdges&&delete this._graph.compactedEdges[t])}}function n(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=function(t,e){return t<e?-1:t>e?1:0}),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i);this.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},this.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},this.peek=function(){return this.data[0]},this._up=function(t){for(var e=this.data,i=this.compare,n=e[t];t>0;){var o=t-1>>1,r=e[o];if(i(n,r)>=0)break;e[t]=r,t=o}e[t]=n},this._down=function(t){for(var e=this.data,i=this.compare,n=this.length>>1,o=e[t];t<n;){var r=1+(t<<1),s=e[r],a=r+1;if(a<this.length&&i(e[a],s)<0&&(r=a,s=e[a]),i(s,o)>=0)break;e[t]=s,t=r}e[t]=o}}function o(t,e,i,n,o,r,s){s=s||{};var a=e[t];return Object.keys(a).reduce((function(a,c){var u=function(t,e,i,n,o,r,s,a){var c=i[t][e],u=i[e][t],l=[],d=[],p=a.edgeDataSeed;for(a.edgeDataReduceFn&&(p=a.edgeDataReduceFn(p,r[e][t]));!n[e];){var h=i[e];if(!h)break;var f=Object.keys(h).filter((function(e){return e!==t}))[0];if(c+=h[f],s){if(u+=i[f][e],d.indexOf(e)>=0){n[e]=i[e];break}d.push(e)}a.edgeDataReduceFn&&(p=a.edgeDataReduceFn(p,r[e][f])),l.push(o[e]),t=e,e=f}return{vertex:e,weight:c,reverseWeight:u,coordinates:l,reducedEdge:p}}(t,c,e,i,n,o,r,s),l=u.weight,d=u.reverseWeight;if(u.vertex!==t&&((!a.edges[u.vertex]||a.edges[u.vertex]>l)&&(a.edges[u.vertex]=l,a.coordinates[u.vertex]=[n[t]].concat(u.coordinates),a.reducedEdges[u.vertex]=u.reducedEdge),r&&!isNaN(d)&&(!a.incomingEdges[u.vertex]||a.incomingEdges[u.vertex]>d))){a.incomingEdges[u.vertex]=d;var p=[n[t]].concat(u.coordinates);p.reverse(),a.incomingCoordinates[u.vertex]=p}return a}),{edges:{},incomingEdges:{},coordinates:{},incomingCoordinates:{},reducedEdges:{}})}function r(t,e){return[Math.round(t[0]/e)*e,Math.round(t[1]/e)*e]}function s(t,e,i){return"FeatureCollection"===t.type?t.features.reduce((function(t,i){return s(i,e,t)}),i):e(i,t)}function a(t){return"LineString"===t.geometry.type}function c(t,e,i){return(!e||"linepoint"!==e.type)&&(!(!(i&&i.path&&i.path.length)||i.path.length<2)&&i)}this.type=e.type,this.graphData={},this.features=t.Features.getColdFeatures(),this.activate=function(){this.enabled=!0,t.options.routing.enable=!0},this.deactivate=function(){this.enabled=!1,t.options.routing.enable=!1,t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([]))},this.getRoute=function(e,n){if(!this.enabled||t.mapMoving)return!1;var o=new i(turf.featureCollection(this.getFeatures()),t.options.routing),r=!!o.findPath&&o.findPath(e,n);return r=c(e,n,r),t.fire("routing.add",{from:e,to:n,path:r}),r},this.getMatch=async function(e){var i=await t.Exploring.getMatch(e,{set:!0,start:t.startPoint});return i.properties.routing=!0,i},this.getClosest=function(){if(!t.closestPoint||!t.lastClick)return!1;var e=this.getRoute(t.lastClick,t.closestPoint);if(!e||!e.path)return!1;var i=turf.lineString(e.path);return i.properties.routing=!0,i},this.getFeatures=function(){return[t.meshIndex.getFeatures(),this.features].flat().filter((function(t){return"LineString"===t.geometry.type}))},t.options.routing.enable&&this.activate()},S=function(t,e){function i(t,e,i,n){var o=e.split("."),r=parseInt(o[0],10),s=parseInt(o[1],10);void 0===t.geometry.coordinates[r]&&(t.geometry.coordinates[r]=[]),t.geometry.coordinates[r][s]=[i,n]}this.type=e.type,this.feature=!1,this.currentCoords=[],this.activate=function(){this.deactivate(),this.enabled=!0,t.options.painting.enable=!0,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))},this.deactivate=function(){this.enabled=!1,t.options.painting.enable=!1,t.map.dragPan.enable(),delete this.feature},this.getFeature=function(){return this.feature},this.setFeature=function(e){if(!this.type||!e)return!1;if(!t.mouseIsDown)return t.hotFeature;var i=this.type,n=function(e,i){var n;"Rectangle"===e?n=turf.polygon([[t.mouseIsDown,i,i,t.mouseIsDown]]):"Circle"===e?(n=turf.polygon([[t.mouseIsDown,i,i,t.mouseIsDown]]),t.Utilities.setProperty(n,"center",t.mouseIsDown)):n=turf.lineString([t.mouseIsDown,i]);return t.Utilities.setProperty(n,"type",e),t.Utilities.setProperty(n,"painting",1),n}(i,e);return this.feature||(this.currentCoords=[],t.startPoint=e,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([n])),t.fire("painting.start",{type:i,coords:e,feature:n})),this.currentCoords.push(e),this.feature=n,this.feature},this.updateFeature=function(e){if(!this.enabled)return t.hotFeature;if(!this.feature)return this.setFeature(e);var n=this.feature,o=this.type;if(this.currentCoords.push(e),"Rectangle"===o)i(n,"0.1",e[0],t.mouseIsDown[1]),i(n,"0.2",e[0],e[1]),i(n,"0.3",t.mouseIsDown[0],e[1]),i(n,"0.4",t.mouseIsDown[0],t.mouseIsDown[1]);else if("Circle"===o){var r=n.properties.center;if(!r||!r.length)return n;const i=turf.distance(turf.point(r),turf.point(e),{units:"kilometers"}),o=turf.circle(r,i);n.geometry.coordinates=o.geometry.coordinates,t.Utilities.setProperty(n,"radiusInKm",i)}else n.geometry.coordinates.push(e);return t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([this.feature])),t.fire("painting.update",{type:o,coords:e,feature:n}),n},this.handleUp=async function(i){return!!this.feature&&(t.Exploring.enabled&&(this.feature=await t.Exploring.getMatch(this.currentCoords,{set:!0,start:t.startPoint})),n=e.updateHotSource(this.feature),n=t.Utilities.cloneDeep(n),t.lastClick={coords:n.geometry.coordinates[n.geometry.coordinates.length-1]},this.currentCoords=[],this.feature=n,n);var n},t.options.painting.enable&&this.activate()},T=function(t,e){this.type=e.type,this.activate=function(){this.enabled=!0,t.options.exploring.enable=!0},this.deactivate=function(){this.enabled=!1,this.currentMatch=!1,t.options.exploring.enable=!1},this.setFeatures=function(e,i={}){if(t.mapMoving||!this.enabled||"draw"!==t.currentMode.id)return!1;if(!t.Routing.enabled){t.hotFeature&&t.hotFeature.geometry.coordinates.pop();e=[t.currentMode.firstClick||!t.hotFeature?t.firstClick.coords:t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1],e];return!t.Utilities.isPointEqual(e[0],e[1])&&this.getRoute(e,i)}if(t.map.getZoom()<t.options.exploring.minZoom)return alert(`Zoom must be lower than ${t.options.exploring.minZoom}`);var n=i.buffer||t.options.exploring.buffer*Math.pow(2,Math.max(1,19-t.map.getZoom()))/100,o=turf.bboxPolygon([t.map.getBounds().getWest(),t.map.getBounds().getSouth(),t.map.getBounds().getEast(),t.map.getBounds().getNorth()]);e&&(o=turf.polygon(turf.buffer(turf.point(e),n).geometry.coordinates)),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([o])),this.getFeatures(turf.bbox(o)).then((e=>{!function(e=[]){if(t.overpassDownloading=!1,t.mapMoving||!t.Exploring.enabled||"draw"!==t.currentMode.id)return t.updateMeshData([],!0);if(t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),t.Snapping.addFeature(t.snapFeature),t.setMeshFeatures(e),t.currentMode.updateHotSource(),t.fire("overpass.add",{features:e}),!t.currentMode.firstClick)return e;var i=turf.explode(turf.featureCollection(e)),n=turf.nearestPoint(turf.point(t.currentMode.firstClick.coords),i);t.lastClick={coords:n.geometry.coordinates}}(e)}))},this.setFeature=function(i=[],n={}){if(!i.length)return t.hotFeature;var o=turf.lineString(i);return o.geometry.coordinates[0]=n.start||o.geometry.coordinates[0],this.currentMatch&&(o=turf.lineString(t.Utilities.combineSameTypeFeatures([this.currentMatch,o]))),this.currentMatch=o,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.fire("exploring.match",{route:this.currentMatch}),e.updateHotSource(this.currentMatch)},this.getFeatures=async function(e){if(!e||!e.length||4!=e.length)return!1;var i=`way["highway"](${e[1]} , ${e[0]} , ${e[3]} , ${e[2]});`;t.map.getZoom()<12&&(i=`way["highway"="motorway"](${e[1]} , ${e[0]} , ${e[3]} , ${e[2]});`),t.overpassDownloading=!0;const n="[out:json][timeout:25];("+i+");out body;>;out skel qt;",o=await fetch("//overpass-api.de/api/interpreter?data="+n,{method:"GET"}),r=function(e){const i={};e.elements.forEach((t=>{const e=`${t.type}-${t.id}`;i[e]=t}));const n=function(t){const e=[];return t.nodes.forEach((t=>{const n=i[`node-${t}`];n&&e.push([n.lon,n.lat])})),e},o=[];return e.elements.forEach((t=>{if("way"===t.type){const e=n(t);e.length>1&&o.push(turf.lineString(e,t.tags))}else"relation"===t.type&&t.members.forEach((e=>{if("way"===e.type){const r=`way-${e.ref}`,s=i[r],a=n(s);a.length>1&&o.push(turf.lineString(a,t.tags))}}))})),t.turf.featureCollection(o)}(await o.json());return r&&r.features?r.features:[]},this.getMatch=async function(e=[],i={}){if(!e.length)return!1;var n=t.options.exploring.tolerance,o=i.feature||turf.cleanCoords(turf.lineString(e)),r=(o=turf.simplify(o,{mutate:!0,tolerance:"function"==typeof n?n(t.map):n,highQuality:!0})).geometry.coordinates;if(r.length<2)return!1;t.overpassDownloading=!0,i.radius=i.radius||50,i.profile=i.profile||"driving",e=r.join(";");const s=r.map((()=>i.radius)).join(";"),a="https://router.project-osrm.org/match/v1/"+i.profile+"/"+e+"?overview=simplified&radiuses="+s+"&generate_hints=false&skip_waypoints=true&gaps=ignore&annotations=nodes&tidy=true&geometries=geojson",c=await fetch(a,{method:"GET"}),u=await c.json();return t.overpassDownloading=!1,"Ok"!==u.code&&alert(`${u.code} - ${u.message}.`),i.set?u.matchings&&u.matchings.length?this.setFeature(u.matchings[0].geometry.coordinates,i):o:u},this.getRoute=async function(e=[],i={}){if(!e.length)return!1;var n=i.feature||turf.cleanCoords(turf.lineString(e)),o=n.geometry.coordinates;if(o.length<2)return!1;t.overpassDownloading=!0,i.profile=i.profile||"driving",e=o.join(";");const r="https://router.project-osrm.org/route/v1/"+i.profile+"/"+e+"?overview=simplified&continue_straight=true&annotations=nodes&geometries=geojson",s=await fetch(r,{method:"GET"}),a=await s.json();return t.overpassDownloading=!1,"Ok"!==a.code&&alert(`${a.code} - ${a.message}.`),i.set?a.routes&&a.routes.length?this.setFeature(a.routes[0].geometry.coordinates,i):n:a},t.options.exploring.enable&&this.activate()};var F=[],O=[];const P=function(){if(!t)throw new Error("MapboxGL script is required!");if(!e)throw new Error("TurfJS script is required!");if(!n.A)throw new Error("Omnivore script is required!");const i=this,o=this.turf=e,r=this.omnivore=n.A;this.version="1.0.3",this.Mapbox=t,this.options=s,this.dev=this.statics.dev,this.id=this.statics.id,this.modes=[],this.plugins={},this.gamepads={},this.enabled=!1,this.mobile=/(iphone|ipod|ipad|android|iemobile|blackberry|bada)/.test(window.navigator.userAgent.toLowerCase())||navigator.userAgent.includes("Mac")&&"ontouchend"in document,this.initialize=function(){return this.initialized||(window[this.id]=this,this.Utilities=new a(this),this.initialized=!0),this},this.init=function(t={},e){if(!t.accessToken)throw new Error("No Mapbox Access Token Provided!");const n=t.container||this.options.map.container;if(!n)throw new Error("Element id is required in the DOM for the map!");return this.options.map.accessToken=t.accessToken,this.options.map.styles=t.styles,this.options.map.container=n,delete t.accessToken,delete t.container,delete t.styles,this.setOptions(t),this.isReady?this.build(this._container):(this.onReady=!(!e||"function"!=typeof e)&&e,async function(t){var e=0;return new Promise((async function(i,n){var o=setInterval((function(){var r=document.getElementById(t);return 1e4===e?(clearInterval(o),n(!1)):r?(clearInterval(o),i(r)):e++}),1)}))}(this.options.map.container).then((function(t,e){if(!t||e)throw new Error(`Element with id "${n}" is required in the DOM for the map!`);i.isReady=!0,i._container=t,i._container.classList.add(i.statics.id),i.Map=new u(i,i.options.map)})),this)},this.load=function(){return!this.isLoaded&&this.isReady&&this.Map.getMap()?(this.map=this.Map.getMap(),this.container=this.Map.getContainer(),this.fullscreen=new t.FullscreenControl({container:document.querySelector("body")}),this.navigation=new t.NavigationControl({visualizePitch:!0,showZoom:!this.mobile,showCompass:!0}),this.attribution=new m(this,{type:"attribute",position:"bottom-right",enable:!0,show:!0,attribution:this.statics.logo.full}),this.map.addControl(this.navigation,this.mobile?"bottom-right":"top-right"),this.mobile||this.map.addControl(this.fullscreen,"top-right"),this.styles=this.map.addControl(new y(this,this.options.map.styles)),this.Locate=new b(this,{init:!0}),this.Layers=new l(this,{init:!0}),this.Features=new d(this,{init:!0}),this.Events=function(t){const e=function(e){t.mapMoving=e,t.Locate&&t.Locate.onMapMove(e),t.setIcon(e)},i=function(e){t.mapMoving=e,t.setIcon(e),t.setCenterMarker(),t.Locate&&t.Locate.following&&t.setMapClass("disable")},n=function(e){t.mapMoving=!1,t.Map.onMapMove(e),t.Locate&&t.Locate.onMapMove(e),t.setIcon(e)},o=function(e){var i=t.options.painting&&t.options.painting.enable;i=i&&t.currentMode&&"draw"===t.currentMode.id,t.Locate&&t.Locate.following?t.setMapClass("disable"):t.dragMoving?t.setMapClass("grabbing"):t.addingVertexOnLine||t.canAddVertex?t.setMapClass("pointer"):t.canDragMove?t.setMapClass("grab"):i?t.setMapClass("painting"):t.setMapClass("pointer"),t.lastMouseEvent=e,t.currentMode.handleMove&&t.currentMode.handleMove(e)},r=function(e){var i=t.options.painting&&t.options.painting.enable;i=i&&t.currentMode&&"draw"===t.currentMode.id,t.Locate&&t.Locate.following?t.setMapClass("disable"):i?t.setMapClass("painting"):t.dragMoving||t.addingVertexOnLine?t.setMapClass("grabbing"):t.canDragMove?t.setMapClass("grab"):t.lastClick?t.setMapClass("grabbing"):t.setMapClass("pointer"),t.mouseIsDown=[e.lngLat.lng,e.lngLat.lat],t.currentMode.handleDown&&t.currentMode.handleDown(e)},s=function(e){t.mouseIsDown=!1,t.Locate&&t.Locate.following?t.setMapClass("disable"):t.setMapClass("pointer"),t.currentMode.handleUp&&t.currentMode.handleUp(e)},a=async function(e){if(e.type.includes("preclick"))return!!t.currentMode.handlePreclick&&t.currentMode.handlePreclick(e);t.currentMode.handleClick&&t.currentMode.handleClick(e)},c=function(e){t.Locate&&t.Locate.following?t.setMapClass("disable"):t.dragMoving?t.setMapClass("grabbing"):t.canDragMove?t.setMapClass("grab"):t.setMapClass("move"),t.currentMode.handleDrag&&t.currentMode.handleDrag(e)},u=function(e){t.currentMode.handleOffMap&&t.currentMode.handleOffMap(e)},l=function(e){t.currentMode.handleOnMap&&t.currentMode.handleOnMap(e)},d=function(e){if(t.textMarker)return;const i=t.getButtons();let n=!1;if(Object.keys(i).forEach((o=>{const r=i[o],s=t.options.keys[o];(s===e.key||s===e.keyCode||r.keycode&&r.keycode===e.keyCode)&&(r.button.click(),n=!0)})),t.options.commands&&t.options.commands.forEach((function(i){if(i.key===e.keyCode||i.key===e.key||i.key===e.code){if(!i.command||"function"!=typeof i.command)return;i.command(e,t,i),n=!0}})),n)return n;switch(e.key.includes("Arrow"),e.code){case"Enter":case"NumpadEnter":t.setMode();break;case"Escape":t.hotFeature=null,t.setMode();break;case"Home":t.moveSelectedFeatures(1);break;case"End":t.moveSelectedFeatures(-1);break;case"Delete":t.mode===t.statics.constants.modes.SELECT?t.hasSelection()&&t.removeSelection():t.mode===t.statics.constants.modes.DRAW&&t.currentMode.deleteVertex()}},p=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},f=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},g=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},m=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},y=function(e){t.addGamepad(e.gamepad||e.detail.gamepad)},v=function(e){t.removeGamepad(e.gamepad||e.detail.gamepad)},b=function(e){t.updateOrientation({alpha:e.alpha,beta:e.beta,gamma:e.gamma})},x=function(t){},E=function(e){t.setMapClass("grabbing"),t.setIcon(e),t.setCenterMarker({transform:!0})},C=function(e){const i=e.type.split(":")[1],n={data:e.detail,type:i.split(".")[0],action:i.split(".")[1],target:t},o={name:i,detail:n};t.map.fire(t.id,o)},M=function(e){t.currentMode.handleContext&&t.currentMode.handleContext(e)},w=function(e){if(!e.sourceDataType||"content"===!e.sourceDataType||!e.sourceId)return!1;const i=e.sourceId,n={id:i,data:e.source.data,type:e.type,target:t};i===t.statics.constants.sources.HOT&&t.fire("source.hot",n)};return{addEventListeners:function(){t.map.on("movestart",e),t.map.on("move",i),t.map.on("moveend",n),t.map.on("mousemove",o),t.map.on("preclick",a),t.map.on("click",a),t.map.on("tap",a),t.map.on("dragstart",x),t.map.on("drag",c),t.map.on("mousedown",r),t.map.on("mouseup",s),t.map.on("rotatestart",E),t.map.on("pitchstart",E),t.map.on("rotate",E),t.map.on("pitch",E),t.map.on("touchstart",p),t.map.on("touchend",f),t.map.on("touchmove",g),t.map.on("touchcancel",m),t.map.on("contextmenu",M),t.map.on("sourcedata",w),h.forEach((function(e){t.map.on(t.id+":"+e,C)})),t.container.addEventListener("keydown",d),t.container.addEventListener("mouseover",l),t.container.addEventListener("mouseleave",u),window.addEventListener("gamepadconnected",y),window.addEventListener("gamepaddisconnected",v),window.addEventListener("deviceorientation",b,!0)},removeEventListeners:function(){t.map.off("movestart",e),t.map.off("move",i),t.map.off("moveend",n),t.map.off("mousemove",o),t.map.off("preclick",a),t.map.off("click",a),t.map.off("tap",a),t.map.off("dragstart",x),t.map.off("drag",c),t.map.off("mousedown",r),t.map.off("mouseup",s),t.map.off("rotatestart",E),t.map.off("pitchstart",E),t.map.off("touchstart",p),t.map.off("touchend",f),t.map.off("touchmove",g),t.map.off("touchcancel",m),t.map.off("contextmenu",M),t.map.off("sourcedata",w),h.forEach((function(e){t.map.off(t.id+":"+e,C)})),t.container.removeEventListener("keydown",d),t.container.removeEventListener("mouseover",l),t.container.removeEventListener("mouseleave",u),window.removeEventListener("gamepadconnected",y),window.removeEventListener("gamepaddisconnected",v),window.removeEventListener("deviceorientation",b,!0)}}}(this),this.Events.removeEventListeners(),this.Events.addEventListeners(),this.onReady&&this.onReady(this),this.Map.setExtent(!1,!0),this.options.enable&&this.enable(),this.isLoaded=!0,this.fire("sdk.ready",{enabled:this.enabled,map:this.map,ready:this.isLoaded}),this):this},this.enable=function(t,e={}){return this.enabled||(this.mode=t&&"select"!==t?"draw":"select",this.type=t,this.setOptions(e),this.setControls(),this.Select=new x(this),this.Draw=new E(this),this.Edit=new C(this),this.modes=[this.Select,this.Draw,this.Edit],this.enabled=!0,this.fire("map.enable",{enabled:this.enabled,mode:this.mode,type:this.type}),this.redraw(),this.setMode({mode:this.mode,type:this.type})),this},this.disable=function(){return this.enabled?(this.modes=[],this.enabled=!1,this.mode=null,this.options=s,this.fire("map.disable",{enabled:this.enabled,mode:this.mode}),this.doubleClickZoom.enable(this.map),this.Layers.removeEventListeners(),this.Events.removeEventListeners(),this.Layers.removeLayers(),this.removeControls(),this):this},this.redraw=async function(){if(!this.Events)return!1;await this.Layers.refresh(),this.Events.removeEventListeners(),this.Events.addEventListeners(),this.Features.updateSource(),this.doubleClickZoom.disable(this.map),this.fire("map.redraw",{enabled:this.enabled,mode:this.mode})},this.refresh=async function(){if(this.noRefresh)return!1;await this.redraw()},this.once=function(t,e){return!(!this.map||!t)&&this.map.once(this.id+":"+t,e)},this.on=function(t,e){if(!e.name)throw new Error("Function must have a name!");return!(!this.map||!t)&&this.map.on(this.id+":"+t,e)},this.off=function(t,e){if(!e.name)throw new Error("Function must have a name!");return!(!this.map||!t)&&this.map.off(this.id+":"+t,e)},this.fire=function(t,e){return!(!this.map||!t)&&this.map.fire(this.id+":"+t,{detail:e})},this.setOptions=function(t={}){return this.options=i.Utilities.assignDeep(this.options||{},t),this.options},this.setMode=function(t={}){t.mode||(t.mode=this.statics.constants.modes.SELECT),t.type||(t.type="Polyline");var e,n=[],o=null,r=t.mode===this.statics.constants.modes.EDIT;if(this.currentMode&&t.mode===this.mode&&t.type===this.currentMode.type)return this.currentMode;if(r){if(!t.feature)return this.currentMode&&this.currentMode.deactivate(),this.setMode();t.feature=i.Utilities.cloneDeep(t.feature),t.mode=this.statics.constants.modes.DRAW,t.type=t.type||t.feature.properties.type,this.editing=i.Utilities.cloneDeep(t.feature),this.removeSelection()}(this.currentMode&&this.currentMode.activated&&this.currentMode.deactivate(),this.container.classList.forEach((function(t){-1!==t.indexOf("mouse-")&&n.push(t)})),n.length>0)&&(e=this.container.classList).remove.apply(e,n);return this.setMapClass("pointer"),this.modes.forEach((function(e){e.canHandle&&e.canHandle(t.mode)&&(o=e)})),o&&(this.fire("mode.change",{old:this.mode,new:t.mode,mode:o,type:t.type}),this.currentMode=o,this.mode=t.mode,o.activate(t)),this.Snapping=new M(this,this.currentMode),this.Pinning=new w(this,this.currentMode),this.Routing=new L(this,this.currentMode),this.Exploring=new T(this,this.currentMode),this.Painting=new S(this,this.currentMode),this.Layers.moveLayers(),this.currentMode},this.setControls=function(t=[]){return this.controls&&this.controls.length?this.controls:!!this.options.controls&&(this.controls=[],(t=t.length?t:this.statics.controls).forEach((function(t){this.controls.push(new m(this,t))}),this),this.controls)},this.setIcon=function(t){!!this.navigation&&this.navigation._compassIcon,this.Locate&&this.Locate.following},this.setCenterMarker=function(t={}){if(!this.mobile||this.noCenterMarker)return!1;var e,i=this.Locate&&this.Locate.following,n=this.statics.logo.icon;if(t.remove)return!(!this.centerMarker||this.centerMarker.noRemove)&&(this.centerMarker.remove(),delete this.centerMarker);if(this.centerMarker)return this.centerMarker.setLngLat(this.map.getCenter()).addTo(this.map),(t.transform||t.gamepad)&&this.centerMarker.setPitchAlignment("map"),this.centerMarker;if(t.dontAdd)return!1;return this.centerMarkerIcon||((e=document.createElement("div")).className=this.id+"-center-marker",function(t,e){t.style.backgroundImage=`url("${e}")`}(e,n)),this.centerMarkerIcon=e,this.centerMarker=new this.Mapbox.Marker(this.centerMarkerIcon),this.centerMarker.setLngLat(this.map.getCenter()).addTo(this.map).setOffset([0,0]),this.centerMarker.noRemove=t.noRemove,i&&this.centerMarker.setOffset([0,-20]),this.centerMarker},this.setButtons=function(){return!!this.getButtons("select")&&this.getButtons("select").add()},this.setActiveButton=function(t){if(!this.controls||!this.controls.length)return!1;this.controls.forEach((function(e){e.setActiveButton(t.toLowerCase())}))},this.setTheme=function(t){this.Control&&this.Control.setTheme(t)},this.setCustomLayers=async function(t=[],e={}){return this.removeFeatures(t,e),await this.Layers.setCustomLayers(t,e)},this.setSelectedFeatures=function(t=[]){if(!t.length)return!1;F.splice(0,F.length,...t),this.map.getSource(this.statics.constants.sources.SELECT).setData(o.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(o.featureCollection(this.getSelectedFeatures())),this.fire("select.load",{features:o.featureCollection(this.getSelectedFeatures()),source:this.map.getSource(this.statics.constants.sources.SELECT)})},this.setMeshFeatures=function(t=[]){return!!t.length&&(this.updateMeshData(t,!0),this.meshIndex.getFeatures())},this.setMapClass=function(t){if(this.container.classList.forEach((function(t){-1!==t.indexOf("mouse-")&&this.container.classList.remove(t)}),this),!t)return!1;this.container.classList.add("mouse-"+t)},this.hasControls=function(){return this.controls&&this.controls.length},this.hasSelection=function(){return this.getSelectedFeatures().length>0},this.hasSingleSelection=function(){return 1===this.getSelectedFeatures().length},this.activateSnapping=function(){var t=this.getButtons("snapping");if(t)return t.activate(),this.Snapping.activate(),this.fire("snapping.activate",{enabled:!0,mesh:this.meshIndex,snapping:this.Snapping}),this.Snapping},this.activatePinning=function(){var t=this.getButtons("pinning");if(t)return t.activate(),this.activateSnapping(),this.Pinning.activate(),this.fire("pinning.activate",{enabled:!0,pinning:this.Pinning}),this.Pinning},this.activateRouting=function(){var t=this.getButtons("routing");if(t)return t.activate(),this.activateSnapping(),this.deactivatePainting(),this.Routing.activate(),this.fire("routing.activate",{enabled:!0,routing:this.Routing}),this.Routing},this.activateExploring=function(){var t=this.getButtons("exploring");if(t)return t.activate(),this.deactivatePainting(),this.Exploring.activate(),this.fire("exploring.activate",{enabled:!0,exploring:this.Exploring}),this.Exploring},this.activatePainting=function(){var t=this.getButtons("painting");if(t)return t.activate(),this.deactivateRouting(),this.deactivateExploring(),this.Painting.activate(this.drawMode),this.fire("painting.activate",{enabled:!0,painting:this.Painting}),this.Painting},this.deactivateSnapping=function(){var t=this.getButtons("snapping");if(t)return t.deactivate(),this.deleteMeshData(),this.Snapping.deactivate(),this.fire("snapping.deactivate",{enable:!1}),!1},this.deactivatePinning=function(){var t=this.getButtons("pinning");if(t)return t.deactivate(),this.Pinning.deactivate(),this.fire("pinning.deactivate",{enable:!1}),!1},this.deactivateRouting=function(){var t=this.getButtons("routing");if(t)return t.deactivate(),this.Routing.deactivate(),this.fire("routing.deactivate",{enable:!1}),!1},this.deactivateExploring=function(){var t=this.getButtons("exploring");if(t)return t.deactivate(),this.deleteMeshData(),this.Exploring.deactivate(),this.fire("exploring.deactivate",{enable:!1}),!1},this.deactivatePainting=function(){var t=this.getButtons("painting");if(t&&(!this.mobile||this.currentMode.finished||"draw"!==this.currentMode.id||!this.currentMode.type||"Rectangle"!==this.currentMode.type))return t.deactivate(),this.Painting.deactivate(),this.fire("painting.deactivate",{enable:!1}),!1},this.getMap=function(){return this.Map.map},this.getModes=function(t){return t?this.modes.find((function(e){if(e.canHandle&&e.canHandle(t))return e})):this.modes},this.getMode=function(){return this.currentMode},this.getColors=function(){return this.options.colors},this.getButtons=function(t){return!!this.hasControls()&&(this.controls.forEach((function(i){var n=i.getButtonOptions();t?!e&&n[t]&&(e=n[t]):(e||(e={}),Object.entries(n).forEach((function(t){var i=t[0],n=t[1];e[i]=n})))})),e);var e},this.getFeatures=function(){return[this.getDrawnFeatures(),this.getSelectedFeatures()].flat()},this.getDrawnFeatures=function(){return this.Features.getColdFeatures()},this.getRenderedFeatures=function(t,e,i){return[this.getRenderedDrawnFeatures(t,e,i),this.getRenderedSnapFeatures(t,e,i)].flat()},this.getRenderedDrawnFeatures=function(t,e,i){var n,r=this.id,s=[r+"-line-cold",r+"-fill-cold",r+"-circle-cold",r+"-icon-cold",r+"-fill-select",r+"-line-select",r+"-point-select",r+"-symbol-select"];this.Layers.getLayers().forEach((function(t){t.id.includes(r)||s.push(t.id)}));var a={layers:s};if(e){var c=o.distanceToDegrees(e);n=[this.map.project([t.lng-c,t.lat-c]),this.map.project([t.lng+c,t.lat+c])]}else{var u=t?this.map.project([t.lng,t.lat]):null;n=u?[[u.x-5,u.y-5],[u.x+5,u.y+5]]:null}i&&(a.filter=i);var l=this.map.queryRenderedFeatures(n,a),d=l.map((function(t){return t.parent||t.properties.parent||t.id||t.properties.id}));return l&&l.length?this.Features.getFeaturesById(d):[]},this.getRenderedSnapFeatures=function(t,e,i){if(!this.meshIndex)return[];var n=o.distanceToDegrees(e),r=[this.map.project([t.lng-n,t.lat-n]),this.map.project([t.lng+n,t.lat+n])],s={layers:[this.statics.constants.layers.MESH+"-line",this.statics.constants.layers.MESH+"-circle"]};i&&(s.filter=i);var a=this.map.queryRenderedFeatures(r,s);return a&&a.length?this.meshIndex.getFeaturesFromIndex(a):[]},this.getFeatureById=function(t){return!!t&&this.Features.getFeatureById(t)},this.getFeaturesByLayer=function(t,e,i,n){var r,s=[];this.Layers.getLayers().forEach((function(e){e.id.includes(t)&&s.push(e.id)}));var a={layers:s};if(i){var c=o.distanceToDegrees(i);r=[this.map.project([e.lng-c,e.lat-c]),this.map.project([e.lng+c,e.lat+c])]}else{var u=e?this.map.project([e.lng,e.lat]):null;r=u?[[u.x-5,u.y-5],[u.x+5,u.y+5]]:null}n&&(a.filter=n);var l=this.map.queryRenderedFeatures(r,a),d=l.map((function(t){return t.parent||t.properties.parent||t.id||t.properties.id}));return l&&l.length?this.Features.getFeaturesById(d):[]},this.getSelectedFeatures=function(){return F},this.getSelectedFeatureIds=function(){return this.getSelectedFeatures().map((t=>t.parent||t.properties.parent||t.id||t.properties.id))},this.getSelectedFeaturesBbox=function(){return this.hasSelection()?o.bbox(o.featureCollection(this.getSelectedFeatures())):null},this.getSelectedPropertyNames=function(){const t=this.id,e=[];return this.getSelectedFeatures().forEach((i=>{Object.keys(i.properties).forEach((i=>{-1===e.indexOf(i)&&i!==t&&e.push(i)}))})),e},this.getSelectedPropertyValues=function(){const t=this.id;var e={};return this.getSelectedFeatures().forEach((function(t){Object.assign(e,t.properties)})),void 0!==e[t]&&delete e[t],e},this.getCommonGeometryType=function(){let t=null;return this.getSelectedFeatures().forEach((e=>{null===t?t=e.geometry.type:e.geometry.type!==t&&(t="illegal")})),"illegal"===t?null:t},this.editFeature=function(t,e={}){var i=e.feature||this.getFeatureById(t);if(!i){if(!this.hasSingleSelection())return!1;i=this.getSelectedFeatures()[0]}return e.id=i.id,e.mode="edit",e.feature=i,this.fire("feature.edit",{feature:i,id:i.id}),this.setMode(e),i},this.cancelEdit=function(t,e){return"draw"===this.currentMode.id&&this.currentMode.deactivate(!0,t,e||this.editing)},this.saveEdit=function(){return this.currentMode.saveEdit()},this.addFeatures=function(t,e){return!!t&&(t.features&&(t=t.features),Array.isArray(t)||(t=[t]),!!t.length&&(this.Features.addFeatures(t),void(!e&&this.zoomToFeatures())))},this.addFeaturesToSelected=function(t){this.getSelectedFeatures().push(...t),this.setButtons(),this.map.getSource(this.statics.constants.sources.SELECT).setData(o.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(o.featureCollection(this.getSelectedFeatures())),this.Features.setText(t),this.fire("feature.select",{ids:this.getSelectedFeatureIds(),features:this.getSelectedFeatures()})},this.addFeaturesToMesh=function(t=[]){return!!t.length&&(this.updateMeshData(t),t)},this.addGamepad=function(t){this.gamepads[t.index]=new this.Gamepad(this,t),this.fire("gamepad.add",{gamepad:t})},this.addTooltip=function(t,e,i,n){if(!this.setTooltip)return!1;this.setTooltip(e,{parent:t,appendTo:n,options:i})},this.addPlugin=function(t){if(!t.id)throw new Error("No Plugin ID provided");var e=t.id;this.plugins[e]=t},this.removeSelection=function(t){if(this.removePopup(),!this.hasSelection())return this.Features.setText();var e=i.Utilities.clone(this.getSelectedFeatureIds()),n=i.Utilities.clone(this.getSelectedFeatures());return t||n.forEach((function(t){this.Features.addFeatures([t],!0)}),this),this.getSelectedFeatures().splice(0,n.length),this.setButtons(),this.map.getSource(this.statics.constants.sources.SELECT).setData(o.featureCollection([])),this.map.getSource(this.statics.constants.sources.VERTEX).setData(o.featureCollection([])),this.Features.setText(),this.fire("feature.deselect",{ids:e,features:n}),n.length},this.removeControls=function(){},this.removeGamepad=function(t){if(!this.gamepads[t.index])return!1;this.gamepads[t.index].onDisconnect(t),delete this.gamepads[t.index],this.fire("gamepad.remove",{gamepad:t})},this.removeFeatures=function(t,e){return t?!!Array.isArray(t)&&void this.Features.removeFeatures(t,!0):this.Features.deleteFeatures()},this.removeFeature=function(t,e){var i=!!t&&this.Features.removeFeatures(t,e);return!e&&this.fire("feature.delete",{id:t,feature:i}),i},this.removePopup=function(){return this.popup&&this.popup.remove?this.popup.remove():!(!this.currentMode.popup||!this.currentMode.popup.remove)&&this.currentMode.popup.remove()},this.updateMeshData=function(t=[],e){this.meshIndex&&!e||(this.meshIndex=new this.Mesh([])),this.meshIndex.addNewFeatures(t);var i=this.statics.constants.sources.MESH;t=o.featureCollection(this.meshIndex.getFeatures());return this.map.getSource(i).setData(t),this.fire("mesh.update",{features:t}),t},this.updateSelectedProperties=function(t,e){this.getSelectedFeatures().forEach((i=>{const n=i.parent||i.properties.parent||i.id||i.properties.id,o={};e.forEach((t=>{i.properties[t]&&(o[t]=i.properties[t])})),i.properties=Object.assign(o,t,{id:n})}))},this.updateOrientation=function(t){return this.Locate.update(t),this.Locate.locate},this.saveFeatures=function(t){const e=this.id;var n,s;if(t){if(!t.id||!t.name)return window.alert("Layer ID and Name are required!");s=t.name+"-"+t.id,n=o.featureCollection(this.Features.getFeaturesByLayer(t))}else this.hasSelection()?(s="Selected Features",n=o.featureCollection(this.getSelectedFeatures())):(s=s="All Features",n=o.featureCollection(this.Features.getColdFeatures()));if(!n.features.length)return window.alert("No Features to Export!");var a=i.Utilities.cloneDeep(n.features);a=a.map((function(t){return t.style={},t.style.stroke=t.properties.style&&t.properties.style.primaryColor?t.properties.style.primaryColor:this.options.colors.primaryColor,t.style["stroke-width"]=3,t.style.fill=t.properties.style&&t.properties.style.secondaryColor?t.properties.style.secondaryColor:this.options.colors.secondaryColor,t.style["fill-opacity"]=1,t.properties.id=t.id,t.properties.unit=t.geometry.unit,t.properties.units=t.geometry.units,delete t.properties.style,delete t.geometry.unit,delete t.geometry.units,t}),this),n=o.featureCollection(a);var c=new Date,u=e+"_export - "+(c.getMonth()+1)+"."+c.getDate()+"."+c.getFullYear()+"_"+c.getHours()+c.getMinutes();const l=new window.JSZip,d={Id:this.id,Version:this.version,Features:n.features.length};["kmz","gpx","geojson"].forEach((function(t){const e=l.folder(s+" "+t.toUpperCase());switch(t){case"kmz":var i=document.createElement("table"),c=document.createElement("tbody");i.appendChild(c),Object.entries(d).forEach((function(t){var e=t[0],i=t[1],n=document.createElement("tr"),o=document.createElement("th"),r=document.createElement("td");o.textContent=e+": ",r.textContent=i,n.appendChild(o),n.appendChild(r),c.appendChild(n)}));var u=r.toKML(n,{name:"id",simplestyle:!0,description:d.Id,documentName:s,documentDescription:i.innerHTML}),p=new Blob([u],{type:"application/vnd.google-earth.kml+xml"});e.file(s.toLowerCase()+".kml",p);break;case"gpx":a.forEach((function(t){var i=t.id,n=o.featureCollection([t]),a=r.toGPX(n,{creator:d.Id,featureTitle:function(t){return t.id}});e.file(s.toLowerCase()+"_"+i+".gpx",a)}));break;case"geojson":var h=n;p=new Blob([JSON.stringify(h)],{type:"application/geojson"});e.file(s.toLowerCase()+".geojson",p)}})),l.generateAsync({type:"blob"}).then((function(t){var e=new Blob([t],{type:"application/zip;charset=utf-8"});window.geoflo.fire("features.export",{features:a,blob:e,date:c,name:u});var i=document.createElement("a");i.setAttribute("href",URL.createObjectURL(e)),i.setAttribute("download",u+".zip"),i.click(),URL.revokeObjectURL(i.href)}))},this.loadFeatures=function(){const t=document.createElement("input");function e(t,e,n){var o=[];if("geojson"===n||"json"===n)o=JSON.parse(t);else{if(!r[n])return alert("File type not supported: "+n);r[n].parse(t,null,{addData:function(t){o=t}})}o.features&&(o=o.features),Array.isArray(o)||(o=[o]),o.forEach((function(t){t.properties.import=!0,t.source=t.source||t.properties.source||i.statics.constants.sources.COLD})),i.fire("features.import",{features:o,file:t,ext:n,name:e}),i.addFeatures(o)}t.type="file",t.setAttribute("multiple","multiple"),t.addEventListener("change",(function(t){const n=[];for(let e=0;e<t.target.files.length;e++)n.push(t.target.files[e]);i.Utilities.processFiles(n,e)}),!1),t.click()},this.moveMapAlongLine=function(t){if(!t)return;const e=o.lineDistance(t),n=o.lineDistance(t);let r;window.requestAnimationFrame((function s(a){r||(r=a);const c=(a-r)/8e4;c>1&&setTimeout((()=>{r=0}),1500);const u=o.along(o.lineString(t),e*c).geometry.coordinates,l=o.along(o.lineString(t),n*c).geometry.coordinates,d=i.map.getFreeCameraOptions();d.position=mapboxgl.MercatorCoordinate.fromLngLat({lng:l[0],lat:l[1]},4e3),d.lookAtPoint({lng:u[0],lat:u[1]}),i.map.setFreeCameraOptions(d),window.requestAnimationFrame(s)}))},this.refreshMeshData=function(){this.meshIndex&&(this.mapMoving||this.fire("snapping.refresh",{features:this.meshIndex.getFeatures()}))},this.deleteMeshData=function(){this.updateMeshData([],!0),this.fire("snapping.delete",{features:this.meshIndex.getFeatures()})},this.deleteUserData=function(){var t;if(this.hasSingleSelection()){if(!window.confirm("Delete Selected Feature?"))return;var e=this.getSelectedFeatures()[0];t=e.parent||e.properties.parent||e.id||e.properties.id,this.Features.removeFeatures(t,!0),this.meshIndex&&this.meshIndex.removeFeature(t),this.fire("feature:delete",{features:this.Features.getColdFeatures()})}else{if(!window.confirm("Delete All Features?"))return;this.Features.deleteFeatures(),this.fire("features.delete",{features:this.Features.getColdFeatures()})}this.hotFeature=null,this.snapFeature=null,this.lastClick=null,this.firstClick=null,this.drawStarted=null,this.removeSelection(t),this.map.getSource(this.statics.constants.sources.SNAP).setData(o.featureCollection([])),this.map.getSource(this.statics.constants.sources.HOT).setData(o.featureCollection([])),this.map.getSource(this.statics.constants.sources.HOTTEXT).setData(o.featureCollection([])),this.editMode&&(this.editMode=!1,this.setMode())},this.doubleClickZoom={enable(t){setTimeout((()=>{t&&t.doubleClickZoom&&t.doubleClickZoom.enable()}),0)},disable(t){setTimeout((()=>{t&&t.doubleClickZoom&&t.doubleClickZoom.disable()}),0)}},this.hideSelectedFeatures=function(){O.length>0?(this.getSelectedFeatures().push(...O),O.splice(0,O.length)):this.hasSelection()&&O.push(...this.getSelectedFeatures().splice(0,this.getSelectedFeatures().length)),this.map.getSource(this.statics.constants.sources.SELECT).setData(o.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(o.featureCollection(this.getSelectedFeatures()))},this.combineSelectedFeatures=function(){if(this.mode===this.statics.constants.modes.SELECT&&this.hasSelection()){var t=this.getCommonGeometryType();if("Polygon"===t){var e=[];this.forEachSelectedFeature((function(t){e.push.apply(e,consumableArray(t.geometry.coordinates))})),e.length>0&&(this.Features.addFeatures([o.polygon(e,this.getSelectedPropertyValues())]),this.removeSelection())}else if("LineString"===t){var n=i.Utilities.combineSameTypeFeatures(this.getSelectedFeatures());n.length>0&&(this.Features.addFeatures([o.lineString(n,this.getSelectedPropertyValues())]),this.removeSelection())}}},this.moveSelectedFeatures=function(t){if(!this.options.moving||!this.options.moving.enable)return!1;var e=this.options.moving.distance;if(this.mode===this.statics.constants.modes.SELECT&&(this.hasSelection()&&"LineString"===this.getCommonGeometryType())){var i=[];this.forEachSelectedFeature((function(n){i.push(o.lineOffset(n,e*t))})),this.setSelectedFeatures(i)}},this.moveFeature=function(t,e){},this.forEachSelectedFeature=function(t){this.getSelectedFeatures().forEach(t)},this.zoomToFeatures=function(t,e={}){if((t=t||(this.hasSelection()?this.getSelectedFeatures():this.Features?this.Features.getColdFeatures():[])).properties&&(t=[t]),t&&t.length||(t=this.Map.options.extent?[o.polygon(this.Map.options.extent)]:[]),t.length<1)return!1;this.Map.setExtent(t,!1,e)},this.createPolygon=function(){if(this.mode===this.statics.constants.modes.SELECT&&(this.hasSelection()&&"LineString"===this.getCommonGeometryType())){var t=i.Utilities.combineSameTypeFeatures(this.getSelectedFeatures());t.length>0&&(i.Utilities.isPointEqual(t[0],t[t.length-1])||t.push(t[0]),this.addFeaturesToSelected([o.polygon([t],this.getSelectedPropertyValues())]),this.removeSelection())}},this.initialize()};P.prototype.statics=r,P.prototype.Gamepad=function(t,e){if(!(window.navigator.getGamepads&&"function"==typeof window.navigator.getGamepads||window.navigator.getGamepads&&"function"==typeof window.navigator.webkitGetGamepads))throw new Error("Gamepads are not supported on your browser!");const i=this;this.options=v;const n={select:"Select",start:"Start",power:"Power",button0:"B",button1:"A",button2:"Y",button3:"X",button4:"BumpLeft",button5:"BumpRight",button6:"TrigLeft",button7:"TrigRight",button8:"Select",button9:"Start",button10:"JoyLeftClick",button11:"JoyRightClick",button12:"DpadUp",button13:"DpadDown",button14:"DpadLeft",button15:"DpadRight",button16:"Power",button17:"Misc",up0:"JoyLeftUp",down0:"JoyLeftDown",right0:"JoyLeftRight",left0:"JoyLeftLeft",up1:"JoyRightUp",down1:"JoyRightDown",right1:"JoyRightRight",left1:"JoyRightLeft",l1:"BumpLeft",r1:"BumpRight",l2:"TrigLeft",r2:"TrigRight"};function o(t,e){let i=Math.sqrt(t*t+e*e);return i>1&&(t/=i,e/=i),[t,e]}function r(t,e,i=.2){let n=Math.sqrt(t*t+e*e);if(n<i)return[0,0];let o=(n-i)/(1-i);return[t/n*o,e/n*o]}function s(){i.refresh(),requestAnimationFrame(s)}function a(t,e){if(!e||!n)return!1;Object.entries(n).forEach((function(e){var n,o,r=e[0],s=e[1];n=r,o=function(e){return t.onEvent("press",r,s,e)},i.associateEvent(n,o,"before"),function(t,e){i.associateEvent(t,e,"action")}(r,(function(e){return t.onEvent("hold",r,s,e)})),function(t,e){i.associateEvent(t,e,"after")}(r,(function(e){return t.onEvent("release",r,s,e)}))}))}function c(t,e,i){var n=u(t[1]),o=u(t[0]),r=u(e[1]),s=u(e[0]),a=r-n,c=s-o,d=Math.sin(a/2)*Math.sin(a/2)+Math.cos(n)*Math.cos(r)*Math.sin(c/2)*Math.sin(c/2),p=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),h=Math.sin((1-i)*p)/Math.sin(p),f=Math.sin(i*p)/Math.sin(p),g=h*Math.cos(n)*Math.cos(o)+f*Math.cos(r)*Math.cos(s),m=h*Math.cos(n)*Math.sin(o)+f*Math.cos(r)*Math.sin(s),y=h*Math.sin(n)+f*Math.sin(r),v=Math.atan2(y,Math.sqrt(g*g+m*m));return[l(Math.atan2(m,g)),l(v)]}function u(t){return t*(Math.PI/180)}function l(t){return t*(180/Math.PI)}this.init=function(e,i){return!!e&&(v.enable?(t.map.fire(t.id+":gamepad.init",{detail:{gamepad:e}}),this.setGamepad(e),a(this,this.gamepad),requestAnimationFrame(s),this):void 0)},this.refresh=function(){for(var t=window.navigator.getGamepads(),e=0;e<t.length;e++){var i,n=t[this.gamepad.id];if(n&&n.connected){for(i=0;i<n.buttons.length;i++){var s=n.buttons[i],a=s.value,c=this.gamepad.layout[`button${i}`];s.pressed?(this.gamepad.pressed[c]||(this.gamepad.pressed[c]=!0,this.gamepad.buttonActions[i].before&&this.gamepad.buttonActions[i].before(a)),this.gamepad.buttonActions[i].action&&this.gamepad.buttonActions[i].action(a)):this.gamepad.pressed[c]&&(delete this.gamepad.pressed[c],this.gamepad.buttonActions[i].after&&this.gamepad.buttonActions[i].after(a))}var u=(n.axes.length+1)/2|0;for(i=0;i<u;i++){var l,d,p=i==u-1&&n.axes.length%2==1;l=n.axes[2*i],d=p?0:n.axes[2*i+1],[l,d]=r(l,d),[l,d]=o(l,d),a=[Number(l.toFixed(2)),Number(d.toFixed(2))];const t=n.axes[i+u].toFixed(4),e=Math.floor(i/2);this.gamepad.axeValues[e][i%2]=t;var h=a[0]>=v.joystick.min,f=a[0]<=-v.joystick.min,g=a[1]<=-v.joystick.min,m=a[1]>=v.joystick.min;this.trigger("right",h,i,a),this.trigger("left",f,i,a),this.trigger("down",m,i,a),this.trigger("up",g,i,a)}}}},this.trigger=function(t,e,i,n){var o=this.gamepad.axesActions,r=this.gamepad.layout[`${t}${i}`],s=this.gamepad.pressed;e?(s[r]||(s[r]=!0,o[i][t].before&&o[i][t].before(n)),n=[v.joystick.max*n[0],v.joystick.max*n[1]],o[i][t].action&&o[i][t].action(n)):s[r]&&(delete s[r],s.JoyLeftUp||s.JoyLeftDown||s.JoyLeftLeft||s.JoyLeftRight||o[0][t].after&&o[0][t].after(n),s.JoyRightUp||s.JoyRightDown||s.JoyRightLeft||s.JoyRightRight||o[1][t].after&&o[1][t].after(n))},this.remove=function(){this.gamepad.disconnect&&this.gamepad.disconnect(),this.gamepad.remove&&this.gamepad.remove(),this.gamepad=null},this.setMap=function(e){const i=t.map,n=i.transform;this.map=this.map||{center:i.getCenter(),zoom:i.getZoom(),pitch:i.getPitch(),bearing:i.getBearing()};var o=this.map.center.x||this.map.center.lat?this.map.center:new mapboxgl.LngLat(this.map.center[0],this.map.center[1]);return o=o.x?n.pointLocation(o):o,n.center=o,n.bearing=this.map.bearing,n.zoom=this.map.zoom,n.pitch=this.map.pitch,i._update(),v.crosshairs&&t.centerMarker&&this.setMarker(),e&&t.currentMode.handleMove({lngLat:v.camera.free?i.getCenter():this.map.center,gamepad:this}),this.map},this.setContainer=function(t,e,i){const n=window.document.createElement(t);return void 0!==e&&(n.className=e),i&&i.appendChild(n),this.container=n,n},this.setLocation=function(t){return this.container.style.visibility=v.debug?"visible":"hidden",this.container.style.left=(t[0]+1)/2*100+"%",this.container.style.top=(t[1]+1)/2*100+"%",this.container.getBoundingClientRect()},this.setMarker=function(){return t.setCenterMarker({gamepad:!0})},this.setGamepad=function(t){var e={type:t.id,connected:t.connected,id:t.index,buttons:t.buttons.length,layout:n,axes:Math.floor(t.axes.length/2),axeValues:[],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:t.mapping,buttonActions:{},axesActions:{},pressed:{}};for(let t=0;t<e.buttons;t++)e.buttonActions[t]=()=>({action:()=>{},after:()=>{},before:()=>{}});for(let t=0;t<e.axes;t++)e.axesActions[t]={down:()=>({action:()=>{},after:()=>{},before:()=>{}}),left:()=>({action:()=>{},after:()=>{},before:()=>{}}),right:()=>({action:()=>{},after:()=>{},before:()=>{}}),up:()=>({action:()=>{},after:()=>{},before:()=>{}})},e.axeValues[t]=[0,0];return t.hapticActuators&&("function"==typeof t.hapticActuators.pulse?(e.haptic=t.hapticActuators,e.vibrationMode=0,e.vibration=!0):t.hapticActuators[0]&&"function"==typeof t.hapticActuators[0].pulse&&(e.haptic=t.hapticActuators[0],e.vibrationMode=0,e.vibration=!0)),t.vibrationActuator&&"function"==typeof t.vibrationActuator.playEffect&&(e.haptic=t.vibrationActuator,e.vibrationMode=1,e.vibration=!0),this.gamepad=e,this.hasJoysticks=e.axes>0&&Object.values(this.gamepad.layout).map((function(t){return t.includes("Joy")})).filter((function(t){return t})).length>0,this.gamepad},this.setCenter=function(e,i,n){var o,r=t.map.getCenter(),s=this.gamepad.pressed,a=this.hasJoysticks?"Joy":"Dpad",u=Object.keys(s).filter((function(t){return t.includes(a)})).length>1,l=!(!i&&!n)&&r;if(l=(l=!(!t.hotFeature||l)&&(t.lastMove||r))||r,n){var d=this.map.bearing;d=s.Up?d:s.Down?d+180:s.Left?d-90:s.Right?d+90:d;var p=turf.destination(turf.point(l),distance,d).geometry.coordinates;lngLats=i?{lng:p[1],lat:p[0]}:p}else if(e){var h=this.setLocation(e),f=!(!h||!h.x)&&[h.x,h.y];o=t.map.unproject(f);var g=u?v.pan.speed/2:v.pan.speed,m=c([l.lng,l.lat],[o.lng,o.lat],g);o=m=t.map.getPitch()>60?c([l.lng,l.lat],[m[0],m[1]],.4):m,t.lastMove=o}else{f=!!t.hotFeature&&t.hotFeature.geometry.coordinates;o=i?t.map.getCenter():f?{lat:f[f.length-1][1],lng:f[f.length-1][0]}:t.map.getCenter(),t.lastMove=!1,this.setLocation([0,0])}return this.map.center=o,this.setMap(!0)},this.setBearing=function(t,e,i){var n=this.map.bearing,o=i?t:Math.abs(t[0]);return e?n-=v.bearing.speed*o:n+=v.bearing.speed*o,this.map.bearing=n,this.setMap()},this.setPitch=function(t,e,i){var n=this.map.pitch,o=i?t:Math.abs(t[1]);return n<0&&(n=0),n>v.pitch.max&&(n=v.pitch.max),e?n+=v.pitch.speed*o:n-=v.pitch.speed*o,this.map.pitch=n,this.setMap()},this.setZoom=function(t,e,i){var n=this.map.zoom;return e?n-=v.zoom.speed*Math.abs(t):n+=v.zoom.speed*Math.abs(t),this.map.zoom=n,this.setMap()},this.setSpeed=function(t,e){var i=v.pan.speed>v.pan.min?v.pan.speed:(v.pan.max&&(v.pan.speed,v.pan.max),v.pan.min);return i=(i=e?i-v.pan.min:i+v.pan.min)<v.pan.min?v.pan.min:v.pan.max&&i>v.pan.max?v.pan.max:i,v.pan.speed=i*Math.abs(t)},this.associateEvent=function(t,e,i){if(t.match(/^button\d+$/)){const n=parseInt(t.match(/^button(\d+)$/)[1]);n>=0&&n<this.gamepad.buttons&&(this.gamepad.buttonActions[n][i]=e)}else if("start"===t)this.gamepad.buttonActions[9][i]=e;else if("select"===t)this.gamepad.buttonActions[8][i]=e;else if("r1"===t)this.gamepad.buttonActions[5][i]=e;else if("r2"===t)this.gamepad.buttonActions[7][i]=e;else if("l1"===t)this.gamepad.buttonActions[4][i]=e;else if("l2"===t)this.gamepad.buttonActions[6][i]=e;else if("power"===t)this.gamepad.buttons>=17?this.gamepad.buttonActions[16][i]=e:error(MESSAGES.INVALID_BUTTON);else if(t.match(/^(up|down|left|right)(\d+)$/)){const n=t.match(/^(up|down|left|right)(\d+)$/),o=n[1],r=parseInt(n[2]);r>=0&&r<this.gamepad.axes?this.gamepad.axesActions[r][o][i]=e:error(MESSAGES.INVALID_BUTTON)}else if(t.match(/^(up|down|left|right)$/)){const n=t.match(/^(up|down|left|right)$/)[1];this.gamepad.axesActions[0][n][i]=e}return this.gamepad},this.onInit=function(e){this.initiated=!0,this.setContainer("div","gamepad",t.map.getContainer()),this.setCenterMarker(),this.setMap()},this.onEvent=function(e,i,n,o){var r={[n]:!0},s=v.camera.free?t.map.getCenter():t.lastMove?t.lastMove:t.map.getCenter(),a={name:n,type:e,key:i,value:o,mode:t.currentMode,gamepad:this,lngLat:s,ctx:t,originalEvent:{}};this.initiated||this.onInit(a),t.map.fire(t.id+":gamepad."+e,{detail:a}),(r.JoyLeftUp||r.JoyLeftDown||r.JoyLeftLeft||r.JoyLeftRight)&&v.mapping.JoyLeftMove(a),(r.JoyRightUp||r.JoyRightDown||r.JoyRightLeft||r.JoyRightRight)&&v.mapping.JoyRightMove(a),r.JoyLeftClick&&v.mapping.JoyLeftClick(a),r.JoyRightClick&&v.mapping.JoyRightClick(a),r.BumpLeft&&v.mapping.BumpLeft(a),r.BumpRight&&v.mapping.BumpRight(a),r.TrigLeft&&v.mapping.TrigLeft(a),r.TrigRight&&v.mapping.TrigRight(a),r.A&&v.mapping.A(a),r.B&&v.mapping.B(a),r.X&&v.mapping.X(a),r.Y&&v.mapping.Y(a),r.Start&&v.mapping.Start(a),r.Select&&v.mapping.Select(a),r.Power&&v.mapping.Power(a),r.Home&&v.mapping.Home(a),r.Misc&&v.mapping.Misc(a),r.DpadUp&&v.mapping.DpadUp(a),r.DpadDown&&v.mapping.DpadDown(a),r.DpadLeft&&v.mapping.DpadLeft(a),r.DpadRight&&v.mapping.DpadRight(a)},this.onDisconnect=function(t){if(!t||!this.gamepad)return!1;if(this.gamepad.id!==t.id)throw new Error("Gamepad id does not match!");this.gamepad.remove(),this.gamepad=null},this.init(e)},P.prototype.Mesh=p;const D=new P;p.prototype[D.id]=D})()})();
//# sourceMappingURL=mapboxgl-geoflo.min.js.map