/*! For license information please see mapboxgl-geoflo.min.js.LICENSE.txt */
(()=>{"use strict";const t="geoflo",e={developer:"solutegrate",id:t,logo:{full:`https://${t}.s3.amazonaws.com/logos/logo_full_white.png`,icon:`https://${t}.s3.amazonaws.com/logos/logo_icon_white.svg`,fullClass:t+"-logo",iconClass:t+"-icon"},controls:[[{type:"utils",enable:!0,position:"top-center",group:"action",divider:!0,show:!0,buttons:{zoom:!0,refresh:!0,locate:!0}},{type:"modes",enable:!0,group:"control",divider:!0,show:!0,buttons:{select:!0,edit:!0,save:!0}},{type:"options",enable:!0,group:"action",divider:!1,show:!0,buttons:{import:!0,export:!0,clear:!0,undo:!0,redo:!0,cancel:!0}}],[{type:"types",enable:!0,position:"top-center",group:"control",divider:!0,show:!0,buttons:{polyline:!0,polygon:!0,rectangle:!0,circle:!0,text:!0}},{type:"actions",enable:!0,group:"control",divider:!1,show:!0,buttons:{snapping:!0,pinning:!0,routing:!0,exploring:!0,painting:!0}}]],constants:{classes:{PREDEFINED_CONTROL_BASE:"mapboxgl-ctrl",PREDEFINED_CONTROL_GROUP:"mapboxgl-ctrl-group",CONTROL_PREFIX:"mapboxgl-ctrl-",ACTION_BUTTON:t+"-action-btn",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_RECTANGLE:"mapbox-gl-draw_rectangle",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TEXT:"mapbox-gl-draw_text",CONTROL_BUTTON_ICON:"mapbox-gl-draw_icon",CONTROL_BUTTON_CLEAR:t+"-delete-data",CONTROL_BUTTON_DELETE_SNAP:t+"-delete-snap-data",CONTROL_BUTTON_LOCATE:t+"-locate",CONTROL_BUTTON_ZOOM_IN_FEATURES:t+"-zoom-in-features",CONTROL_BUTTON_HIDE_SELECTED:t+"-hide-selected",CONTROL_BUTTON_ADD_FEATURE_TO_GRID:t+"-add-feature-to-grid",CONTROL_BUTTON_CREATE_POLYGON:t+"-create-polygon",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_BUTTON_GROUP_FEATURES:t+"-group-features",CONTROL_BUTTON_UNGROUP_FEATURES:t+"-ungroup-features",CONTROL_BUTTON_DOWNLOAD_WAYS:t+"-download-ways",CONTROL_BUTTON_DOWNLOAD_BUILDINGS:t+"-download-buildings",CONTROL_BUTTON_REFRESH:t+"-refresh",CONTROL_BUTTON_EDIT:t+"-edit",CONTROL_BUTTON_CUT:t+"-cut",CONTROL_BUTTON_SELECT:t+"-select",CONTROL_BUTTON_DOWNLOAD_DATA:t+"-download-data",CONTROL_BUTTON_EXPORT:t+"-export",CONTROL_BUTTON_SAVE_AS_GIST:t+"-save-as-gist",CONTROL_BUTTON_SAVE_AS_GEOJSON:t+"-save-as-geojson",CONTROL_BUTTON_SAVE_AS_KML:t+"-save-as-kml",CONTROL_BUTTON_EXPAND_EDITOR:t+"-expand-editor",CONTROL_BUTTON_IMPORT:t+"-import",CONTROL_BUTTON_FINSIH:t+"-finish",CONTROL_BUTTON_CANCEL:t+"-cancel",CONTROL_BUTTON_UNDO:t+"-undo",CONTROL_BUTTON_REDO:t+"-redo",CONTROL_GROUP:t+"-ctrl-group",DROPDOWN_GROUP:t+"-dropdown-group",DIVIDER:t+"-divider",ACTION_GROUP:t+"-action-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources:{SELECT:t+"-select",SNAP:t+"-snap",ROUTE:t+"-route",HOT:t+"-hot",COLD:t+"-cold",MESH:t+"-mesh",VERTEX:t+"-vertex",HOTTEXT:t+"-text",COLDTEXT:t+"-coldtext",GAMEPAD:t+"-gamepad"},layers:{MESH:t+"-mesh"},cursors:{ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types:{POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes:{FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes:{DRAW:"draw",CUT:"cut",SELECT:"select",DELETE:"delete",EDIT:"edit"},events:{CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions:{MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},meta:{FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates:{ACTIVE:"true",INACTIVE:"false"},LAT_MIN:-90,LAT_RENDERED_MIN:-85,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270,MIN_SEGMENT_LENGTH:1e-6,MIN_DISTANCE:1e-5,CIRCUM:40075017}},i={theme:"dark",showLineUnits:!1,showFeatureText:!0,controls:{options:!1,modes:!1,utils:!1,types:!1,actions:!1},map:{container:"map",center:[-95.52816680236892,39.56431143986035],zoom:3.5,maxPitch:50,projection:"mercator",style:"mapbox://styles/mapbox/dark-v11",hash:!0,extent:[[[-127.3638459,49.6212752],[-73.7295136,49.6212752],[-73.7295136,24.7473201],[-127.3638459,24.7473201],[-127.3638459,49.6212752]]]},keys:{import:"u",export:"d",delete:"Delete",cancel:"Escape",select:"Escape",edit:"Enter",refresh:"q",zoom:"z",locate:"l",snapping:"!",pinning:"@",routing:"#",exploring:"$",painting:"%",LineString:"1",Polygon:"2",Rectangle:"3",Circle:"4",Text:"5",Icon:"6"},commands:[{key:".",modifier:!1,command:function(t,e,i){var o={lngLat:e.map.getCenter()};"draw"===e.currentMode.id?(e.currentMode.handleUp(o),e.currentMode.handleClick(o)):e.currentMode.handleClick(o)}}],units:{Polyline:"feet",Polygon:"acres",Rectangle:"acres",Icon:"feature",Circle:"feature",Marker:"feature"},colors:{error:"#ff7676",primaryColor:"#d7ef7e",primaryBackground:"#5a5a5a",primaryText:"#c5c5c5",primaryBorder:"#6fafdb",secondaryColor:"#6fafdb",secondaryBackground:"#333333",secondaryText:"#333333",secondaryBorder:"#404040",primarySelect:"#333333",primaryEdit:"#d7ef7e",primaryHot:"#d7ef7e",primaryCold:"#6fafdb",primarySnap:"#c5c5c5",primaryBase:"#c5c5c5",primaryDebug:"#ff7676",primaryVertex:"#c5c5c5",secondarySelect:"#d7ef7e",secondaryEdit:"#c5c5c5",secondaryHot:"#333333",secondaryCold:"#c5c5c5",secondarySnap:"#d7ef7e",secondaryBase:"#242424",secondaryDebug:"#d7ef7e",secondaryVertex:"#333333"},select:{popup:!1,multiple:!1},snapping:{enable:!1,pixels:!1,distance:321.8688,tolerance:.002},routing:{enable:!1,precision:15e-7},pinning:{enable:!1,buffer:50/5280*1.609344,idle:20},exploring:{enable:!1,minZoom:12,buffer:1.5240000000000002,tolerance:1e-5},moving:{enable:!1,distance:9144e-7},painting:{enable:!1,tolerance:5e-6},gamepad:{enable:!0,debug:!1,crosshairs:!0,joystick:{min:.2,max:.7},camera:{free:!0},pan:{speed:.001,min:.001,max:.05},bearing:{speed:.8},pitch:{speed:1.5,max:70},zoom:{speed:.008},rumble:{startDelay:0,duration:200,weakMagnitude:1,strongMagnitude:1},mapping:{Select:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&t.ctx.getButtons("clear").button.click()},Start:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type&&t.gamepad.hasJoysticks){var e="select"===t.mode.id?"edit":"select";t.ctx.getButtons(e).button.click()}},Power:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&t.ctx.getButtons("save").button.click()},Menu:function(t){"press"===t.type||"hold"===t.type||t.type},Misc:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type&&t.gamepad.hasJoysticks){t.ctx.getButtons("zoom").button.click();var e=setInterval((function(){ctx.mapMoving||(clearInterval(e),t.gamepad.map.center=t.ctx.map.getCenter(),t.gamepad.map.zoom=t.ctx.map.getZoom())}),1)}},A:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type)if(t.gamepad.hasJoysticks)t.ctx.getButtons("routing").button.click();else if(!t.gamepad.pressed.BumpLeft&&!t.gamepad.pressed.BumpRight)return this.JoyLeftClick(t)},B:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type)if(t.gamepad.hasJoysticks)t.ctx.getButtons("painting").button.click();else if(!t.gamepad.pressed.BumpLeft&&!t.gamepad.pressed.BumpRight)return this.JoyRightClick(t)},Y:function(t){"press"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft||t.gamepad.pressed.BumpRight)&&t.gamepad.setSpeed(t.value,!1):"hold"===t.type||"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("snapping").button.click()},X:function(t){"press"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft||t.gamepad.pressed.BumpRight)&&t.gamepad.setSpeed(t.value,!0):"hold"===t.type||"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("pinning").button.click()},JoyLeftMove:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setCenter(t.value,t.gamepad.options.camera.free):"release"===t.type&&t.gamepad.setCenter(!1,t.gamepad.options.camera.free))},JoyRightMove:function(t){"press"===t.type||("hold"===t.type?t.name.includes("Up")||t.name.includes("Down")?t.gamepad.setPitch(t.value,t.name.includes("Up")):(t.name.includes("Left")||t.name.includes("Right"))&&t.gamepad.setBearing(t.value,t.name.includes("Left")):t.type)},JoyLeftClick:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&"draw"===t.mode.id&&t.mode.deleteVertex()},JoyRightClick:function(t){if("press"===t.type){if("draw"===t.mode.id)return!!t.lngLat&&t.mode.handleDown(t)}else if("hold"===t.type);else if("release"===t.type){if(!t.lngLat)return!1;"draw"===t.mode.id?(t.mode.handleUp(t),t.mode.handleClick(t)):t.mode.handleClick(t)}},BumpLeft:function(t){if("press"===t.type){if(t.gamepad.hasJoysticks)return t.gamepad.setSpeed(t.value,!0);if(t.gamepad.pressed.BumpRight)return!1}else"hold"===t.type?t.gamepad.hasJoysticks:t.type},BumpRight:function(t){if("press"===t.type){if(t.gamepad.hasJoysticks)return t.gamepad.setSpeed(t.value,!1);if(t.gamepad.pressed.BumpLeft)return!1}else"hold"===t.type||t.type},TrigLeft:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setZoom(t.value,!0):t.type)},TrigRight:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setZoom(t.value,!1):t.type)},DpadUp:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setPitch(t.value,!0):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Polygon").button.click())},DpadDown:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setPitch(t.value,!1):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Circle").button.click())},DpadLeft:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setBearing(t.value,!0):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Polyline").button.click())},DpadRight:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setBearing(t.value,!1):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Rectangle").button.click())}}}},o=i;function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}const s=function(){this.geoflo;this.pointInCoordinates=function(t,e){var i=[];return t.geometry.coordinates.forEach((function(o,n){0!==n&&n!==t.geometry.coordinates.length-1&&o[0]===e[0]&&o[1]===e[1]&&i.push(n)})),i},this.sameBorders=function(t,e){return!(!t||!e)&&(t.border1[0]===e.border1[0]&&t.border1[1]===e.border1[1]&&t.border2[0]===e.border2[0]&&t.border2[1]===e.border2[1]||t.border1[0]===e.border2[0]&&t.border1[1]===e.border2[1]&&t.border2[0]===e.border1[0]&&t.border2[1]===e.border1[1])},this.getRandomColor=function(){for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t},this.createRandomStroke=function(){return{stroke:this.getRandomColor()}},this.createLineAndSaveLength=function(t,e){var i=Object.assign({},e,this.createRandomStroke()),o=turf.lineString(t,i);return i.length=turf.lineDistance(o),o},this.lineSplit=function(t,e){var i=t.properties,o=[].concat(n(t.geometry.coordinates)),s=[],r=0;return e.forEach((function(t){if((t-=r)<o.length-1){var e=o.splice(t,o.length-t);o.length>0&&(o.push(e[0]),s.push(this.createLineAndSaveLength(o,i))),o=e,r+=t}}),this),o.length>0&&s.push(this.createLineAndSaveLength(o,i)),s},this.splitLines=function(t,e){var i=[],o=[];if(t.geometry.coordinates.forEach((function(t,s){var r=this.pointInCoordinates(e,t);r.length>0&&(o.push.apply(o,n(r)),i.push(s))}),this),0===i.length&&0===o.length)return null;var s=[];return s.push.apply(s,n(this.lineSplit(t,i))),s.push.apply(s,n(this.lineSplit(e,o))),s},this.createSimpleMesh=function(t){var e=[];return t.forEach((function(t){for(var i=t.properties,o=t.geometry.coordinates,n=o[0],s=null,r=1;r<o.length;r++)s=o[r],e.push(this.createLineAndSaveLength([n,s],i)),n=s}),this),e},this.createMesh=function(t){var e=[];return t.forEach((function(e){var i=e.properties.cutPoints;i||(i=[],e.properties.cutPoints=i),t.forEach((function(t){if(e!==t){var o=t.properties.cutPoints;o||(o=[],t.properties.cutPoints=o),e.geometry.coordinates.forEach((function(n,s){var r=this.pointInCoordinates(t,n);r.length>0&&(r.forEach((function(t){-1===o.indexOf(t)&&o.push(t)})),0!==s&&s!==e.geometry.coordinates.length-1&&-1===i.indexOf(s)&&i.push(s))}),this)}}),this)}),this),t.forEach((function(t){t.properties.cutPoints.sort((function(t,e){return t-e})),e.push.apply(e,n(this.lineSplit(t,t.properties.cutPoints)))}),this),e},this.setProperty=function(t,e,i){if(!t)return!1;var o=t.properties;o||(o={},t.properties=o),e.includes(".")?(o[(e=e.split("."))[0]]||(o[e[0]]={}),o[e[0]][e[1]]=i):o[e]=i},this.setProperties=function(t,e){t.properties=Object.assign(t.properties||{},e)},this.findClosestFeatures=function(t,e,i){var o=t.pointIndex.within(e.lng,e.lat,i),n={},s=[];return o.forEach((function(e){var i=t.pointFeatureMap[e];n[i]||(s.push(t.featureById[i]),n[i]=!0)})),s},this.isPointEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]},this.isPoint=function(t){return!!t&&"Point"===t.geometry.type},this.isPolygon=function(t){var e=t.geometry.coordinates,i=e[0],o=e[e.length-1];return this.isPointEqual(i,o)},this.isLineString=function(t){return!!t&&"LineString"===t.geometry.type},this.isValidLineString=function(t){return!!this.isLineString(t)&&!(t.geometry.coordinates.length<2)},this.isLastIndex=function(t,e){return!!e&&(this.isLineString(e)?t==e.geometry.coordinates.length-1:this.isPolygon(e)?t==e.geometry.coordinates[0].length-1:0==t)},this.getLastIndexCoords=function(t){return this.isLineString(t)?t.geometry.coordinates[t.geometry.coordinates.length-1]:this.isPolygon(t)?t.geometry.coordinates[0][t.geometry.coordinates.length-1]:t.geometry.coordinates},this.isEmptyLineString=function(t){if("LineString"===t.geometry.type){var e=t.geometry.coordinates;if(2===e.length){var i=e[0],o=e[e.length-1];return this.isPointEqual(i,o)}}return!1},this.isPointAtVertex=function(t,e){var i=t[0],o=t[t.length-1];return this.isPointEqual(i,e)||this.isPointEqual(o,e)},this.isPointNotTooClose=function(t,e){var i=turf.lineString([t,e]);return turf.lineDistance(i)>=statics.constants.MIN_DISTANCE&&!(t[0]===e[0]&&t[1]===e[1])},this.isOverlapping=function(t,e){var i=t.geometry.coordinates,o=e.geometry.coordinates;if(2===i.length&&2===o.length){var n=this.createBbox(i),s=this.createBbox(o);return!(n.east<s.west||n.west>s.east)&&!(n.north<s.south||n.south>s.north)}throw new Error("wrong number of coordinates, expected 2")},this.createLineWithLength=function(t){var e=turf.lineString(t),i=turf.lineDistance(e);return this.setProperties(e,{length:i}),e},this.reducePrecision=function(t){return t[0]=Number(Number(t[0]).toFixed(7)),t[1]=Number(Number(t[1]).toFixed(7)),t},this.createBbox=function(t){var e={};return t[0][0]<t[1][0]?(e.west=t[0][0],e.east=t[1][0]):(e.west=t[1][0],e.east=t[0][0]),t[0][1]<t[1][1]?(e.south=t[0][1],e.north=t[1][1]):(e.south=t[1][1],e.north=t[0][1]),e},this.stringToDOM=function(t){return(new DOMParser).parseFromString(t,"text/xml")},this.processFiles=function(t,e){t.forEach((function(t){var i=t.name,o=i.substring(i.lastIndexOf(".")+1,i.length).toLowerCase(),n=new FileReader;n.onloadend=function(){if(n.readyState===FileReader.DONE)try{e(n.result,i,o)}catch(t){}},n.readAsText(t)}))},this.combineSameTypeFeatures=function(t){var e=[];return t.forEach((function(t){if(0===e.length)e.push.apply(e,n(t.geometry.coordinates));else{var i=e[0],o=e[e.length-1],s=t.geometry.coordinates[0],r=t.geometry.coordinates[t.geometry.coordinates.length-1];if(this.isPointEqual(o,s))e.push.apply(e,n(t.geometry.coordinates.slice(1,t.geometry.coordinates.length)));else if(this.isPointEqual(o,r))e.push.apply(e,n(t.geometry.coordinates.slice(0,t.geometry.coordinates.length-1).reverse()));else if(this.isPointEqual(i,r))e.splice.apply(e,[0,0].concat(n(t.geometry.coordinates.slice(0,t.geometry.coordinates.length-1))));else if(this.isPointEqual(i,s))e.splice.apply(e,[0,1].concat(n(t.geometry.coordinates.reverse())));else{turf.distance(o,s)<turf.distance(o,r)?e.push.apply(e,n(t.geometry.coordinates)):e.push.apply(e,n([].concat(n(t.geometry.coordinates)).reverse()))}}}),this),e},this.degrees2meters=function(t){const e=20037508.34*t[0]/180;let i=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return i=20037508.34*i/180,[e,i]},this.meters2degrees=function(t){return[180*t[0]/20037508.34,360*Math.atan(Math.exp(t[1]*Math.PI/20037508.34))/Math.PI-90]},this.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},this.clone=function(t,e){var i={};return t instanceof Array?t.map((function(t){return this.clone(t,e)}),this):t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t):t instanceof Function?e&&e.newFns?new Function("return "+t.toString())():t:t instanceof Object?(Object.keys(t).forEach((function(o){i[o]=this.clone(t[o],e)}),this),i):[void 0,null].indexOf(t)>-1?t:"Symbol"===t.constructor.name?Symbol(t.toString().replace(/^Symbol\(/,"").slice(0,-1)):t.__proto__.constructor(t)},this.cloneDeep=function(t,e){var i=Object.prototype.hasOwnProperty,o=Object.prototype.toString;function n(t,e){switch(a(t)){case"object":return function(t,e){if(s(t)){var o={};return function(t,e,o){r(t,(function(n,s){if(i.call(t,s))return e.call(o,t[s],s,t)}))}(t,(function(t,i){this[i]=n(t,e)}),o),o}return e?e(t):t}(t,e);case"array":return function(t,e){var i=t.length,o=[],s=-1;for(;++s<i;)o[s]=n(t[s],e);return o}(t,e);default:return l(t)}}function s(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)}function r(t,e,i){for(var o in t)if(!1===e.call(i,t[o],o,t))break}function a(t){if(void 0===t)return"undefined";if(null===t)return"null";if(!0===t||!1===t||t instanceof Boolean)return"boolean";if("string"==typeof t||t instanceof String)return"string";if("number"==typeof t||t instanceof Number)return"number";if("function"==typeof t||t instanceof Function)return"function";if(void 0!==Array.isArray&&Array.isArray(t))return"array";if(t instanceof RegExp)return"regexp";if(t instanceof Date)return"date";var e=o.call(t);return"[object RegExp]"===e?"regexp":"[object Date]"===e?"date":"[object Arguments]"===e?"arguments":"[object Error]"===e?"error":c(t)?"buffer":"[object Set]"===e?"set":"[object WeakSet]"===e?"weakset":"[object Map]"===e?"map":"[object WeakMap]"===e?"weakmap":"[object Symbol]"===e?"symbol":"[object Int8Array]"===e?"int8array":"[object Uint8Array]"===e?"uint8array":"[object Uint8ClampedArray]"===e?"uint8clampedarray":"[object Int16Array]"===e?"int16array":"[object Uint16Array]"===e?"uint16array":"[object Int32Array]"===e?"int32array":"[object Uint32Array]"===e?"uint32array":"[object Float32Array]"===e?"float32array":"[object Float64Array]"===e?"float64array":"object"}function c(t){return null!=t&&(function(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&c(t.slice(0,0))}(t)||!!t._isBuffer)}function u(t){return null!=t&&("object"==typeof t||"function"==typeof t)}function l(t){var e=a(t);return l.hasOwnProperty(e)?l[e](t):t}return l.array=function(t){return t.slice()},l.date=function(t){return new Date(+t)},l.object=function(t){return u(t)?function(t,e){if(!u(t))throw new TypeError("mixin-object expects the first argument to be an object.");for(var i=arguments.length,o=0;++o<i;){var n=arguments[o];u(n)&&r(n,copy,t)}return t}({},t):t},l.regexp=function(t){var e="";return e+=t.multiline?"m":"",e+=t.global?"g":"",e+=t.ignorecase?"i":"",new RegExp(t.source,e)},n(t,e)},this.assignDeep=function(t,e,{isMutatingOk:i=!1,isStrictlySafe:o=!1}={}){t=i?t:this.cloneDeep(t);for(const[i,o]of Object.entries(e))null!==o&&"object"==typeof o?(void 0===t[i]&&(t[i]={}),t[i]=this.assignDeep(t[i],o,{isMutatingOk:!0})):t[i]=o;return t},this.compareDeep=function(){var t,e,i,o;function n(t,e){var s;if(isNaN(t)&&isNaN(e)&&"number"==typeof t&&"number"==typeof e)return!0;if(t===e)return!0;if("function"==typeof t&&"function"==typeof e||t instanceof Date&&e instanceof Date||t instanceof RegExp&&e instanceof RegExp||t instanceof String&&e instanceof String||t instanceof Number&&e instanceof Number)return t.toString()===e.toString();if(!(t instanceof Object&&e instanceof Object))return!1;if(t.isPrototypeOf(e)||e.isPrototypeOf(t))return!1;if(t.constructor!==e.constructor)return!1;if(t.prototype!==e.prototype)return!1;if(i.indexOf(t)>-1||o.indexOf(e)>-1)return!1;for(s in e){if(e.hasOwnProperty(s)!==t.hasOwnProperty(s))return!1;if(typeof e[s]!=typeof t[s])return!1}for(s in t){if(e.hasOwnProperty(s)!==t.hasOwnProperty(s))return!1;if(typeof e[s]!=typeof t[s])return!1;switch(typeof t[s]){case"object":case"function":if(i.push(t),o.push(e),!n(t[s],e[s]))return!1;i.pop(),o.pop();break;default:if(t[s]!==e[s])return!1}}return!0}if(arguments.length<1)return!0;for(t=1,e=arguments.length;t<e;t++)if(i=[],o=[],!n(arguments[0],arguments[t]))return!1;return!0},this.consumableArray=function(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}},r=function(t={}){const e=this.geoflo;this.options=t,this.init=function(t={}){return e.Utilities.extend(this.options,t),this.styles=this.options.styles||[{title:"Standard",uri:"mapbox://styles/solutegrate/clxdoec8x006901qj7wjf8uxo"},{title:"Satellite",uri:"mapbox://styles/mapbox/satellite-streets-v11"},{title:"Standard",uri:"mapbox://styles/mapbox/standard"},{title:"Dark",uri:"mapbox://styles/mapbox/dark-v11"},{title:"Light",uri:"mapbox://styles/mapbox/light-v11"},{title:"Outdoors",uri:"mapbox://styles/mapbox/outdoors-v11"}],this.defaultStyle=this.options.selected||"Standard",this.onDocumentClick=this.onDocumentClick.bind(this),this.events=this.options.eventListeners,this},this.select=function(t){if(!this.mapStyleContainer||!this.mapStyleContainer.checkVisibility()){var e=this.styles.find((e=>e.title===t));if(e&&this.map.setStyle(e.uri),this.events&&this.events.onChange&&this.events.onChange({style:e},e))return}const i=this.mapStyleContainer.getElementsByClassName(t);i.length>0&&i[0].click()},this.hide=function(){this.controlContainer&&(this.controlContainer.style.display="none")},this.show=function(){this.controlContainer&&(this.controlContainer.style.display="block")},this.getDefaultPosition=function(){return"top-right"},this.onAdd=function(t){this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mapStyleContainer=document.createElement("div"),this.styleButton=document.createElement("button"),this.styleButton.type="button",this.mapStyleContainer.classList.add("mapboxgl-style-list");for(const t of this.styles){const e=document.createElement("button");e.type="button",e.classList.add(t.title.replace(/[^a-z0-9-]/gi,"_")),e.dataset.uri=JSON.stringify(t.uri),e.addEventListener("click",(t=>{const e=t.target||t.srcElement;if(this.closeModal(),e.classList.contains("active"))return;if(this.events&&this.events.onOpen&&this.events.onOpen(t))return;const i=JSON.parse(e.dataset.uri);this.map.setStyle(i);const o=this.mapStyleContainer.getElementsByClassName("active");for(;o[0];)o[0].classList.remove("active");e.classList.add("active"),this.events&&this.events.onChange&&this.events.onChange(t,i)})),t.title===this.defaultStyle&&e.classList.add("active"),this.mapStyleContainer.appendChild(e)}return this.styleButton.classList.add("mapboxgl-ctrl-icon"),this.styleButton.classList.add("mapboxgl-style-switcher"),this.styleButton.addEventListener("click",(t=>{this.events&&this.events.onSelect&&this.events.onSelect(t)||this.openModal()})),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.styleButton),this.controlContainer.appendChild(this.mapStyleContainer),this.closeModal(),this.controlContainer},this.onRemove=function(){this.controlContainer&&this.controlContainer.parentNode&&this.map&&this.styleButton&&(this.styleButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)},this.closeModal=function(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="none",this.styleButton.style.display="block")},this.openModal=function(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="block",this.styleButton.style.display="none")},this.onDocumentClick=function(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.closeModal()},this.init()},a=function(){const t=this.geoflo;if(!t.map)throw new Error("No map object provided!");const e=this,i=t.map,o=t.id,n=t.statics,s={Polygon:["-fill","-border"],Polyline:["-line","-dash","-buffer"],Point:["-circle","-icon","-image","-cluster-circle","-cluster-icon","-count-icon","-count-text"],Image:["-image"]};async function r(t=[],e={}){if(await c.call(this),!t.length)return!1;for(const i of t)await a.call(this,i,e);return this.moveLayers(),this.showTextLayers&&this.addTextLayer(),this.getLayers()}async function a(e,i){var o,n=e.details||{},r=e.options||{},a=e.layers||[],c=e.features||[],h=c&&c.length;n.id&&n.type||(o=!0);const g=this.getType(n.type);g||(o=!0);var m={type:g};n.default?m.default=!0:m.custom=!0,n.name&&(m.name=n.name);var y=n.source||n.id;m.source=y;var v={type:g,source:y,id:n.id,types:s[g],style:e.style||{},filter:e.filter,images:e.images,details:n,options:r,layers:a};return a="Image"===g?await u.call(this,v,r):"Polygon"===g?await l.call(this,v,r):"Polyline"===g?await p.call(this,v,r):"Point"===g?await d.call(this,v,r):[],this.removeLayers(a),this.removeSource(y),this.addSource(y,g,r),this.addLayers(a,m),f.call(this,{layer:n.id,source:y}),v.metadata=m,this._layers.push(v),this._sources.push({id:y,type:g,options:r}),h&&t.Features.addFeatures(c),new Promise((async function(i,n){if(o)return i(o);var s=setInterval((function(){var o=t.Layers.getFeatures(y);if(!h||o.length)return clearInterval(s),i({layer:e,features:o})}),1)}))}async function c(){const e=t.map;return new Promise((async function(t,i){if(e.hasImage("text-marker"))return t(!0);e.loadImage("https://docs.mapbox.com/mapbox-gl-js/assets/popup.png",(async function(o,n){return o?i(o):(e.hasImage("text-marker")||e.addImage("text-marker",n,{content:[25,25,115,100],stretchX:[[25,115]],stretchY:[[25,100]],pixelRatio:2,sdf:!1}),t(n))}))}))}async function u(t={},e={}){if(!t.source)return[];for(var o=[],n=t.source,s=0;s<t.types.length;s++){var r,a,c=t.types[s],u=t.style,l=t.id+c;if(t.images&&t.images.length){for(var p=0;p<t.images.length;p++){var d=t.images[p];if(d){var h=await g(d);h&&(i.hasImage(d.id)?i.updateImage(d.id,h,{pixelRatio:2}):i.addImage(d.id,h,{pixelRatio:2}))}}r=Object.assign({},{visibility:e.visibility||"visible","icon-image":["get","primaryImage",["get","style",["properties"]]],"icon-size":["interpolate",["linear"],["zoom"],1,.4,15,1],"icon-allow-overlap":!0,"icon-anchor":"bottom"},u.image&&u.image.layout||{}),a=Object.assign({},{"icon-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]]},u.image&&u.image.paint||{}),(u={id:l,type:"symbol",source:n,slot:u.slot||"top",filter:t.filter||["==","$type","Point"],layout:r,paint:a})&&o.push(u)}}return o}async function l(t={},e={}){if(!t.source)return[];for(var i=[],o=t.source,n=0;n<t.types.length;n++){var s,r,a=t.types[n],c=t.style,u=t.id+a;a.includes("border")?(s=Object.assign({},{visibility:e.visibility||"visible"},c.border&&c.border.layout||{}),r=Object.assign({},{"line-color":["get","primaryColor",["get","style",["properties"]]],"line-width":["case",["boolean",["has","width",["get","style",["properties"]]],!0],["get","width",["get","style",["properties"]]],2],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.8]},c.border&&c.border.paint||{}),c={id:u,type:"line",source:o,slot:c.slot||"bottom",filter:c.border&&c.border.filter||["==","$type","Polygon"],layout:s,paint:r}):a.includes("fill")&&(s=Object.assign({},{visibility:e.visibility||"visible"},c.fill&&c.fill.layout||{}),r=Object.assign({},{"fill-color":["get","secondaryColor",["get","style",["properties"]]],"fill-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.5]},c.fill&&c.fill.paint||{}),c={id:u,type:"fill",source:o,slot:c.slot||"bottom",filter:c.fill&&c.fill.filter||["==","$type","Polygon"],layout:s,paint:r}),c&&i.push(c)}return i}async function p(t={},e={}){if(!t.source)return[];for(var i=[],o=t.source,n=0;n<t.types.length;n++){var s,r,a=t.types[n],c=t.style,u=t.id+a;a.includes("line")&&(s=Object.assign({},{visibility:e.visibility||"visible","line-miter-limit":2,"line-join":"round","line-cap":"round"},c.border&&c.border.layout||{}),r=Object.assign({},{"line-color":["get","primaryColor",["get","style",["properties"]]],"line-width":["case",["boolean",["has","width",["get","style",["properties"]]],!0],["get","width",["get","style",["properties"]]],4],"line-offset":["case",["boolean",["has","offset"],!0],["get","offset"],0],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]},c.border&&c.border.paint||{}),c={id:u,type:"line",source:o,slot:c.slot||"middle",filter:c.line&&c.line.filter||["==","$type","LineString"],layout:s,paint:r}),c&&i.push(c)}return i}async function d(e={},o={}){if(!e.source)return[];for(var n=[],s=e.source,r=i.getStyle().imports&&i.getStyle().imports.length,a=0;a<e.types.length;a++){var c,u,l=e.types[a],p=e.style,d=e.id+l;if(l.includes("circle")){if(o.noCircle)continue;if(c=Object.assign({},{visibility:o.visibility},p.circle&&p.circle.layout||{}),u=Object.assign({},{"circle-radius":10,"circle-stroke-width":2,"circle-color":["get","secondaryColor",["get","style",["properties"]]],"circle-stroke-color":["get","primaryColor",["get","style",["properties"]]],"circle-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]],"circle-stroke-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]]},p.circle&&p.circle.paint||{}),p={id:d,type:"circle",source:s,slot:p.slot||"top",filter:p.circle&&p.circle.filter||["==","$type","Point"],layout:c,paint:u},l.includes("cluster")){if(o.noCluster)continue;p.filter=["has","point_count"],p.paint["circle-color"]=o.secondaryColor||t.options.colors.secondaryColor,p.paint["circle-stroke-color"]=o.primaryColor||t.options.colors.primaryColor}}else if(l.includes("image")){if(o.noImage)continue;if(!e.images||!e.images.length)continue;for(var h=0;h<e.images.length;h++){var f=e.images[h];if(f){var m=await g(f);m&&(i.hasImage(f.id)?i.updateImage(f.id,m,{pixelRatio:2}):i.addImage(f.id,m,{pixelRatio:2}))}}c=Object.assign({},{visibility:o.visibility||"visible","icon-image":["get","primaryImage",["get","style",["properties"]]],"icon-size":["interpolate",["linear"],["zoom"],1,.4,15,1],"icon-allow-overlap":!0,"icon-anchor":"bottom"},p.image&&p.image.layout||{}),u=Object.assign({},{"icon-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]]},p.image&&p.image.paint||{}),p={id:d,type:"symbol",source:s,slot:p.slot||"top",filter:p.image&&p.image.filter||["==","$type","Point"],layout:c,paint:u}}else if(l.includes("icon")){if(r)continue;if(c=Object.assign({},{visibility:o.visibility,"icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-rotate":["get","rotate",["get","style",["properties"]]],"text-rotation-alignment":"viewport","text-size":14,"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},p.icon&&p.icon.layout||{}),u=Object.assign({},{"text-translate-anchor":"viewport","text-halo-color":["get","primaryColor",["get","style",["properties"]]],"text-halo-width":0,"text-color":["get","primaryColor",["get","style",["properties"]]],"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]]},p.icon&&p.icon.paint||{}),p={id:d,type:"symbol",source:s,slot:p.slot||"top",filter:p.icon?p.icon.filter||["==","$type","Point"]:p.circle&&p.circle.filter||["==","$type","Point"],layout:c,paint:u},l.includes("cluster")){if(o.noCluster)continue;p.filter=["has","point_count"],p.layout["text-field"]=o.primaryIcon||"",p.paint["text-halo-color"]=o.secondaryColor||t.options.colors.secondaryCold,p.paint["text-color"]=o.primaryColor||t.options.colors.secondaryText}else if(l.includes("count")){if(o.noCluster)continue;p.filter=["has","point_count"],p.layout={visibility:o.visibility,"icon-optional":!0,"text-field":o.countIcon||"","text-size":{base:14,stops:[[10,16],[14,14]]},"text-line-height":1,"text-padding":0,"text-offset":[.5,-.6],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},p.paint={"text-translate-anchor":"viewport","text-color":o.countIconColor||t.options.colors.primaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]}}}else if(l.includes("text")){if(r)continue;if(l.includes("count")){if(o.noCluster)continue;c=Object.assign({},{"text-field":["get","point_count_abbreviated"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":{base:14,stops:[[10,14],[14,12]]},"text-offset":[.55,-.9]},p.text&&p.text.layout||{}),u=Object.assign({},{"text-color":o.countTextColor||t.options.colors.secondaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]},p.text&&p.text.paint||{}),p={id:d,type:"symbol",source:s,slot:p.slot||"top",filter:["has","point_count"],layout:c,paint:u}}}p&&n.push(p)}return n}function h(t={}){var e=this.getLayerIds();e.length&&(t.off?(i.off("mousemove",e,this.onLayerMouseover),i.off("mouseleave",e,this.onLayerMouseout)):t.on?(i.on("mousemove",e,this.onLayerMouseover),i.on("mouseleave",e,this.onLayerMouseout)):t||(h({off:!0}),h({on:!0})))}function f(t){if(!t)return!1;var e=this._layers.findIndex((e=>e.id===t.layer)),i=this._sources.findIndex((e=>e.id===t.source));-1!==e&&this._layers.splice(e,1),-1!==i&&this._sources.splice(i,1)}async function g(t={}){return!(!t.url||!t.id)&&new Promise((async function(e,o){const n=t.url+"?"+(new Date).getTime();i.loadImage(n,(function(t,i){return t?o(t):e(i)}))}))}this.sources=[],this.layers=[],this._layers=[],this._sources=[],this.defaultLayers=[{source:n.constants.sources.COLD,id:o+"-fill-cold",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":t.options.colors.secondaryCold,"fill-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.3]}},{source:n.constants.sources.COLD,id:o+"-line-cold",type:"line",layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":t.options.colors.primaryCold,"line-width":4,"line-gap-width":["match",["get","type"],"Polygon",0,0],"line-offset":["case",["boolean",["has","offset"],!0],["get","offset"],0],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:n.constants.sources.COLD,id:o+"-circle-cold",filter:["all",["==",["get","type"],"Circle"],["!=",["geometry-type"],"Polygon"]],type:"circle",paint:{"circle-radius":{base:6,stops:[[10,6],[14,10]]},"circle-stroke-width":1,"circle-color":t.options.colors.primaryCold,"circle-stroke-color":t.options.colors.secondaryCold,"circle-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1],"circle-stroke-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:n.constants.sources.COLD,id:o+"-icon-cold",type:"symbol",filter:["==",["get","type"],"Icon"],layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-width":0,"text-halo-color":t.options.colors.primaryCold,"text-color":t.options.colors.secondaryBackground,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:n.constants.sources.COLD,id:o+"-text-cold",type:"symbol",filter:["==","$type","Point"],layout:{"symbol-placement":"point","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-size":18,"text-justify":["get","justify"],"text-letter-spacing":.05,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,0],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":t.options.colors.primaryCold,"text-halo-color":t.options.colors.primaryText,"text-halo-width":.5,"text-opacity":1,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{id:n.constants.layers.MESH+"-line",source:n.constants.sources.MESH,type:"line",paint:{"line-color":t.options.colors.primaryBase,"line-width":2,"line-opacity":.3}},{id:n.constants.layers.MESH+"-circle",source:n.constants.sources.MESH,type:"circle",paint:{"circle-radius":2,"circle-color":t.options.colors.primaryBase,"circle-opacity":.3}},{source:n.constants.sources.HOT,id:o+"-fill-hot",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":t.options.colors.secondaryHot,"fill-opacity":["case",["boolean",["has","new"],!0],.5,.1]}},{source:n.constants.sources.HOT,id:o+"-line-hot",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.primaryHot,"line-width":4,"line-dasharray":[1,2]}},{source:n.constants.sources.HOT,id:o+"-point-hot",filter:["==","$type","Point"],type:"circle",paint:{"circle-radius":["match",["get","type"],"Circle",8,4],"circle-stroke-width":1,"circle-color":t.options.colors.primaryHot,"circle-stroke-color":t.options.colors.secondaryHot}},{source:n.constants.sources.HOT,id:o+"-icon-hot",filter:["==",["get","type"],"Icon"],type:"symbol",layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":t.options.colors.primaryHot,"text-halo-width":0,"text-color":t.options.colors.secondaryHot}},{source:n.constants.sources.HOT,id:o+"-image-hot",filter:["==",["get","type"],"Image"],type:"symbol",layout:{visibility:"visible","icon-image":["get","primaryImage",["get","style",["properties"]]],"icon-size":["interpolate",["linear"],["zoom"],1,.4,15,1],"icon-allow-overlap":!0,"icon-anchor":"bottom"}},{source:n.constants.sources.HOTTEXT,id:o+"-text-hot",type:"symbol",layout:{"symbol-placement":"point","text-field":["get","text"],"text-font":["Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-anchor":["get","anchor"],"text-size":18,"text-justify":["get","justify"],"text-letter-spacing":.1,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,1.5],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":t.options.colors.primaryText,"text-halo-color":t.options.colors.primaryBackground,"text-halo-width":1,"text-opacity":1}},{source:n.constants.sources.SNAP,id:o+"-point-snap",type:"circle",filter:["==","$type","Point"],paint:{"circle-radius":["match",["get","type"],"Circle",6,"Icon",0,6],"circle-stroke-width":2,"circle-color":t.options.colors.primarySnap,"circle-stroke-color":t.options.colors.secondarySnap}},{source:n.constants.sources.SNAP,id:o+"-icon-snap",type:"symbol",filter:["==",["get","type"],"Icon"],layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:18,stops:[[10,18],[14,16]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":t.options.colors.primarySnap,"text-halo-width":0,"text-color":t.options.colors.secondarySnap}},{source:n.constants.sources.SNAP,id:o+"-image-snap",filter:["==",["get","type"],"Image"],type:"symbol",layout:{visibility:"visible","icon-image":["get","primaryImage",["get","style",["properties"]]],"icon-size":["interpolate",["linear"],["zoom"],1,.4,15,1],"icon-allow-overlap":!0,"icon-anchor":"bottom"}},{source:n.constants.sources.SNAP,id:o+"-line-snap",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.secondarySnap,"line-width":4,"line-dasharray":[1,2]}},{source:n.constants.sources.ROUTE,id:o+"-line-route",type:"line",filter:["==","$type","LineString"],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.error,"line-width":4,"line-dasharray":[]}},{source:n.constants.sources.SELECT,id:o+"-line-select",type:"line",slot:"top",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.secondarySelect,"line-width":4}},{source:n.constants.sources.SELECT,id:o+"-fill-select",type:"fill",layout:{},slot:"top",filter:["==","$type","Polygon"],paint:{"fill-color":t.options.colors.primarySelect,"fill-opacity":.4}},{source:n.constants.sources.SELECT,id:o+"-point-select",filter:["all",["!=",["get","type"],"Text"],["==",["geometry-type"],"Point"]],type:"circle",slot:"top",paint:{"circle-radius":12,"circle-stroke-width":2,"circle-color":t.options.colors.primarySelect,"circle-stroke-color":t.options.colors.secondarySelect}},{source:n.constants.sources.SELECT,id:o+"-symbol-select",filter:["==",["get","type"],"Icon"],type:"symbol",slot:"top",layout:{"icon-optional":!0,"symbol-placement":"point","text-rotation-alignment":"viewport","text-field":["get","primaryIcon",["get","style",["properties"]]],"text-rotate":["get","rotate",["get","style",["properties"]]],"text-size":14,"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":t.options.colors.secondarySelect,"text-halo-width":2,"text-color":t.options.colors.primaryBackground}},{source:n.constants.sources.SELECT,id:o+"-text-select",filter:["==",["get","type"],"Text"],type:"symbol",slot:"top",layout:{"symbol-placement":"point","text-rotation-alignment":"viewport","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-allow-overlap":!0,"text-size":18,"text-justify":["get","justify"],"text-letter-spacing":.12,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,1.5],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":t.options.colors.primaryBackground,"text-halo-color":t.options.colors.primaryColor,"text-halo-width":2,"text-opacity":1}},{source:n.constants.sources.SELECT,id:o+"-image-select",filter:["==",["get","type"],"Image"],type:"symbol",slot:"top",layout:{"icon-image":["get","primaryImage",["get","style",["properties"]]],"icon-size":["interpolate",["linear"],["zoom"],1,.4,15,1],"icon-allow-overlap":!0,"icon-anchor":"bottom"}},{source:n.constants.sources.VERTEX,id:o+"-point-vertex",type:"circle",filter:["==","$type","LineString"],paint:{"circle-radius":4,"circle-stroke-width":3,"circle-color":t.options.colors.primaryVertex,"circle-stroke-color":t.options.colors.secondaryVertex}},{source:n.constants.sources.GAMEPAD,id:o+"-gamepad",type:"symbol",layout:{"icon-image":"gamepad","icon-size":.25}}],this.init=function(t={}){return this.options=t,this.refresh()},this.refresh=async function(e={}){var i=t.Utilities.cloneDeep(this._layers);return this._layers=[],this._sources=[],this.removeEventListeners(),this.removeLayers(this.defaultLayers),this.removeSources(Object.values(t.statics.constants.sources)),this.addEventListeners(),this.addSources(Object.values(t.statics.constants.sources)),this.addLayers(this.defaultLayers,this.options),await r.call(this,i),setTimeout((function(){t.Layers.moveLayers()}),250),this.getLayers()},this.setCustomLayers=async function(t,e){return t?await r.call(this,t,e):[]},this.getCustomLayers=function(){return this._layers},this.hasCustomLayers=function(){return this.getCustomLayers().length},this.getFeatures=function(t){var e=this.getSource(t);return e&&e._data?e._data.features:[]},this.getSelection=function(t=[],i){var o=!(!t||!t.length)&&t[0];return!!o&&(!o.properties.cluster||(e.onClusterClick(o,i),!1))},this.getType=function(t){return"Polygon"===t||"Rectangle"===t?"Polygon":"Polyline"===t||"LineString"===t||"Line"===t?"Polyline":"Point"===t||"Circle"===t||"Marker"===t||"Icon"===t||"Text"===t?"Point":"Image"===t&&"Image"},this.getSources=function(){return this.sources},this.getSource=function(t){return!!t&&this.getSources().find((function(e){return e.id===t}))},this.getSourceIds=function(){return this.getSources().map((function(t){return t.id}))},this.getLayers=function(){return this.layers},this.getLayer=function(t,e){if(!t)return!1;var i=e?this.getCustomLayers():this.getLayers(),o=i.find((function(e){return e.id===t}));return o||(o=i.filter((function(e){return e.source===t}))),o},this.getLayerIds=function(t){return(t||this.getCustomLayers()).map((function(t){return t.id}))},this.addSources=function(e=[],i={}){return e.forEach((function(t){this.addSource(t,!1,i)}),this),t.fire("sources.add",{sources:this.getSources()}),this.getSources()},this.addSource=function(e,o,n={}){if(!e)throw new Error("No source was provided!");var s={type:n.type||"geojson",data:turf.featureCollection(n.features||[]),promoteId:n.promoteId||"id"};return o&&"Point"===o&&!n.noCluster&&(s=Object.assign(s,{cluster:!0,clusterMaxZoom:n.clusterMaxZoom||14,clusterRadius:n.clusterRadius||50})),i.addSource(e,s),this.sources.push(i.getSource(e)),t.fire("source.add",{id:e,source:this.getSource(e)}),this.getSource(e)},this.addLayers=function(e=[],i={}){return e.forEach((function(t,e){this.addLayer(t,i,e)}),this),t.fire("layers.add",{layers:this.getLayers()}),h.call(this),this.getLayers()},this.addLayer=function(e,o={},n){return!(!e||!e.id)&&(e.metadata=o,i.addLayer(e,!!o.custom&&n),(e=i.getLayer(e.id))?(this.layers.push(e),t.fire("layer.add",{id:e.id,layer:this.getLayer(e.id)}),this.getLayer(e.id)):void 0)},this.addTextLayer=function(e={}){var o=e.select?t.Layers.getLayer(t.statics.constants.sources.SELECT):this.getCustomLayers(),n=e.field||"text";this.removeTextLayer(e),o.forEach((function(t){var o=t.id+"-Text",s=["all",["==",["geometry-type"],"Point"],["has",n]];e.filter&&(s=e.filter),!e.select&&e.ids&&(s=["in","id",...e.ids]);var r=Object.assign({},{visibility:"visible","symbol-placement":"point","text-rotation-alignment":"viewport","text-field":["get",n],"text-keep-upright":!0,"text-allow-overlap":!0,"text-anchor":"top","text-size":12,"text-justify":"center","text-letter-spacing":.25,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,.5],"text-padding":2,"text-rotate":0,"text-transform":"none","text-font":["Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-ignore-placement":!1,"text-max-width":15},t.text&&t.text.layout||{},e.layout),a=Object.assign({},{"text-translate-anchor":"viewport","text-halo-color":["get","primaryColor",["get","style",["properties"]]],"text-halo-width":1.2,"text-color":["get","secondaryColor",["get","style",["properties"]]],"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]},t.text&&t.text.paint||{},e.paint),c={id:o,type:"symbol",source:t.source||t.details.source||o,slot:"top",filter:s,layout:r,paint:a,metadata:{text:!0,name:o}};i.getLayer(o)||i.addLayer(c)}),this),this.showTextLayers=!0},this.removeSources=function(e){(e=e||this.getSourceIds()).forEach((function(t){this.removeSource(t)}),this),t.fire("sources.remove",{removed:!0})},this.removeSource=function(e){if(!e)return!1;i.getSource(e)&&i.removeSource(e);var o;return(o=this.sources.findIndex((function(t){return t.id===e})))>-1&&this.sources.splice(o,1),t.fire("source.remove",{removed:e}),e},this.removeLayers=function(e){var i=this.getLayerIds(e);return i.forEach((function(t){this.removeLayer(t)}),this),t.fire("layers.remove",{removed:i}),i},this.removeLayer=function(e){if(!e)return!1;i.getLayer(e)&&i.removeLayer(e);var o;return(o=this.layers.findIndex((function(t){return t.id===e})))>-1&&this.layers.splice(o,1),t.fire("layer.remove",{removed:e}),e},this.removeTextLayer=function(t={}){this.getLayers().forEach((function(t){t.metadata.text&&i.getLayer(t.id)&&i.removeLayer(t.id)}),this),this.showTextLayers=!1},this.moveLayers=function(e){(e=e||this.defaultLayers).forEach((function(e){t.map.getLayer(e.id)&&t.map.moveLayer(e.id)}))},this.addEventListeners=function(t={}){return h.call(this,{on:!0})},this.removeEventListeners=function(t={}){return h.call(this,{off:!0})},this.onClusterClick=function(t){if(!t.source)return!1;i.getSource(t.source).getClusterExpansionZoom(t.properties.cluster_id,(function(e,o){e||i.easeTo({center:t.geometry.coordinates,zoom:o+2})}))},this.onLayerMouseover=function(t){},this.onLayerMouseout=function(t){}},c=function(){const t=this.geoflo;if(!t.map)throw new Error("No map object provided!");const e=[];function i(i){var o=e.find((t=>t.id===i||t.properties.id===i));return o=o||t.getSelectedFeatures().find((t=>t.id===i||t.properties.id===i))}function o(i=[]){var o={},n=[],r=t.map.getSource(t.statics.constants.sources.COLDTEXT),a=t.map.getSource(t.statics.constants.sources.COLD);return t.updatingSource=!0,r&&r.setData(turf.featureCollection([])),a&&a.setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),e.forEach((t=>{delete t.properties.new,delete t.properties.offset;var e=t.source;if(!i.length||i.includes(e)){if(!e)return n.push(t);o[e]||(o[e]=[]),o[e].push(t)}})),e.length||t.Layers.getCustomLayers().forEach((e=>{if(e.details&&e.details.source){var i=e.details.source;if(!t.map.getSource(i))return!1;t.map.getSource(i).setData(turf.featureCollection([]))}})),Object.entries(o).forEach((e=>{var i=e[0],o=e[1];if(!t.map.getSource(i))return n.push(o);s(o,i)})),s(n.flat(),t.statics.constants.sources.COLD),setTimeout((()=>{this.setFeaturesState(e,{hidden:!1})}),100),t.fire("features.update",{features:e}),o=null,n=null,t.updatingSource=!1,e}function n(e){(e=t.Utilities.cloneDeep(e)).properties.type=this.currentType;var i=turf.point(e.geometry.coordinates[1]),o=this.getUnits(e),n="feet";return o=this.convertUnits(e,o,n),i.properties.units=o,i.properties.unit=n,i.properties.text=`${o} ${n}`,i.properties.transform="uppercase",i.properties.anchor="bottom-left",this.textFeatures.push(i),i}function s(e,i){if(!(e&&e.length&&i&&t.map.getSource(i)))return!1;if(!t.options.offsetOverlappingLines)return t.map.getSource(i).setData(turf.featureCollection(e));var o=new t.Mesh(e,!0),n=o.getFeatures();n.forEach((function(o){var s=e.find((function(t){return t.id===o.parent}));s&&(o.source=i,o.properties.style=s.properties.style||o.properties.style,function(e,i){if(!t.options.offsetOverlappingLines)return!1;if(!r(i))return!1;if(i.properties.offset)return!1;var o=6,n=[];e.forEach((function(t){return!!r(t)&&(t.parent!==i.parent&&(!t.properties.offset&&(!(!turf.booleanOverlap(t,i)&&!turf.booleanWithin(t,i))&&void n.push(t))))}),this),n.forEach((function(t){t.properties.offset=o,o*=2}),this)}(n,o))})),t.map.getSource(i).setData(turf.featureCollection(n)),t.fire("features.offset",{features:e,offset:n,source:i}),o=null,n=null}function r(t){return!!t&&"LineString"===turf.getType(t)}this.offsetLines=!1,this.getColdFeatures=function(){return e},this.getFeatureById=function(t){return Array.isArray(t)&&t.length>1?this.getFeaturesById(t):("object"==typeof t&&(t=t.parent||t.properties.parent||t.id||t.properties.id),i(t))},this.getFeaturesById=function(t){const e=[],i=[];return t.forEach((t=>{const o=this.getFeatureById(t);o&&!e.includes(t)&&(e.push(t),i.push(o))}),this),i},this.getType=function(t){return function(t){return t?function(t){return!!t&&("Polygon"===turf.getType(t)&&"Rectangle"===t.properties.type)}(t)?"Rectangle":function(t){return!!t&&("Polygon"===turf.getType(t)||"Polygon"===t.properties.type)}(t)?"Polygon":r(t)?"Polyline":function(t){return!!t&&("Point"===turf.getType(t)&&"Text"===t.properties.type)}(t)?"Text":function(t){return!!t&&("Point"===turf.getType(t)&&"Icon"===t.properties.type)}(t)?"Icon":function(t){return!!t&&("Point"===turf.getType(t)&&"Image"===t.properties.type)}(t)?"Image":function(t){return!!t&&(!("Point"!==turf.getType(t)||t.properties.type&&"Circle"!==t.properties.type)||"Point"===turf.getType(t)&&"Text"!==t.properties.type&&"Icon"!==t.properties.type&&"Image"!==t.properties.type)}(t)?"Circle":null:null}(t)},this.getUnit=function(e){if(!e)return!1;var i=e.properties.type;return!!i&&(!(!t.options.units||!t.options.units[i])&&t.options.units[i])},this.getUnits=function(t){if(!this.getUnit(t)||!t)return!1;var e=1,i=t.properties.type;return"Polyline"===i?e=turf.length(t,{units:"meters"}):("Polygon"===i||"Rectangle"===i)&&(e=turf.area(t)),e},this.setFeaturesState=function(e=[],i){return i&&e.length?(e.forEach((function(e){var o=e.id||e.properties.id;t.hotFeature&&t.hotFeature.id===o||this.setFeatureState(o,i)}),this),e):[]},this.setFeatureState=function(e,o){if(!o||!e)return!1;var n=function(e){var o="object"==typeof e&&e.id?e:i(e);if(!(o&&o.source&&t.map.getSource(o.source)&&t.map.getSource(o.source)._data))return[];var n=t.options.offsetOverlappingLines?"parent":"id",s=t.map.getSource(o.source)._data.features.filter((function(t){return t[n]===e||t.properties[n]===e}));return s}(e);return n.forEach((function(e){var i=e.id||e.properties.id;t.map.setFeatureState({source:e.source,id:i},o)})),n},this.setText=function(e=[]){if(!t.options.showFeatureText)return!1;var i=t.statics.constants.sources.HOTTEXT;this.textFeatures=[],e.features&&(e=e.features),Array.isArray(e)||(e=[e]),e.forEach((function(e){var o=e.properties.type;if(o)if(this.currentType=o,"Polyline"===o&&t.Utilities.isValidLineString(e)&&t.options.showLineUnits)turf.segmentEach(e,n.bind(this));else{i=t.statics.constants.sources.SELECT;var s=t.Utilities.cloneDeep(e);s.properties={type:"Text",text:e.properties.text,style:e.properties.style},this.textFeatures.push(s)}}),this),t.map.getSource(i).setData(turf.featureCollection(this.textFeatures)),delete this.textFeatures,delete this.currentType},this.addFeature=function(e,i,o={}){return!(!e||!e.properties)&&(e=turf.cleanCoords(e),(e=turf.truncate(e,{precision:6,coordinates:3,mutate:!0})).properties=t.Utilities.assignDeep(o,e.properties),e.source=i||e.source||e.properties.source||t.statics.constants.sources.COLD,delete e.properties.source,delete e.properties.painting,delete e.properties.edit,delete e.properties.new,delete e.properties.selected,delete e.properties.hidden,delete e.properties.offset,e.properties.style=e.properties.style||{},this.addUnits(e),this.addFeatures([e]),e)},this.addFeatures=function(i,o,n){var s,r=[];return i.forEach((i=>{if(i.id=i.id||i.properties.id||URL.createObjectURL(new Blob([])).slice(-36),n&&i.id!==n)return!1;i.source=i.source||i.properties.source||t.statics.constants.sources.COLD,i.properties.id=i.id,i.properties.type=this.getType(i);var a=e.findIndex((function(t){if(t.id===i.id||t.properties.id===i.id)return t}));a>-1?(this.setFeatureState(i.id,{hidden:!o}),e[a]=i,s=!o):(s=!this.updatingFeatures,e.push(i)),o&&delete i.properties._selected,s&&!r.includes(i.source)&&r.push(i.source)}),this),s&&this.updateSource(r),i},this.addUnits=function(t,e){var i=e||this.getUnit(t);if(!i)return!1;var o=this.convertUnits(t,null,e);return t.geometry.units=o,t.geometry.unit=i,t},this.selectFeatures=function(e){if(!e||!e.length)return!1;var i=t.getSelectedFeatures();return e.forEach((function(t){var e=t.id||t.properties.id;if(i.findIndex((t=>t.id===e||t.properties.id===e))>-1)return!1;t.properties._selected=!0,i.push(t)})),i},this.updateFeatures=function(e,i={}){e=e||t.getFeatures();var o=[],n=t.getSelectedFeatures();return this.updatingFeatures=!0,e.forEach((function(e){var s=e.id||e.properties.id;if(!s)return!1;var r=this.getFeatureById(s);if(!r||void 0===r)return o.push(e.source),this.addFeature(e,e.source);var a=n.find((t=>t.id===s||t.properties.id===s));if(a&&!t.noSelect)return a.geometry.coordinates=e.geometry.coordinates,a.properties=e.properties,a.properties._selected=!0,t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection(n));if(o.includes(r.source)||o.push(r.source),"pinning"===i.type){if(!i.coords)return!1;"Point"===r.geometry.type?r.geometry.coordinates=coords:"Polygon"===r.geometry.type&&coords?r.geometry.coordinates[0][e.index]=coords:"LineString"===r.geometry.type&&coords&&(r.geometry.coordinates[e.index]=coords)}else r.geometry.coordinates=e.geometry.coordinates,r.properties=e.properties;i.addUnits&&this.addUnits(r)}),this),this.updatingFeatures=!1,!!o.length&&this.updateSource(o)},this.updateSource=function(t){return o.call(this,t)},this.removeFeatures=function(t,i){const o=[];var n,s;return Array.isArray(t)&&i?(s=t.map((function(t){return t.details?t.details.id:t.id?t.id:t})),e.forEach((t=>{if(s.includes(t.source)){var i=e.findIndex((e=>t.id===e.id||t.properties.id===e.id));i>-1&&o.push(...e.splice(i,1))}})),this.updateSource(s)):(n=i?e.findIndex((e=>e.id===t||e.properties.id===t)):e.find((e=>e.id===t||e.properties.id===t)),i?(n>-1&&(o.push(...e.splice(n,1)),s=[o[0].source]),this.updateSource(s)):(o.push(n),this.setFeatureState(t,{hidden:!0}))),o},this.deleteFeatures=function(){e.splice(0,e.length),this.updateSource()},this.convertUnits=function(t,e,i){var o=t.properties.type,n=i||this.getUnit(t);return e=e||this.getUnits(t),"Polyline"===o?e=Math.round(turf.convertLength(e,"meters",n)):("Polygon"===o||"Rectangle"===o)&&(e=Math.round(turf.convertArea(e,"meters",n))),e=e?Number(e.toFixed(2)):0}},u=function(t,e){var i=1,o=[],n={};const s=this.geoflo;function r(t,e){return!n[i]&&!h(i)&&(n[i]=t,t.id=i,t.parent=e,s.Utilities.setProperty(t,"id",i),s.Utilities.setProperty(t,"parent",e),i++,!0)}function a(t,e,i){for(var o=turf.truncate(turf.point(t[0]),{precision:7,coordinates:2,mutate:!0}),n=null,a=1;a<t.length;a++){if(n=turf.truncate(turf.point(t[a]),{precision:7,coordinates:2,mutate:!0}),!s.Utilities.isPointEqual(o.geometry.coordinates,n.geometry.coordinates)){var c=turf.lineString([o.geometry.coordinates,n.geometry.coordinates]);r(c,i)&&e.push(c)}o=n}}function c(t){var i=[];return t&&t.length?(t.forEach((function(t){var o=t.geometry.type,n=t.parent||t.properties.parent||t.id||t.properties.id;if(e&&"LineString"!==o&&!t.properties.unfill)return!!r(t=s.Utilities.cloneDeep(t),n)&&i.push(t);"MultiPolygon"===o?t.geometry.coordinates.forEach((function(t){t.forEach((function(t){a(t,i,n)}))})):"Polygon"===o||"MultiLineString"===o?t.geometry.coordinates.forEach((function(t){a(t,i,n)})):"LineString"===o?a(t.geometry.coordinates,i,n):"Point"===o&&r(t=s.Utilities.cloneDeep(t),n)&&i.push(t)})),i):i}function u(t,e,i){var o=e.id||e.properties.id,n=t[o];void 0===n&&(n=[],t[o]=n),i.forEach((function(t){var e=s.Utilities.reducePrecision(t.geometry.coordinates);-1===n.findIndex((function(t){return t[0]===e[0]&&t[1]===e[1]}))&&n.push(e)}))}function l(t,e){for(var i={},n=function(t,e,o){var n=t.geometry.coordinates,r=e.geometry.coordinates,a=o.geometry.coordinates,c=!1,l=!1,p=!1;if(!s.Utilities.isPointEqual(n,r[0])&&!s.Utilities.isPointEqual(n,r[1])){var d=turf.point(r[0]),h=turf.point(r[1]),f=turf.distance(t,d)<turf.distance(t,h)?d:h;turf.pointOnLine(o,f).properties.dist<s.statics.constants.MIN_DISTANCE?(u(i,o,[f]),p=!0):c=!0}if(!s.Utilities.isPointEqual(n,a[0])&&!s.Utilities.isPointEqual(n,a[1])){var g=turf.point(a[0]),m=turf.point(a[1]),y=turf.distance(t,g)<turf.distance(t,m)?g:m;turf.pointOnLine(e,y).properties.dist<s.statics.constants.MIN_DISTANCE?(u(i,e,[y]),p=!0):l=!0}p||(c&&u(i,e,[t]),l&&u(i,o,[t]))},r=function(t,e){var o=turf.pointOnLine(t,turf.point(e));return o.properties.dist<s.statics.constants.MIN_DISTANCE&&!s.Utilities.isPointAtVertex(t.geometry.coordinates,e)&&(u(i,t,[o]),!0)},a=t===e,c=0;c<t.length;c++)for(var l=t[c],p=l.geometry.type,d=a?c+1:0;d<e.length;d++){var f=e[d],g=f.geometry.type,m=f.id||f.properties.id;if("LineString"===p&&"LineString"===g){if(s.Utilities.isOverlapping(l,f)){var y=turf.lineIntersect(l,f).features;if(y.length>0){y.length,n(y[0],l,f)}else{var v=l.geometry.coordinates,b=f.geometry.coordinates;r(l,b[0]),r(l,b[1]),r(f,v[0]),r(f,v[1])}if(h(m)){var x=o.indexOf(h(m));o.splice(x,1)}}}else if("Point"===p||"Point"===g){if("Point"===g&&"Point"===g);else{var C="Point"===p?l:f,E="LineString"===p?l:f;m=C.id||C.properties.id,r(E,C.geometry.coordinates)&&(i[m]=[])}if(h(m)){x=o.indexOf(h(m));o.splice(x,1)}}}return i}function p(t,e){var i=[];return t.forEach((function(t){var o=t.id||t.properties.id;if("LineString"===t.geometry.type){var n=e[o];if(void 0!==n){var a=turf.lineSplit(t,turf.multiPoint(n));turf.featureEach(a,(function(t){var e=turf.lineDistance(t);e>s.statics.constants.MIN_SEGMENT_LENGTH&&(s.Utilities.setProperties(t,{length:e}),r(t),i.push(t))}))}else{var c=turf.lineDistance(t);c>s.statics.constants.MIN_SEGMENT_LENGTH&&(s.Utilities.setProperties(t,{length:c}),i.push(t))}}else{void 0===e[o]&&i.push(t)}})),i}function d(t){var i=c(t);return e?i:p(i,l(i,i))}function h(t){return o.find((function(e){return e.id===t||e.properties.id===t}))}function f(t){return o.filter((function(e){return e.parent===t||e.properties.parent===t}))}this.addNewFeatures=function(t){var e=c(d(t)),i=l(e,o);return o=[].concat(s.Utilities.consumableArray(p(o,i)),s.Utilities.consumableArray(p(e,i))),this.getFeatures()},this.getFeatures=function(){return o},this.splitSegmentAtPoint=function(t,e){var i=n[t];if(void 0!==i){var a=o.indexOf(i);o.splice(a,1);var c=s.Utilities.createLineWithLength([e,i.geometry.coordinates[0]]),u=s.Utilities.createLineWithLength([e,i.geometry.coordinates[1]]);r(c),r(u),o.push(c,u)}},this.getFeaturesFromIndex=function(t){var e=[];return t.forEach((function(t){var i=t.id||t.properties.id,o=n[i];void 0!==o&&e.push(o)})),e},this.getFeatureById=function(t){return h(t)},this.getFeaturesByParentId=function(t){return f(t)},this.removeFeature=function(t){return function(t){var e=f(t);e&&e.length&&(e.forEach((function(t){var e=o.indexOf(t);o.splice(e,1)})),s.updateMeshData());return o}(t)},t&&(o=d(t))},l=["map.enable","map.disable","map.ready","map.redraw","map.refresh","mode.change","theme.change","sources.add","source.add","source.hot","layers.add","layers.remove","layer.add","control.add","control.remove","features.zoom","features.add","features.delete","features.update","features.import","features.export","features.offset","feature.add","feature.delete","feature.select","feature.deselect","feature.update","feature.history","select.load","select.add","select.remove","select.activate","select.deactivate","draw.activate","draw.deactivate","draw.start","draw.finish","draw.cancel","mesh.load","text.add","icon.add","vertex.find","vertex.on","vertex.off","vertex.add","vertex.drag","vertex.dragsnap","vertex.delete","overpass.add","snapping.activate","snapping.deactivate","snapping.add","snapping.refresh","snapping.delete","pinning.activate","pinning.deactivate","pinning.add","pinning.update","routing.activate","routing.deactivate","routing.add","painting.activate","painting.deactivate","painting.start","painting.update","gamepad.init","gamepad.add","gamepad.remove","gamepad.hold","gamepad.press","gamepad.release","gamepad.connect","gamepad.disconnect","locate.on","locate.off","locate.update"],p=function(t){const e=function(e){t.mapMoving=e,t.settingExtent||(t.locate&&t.locate.onMapMove(e),t.setIcon(e))},i=function(e){t.mapMoving=e,t.settingExtent||(t.setIcon(e),t.setCenterMarker(),t.locate&&t.locate.following&&t.setMapClass("disable"))},o=function(e){t.mapMoving=!1,t.settingExtent||(t.onMapMove(e),t.locate&&t.locate.onMapMove(e),t.setIcon(e))},n=function(e){var i=t.options.painting&&t.options.painting.enable;i=i&&t.currentMode&&"draw"===t.currentMode.id,t.locate&&t.locate.following?t.setMapClass("disable"):t.dragMoving?t.setMapClass("grabbing"):t.addingVertexOnLine||t.canAddVertex?t.setMapClass("pointer"):t.canDragMove?t.setMapClass("grab"):i?t.setMapClass("painting"):t.setMapClass("pointer"),t.lastMouseEvent=e,t.currentMode.handleMove&&t.currentMode.handleMove(e)},s=function(e){var i=t.options.painting&&t.options.painting.enable;i=i&&t.currentMode&&"draw"===t.currentMode.id,t.locate&&t.locate.following?t.setMapClass("disable"):i?t.setMapClass("painting"):t.dragMoving||t.addingVertexOnLine?t.setMapClass("grabbing"):t.canDragMove?t.setMapClass("grab"):t.lastClick?t.setMapClass("grabbing"):t.setMapClass("pointer"),t.mouseIsDown=[e.lngLat.lng,e.lngLat.lat],t.currentMode.handleDown&&t.currentMode.handleDown(e)},r=function(e){t.mouseIsDown=!1,t.locate&&t.locate.following?t.setMapClass("disable"):t.setMapClass("pointer"),t.currentMode.handleUp&&t.currentMode.handleUp(e)},a=async function(e){if(e.type.includes("preclick"))return!!t.currentMode.handlePreclick&&t.currentMode.handlePreclick(e);t.currentMode.handleClick&&t.currentMode.handleClick(e)},c=function(e){t.locate&&t.locate.following?t.setMapClass("disable"):t.dragMoving?t.setMapClass("grabbing"):t.canDragMove?t.setMapClass("grab"):t.setMapClass("move"),t.currentMode.handleDrag&&t.currentMode.handleDrag(e)},u=function(e){t.currentMode.handleOffMap&&t.currentMode.handleOffMap(e)},p=function(e){t.currentMode.handleOnMap&&t.currentMode.handleOnMap(e)},d=function(e){if(t.textMarker)return;const i=t.getButtons();let o=!1;if(Object.keys(i).forEach((n=>{const s=i[n],r=t.options.keys[n];(r===e.key||r===e.keyCode||s.keycode&&s.keycode===e.keyCode)&&(s.button.click(),o=!0)})),t.options.commands&&t.options.commands.forEach((function(i){if(i.key===e.keyCode||i.key===e.key||i.key===e.code){if(!i.command||"function"!=typeof i.command)return;i.command(e,t,i),o=!0}})),o)return o;switch(e.key.includes("Arrow"),e.code){case"Enter":case"NumpadEnter":t.setMode();break;case"Escape":t.hotFeature=null,t.setMode();break;case"Home":t.moveSelectedFeatures(1);break;case"End":t.moveSelectedFeatures(-1);break;case"Delete":t.mode===t.statics.constants.modes.SELECT?t.hasSelection()&&t.removeSelection():t.mode===t.statics.constants.modes.DRAW&&t.currentMode.deleteVertex()}},h=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},f=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},g=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},m=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},y=function(e){t.addGamepad(e.gamepad||e.detail.gamepad)},v=function(e){t.removeGamepad(e.gamepad||e.detail.gamepad)},b=function(e){t.updateOrientation({alpha:e.alpha,beta:e.beta,gamma:e.gamma})},x=function(t){},C=function(e){t.setMapClass("grabbing"),t.setIcon(e),t.setCenterMarker({transform:!0})},E=function(e){const i=e.type.split(":")[1],o={data:e.detail,type:i.split(".")[0],action:i.split(".")[1],target:t},n={name:i,detail:o};t.map.fire(t.id,n)},L=function(e){t.currentMode.handleContext&&t.currentMode.handleContext(e)},S=function(e){if(!e.sourceDataType||"content"===!e.sourceDataType||!e.sourceId)return!1;const i=e.sourceId,o={id:i,data:e.source.data,type:e.type,target:t};i===t.statics.constants.sources.HOT&&t.fire("source.hot",o)};return{addEventListeners:function(){t.map.on("movestart",e),t.map.on("move",i),t.map.on("moveend",o),t.map.on("mousemove",n),t.map.on("preclick",a),t.map.on("click",a),t.map.on("tap",a),t.map.on("dragstart",x),t.map.on("drag",c),t.map.on("mousedown",s),t.map.on("mouseup",r),t.map.on("rotatestart",C),t.map.on("pitchstart",C),t.map.on("rotate",C),t.map.on("pitch",C),t.map.on("touchstart",h),t.map.on("touchend",f),t.map.on("touchmove",g),t.map.on("touchcancel",m),t.map.on("contextmenu",L),t.map.on("sourcedata",S),l.forEach((function(e){t.map.on(t.id+":"+e,E)})),t.container.addEventListener("keydown",d),t.container.addEventListener("mouseover",p),t.container.addEventListener("mouseleave",u),window.addEventListener("gamepadconnected",y),window.addEventListener("gamepaddisconnected",v),window.addEventListener("deviceorientation",b,!0)},removeEventListeners:function(){t.map.off("movestart",e),t.map.off("move",i),t.map.off("moveend",o),t.map.off("mousemove",n),t.map.off("preclick",a),t.map.off("click",a),t.map.off("tap",a),t.map.off("dragstart",x),t.map.off("drag",c),t.map.off("mousedown",s),t.map.off("mouseup",r),t.map.off("rotatestart",C),t.map.off("pitchstart",C),t.map.off("touchstart",h),t.map.off("touchend",f),t.map.off("touchmove",g),t.map.off("touchcancel",m),t.map.off("contextmenu",L),t.map.off("sourcedata",S),l.forEach((function(e){t.map.off(t.id+":"+e,E)})),t.container.removeEventListener("keydown",d),t.container.removeEventListener("mouseover",p),t.container.removeEventListener("mouseleave",u),window.removeEventListener("gamepadconnected",y),window.removeEventListener("gamepaddisconnected",v),window.removeEventListener("deviceorientation",b,!0)}}},d=function(){const t=this.geoflo;var e,i,o,n=[],s=[],r=[];function a(t,e){var i=document.createElement("tr");if(i.classList.add("popup-table-row"),t){var o=document.createElement("th");o.classList.add("popup-table-header"),o.appendChild(document.createTextNode(t)),i.appendChild(o)}var n=document.createElement("td");return n.classList.add("popup-table-data"),n.classList.add(t),n.appendChild(document.createTextNode(e)),i.appendChild(n),i}function c(e){i=t.options.select.multiple,r=e,n=void 0===n?[]:n,e.length>=n.length&&n.splice(0,e.length-n.length+1);var s=e[0];o=s.id||s.properties.id,e.length>1&&e.forEach((t=>{const e=t.id||t.properties.id;-1===n.indexOf(e)&&(o=e,s=t)})),i||t.currentMode.deselectCurrentFeature(),t.currentMode.selectFeature(o)}this.id="select",this.activate=function(e={}){return!this.activated&&(t.currentMode.id!==this.id?(e.mode=this.id,t.setMode(e)):(this.activated=!0,t.map.dragPan.enable(),t.setButtons(),t.setActiveButton("select"),t.fire("select.activate",{activated:!0,options:e}),this.gamepad,t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),void setTimeout((function(t){t.selectFeature(e.id?e.id:!!e.feature&&e.feature.id)}),5,this)))},this.deactivate=function(){if(!this.activated)return!1;this.activated=!1,this.deselectCurrentFeature(),t.setButtons(),t.fire("select.deactivate",{activated:!0})},this.canHandle=function(e){return t.statics.constants.modes.SELECT===e},this.selectFeature=function(e,i={}){const o=t.options.select.popup,r=t.Layers.getLayer(t.statics.constants.sources.SELECT);return t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),!!e&&(-1===n.indexOf(e)&&n.push(e),s=t.Features.removeFeatures(e,!0),t.addFeaturesToSelected(s,i),o&&this.addPopup(s),t.getSelectedFeatures().forEach((function(e){const i=e.source,o=t.Layers.getLayer(i,!0),n=!!o&&o.style;if(!n)return r.forEach((function(e){let i=t.map.getLayer(e.id);i&&(e.paint?Object.entries(e.paint).forEach((function(t){const e=t[0],o=t[1];i.setPaintProperty(e,o)})):e.layout&&Object.entries(e.layout).forEach((function(t){const e=t[0],o=t[1];i.setLayoutProperty(e,o)})))}));r.forEach((function(t){let e=o.type;e&&(e=e.toLowerCase(),t.id.includes(e)&&n[e]&&(n[e].paint?Object.entries(n[e].paint).forEach((function(e){const i=e[0],o=e[1];t.setPaintProperty(i,o)})):n[e].layout&&Object.entries(n[e].layout).forEach((function(e){const i=e[0],o=e[1];t.setLayoutProperty(i,o)}))))}))})),t.fire("feature.select",{ids:t.getSelectedFeatureIds(),features:t.getSelectedFeatures()}),t.wantingToEdit?(1==s.length&&e===s[0].id&&(a=s[0],t.wantingToEdit=!1,t.setMode("edit",a.properties.type,a)),s):s);var a},this.deselectCurrentFeature=function(){t.fire("feature.deselect",{ids:t.getSelectedFeatureIds(),features:t.getSelectedFeatures()}),t.removeSelection()},this.addPopup=function(i){this.popupElement=function(e){const i=document.createElement("div");i.classList.add("popup-table-holder");const o=function(e){var i=document.createElement("table"),o=["id","type"];i.style.width="100%",i.style.height="100%",i.setAttribute("border","1"),i.classList.add("popup-table");var n=document.createElement("tbody");return e.forEach((function(e,i){var s=e.properties.type;o.forEach((function(t){n.appendChild(a(t,e.properties[t]))})),n.appendChild(a("geometry",e.geometry.type)),"LineString"===e.geometry.type?(t.Features.addUnits(e,"feet"),n.appendChild(a("unit",e.geometry.unit)),n.appendChild(a("units",e.geometry.units))):"Text"===s?n.appendChild(a("content",e.properties.text)):"Polygon"===e.geometry.type&&(t.Features.addUnits(e,"acres"),n.appendChild(a("unit",e.geometry.unit)),n.appendChild(a("units",e.geometry.units)))})),i.appendChild(n),i}(e);if(i.appendChild(o),r.length>1){var n=document.createElement("div");n.classList.add("popup-table-button"),n.innerHTML="<button> Next </button>",n.addEventListener("click",c.bind(this)),i.appendChild(n)}return i}(i),this.popup=new mapboxgl.Popup({closeOnClick:!1}).setLngLat(e).setDOMContent(this.popupElement).addTo(t.map).setOffset(12),this.popup._container.style["margin-bottom"]="10px"},this.removePopup=function(){return!(!this.popup||!this.popup.remove)&&this.popup.remove()},this.handleMove=function(t){},this.handleClick=function(s){var a=t.getRenderedDrawnFeatures(s.lngLat);if(e=[s.lngLat.lng,s.lngLat.lat],i=s.originalEvent&&s.originalEvent.shiftKey&&t.options.select.multiple,a.length>0){if(!t.Layers.getSelection(a,e))return;c.call(this,a)}else i||(n=[],r=[],e=!1,o=!1,this.deselectCurrentFeature())},this.handleDrag=function(t){}},h=function(){const t=this.geoflo;function e(e,o,n){var s,r=t.currentMode.cancelled;if(t.editMode&&!t.currentMode.savingEdit&&!r)return t.currentMode.saveEdit(o);if(r||!e)return i(),t.hotFeature&&(t.removeSelection(),t.removeFeature(t.hotFeature.id,!0),t.addFeatures([t.hotFeature],!0)),t.Pinning.resetFeatures(),t.editMode||t.fire("draw.cancel",{cancel:!0,feature:t.hotFeature}),!1;if("Text"===e&&!n)return a.call(t.currentMode,e,o);if(t.hotFeature){if(t.Utilities.isPoint(t.hotFeature)){var u=Array.isArray(t.hotFeature.geometry.coordinates[0])?t.hotFeature.geometry.coordinates[0]:[t.hotFeature.geometry.coordinates[0],t.hotFeature.geometry.coordinates[1]];s=o=t.Painting.enabled||t.currentMode.savingEdit?o:turf.point(u)}else t.Utilities.isPolygon(t.hotFeature,e)?(t.hotFeature.geometry.type="Polygon","Rectangle"===e?t.endPoint&&c(t.hotFeature,"0.2",t.endPoint[0],t.endPoint[1]):(t.hotFeature.geometry.coordinates.push(t.hotFeature.geometry.coordinates[0]),t.hotFeature.geometry.coordinates=[t.hotFeature.geometry.coordinates])):t.Utilities.isLineString(t.hotFeature,e)?"Polygon"===e?(t.hotFeature.geometry.type=e,t.hotFeature.geometry.coordinates.push(t.hotFeature.geometry.coordinates[0]),t.hotFeature.geometry.coordinates=[t.hotFeature.geometry.coordinates]):"Rectangle"===e&&t.endPoint&&c(t.hotFeature,"0.2",t.endPoint[0],t.endPoint[1]):o&&(s=o);if(t.Painting.enabled){var l=t.options.painting.tolerance;t.hotFeature="Circle"===e?t.hotFeature:turf.simplify(t.hotFeature,{mutate:!0,tolerance:"function"==typeof l?l(t.map):l,highQuality:!0}),t.startPoint&&(t.hotFeature.geometry.coordinates[0]=t.startPoint)}}else o&&(s=o);return(s=t.Exploring.currentFeature||s||t.hotFeature)&&t.currentMode.activated?(s=t.Features.addFeature(s,t.currentMode.source,t.currentMode.properties),t.fire("draw.finish",{feature:s,pinned:t.Pinning.getFeatures(),type:e,editing:t.editMode}),t.currentMode.deactivate()):t.currentMode.deactivate()}function i(i,o,n){var s=t.textMarker;if(!s)return!1;var r=s.getElement(),c=r.value;if(!c.length||t.currentMode.cancelled)return s.remove(),t.textInput=!1,a.call(this,o,n);var u=[r.getAttribute("lng"),r.getAttribute("lat")];o=o||r.getAttribute("type"),t.currentMode.properties.text=c;n={type:"Feature",properties:{type:o,text:c},geometry:{type:"Point",coordinates:u}};s.remove(),e(o,n,c)}function o(e){var i,o=t.hotFeature;if(t.dragMoving)return!1;if(!o)return!1;var n=t.Snapping.getClosest(e.geometry.coordinates),s=n.coords,r=!!n.point&&n.point.type;if(!r)return!1;if(!s&&"linepoint"===r&&n.point.borders){var a=turf.lineString([n.point.border1,n.point.border2]);s=(i=turf.along(a,n.point.distance1)).geometry.coordinates}return!!s&&((i=t.Utilities.isLineString(o)&&"vertex"===r?turf.booleanPointOnLine(o,turf.point(s)):turf.point(s)).properties.type=r,t.fire("vertex.find",{vertex:i,feature:t.hotFeature,closest:n}),i)}function n(e,i){var o;if(i&&e){var n=t.hotFeature.geometry.coordinates,s=turf.lineString(n),r=turf.point(n[0]),a=turf.lineSlice(r,e,s),c=a.geometry.coordinates.length-1,u=a.geometry.coordinates[c];e=turf.point(u),s.geometry.coordinates.splice.apply(s.geometry.coordinates,[c,0].concat([u])),s=turf.cleanCoords(s),o=turf.truncate(s,{precision:6,coordinates:2,mutate:!0}),t.hotFeature.geometry.coordinates=o.geometry.coordinates,t.hotFeature=t.Utilities.cloneDeep(t.hotFeature)}else e&&(t.canDragMove=!0,t.canAddVertex=e);return e}function s(e,i){var o,s=t.hotFeature;if(t.dragMoving)return r();if(!s||!e)return r();t.updateMeshData();var a=e.properties.type;if(o=e.properties.index||0==e.properties.index?e.properties.index:("Circle"===t.currentMode.type||"Icon"===t.currentMode.type||"Image"===t.currentMode.type)&&0,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([e])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),"linepoint"===a)return n(e);t.map.dragPan.disable(),t.dragIndex=o,t.addedVertexOnLine=!!i&&e,t.canAddVertex=!1,t.canDragMove=!0,t.snappedVertex=e.geometry.coordinates,t.Pinning.setFeatures(t.snappedVertex),t.fire("vertex.on",{vertex:e,index:o,feature:t.hotFeature})}function r(){if(t.hotFeature){if(t.mouseIsDown&&t.Painting.enabled)return!1;t.snappedVertex&&(t.lastIndex&&(t.lastClick={coords:t.snappedVertex}),t.fire("vertex.off",{vertex:!1,index:t.dragIndex,feature:t.hotFeature})),t.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.snappedVertex=null,t.dragIndex=-1,t.mouseIsDown=t.touchDown||!1,t.pinableFeatures=[],t.lastIndex=!1,t.canAddVertex=!1,t.addedVertexOnLine=!1}}function a(e,o){if(!(o=o||t.hotFeature))return!1;if(e=e||o.properties.type,o.properties.type=e,"Text"===e){if(t.textInput)return i(0,e,o);var n={lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]},s=t.textInput=document.createElement("input");s.value=o.properties.text||"",s.className="text-marker",s.setAttribute("contenteditable","true"),s.setAttribute("autocorrect","off"),s.setAttribute("spellcheck","false"),s.setAttribute("placeholder","Press Enter or Select Button When Done..."),s.setAttribute("type",e),s.setAttribute("lng",n.lng),s.setAttribute("lat",n.lat),t.textMarker=new t.Mapbox.Marker(s).setLngLat(n).addTo(t.map),t.textMarker.setOffset([0,-25]),s.addEventListener("submit",i),s.addEventListener("keydown",(function(t){[32,37,38,39,40].indexOf(t.keyCode)>-1?t.stopPropagation():13===t.keyCode&&(t.preventDefault(),i())})),s.addEventListener("paste",(function(t){var e,i;t.stopImmediatePropagation(),t.preventDefault(),e=t.clipboardData||window.clipboardData,i=e.getData("text/plain").slice(0,CHAR_LIMIT),t.target.innerText=i})),s.focus(),t.fire("text.add",{feature:o,marker:t.textMarker,type:e})}}function c(t,e,i,o){var n=e.split("."),s=parseInt(n[0],10),r=parseInt(n[1],10);void 0===t.geometry.coordinates[s]&&(t.geometry.coordinates[s]=[]),t.geometry.coordinates[s][r]=[i,o]}this.id="draw",this.canHandle=function(e){return t.statics.constants.modes.DRAW===e},this.activate=function(e={}){if(this.activated)return!1;if(t.currentMode.id!==this.id)return e.mode=this.id,t.setMode(e);this.activated=!0,this._handleHistory=this.handleHistory.bind(this),this.history=[],this.undo=[],e.feature&&(e.type=function(e){var i=t.Features.getType(e);if(!i)return alert("No Feature Type Found");t.currentMode.type=i,t.currentMode.source=e.source,t.editMode=!0,t.hotFeature=e,t.Utilities.setProperty(t.hotFeature,"type",i),t.Utilities.setProperty(t.hotFeature,"edit",!0),t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),"Polygon"===i?t.hotFeature=turf.polygonToLine(t.hotFeature):"Circle"===i||"Icon"===i||"Image"===i?t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([])):"Text"===i?(t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([t.hotFeature])),a.call(t.currentMode,i,t.hotFeature)):(t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])));var o=t.Utilities.isPoint(t.hotFeature)?t.hotFeature.geometry.coordinates:t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1];return t.lastClick={coords:o},t.Features.removeFeatures(t.hotFeature.id),t.refreshMeshData(),t.currentMode.type}(e.feature)),t.drawMode=!t.editMode;var i=e.lngLat;delete e.lngLat;var o=this.type=e.type,n=e.feature?e.feature.properties:e;this.properties=Object.assign({},n),delete this.properties.mode,delete this.properties.location;const s=e.id||n.id||URL.createObjectURL(new Blob([])).slice(-36);return this.properties.id=s,this.properties.type=o,t.setButtons(),t.setActiveButton(o),t.Utilities.isPoint(t.hotFeature)&&(this.isPoint=!0),t.fire("draw.activate",{id:s,type:o,activated:this.activated,editing:t.editMode,feature:t.hotFeature||e.feature,properties:this.properties}),t.on("source.hot",this._handleHistory),i&&this.handleMove({lngLat:i}),(t.options.painting.enable||t.mobile&&"Rectangle"===o)&&t.activatePainting(),this.updateHotSource(),this},this.deactivate=function(e,i,o){if(!this.activated)return!1;var n;e&&this.cancelEdit(i,o),n=this,t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),t.deleteMeshData(),n.history=[],n.undo=[],n.type=null,n.cancelled=!1,n.activated=!1,n.savingEdit=!1,t.editMode=!1,t.drawMode=!1,delete t.startPoint,delete t.lastClick,delete t.firstClick,delete t.endPoint,delete t.snapFeature,delete t.hotFeature,delete t.drawStarted,delete t.dragMoving,delete t.editing,delete t.textMarker,delete t.textInput,delete t.touchMoving,delete t.touchDown,delete t.pinningFeatures,delete t.pinnedFeatures,delete t.canDragMove,delete t.canAddVertex,delete t.dragIndex,delete t.addedVertexOnLine,delete t.snappedVertex,t.setButtons(),t.off("source.hot",this._handleHistory),t.fire("draw.deactivate",{activated:this.activated}),setTimeout((function(){t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([]))}),300),t.options.repeatDraw?this.activate(this.properties):t.setMode()},this.updateHotSource=function(e,i){if(e&&(t.hotFeature=e),t.hotFeature&&!t.overpassDownloading)return t.hotFeature.properties=t.Utilities.assignDeep(t.hotFeature.properties,i||{}),t.hotFeature.properties.style=t.hotFeature.properties.style||{},t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.hotFeature},this.deleteVertex=function(e){if(t.hotFeature){const i=t.hotFeature.geometry.coordinates;e=void 0!==e?e:i.length-1,i.length>1&&(i.splice(e,1),t.lastClick={coords:i[i.length-1]},i.length>0?t.snapFeature=turf.point(i[i.length-1]):t.snapFeature=null,i.length>1?t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])):(t.hotFeature=null,t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([]))),t.fire("vertex.delete",{coords:i,index:e,feature:t.hotFeature})),t.lastMouseEvent&&t.currentMode.handleMove&&t.currentMode.handleMove(t.lastMouseEvent)}else t.snapFeature&&(t.snapFeature=null,t.lastClick=null,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])))},this.getFeature=function(){return t.hotFeature},this.selectFeature=function(e){return!!e&&(t.setMode(),t.currentMode.selectFeature(e))},this.saveEdit=function(i){var o=t.hotFeature;if(!o)return!1;var n=o.properties.type||i.properties.type||this.type;return i=i||o,this.savingEdit=!0,e(n,i)},this.cancelEdit=function(i,o){return this.cancelled=!0,o&&o.properties.type?(this.standby=i,t.hotFeature=o,t.fire("draw.cancel",{feature:o}),e()):(t.hotFeature=null,e())},this.handleDown=function(e){if(t.mouseIsDown=[e.lngLat.lng,e.lngLat.lat],e.touch&&(t.touchDown=!0,s(o(turf.point(t.mouseIsDown)))),t.canAddVertex)return s(o(n(t.canAddVertex,e)),!0);t.Pinning.setFeatures(t.snappedVertex),function(){var e=setInterval((function(){t.mouseIsDown?(t.lastDragMove+=1,t.lastDragMove<t.options.pinning.idle?t.mouseIsIdle=!1:(t.mouseIsIdle=!0,t.Snapping.setVertex(),t.Pinning.updateFeatures())):(t.lastDragMove=0,t.mouseIsIdle=!1,clearInterval(e))}),1)}()},this.handleUp=function(i){if(t.mouseIsDown=!1,t.touchDown=!1,t.Painting.enabled)return t.Painting.handleUp(i);if(!t.addedVertexOnLine||t.dragMoving){if(i.touch&&t.touchMoving)return t.dragMoving=!1;if(t.Utilities.isPoint(t.hotFeature)&&t.snappedVertex)return t.editMode?this.saveEdit():e(this.type);if(t.snappedVertex&&t.dragMoving&&!t.mapMoving&&"Rectangle"!==this.type){t.gamepadDrag=i.gamepad;var n=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);n=n||!(!t.Utilities.isPolygon(t.hotFeature)||0!=t.dragIndex);var r=t.Utilities.getLastIndexCoords(t.hotFeature);s(o(turf.point(t.snappedVertex))),this.updateHotSource(),n&&setTimeout((function(){t.lastClick={coords:r}}),100)}t.pinableFeatures=[],t.mouseIsIdle=!1,a.call(this,this.type),t.refreshMeshData()}},this.handleClick=function(i){if(i.finish)return t.editMode?this.saveEdit():e(this.type);if(i.touch&&t.touchMoving)return t.touchMoving=!1,t.Snapping.setFeature(),this.updateHotSource();if(i.touch&&(t.touchClick=!0),t.addedVertexOnLine)return t.Snapping.setFeature(),this.updateHotSource(),s(o(t.addedVertexOnLine)),this.handleDrag(i),t.dragMoving=!1,t.gamepadDrag=!1,t.mouseIsIdle=!1,i;if(t.gamepadDrag)return t.gamepadDrag=!1;if(!t.editMode||"Polygon"!==this.type&&"Text"!==this.type){this.firstClick||t.drawStarted?t.fire("vertex.add",{type:this.type,coords:[i.lngLat.lng,i.lngLat.lat]}):(t.drawStarted=!0,t.fire("draw.start",{type:this.type,editing:t.editMode,coords:[i.lngLat.lng,i.lngLat.lat]}));var n=t.closestPoint||{coords:[i.lngLat.lng,i.lngLat.lat]},r=turf.point(n.coords);if(r.properties=this.properties,r.source=this.source,t.lastMove=n.coords.length>1&&{lat:n.coords[n.coords.length-1][1],lng:n.coords[n.coords.length-1][0]},!t.startPoint){if("Rectangle"===this.type)return t.startPoint=n.coords,t.hotFeature=turf.polygon([[t.startPoint,[i.lngLat.lng,i.lngLat.lat],[t.startPoint[0],i.lngLat.lat],t.startPoint]]),t.Utilities.setProperty(t.hotFeature,"type",this.type);"Polygon"===this.type&&(t.startPoint=n.coords)}return!t.snapFeature&&n&&(t.snapFeature=n),function(e,i){var o=["Circle","Icon","Text","Image"];return!e||(!!o.includes(e)||("Rectangle"===e&&t.startPoint?(t.endPoint=i,!0):!!("Polygon"===e&&t.snappedVertex&&t.startPoint&&t.Utilities.isPointEqual(t.startPoint,t.snappedVertex))||(!(!t.snappedVertex||!t.Utilities.isLastIndex(t.dragIndex,t.hotFeature))||!(!t.lastClick||!t.Utilities.isPointEqual(t.lastClick.coords,i)))))}(this.type,n.coords)?e(this.type,r):(this.firstClick=!t.firstClick&&{coords:n.coords},t.lastClick=n,t.firstClick=t.firstClick?t.firstClick:{coords:n.coords},t.Snapping.setFeature(),a.call(this,this.type),t.Exploring.setFeatures(n.coords,{set:!0}),delete t.touchClick,this.updateHotSource())}},this.handleMove=function(e){if(e.touch&&t.mouseIsDown&&(t.touchMoving=!0),t.overpassDownloading)return!1;if(t.mouseIsDown&&t.canAddVertex)return!1;if(t.canDragMove&&t.snappedVertex&&t.mouseIsDown)return this.handleDrag(e);if(t.mouseIsDown&&t.Painting.enabled)return this.handlePainting(e);if(e.touch&&t.touchMoving)return t.snapFeature=!1;if(1===(!!e.originalEvent&&(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which)))return!1;var i=t.Routing.enabled;e.originalEvent&&e.originalEvent.altKey&&(i=!1);var n=t.Snapping.enabled;e.originalEvent&&e.originalEvent.shiftKey&&(n=!1);var r=[e.lngLat.lng,e.lngLat.lat],a=t.Utilities.isPoint(t.hotFeature),c=t.editMode&&("Polygon"===this.type||"Rectangle"===this.type),u=turf.point(r),l=null;return c?l=u:n?l=t.Snapping.setClosest(r,a):a?a&&(l=u):l=t.Snapping.updateFeature(r),i&&(l=t.Routing.getClosest()||l),l||(l=u),t.Snapping.addFeature(l,this.properties,c),s(o(u)),!l&&this.isPoint&&delete this.isPoint,c&&i&&t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),"Rectangle"===this.type?this.handleRectangle(e):"Icon"===this.type?this.handleIcon(e,t.snapFeature):"Text"===this.type?this.handleText(e,t.snapFeature):void 0},this.handleDrag=function(e){if(!(t.dragIndex>-1))return r(),t.mouseIsDown&&t.Painting.enabled&&this.handlePainting(e),!1;!e.gamepad&&e.originalEvent.stopPropagation(),t.dragMoving=!0,t.lastDragMove=0,t.snappedVertex=[e.lngLat.lng,e.lngLat.lat],t.bypassRouting=!0,t.bypassSnapping=!e.gamepad&&e.originalEvent.shiftKey,t.lastIndex=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);var i=turf.point(t.snappedVertex);if(t.lastIndex&&(t.lastClick={coords:t.snappedVertex}),"Circle"===this.type||"Icon"===this.type||"Image"===this.type)t.Painting.enabled||(t.hotFeature.geometry.coordinates=t.snappedVertex);else{var o=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);t.hotFeature.geometry.coordinates[t.dragIndex]=t.snappedVertex,"Polygon"===this.type&&(o&&(t.hotFeature.geometry.coordinates[0]=t.snappedVertex),0==t.dragIndex&&(t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1]=t.snappedVertex))}t.Utilities.setProperty(t.hotFeature,"type",this.type),t.Utilities.setProperty(i,"type",this.type),t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([i])),t.fire("vertex.drag",{type:this.type,coords:[e.lngLat.lng,e.lngLat.lat],feature:t.hotFeature,vertex:i}),t.Pinning.updateFeatures()},this.handleTouch=function(t){t.touch=!0,"touchstart"===t.type?this.handleDown(t):"touchend"===t.type?(this.handleUp(t),this.handleClick(t)):"touchmove"===t.type&&this.handleMove(t)},this.handleOffMap=function(e){t.map.getSource(t.statics.constants.sources.SNAP)&&t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))},this.handleOnMap=function(e){t.map.getSource(t.statics.constants.sources.SNAP)&&t.snapFeature&&t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([t.snapFeature]))},this.handlePainting=function(e){if(!t.mouseIsDown)return!1;t.map.dragPan.disable(),t.setMapClass("painting");var i=t.snapFeature&&!t.Painting.feature,o=!(!e.lngLat||!e.lngLat.lng)&&[e.lngLat.lng,e.lngLat.lat];return i&&(o=t.snapFeature.geometry.coordinates),!!o&&t.Painting.updateFeature(o)},this.handleRectangle=function(e){if(t.editMode&&t.hotFeature&&(t.startPoint=t.hotFeature.geometry.coordinates[0][0]),t.startPoint){t.dragMoving||t.Utilities.setProperty(t.hotFeature,"type",this.type),t.dragMoving=!0;var i=t.snapFeature?t.snapFeature.geometry.coordinates:[e.lngLat.lng,e.lngLat.lat];if(t.dragIndex>-1){var o=0==t.dragIndex||4==t.dragIndex?4:t.dragIndex,n=1==o?3:2==o?4:3==o?1:2,s=1==n?4:2==n?1:3==n?2:3,r=1==s?3:2==s?4:3==s?1:2;c(t.hotFeature,"0."+o,i[0],i[1]),c(t.hotFeature,"0."+s,i[0],t.startPoint[1]),c(t.hotFeature,"0."+r,t.startPoint[0],i[1]),c(t.hotFeature,"0."+n,t.startPoint[0],t.startPoint[1])}else c(t.hotFeature,"0.1",i[0],t.startPoint[1]),c(t.hotFeature,"0.2",i[0],i[1]),c(t.hotFeature,"0.3",t.startPoint[0],i[1]),c(t.hotFeature,"0.4",t.startPoint[0],t.startPoint[1]);t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature]))}},this.handleText=function(t,e){},this.handleIcon=function(t,e){},this.handleContext=function(e){t.canDragMove&&t.snappedVertex&&(t.dragIndex>-1&&(t.hotFeature.geometry.coordinates.splice(t.dragIndex,1),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))))},this.handleHistory=function(e){if(!t.dragMoving){var i=t.currentMode.history,o=new Date,n=e.detail.data.features;if(n&&n.length){var s=t.Utilities.cloneDeep(n[0]);s.historyDate=o,i.push(s),t.fire("feature.history",{type:t.currentMode.type,feature:s,history:i})}}},this.handleUndo=function(){return alert("UNDER DEVELOPMENT")},this.handleRedo=function(){return alert("UNDER DEVELOPMENT")}},f=function(){const t=this.geoflo;function e(t,e=[]){t&&e.forEach((function(e){e&&t.classList.add(e)}))}this.init=function(e={}){return this.options=t.Utilities.extend({},e),this.control=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!1}),this.control.on("geolocate",this.onControlEvent.bind(this)),t.map.addControl(this.control,"top-right"),this},this.hide=function(){this.control._container.style.display="none"},this.show=function(){this.control._container.style.display="block"},this.ready=function(){var t=this,e=this.control,i=setInterval((function(){if(e._geolocateButton)return t.build(),clearInterval(i)}),1)},this.build=function(){this.button=this.control._geolocateButton,this.marker=this.control._userLocationDotMarker,this.button.addEventListener("click",this.onControlEvent.bind(this))},this.update=function(e={}){e.alpha;const i=this.heading(),o=(this.bearing(),this.following);i&&o&&!t.mapMoving&&(t.map.setBearing(i-1),t.map.setCenter(this.marker._lngLat))},this.heading=function(){return this.control._heading},this.bearing=function(){return t.map.getBearing()},this.locate=function(){return this.locating=!0,this.unlocated=!1,this.control._follow=this.following=!1,e(this.button,["mapboxgl-ctrl-geolocate-waiting"]),t.fire("locate.on",{state:this.state()}),this.control.trigger()},this.relocate=function(){return this.following&&this.state("ACTIVE_LOCK"),e(this.button,["mapboxgl-ctrl-geolocate-active"]),this.control.trigger()},this.unlocate=function(){return this.state("ACTIVE_LOCK"),this.control._follow=this.following=!1,t.map.dragPan.enable(),this.unlocated=!0,t.fire("locate.off",{state:this.state()}),this.control.trigger()},this.follow=function(){return e(this.button,["mapboxgl-ctrl-geolocate-follow"]),t.map.dragPan.disable(),this.control._follow=this.following=!0},this.state=function(t){return t?this.control._watchState=t:this.control._watchState},this.getButton=function(){return this.control._geolocateButton},this.removeClasses=function(){var t=this.button;t&&(t.classList.remove("mapboxgl-ctrl-geolocate-waiting"),t.classList.remove("mapboxgl-ctrl-geolocate-active"),t.classList.remove("mapboxgl-ctrl-geolocate-active-error"),t.classList.remove("mapboxgl-ctrl-geolocate-background"),t.classList.remove("mapboxgl-ctrl-geolocate-background-error"),t.classList.remove("mapboxgl-ctrl-geolocate-follow"))},this.onAdd=function(t){},this.onControlEvent=function(e){if(this.marker=this.control._userLocationDotMarker,this.removeClasses(),e.coords)this.onLocate(e);else if(e.target===this.button){if(t.map.dragPan.enable(),"OFF"===this.state())return this.locate();if("BACKGROUND"===this.state()&&!this.following)return this.relocate();if("ACTIVE_LOCK"===this.state()&&!this.following)return this.follow();this.unlocate()}},this.onLocate=function(i){"ACTIVE_LOCK"===this.state()&&this.locating&&(this.locating=!1,this.currentLocation=i.coords,e(this.button,["mapboxgl-ctrl-geolocate-active"])),t.fire("locate.update",{locating:this.locating,coords:i.coords,state:this.state()})},this.onMapMove=function(t){if(this.button&&!this.following&&!this.unlocated)return"ACTIVE_LOCK"===this.state()?e(this.button,["mapboxgl-ctrl-geolocate-active"]):void e(this.button,["mapboxgl-ctrl-geolocate-background"])},this.init()},g=function(t){const e=this.geoflo;function i(t,i,n,s){const r=function(t,e){const i=[],n={},s=function(t,e){function i(t,e){return new o(t,e)}function o(t,e){var i={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254};if(void 0===t)throw new Error("No latitude given.");if(e&&!i[e])throw new Error("Unknown unit "+e+". Use one of: "+Object.keys(i));var o=e?i[e]:1,n=Math.cos(t*Math.PI/180),s=2*n*n-1,r=2*n*s-n,a=2*n*r-s,c=2*n*a-r;this.kx=o*(111.41513*n-.09455*r+12e-5*c),this.ky=o*(111.13209-.56605*s+.0012*a)}return i.fromTile=function(t,e,i){var n=Math.PI*(1-2*(t+.5)/Math.pow(2,e));return new o(180*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))/Math.PI,i)},i.units={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},o.prototype={equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},interpolate:function(t,e,i){var o=e[0]-t[0],n=e[1]-t[1];return[t[0]+o*i,t[1]+n*i]},distance:function(t,e){var i=(t[0]-e[0])*this.kx,o=(t[1]-e[1])*this.ky;return Math.sqrt(i*i+o*o)},bearing:function(t,e){var i=(e[0]-t[0])*this.kx,o=(e[1]-t[1])*this.ky;if(!i&&!o)return 0;var n=180*Math.atan2(-o,i)/Math.PI+90;return n>180&&(n-=360),n},destination:function(t,e,i){var o=(90-i)*Math.PI/180;return this.offset(t,Math.cos(o)*e,Math.sin(o)*e)},offset:function(t,e,i){return[t[0]+e/this.kx,t[1]+i/this.ky]},lineDistance:function(t){for(var e=0,i=0;i<t.length-1;i++)e+=this.distance(t[i],t[i+1]);return e},area:function(t){for(var e=0,i=0;i<t.length;i++)for(var o=t[i],n=0,s=o.length,r=s-1;n<s;r=n++)e+=(o[n][0]-o[r][0])*(o[n][1]+o[r][1])*(i?-1:1);return Math.abs(e)/2*this.kx*this.ky},along:function(t,e){var i=0;if(e<=0)return t[0];for(var o=0;o<t.length-1;o++){var n=t[o],s=t[o+1],r=this.distance(n,s);if((i+=r)>e)return this.interpolate(n,s,(e-(i-r))/r)}return t[t.length-1]},pointOnLine:function(t,e){for(var i,o,n,s,r=1/0,a=0;a<t.length-1;a++){var c=t[a][0],u=t[a][1],l=(t[a+1][0]-c)*this.kx,p=(t[a+1][1]-u)*this.ky;if(0!==l||0!==p){var d=((e[0]-c)*this.kx*l+(e[1]-u)*this.ky*p)/(l*l+p*p);d>1?(c=t[a+1][0],u=t[a+1][1]):d>0&&(c+=l/this.kx*d,u+=p/this.ky*d)}var h=(l=(e[0]-c)*this.kx)*l+(p=(e[1]-u)*this.ky)*p;h<r&&(r=h,i=c,o=u,n=a,s=d)}return{point:[i,o],index:n,t:s}},lineSlice:function(t,e,i){var o=this.pointOnLine(i,t),n=this.pointOnLine(i,e);if(o.index>n.index||o.index===n.index&&o.t>n.t){var s=o;o=n,n=s}var r=[o.point],a=o.index+1,c=n.index;!this.equals(i[a],r[0])&&a<=c&&r.push(i[a]);for(var u=a+1;u<=c;u++)r.push(i[u]);return this.equals(i[c],n.point)||r.push(n.point),r},lineSliceAlong:function(t,e,i){for(var o=0,n=[],s=0;s<i.length-1;s++){var r=i[s],a=i[s+1],c=this.distance(r,a);if((o+=c)>t&&0===n.length&&n.push(this.interpolate(r,a,(t-(o-c))/c)),o>=e)return n.push(this.interpolate(r,a,(e-(o-c))/c)),n;o>t&&n.push(a)}return n},bufferPoint:function(t,e){var i=e/this.ky,o=e/this.kx;return[t[0]-o,t[1]-i,t[0]+o,t[1]+i]},bufferBBox:function(t,e){var i=e/this.ky,o=e/this.kx;return[t[0]-o,t[1]-i,t[2]+o,t[3]+i]},insideBBox:function(t,e){return t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}},i(t,e)}(e[1]);return t.forEach((t=>{const r=t.id||t.properties.id;if(void 0===n[r]){n[r]=!0;const a=t.geometry.type;if("LineString"===a)t.geometry.coordinates&&o(s,t.geometry.coordinates,e).forEach((t=>{t.id=r,t.dist=s.distance(t.coords,e),i.push(t)}));else if("Point"===a){const o={id:r,type:"vertex",coords:t.geometry.coordinates,lineEdge:!0};o.dist=s.distance(o.coords,e),i.push(o)}else if("Polygon"===a){if(turf.booleanWithin(turf.point(e),t))return;t.geometry.coordinates.forEach(((t,n)=>{o(s,t,e).forEach((t=>{t.id=r,t.polygonCoordsArray=n,t.dist=s.distance(t.coords,e),i.push(t)}))}))}}})),i}(t,i);let a,c=null,u=null,l=e.id||"id";return r.forEach((t=>{const e=t.dist;null!==e&&("vertex"===t.type?null===c?c=t:void 0!==s?1e3*e<s&&c&&c.lineEdge&&(c=t):e<=c.dist&&(e===c.dist?c.lineEdge&&(c=t):c=t):e<n&&(null!==u&&e===u.dist&&u[l]!==t[l]&&"linepoint"===u.type&&(t.distance1<=u.distance1&&t.distance2<=u.distance2||t.distance2<=u.distance1&&t.distance1<=u.distance2)&&(u=t),(null===u||e<u.dist)&&(u=t,a=t.border1&&t.border2?{border1:t.border1,border2:t.border2,distance1:t.distance1,distance2:t.distance2}:null)))})),null!==c?null!==u?c.dist<n?Object.assign({borders:null},c):Object.assign({borders:a},u):Object.assign({borders:null},c):null!==u?Object.assign({borders:a},u):null}function o(t,e,i){const o=[],n=t.pointOnLine(e,i),s=n.point,r=n.index,a={type:"linepoint",coords:s},c=e[r],u=e[r+1],l=t.distance(c,i),p=t.distance(u,i);let d=!1,h=null;return l<p?(d=0===r,h=c):(d=r+1===e.length-1,h=u),a.border1=c,a.distance1=l,a.border2=u,a.distance2=p,o.push(a),o.push({type:"vertex",coords:h,lineEdge:d}),o}function n(t,i){return e.statics.constants.CIRCUM*Math.cos(t*(Math.PI/180))/Math.pow(2,i+8)}function s(t){return t?(e.Utilities.setProperty(t,"type",e.currentMode.type),e.Utilities.setProperty(t,"style",{primaryColor:e.options.colors.primarySnap,secondaryColor:e.options.colors.secondarySnap}),e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([t])),t):(e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])),e.snapFeature)}this.type=t.type,this.activate=function(){this.enabled=!0,e.options.snapping.enable=!0},this.deactivate=function(){this.enabled=!1,e.options.snapping.enable=!1,e.updateMeshData([],!0)},this.getClosest=function(t,o){var s=e.options.snapping.distance*Math.pow(2,Math.max(1,19-e.map.getZoom()))/1e5,r=!!e.options.snapping.pixels&&e.options.snapping.pixels*n(t[1],e.map.getZoom()),a=i(o=o?e.getRenderedSnapFeatures({lng:t[0],lat:t[1]},s):[e.hotFeature],t,s,r);return{point:a,coords:t=!!a&&((r||"vertex"===a.type&&a.dist<=s)&&a.coords)}},this.setClosest=function(t,o,s){var r,a=null,c=e.options.snapping.distance*Math.pow(2,Math.max(1,19-e.map.getZoom()))/1e5,u=!!e.options.snapping.pixels&&e.options.snapping.pixels*n(t[1],e.map.getZoom()),l=!(!e.pinableFeatures||!e.pinableFeatures.length)&&["case",["any",...e.pinableFeatures.map((t=>["==",["get","id"],t.id||t.properties.id]))],!1,!0],p=e.getRenderedFeatures({lng:t[0],lat:t[1]},c,l),d=!(!p||!p.length)&&i(p,t,c,u);if(e.closestPoint=d,!p&&!o||!d&&!o)return this.updateFeature(t);if(!d||!d.coords)return a;if(s||!e.lastClick)a=turf.point(d.coords);else{if(Array.isArray(e.lastClick.coords)&&Array.isArray(e.lastClick.coords[0])&&(e.lastClick.coords=e.lastClick.coords[0]),r=turf.distance(turf.point(t),turf.point(e.lastClick.coords)),e.Utilities.isPointEqual(e.lastClick.coords,d.coords)&&r>e.options.snapping.tolerance)return this.updateFeature(t);a=turf.lineString([e.lastClick.coords,d.coords])}return e.fire("snapping.add",{closest:d,snapped:a}),a},this.setFeature=function(t,i){if(e.touchClick)return null;if(!(t=t||e.snapFeature)&&i)return s(turf.point(i));if(!t)return e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])),null;var o=t.geometry.coordinates,n=i||e.lastClick.coords,r=e.firstClick.coords,a="Polygon"===this.type;if(!("LineString"===t.geometry.type)||o.length<2)t=s(a?turf.lineString([r,n]):turf.point(n));else if(e.hotFeature){var c=e.hotFeature.geometry.coordinates;a&&o.pop(),c.splice.apply(c,[-1,1].concat(e.Utilities.consumableArray(o)))}else e.hotFeature=turf.lineString(o);return e.Utilities.setProperty(e.hotFeature,"type",this.type),e.Utilities.setProperty(e.hotFeature,"style",{primaryColor:e.options.colors.primaryHot,secondaryColor:e.options.colors.secondaryHot}),t=s(a?turf.lineString([r,n]):turf.point(n)),e.snapFeature=t,e.snapFeature},this.setVertex=function(){var t=e.Snapping.enabled;e.bypassSnapping&&(t=!1);var i=e.Routing.enabled;return e.bypassRouting&&(i=!1),!(!t||!e.snappedVertex)&&(e.snapFeature=this.setClosest(e.snappedVertex,!0,!0),i&&(e.snapFeature=e.Routing.getClosest()||e.snapFeature),e.snapFeature?(e.Utilities.setProperty(e.snapFeature,"type",e.currentMode.type),e.map.getSource(e.statics.constants.sources[i?"ROUTE":"SNAP"]).setData(turf.featureCollection([e.snapFeature])),e.hotFeature.geometry.coordinates[e.dragIndex]=e.snapFeature.geometry.coordinates,e.map.getSource(e.statics.constants.sources.HOT).setData(turf.featureCollection([e.hotFeature])),void e.fire("vertex.dragsnap",{feature:e.hotFeature,vertex:turf.point(e.snappedVertex)})):e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])))},this.addFeature=function(t,i={},o){if(e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])),e.map.getSource(e.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),!t||o)return!1;i&&(t.properties=e.Utilities.assignDeep(e.Utilities.cloneDeep(i),t.properties)),e.snapFeature=t,e.map.getSource(e.statics.constants.sources[t.properties.routing?"ROUTE":"SNAP"]).setData(turf.featureCollection([e.snapFeature]))},this.updateFeature=function(t){if(e.closestPoint=null,!e.lastClick)return null;if(!e.firstClick||e.mouseIsDown)return null;var i=e.Features.getType(e.hotFeature)||e.currentMode.type,o=e.hotFeature?e.Utilities.getLastIndexCoords(e.hotFeature):e.lastClick.coords,n=turf.point(t),s=i&&"Polygon"===i&&e.hotFeature?[o,t,e.firstClick.coords]:[o,t],r=turf.lineString(s);r.properties.type=i,r.properties.hint=!0,r.properties.style={primaryColor:e.options.colors.primarySnap,secondaryColor:e.options.colors.secondarySnap};var a="feet",c=e.Features.getUnits(r);return n=function(t,i={}){var o=e.map.getSource(e.statics.constants.sources.HOTTEXT)._data.features;o.length&&o[o.length-1].properties.mouseLine&&o.pop();return t.properties.units=i.units,t.properties.unit=i.unit,t.properties.text=`${i.units} ${i.unit}`,t.properties.transform="uppercase",t.properties.anchor="bottom-left",t.properties.mouseLine=!0,o.push(t),e.map.getSource(e.statics.constants.sources.HOTTEXT).setData(turf.featureCollection(o)),t}(n,{units:c=e.Features.convertUnits(r,c,a),unit:a}),r},e.options.snapping.enable&&this.activate()},m=function(t){const e=this.geoflo;function i(t){if(!t||!t.length)return!1;t.forEach((function(t){this.updatedFeatures.find((function(e){return e.id===t.id}))||this.updatedFeatures.push(e.Utilities.cloneDeep(t.feature))}),this)}this.type=t.type,this.updatedFeatures=[],this.activate=function(){this.updatedFeatures=[],this.enabled=!0,e.options.pinning.enable=!0},this.deactivate=function(){this.enabled=!1,e.options.pinning.enable=!1,this.resetFeatures(),delete this.buffer,delete e.pinableFeatures,delete e.pinningFeatures,this.updatedFeatures=[]},this.getFeatures=function(){return e.pinnedFeatures&&e.pinnedFeatures.length?e.pinnedFeatures.map((function(t){return t.feature})):[]},this.setBuffer=function(t){if(delete this.buffer,!this.enabled)return!1;if(!t||!e.options.pinning.buffer)return!1;var i=turf.buffer(turf.point(t),e.options.pinning.buffer),o=turf.polygon(i.geometry.coordinates);return this.buffer={feature:i,radius:o,coords:t},this.buffer},this.setFeatures=function(t){return e.pinableFeatures=[],!(!this.enabled||!t)&&(e.pinableFeatures=this.getNearByFeatures(t),e.fire("pinning.add",{features:e.pinableFeatures,buffer:this.buffer}),e.pinableFeatures)},this.resetFeatures=function(){if(!this.updatedFeatures.length)return!1;e.addFeatures(this.updatedFeatures,!0)},this.updateFeatures=function(){return!!this.enabled&&(e.pinableFeatures&&e.pinableFeatures.length?(i.call(this,e.pinableFeatures),e.Features.updateFeatures(e.pinableFeatures,{type:"pinning",coords:e.snappedVertex,addUnits:!0}),e.pinnedFeatures=e.Utilities.cloneDeep(e.pinableFeatures),e.fire("pinning.update",{feature:e.hotFeature,vertex:turf.point(e.snappedVertex),features:e.pinnedFeatures}),e.pinningFeatures):(delete e.pinningFeatures,!1))},this.getNearByFeatures=function(t){if(!this.enabled||!t)return!1;var i=e.hotFeature,o=e.options.snapping.distance*Math.pow(2,Math.max(1,19-e.map.getZoom()))/1e5,n=this.setBuffer(t),s=e.getRenderedDrawnFeatures({lng:t[0],lat:t[1]},o),r=[];return s.forEach((function(t){turf.coordEach(t,(function(o,s){var a=!1;n.radius&&turf.booleanWithin(turf.point(o),n.radius)&&(a=!0),!a&&n.coords&&e.Utilities.isPointEqual(o,n.coords)&&(a=!0),a&&(i&&i.id===t.id||r.push({id:t.id||t.properties.id,type:t.properties.type,index:s,feature:t}))}))})),r},e.options.pinning.enable&&this.activate()},y=function(t){const e=this.geoflo;function i(t,e){if(e=e||{},t.compactedVertices||(t=function(t,e){var i;e=e||{};var o=e.weightFn||function(t,e){return turf.distance(turf.point(t),turf.point(e))};"FeatureCollection"===t.type?i=function(t,e){e=e||{};var i=e.keyFn||function(t){return t.join(",")},o=e.precision||1e-5,n=function(t,e){var i=[];"FeatureCollection"===t.type&&(i=i.concat(t.features.filter(e)));return{type:"FeatureCollection",features:i}}(t,a),c=turf.explode(n).features.reduce((function(t,n,r,a){var c=s(n.geometry.coordinates,o);return t[i(c)]=n.geometry.coordinates,r%1e3==0&&e.progress&&e.progress("topo:vertices",r,a.length),t}),{}),u=r(n,(function(t,n,r,a){return n.geometry.coordinates.forEach((function(e,r,a){if(r>0){var c=i(s(a[r-1],o)),u=i(s(e,o));t.push([c,u,n.properties])}})),r%1e3==0&&e.progress&&e.progress("topo:edges",r,a.length),t}),[]);return{vertices:c,edges:u}}(t,e):t.edges&&(i=t);t=i.edges.reduce((function(t,n,s,r){var a=n[0],c=n[1],u=n[2],l=o(i.vertices[a],i.vertices[c],u),p=function(i){t.vertices[i]||(t.vertices[i]={},e.edgeDataReduceFn&&(t.edgeData[i]={}))},d=function(i,o,n){t.vertices[i][o]=n,e.edgeDataReduceFn&&(t.edgeData[i][o]=e.edgeDataReduceFn(e.edgeDataSeed,u))};return l&&(p(a),p(c),l instanceof Object?(l.forward&&d(a,c,l.forward),l.backward&&d(c,a,l.backward)):(d(a,c,l),d(c,a,l))),s%1e3==0&&e.progress&&e.progress("edgeweights",s,r.length),t}),{edgeData:{},vertices:{}});var c=function(t,e,i,o){o=o||{};var s=o.progress,r=Object.keys(t).reduce((function(e,i,n,r){var a,c=t[i],u=Object.keys(c),l=u.length;if(!1===o.compact)a=!1;else if(1===l){a=!t[u[0]][i]}else a=2===l&&u.filter((function(e){return t[e][i]})).length===l;return a||(e[i]=c),n%1e3==0&&s&&s("compact:ends",n,r.length),e}),{});return Object.keys(r).reduce((function(a,c,u,l){var p=n(c,t,r,e,i,!1,o);return a.graph[c]=p.edges,a.coordinates[c]=p.coordinates,o.edgeDataReduceFn&&(a.reducedEdges[c]=p.reducedEdges),u%1e3==0&&s&&s("compact:nodes",u,l.length),a}),{graph:{},coordinates:{},reducedEdges:{}})}(t.vertices,i.vertices,t.edgeData,e);return{vertices:t.vertices,edgeData:t.edgeData,sourceVertices:i.vertices,compactedVertices:c.graph,compactedCoordinates:c.coordinates,compactedEdges:e.edgeDataReduceFn?c.reducedEdges:null}}(t,e)),this._graph=t,this._keyFn=e.keyFn||function(t){return t.join(",")},this._precision=e.precision||1e-5,this._options=e,0===Object.keys(this._graph.compactedVertices).filter((function(t){return"edgeData"!==t})).length)return null;this.findPath=function(t,e){var i=this._keyFn(s(t.coords,this._precision)),n=this._keyFn(s(e.coords,this._precision));if(!this._graph.vertices[i]||!this._graph.vertices[n])return null;this._createPhantom(i),this._createPhantom(n);var r=function(t,e,i){var n={};n[e]=0;var s=[0,[e],e],r=new o([s],(function(t,e){return t[0]-e[0]}));for(;r.length;){var a=r.pop(),c=a[0],u=a[2];if(u===i)return a.slice(0,2);var l=t[u];Object.keys(l).forEach((function(t){var e=c+l[t];if(!(t in n)||e<n[t]){n[t]=e;var i=[e,a[1].concat([t]),t];r.push(i)}}))}return null}(this._graph.compactedVertices,i,n);if(r){var a=r[0];return{fullPath:r=r[1],path:r.reduce(function(t,e,i,o){return i>0&&(t=t.concat(this._graph.compactedCoordinates[o[i-1]][e])),t}.bind(this),[]).concat([this._graph.sourceVertices[n]]),weight:a,edgeDatas:this._graph.compactedEdges?r.reduce(function(t,e,i,o){return i>0&&t.push({reducedEdge:this._graph.compactedEdges[o[i-1]][e]}),t}.bind(this),[]):void 0}}return null},this.serialize=function(){return this._graph},this._createPhantom=function(t){if(this._graph.compactedVertices[t])return null;var e=n(t,this._graph.vertices,this._graph.compactedVertices,this._graph.sourceVertices,this._graph.edgeData,!0,this._options);return this._graph.compactedVertices[t]=e.edges,this._graph.compactedCoordinates[t]=e.coordinates,this._graph.compactedEdges&&(this._graph.compactedEdges[t]=e.reducedEdges),Object.keys(e.incomingEdges).forEach(function(i){this._graph.compactedVertices[i][t]=e.incomingEdges[i],this._graph.compactedCoordinates[i][t]=[this._graph.sourceVertices[i]].concat(e.incomingCoordinates[i].slice(0,-1)),this._graph.compactedEdges&&(this._graph.compactedEdges[i][t]=e.reducedEdges[i])}.bind(this)),t},this._removePhantom=function(t){t&&(Object.keys(this._graph.compactedVertices[t]).forEach(function(e){delete this._graph.compactedVertices[e][t]}.bind(this)),Object.keys(this._graph.compactedCoordinates[t]).forEach(function(e){delete this._graph.compactedCoordinates[e][t]}.bind(this)),this._graph.compactedEdges&&Object.keys(this._graph.compactedEdges[t]).forEach(function(e){delete this._graph.compactedEdges[e][t]}.bind(this)),delete this._graph.compactedVertices[t],delete this._graph.compactedCoordinates[t],this._graph.compactedEdges&&delete this._graph.compactedEdges[t])}}function o(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=function(t,e){return t<e?-1:t>e?1:0}),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var i=(this.length>>1)-1;i>=0;i--)this._down(i);this.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},this.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},this.peek=function(){return this.data[0]},this._up=function(t){for(var e=this.data,i=this.compare,o=e[t];t>0;){var n=t-1>>1,s=e[n];if(i(o,s)>=0)break;e[t]=s,t=n}e[t]=o},this._down=function(t){for(var e=this.data,i=this.compare,o=this.length>>1,n=e[t];t<o;){var s=1+(t<<1),r=e[s],a=s+1;if(a<this.length&&i(e[a],r)<0&&(s=a,r=e[a]),i(r,n)>=0)break;e[t]=r,t=s}e[t]=n}}function n(t,e,i,o,n,s,r){r=r||{};var a=e[t];return Object.keys(a).reduce((function(a,c){var u=function(t,e,i,o,n,s,r,a){var c=i[t][e],u=i[e][t],l=[],p=[],d=a.edgeDataSeed;for(a.edgeDataReduceFn&&(d=a.edgeDataReduceFn(d,s[e][t]));!o[e];){var h=i[e];if(!h)break;var f=Object.keys(h).filter((function(e){return e!==t}))[0];if(c+=h[f],r){if(u+=i[f][e],p.indexOf(e)>=0){o[e]=i[e];break}p.push(e)}a.edgeDataReduceFn&&(d=a.edgeDataReduceFn(d,s[e][f])),l.push(n[e]),t=e,e=f}return{vertex:e,weight:c,reverseWeight:u,coordinates:l,reducedEdge:d}}(t,c,e,i,o,n,s,r),l=u.weight,p=u.reverseWeight;if(u.vertex!==t&&((!a.edges[u.vertex]||a.edges[u.vertex]>l)&&(a.edges[u.vertex]=l,a.coordinates[u.vertex]=[o[t]].concat(u.coordinates),a.reducedEdges[u.vertex]=u.reducedEdge),s&&!isNaN(p)&&(!a.incomingEdges[u.vertex]||a.incomingEdges[u.vertex]>p))){a.incomingEdges[u.vertex]=p;var d=[o[t]].concat(u.coordinates);d.reverse(),a.incomingCoordinates[u.vertex]=d}return a}),{edges:{},incomingEdges:{},coordinates:{},incomingCoordinates:{},reducedEdges:{}})}function s(t,e){return[Math.round(t[0]/e)*e,Math.round(t[1]/e)*e]}function r(t,e,i){return"FeatureCollection"===t.type?t.features.reduce((function(t,i){return r(i,e,t)}),i):e(i,t)}function a(t){return"LineString"===t.geometry.type}function c(t,e,i){return(!e||"linepoint"!==e.type)&&(!(!(i&&i.path&&i.path.length)||i.path.length<2)&&i)}this.type=t.type,this.graphData={},this.features=e.Features.getColdFeatures(),this.activate=function(){this.enabled=!0,e.options.routing.enable=!0},this.deactivate=function(){this.enabled=!1,e.options.routing.enable=!1,e.map.getSource(e.statics.constants.sources.ROUTE).setData(turf.featureCollection([]))},this.getRoute=function(t,o){if(!this.enabled||e.mapMoving)return!1;var n=new i(turf.featureCollection(this.getFeatures()),e.options.routing),s=!!n.findPath&&n.findPath(t,o);return s=c(t,o,s),e.fire("routing.add",{from:t,to:o,path:s}),s},this.getMatch=async function(t){var i=await e.Exploring.getMatch(t,{set:!0,start:e.startPoint});return i.properties.routing=!0,i},this.getClosest=function(){if(!e.closestPoint||!e.lastClick)return!1;var t=this.getRoute(e.lastClick,e.closestPoint);if(!t||!t.path)return!1;var i=turf.lineString(t.path);return i.properties.routing=!0,i},this.getFeatures=function(){return[e.meshIndex.getFeatures(),this.features].flat().filter((function(t){return"LineString"===t.geometry.type}))},e.options.routing.enable&&this.activate()},v=function(t){const e=this.geoflo;this.type=t.type,this.activate=function(){this.enabled=!0,e.options.exploring.enable=!0},this.deactivate=function(){this.enabled=!1,this.currentMatch=!1,e.options.exploring.enable=!1},this.setFeatures=function(t,i={}){if(e.mapMoving||!this.enabled||"draw"!==e.currentMode.id)return!1;if(!e.Routing.enabled){e.hotFeature&&e.hotFeature.geometry.coordinates.pop();t=[e.currentMode.firstClick||!e.hotFeature?e.firstClick.coords:e.hotFeature.geometry.coordinates[e.hotFeature.geometry.coordinates.length-1],t];return!e.Utilities.isPointEqual(t[0],t[1])&&this.getRoute(t,i)}if(e.map.getZoom()<e.options.exploring.minZoom)return alert(`Zoom must be lower than ${e.options.exploring.minZoom}`);var o=i.buffer||e.options.exploring.buffer*Math.pow(2,Math.max(1,19-e.map.getZoom()))/100,n=turf.bboxPolygon([e.map.getBounds().getWest(),e.map.getBounds().getSouth(),e.map.getBounds().getEast(),e.map.getBounds().getNorth()]);t&&(n=turf.polygon(turf.buffer(turf.point(t),o).geometry.coordinates)),e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])),e.map.getSource(e.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),e.map.getSource(e.statics.constants.sources.VERTEX).setData(turf.featureCollection([n])),this.getFeatures(turf.bbox(n)).then((t=>{!function(t=[]){if(e.overpassDownloading=!1,e.mapMoving||!e.Exploring.enabled||"draw"!==e.currentMode.id)return e.updateMeshData([],!0);if(e.map.getSource(e.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),e.Snapping.addFeature(e.snapFeature),e.setMeshFeatures(t),e.currentMode.updateHotSource(),e.fire("overpass.add",{features:t}),!e.currentMode.firstClick)return t;var i=turf.explode(turf.featureCollection(t)),o=turf.nearestPoint(turf.point(e.currentMode.firstClick.coords),i);e.lastClick={coords:o.geometry.coordinates}}(t)}))},this.setFeature=function(i=[],o={}){if(!e.hotFeature)return!1;if(!i.length)return e.hotFeature;var n=turf.lineString(i);return n.geometry.coordinates[0]=o.start||n.geometry.coordinates[0],this.currentMatch&&(n=turf.lineString(e.Utilities.combineSameTypeFeatures([this.currentMatch,n]))),this.currentMatch=n,e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])),e.fire("exploring.match",{route:this.currentMatch}),t.updateHotSource(this.currentMatch)},this.getFeatures=async function(t){if(!t||!t.length||4!=t.length)return!1;var i=`way["highway"](${t[1]} , ${t[0]} , ${t[3]} , ${t[2]});`;e.map.getZoom()<12&&(i=`way["highway"="motorway"](${t[1]} , ${t[0]} , ${t[3]} , ${t[2]});`),e.overpassDownloading=!0;const o="[out:json][timeout:25];("+i+");out body;>;out skel qt;",n=await fetch("//overpass-api.de/api/interpreter?data="+o,{method:"GET"}),s=function(t){const i={};t.elements.forEach((t=>{const e=`${t.type}-${t.id}`;i[e]=t}));const o=function(t){const e=[];return t.nodes.forEach((t=>{const o=i[`node-${t}`];o&&e.push([o.lon,o.lat])})),e},n=[];return t.elements.forEach((t=>{if("way"===t.type){const e=o(t);e.length>1&&n.push(turf.lineString(e,t.tags))}else"relation"===t.type&&t.members.forEach((e=>{if("way"===e.type){const s=`way-${e.ref}`,r=i[s],a=o(r);a.length>1&&n.push(turf.lineString(a,t.tags))}}))})),e.turf.featureCollection(n)}(await n.json());return s&&s.features?s.features:[]},this.getMatch=async function(t=[],i={}){if(!t.length)return!1;var o=e.options.exploring.tolerance,n=i.feature||turf.cleanCoords(turf.lineString(t)),s=(n=turf.simplify(n,{mutate:!0,tolerance:"function"==typeof o?o(e.map):o,highQuality:!0})).geometry.coordinates;if(s.length<2)return!1;e.overpassDownloading=!0,i.radius=i.radius||50,i.profile=i.profile||"driving",t=s.join(";");const r=s.map((()=>i.radius)).join(";"),a="https://router.project-osrm.org/match/v1/"+i.profile+"/"+t+"?overview=simplified&radiuses="+r+"&generate_hints=false&skip_waypoints=true&gaps=ignore&annotations=nodes&tidy=true&geometries=geojson",c=await fetch(a,{method:"GET"}),u=await c.json();return e.overpassDownloading=!1,"Ok"!==u.code&&alert(`${u.code} - ${u.message}.`),i.set?u.matchings&&u.matchings.length?this.setFeature(u.matchings[0].geometry.coordinates,i):n:u},this.getRoute=async function(t=[],i={}){var o=i.feature?i.feature:!!t.length&&turf.cleanCoords(turf.lineString(t));if(!o)return!1;var n=o.geometry.coordinates;if(n.length<2)return!1;e.overpassDownloading=!0,i.profile=i.profile||"driving",t=n.join(";");const s="https://router.project-osrm.org/route/v1/"+i.profile+"/"+t+"?overview=simplified&continue_straight=true&annotations=nodes&geometries=geojson",r=await fetch(s,{method:"GET"}),a=await r.json();return e.overpassDownloading=!1,"Ok"!==a.code&&alert(`${a.code} - ${a.message}.`),i.set?a.routes&&a.routes.length?this.setFeature(a.routes[0].geometry.coordinates,i):o:a},e.options.exploring.enable&&this.activate()},b=function(t){const e=this.geoflo;function i(t,e,i,o){var n=e.split("."),s=parseInt(n[0],10),r=parseInt(n[1],10);void 0===t.geometry.coordinates[s]&&(t.geometry.coordinates[s]=[]),t.geometry.coordinates[s][r]=[i,o]}this.type=t.type,this.feature=!1,this.currentCoords=[],this.activate=function(){this.deactivate(),this.enabled=!0,e.options.painting.enable=!0,e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([]))},this.deactivate=function(){this.enabled=!1,e.options.painting.enable=!1,e.map.dragPan.enable(),delete this.feature},this.getFeature=function(){return this.feature},this.setFeature=function(t){if(!this.type||!t)return!1;if(!e.mouseIsDown)return e.hotFeature;var i=this.type,o=function(t,i){var o;"Rectangle"===t?o=turf.polygon([[e.mouseIsDown,i,i,e.mouseIsDown]]):"Circle"===t?(o=turf.polygon([[e.mouseIsDown,i,i,e.mouseIsDown]]),e.Utilities.setProperty(o,"center",e.mouseIsDown)):o=turf.lineString([e.mouseIsDown,i]);return e.Utilities.setProperty(o,"type",t),e.Utilities.setProperty(o,"painting",1),o}(i,t);return this.feature||(this.currentCoords=[],e.startPoint=t,e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([o])),e.fire("painting.start",{type:i,coords:t,feature:o})),this.currentCoords.push(t),this.feature=o,this.feature},this.updateFeature=function(t){if(!this.enabled)return e.hotFeature;if(!this.feature)return this.setFeature(t);var o=this.feature,n=this.type;if(this.currentCoords.push(t),"Rectangle"===n)i(o,"0.1",t[0],e.mouseIsDown[1]),i(o,"0.2",t[0],t[1]),i(o,"0.3",e.mouseIsDown[0],t[1]),i(o,"0.4",e.mouseIsDown[0],e.mouseIsDown[1]);else if("Circle"===n){var s=o.properties.center;if(!s||!s.length)return o;const i=turf.distance(turf.point(s),turf.point(t),{units:"kilometers"}),n=turf.circle(s,i);o.geometry.coordinates=n.geometry.coordinates,e.Utilities.setProperty(o,"radiusInKm",i)}else o.geometry.coordinates.push(t);return e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([this.feature])),e.fire("painting.update",{type:n,coords:t,feature:o}),o},this.handleUp=async function(i){return!!this.feature&&(e.Exploring.enabled&&(this.feature=await e.Exploring.getMatch(this.currentCoords,{set:!0,start:e.startPoint})),o=t.updateHotSource(this.feature),o=e.Utilities.cloneDeep(o),e.lastClick={coords:o.geometry.coordinates[o.geometry.coordinates.length-1]},this.currentCoords=[],this.feature=o,o);var o},e.options.painting.enable&&this.activate()},x=function(t,e={}){const i=this.geoflo;this.controls=t,this.options=e;var o=function(t,e){if((t=t.trim()).includes("rgba"))t=this.hex(t);else{if(!t||-1===[4,7].indexOf(t.length))return!1;3===(t=t.substr(1)).length&&(t=t.split("").map((function(t){return t+t+""})).join(""))}var i=parseInt(t.slice(0,2),16),o=parseInt(t.slice(2,4),16),n=parseInt(t.slice(4,6),16);return void 0!==e?"rgba("+i+" "+o+" "+n+" / "+e+"%)":"rgb("+i+" "+o+" "+n+")"};this.enable=function(t){if(!t)return null;this.position=t.position,i.map.addControl(this,t.position)},this.disable=function(){i.map.removeControl(this)},this.onAdd=function(t){return!!this.options&&(this.options.attribution?this.setAttribution(t):(this.setTheme(e.colors||i.options.colors),i.fire("control.add",{control:this,element:this.element}),this.element))},this.onRemove=function(){i.buttons.removeButtons(),i.fire("control.remove",{element:this.element}),i.disable()},this.setAttribution=function(){var t=Attr(i,this.control,e);return Object.assign(this,t),this.setTheme(e.colors||i.options.colors),i.fire("control.add",{control:this,element:this.element}),this.element},this.setMode=function(t){i.setActiveButton(t||"select")},this.setTheme=function(t){if(t)return t.primaryColor&&document.documentElement.style.setProperty("--"+i.id+"-primary-color",o(t.primaryColor)),t.primaryBackground&&document.documentElement.style.setProperty("--"+i.id+"-primary-background",o(t.primaryBackground)),t.primaryText&&document.documentElement.style.setProperty("--"+i.id+"-primary-text",o(t.primaryText)),t.primaryBorder&&document.documentElement.style.setProperty("--"+i.id+"-primary-border",o(t.primaryBorder)),t.secondaryColor&&document.documentElement.style.setProperty("--"+i.id+"-secondary-color",o(t.secondaryColor)),t.secondaryBackground&&document.documentElement.style.setProperty("--"+i.id+"-secondary-background",o(t.secondaryBackground)),t.secondaryText&&document.documentElement.style.setProperty("--"+i.id+"-secondary-text",o(t.secondaryText)),t.secondaryBorder&&document.documentElement.style.setProperty("--"+i.id+"-secondary-border",o(t.secondaryBorder)),i.fire("theme.change",{colors:t}),this.getTheme()},this.setControl=function(t){if(!t)return!1;var e;this.element=document.createElement("div"),this.element.className=i.id+"-control-wrap",this.control=document.createElement("div"),this.control.className=i.statics.constants.classes.PREDEFINED_CONTROL_BASE+" "+i.statics.constants.classes.PREDEFINED_CONTROL_GROUP,this.element.appendChild(this.control),Array.isArray(t)&&(e=function(t,e){if(!e||!t)return!1;var o,n,s=["mode","feature","mouse"],r={},a={},c=null,u={mode:null,feature:null,mouse:null},l={mode:null,feature:null,mouse:null};const p=function(t){if(!i.currentMode)return!1;i.currentMode.handleOffMap&&i.currentMode.handleOffMap(t)},d=function(t){if(!i.currentMode)return!1;i.currentMode.handleOnMap&&i.currentMode.handleOnMap(t)};return e.forEach((function(e){w(e)||(e.show=!1),E(e),m(t,e)})),{setActiveButton:S,queueMapClasses:h,updateMapClasses:f,removeButtons:T,getButtonOptions:M,getButtonElements:O,position:n};function h(t){l=i.Utilities.extend(l,t)}function f(){if(i.container){var t,e,o=[],n=[];if(s.forEach((function(t){l[t]!==u[t]&&(o.push(t+"-"+u[t]),null!==l[t]&&n.push(t+"-"+l[t]))})),o.length>0)(t=i.container.classList).remove.apply(t,o);if(n.length>0)(e=i.container.classList).add.apply(e,n);u=i.Utilities.extend(u,l)}}function g(t){return t.title+(t.key?" ("+t.key+")":"")}function m(t,e){var o=document.createElement("div"),s=(e.group?e.group.toUpperCase():e.attribution?"ATTR":"NONE")+"_GROUP";return t.appendChild(o),o.className=i.statics.constants.classes[s]+" "+e.type,o.style.display=e.show?n.includes("center")?"flex":"block":"none",e.show&&e.divider&&t.appendChild(C()),o.addEventListener("mouseover",d),o.addEventListener("mouseleave",p),F(e,o),o}function y(t,e){if(!o||!o.buttons[t])return!1;var n=e.position,s=e.button||document.createElement("button");return e.key=i.options.keys&&i.options.keys[t]?i.options.keys[t]:e.key,e.title&&s.setAttribute("title",g(e)),e.container.appendChild(s),e.id=t,e.button=s,e.add=function(t={}){this.button.style.display="flex",this.onAdd&&this.onAdd(t)},e.remove=function(t={}){this.button.style.display="none",this.onRemove&&this.onRemove(t)},e.activate=function(){this.button.classList.remove(e.inactiveClass),this.button.classList.add(e.activeClass),this.button.classList.add(i.statics.constants.classes.ACTIVE_BUTTON)},e.deactivate=function(){s.classList.remove(e.activeClass),s.classList.remove(i.statics.constants.classes.ACTIVE_BUTTON),s.classList.add(e.inactiveClass)},e.dontShow&&(s.style.display="none"),r[t]=s,a[t]=e,n&&(n=n.includes("right")?"left":n.includes("left")?"right":n.includes("bottom")?"top":n.includes("top")?"bottom":"absolute"),e.container.tooltipPosition=n,i.addTooltip(e.container,s,g(e)),s}function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=y(t,e);return!!o&&(o.className=i.statics.constants.classes.CONTROL_BUTTON+" "+e.className,o.addEventListener("click",(function(i){i.preventDefault(),i.stopPropagation(),i.target===c?(L(),e.onDeactivate&&e.onDeactivate(e)):e.onActivate(e)&&S(t)}),!0),o)}function b(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=y(t,e);return!!o&&(o.className=""+i.statics.constants.classes.CONTROL_BUTTON,i.options[e.name]&&i.options[e.name].enable?(o.classList.add(e.activeClass),o.classList.add(i.statics.constants.classes.ACTIVE_BUTTON)):o.classList.add(e.inactiveClass),o.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),i.options[e.name]||(i.options[e.name]={}),i.options[e.name].enable?e.onDeactivate&&e.onDeactivate(e):e.onActivate(e)}),!0),o)}function x(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=y(t,e);return!!o&&(o.className=i.statics.constants.classes.ACTION_BUTTON+" "+e.className,"locate"===t&&i.locate&&i.locate.control&&i.locate.control._container.remove(),o.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.onActivate(e)}),!0),o)}function C(){var t=document.createElement("div");return t.className=""+i.statics.constants.classes.DIVIDER,t}function E(t){if(!n){if(!t.position)throw new Error("The first control needs to have a position");n=t.position}}function L(){c&&(c.classList.remove(i.statics.constants.classes.ACTIVE_BUTTON),c=null)}function S(t){L();var e=!t&&i.editMode?r.edit:t?"edit"===t?r.select:r[t]:r.select;e&&e&&"trash"!==t&&(e.title.includes("Draw ")?e.title.includes(i.currentMode.type)&&(e.classList.add(i.statics.constants.classes.ACTIVE_BUTTON),c=e):e.classList.add(i.statics.constants.classes.ACTIVE_BUTTON))}function F(t,e){o=t,"modes"===t.type?(v("select",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_SELECT,key:"s",title:"Select Features",onAdd:function(){i.editMode||i.drawMode?(i.getButtons("edit").remove(),i.getButtons("save").add()):i.hasSelection()?(i.getButtons("save").remove(),i.getButtons("edit").add()):(i.getButtons("save").remove(),i.getButtons("edit").remove(),i.getButtons("undo").remove(),i.getButtons("cancel").remove(),i.getButtons("redo").remove(),i.getButtons("import").add(),i.getButtons("export").add(),i.getButtons("clear").add())},onActivate:function(){return i.noSelect=!1,i.setMode(),!0},onDeactivate:function(){i.noSelect=!0}}),v("edit",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_EDIT,key:"Enter",title:"Edit Feature",dontShow:!0,onAdd:function(){i.getButtons("select").remove(),this.button.classList.remove(i.statics.constants.classes.ACTIVE_BUTTON),this.button.style.display="flex",this.button.style["background-color"]=i.options.colors.secondaryBackground},onActivate:function(){i.editFeature(),i.getButtons("save").add()},onDeactivate:function(){i.currentMode.deactivate()},onRemove:function(t){!i.getButtons("save")&&createSelect(t)}}),v("save",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_FINSIH,key:"Enter",title:"Save Edit",dontShow:!0,onAdd:function(t){i.getButtons("select").remove(),i.getButtons("edit").remove(),i.getButtons("import").remove(),i.getButtons("export").remove(),i.getButtons("clear").remove(),i.getButtons("undo").add(),i.getButtons("cancel").add(),i.getButtons("redo").add(),this.button.style["background-color"]=i.options.colors.secondaryColor},onActivate:function(t){i.currentMode.handleClick({finish:!0})}})):"options"===t.type?(x("import",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_IMPORT,key:"u",title:"Import Features",onActivate:function(){return i.loadFeatures()}}),x("export",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_EXPORT,key:"d",title:"Export Features",onActivate:function(){return i.saveFeatures()}}),x("clear",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_CLEAR,key:"Delete",title:"Delete Selected or All Features",onActivate:function(){return i.deleteMeshData(),i.deleteUserData(),i.getButtons("select").add(),!0}}),x("undo",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_UNDO,key:"u",title:"Undo Edit",dontShow:!0,onActivate:function(){return i.currentMode.handleUndo()}}),x("redo",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_REDO,key:"r",title:"Redo Edit",dontShow:!0,onActivate:function(){return i.currentMode.handleRedo()}}),x("cancel",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_CANCEL,key:"Escape",title:"Cancel Edit",dontShow:!0,onActivate:function(){return i.cancelEdit()}})):"actions"===t.type?(b("snapping",{container:e,name:"snapping",title:"Enable/Disable Snapping",activeClass:i.id+"-snapping-enabled",inactiveClass:i.id+"-snapping-disabled",onActivate:function(){return i.activateSnapping()},onDeactivate:function(){return i.deactivateSnapping()}}),b("pinning",{container:e,name:"pinning",title:"Enable/Disable Pinning",activeClass:i.id+"-pinning-enabled",inactiveClass:i.id+"-pinning-disabled",onActivate:function(){return i.activatePinning()},onDeactivate:function(){return i.deactivatePinning()}}),b("routing",{container:e,name:"routing",title:"Enable/Disable Routing",activeClass:i.id+"-routing-enabled",inactiveClass:i.id+"-routing-disabled",onActivate:function(){return i.activateRouting()},onDeactivate:function(){return i.deactivateRouting()}}),b("exploring",{container:e,name:"exploring",title:"Enable/Disable Exploring",activeClass:i.id+"-exploring-enabled",inactiveClass:i.id+"-exploring-disabled",onActivate:function(){return i.activateExploring()},onDeactivate:function(){return i.deactivateExploring()}}),b("painting",{container:e,name:"painting",title:"Enable/Disable Painting",activeClass:i.id+"-painting-enabled",inactiveClass:i.id+"-painting-disabled",onActivate:function(){return i.activatePainting()},onDeactivate:function(){return i.deactivatePainting()}})):"types"===t.type?(v("polyline",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_LINE,key:"l",title:"Draw Polyline",onActivate:function(){return i.setMode({mode:i.statics.constants.modes.DRAW,type:"Polyline"})},onDeactivate:function(){i.currentMode.deactivate(),i.setMode()}}),v("polygon",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_POLYGON,key:"p",title:"Draw Polygon",onActivate:function(){return i.setMode({mode:i.statics.constants.modes.DRAW,type:"Polygon"})},onDeactivate:function(){i.currentMode.deactivate(),i.setMode()}}),v("rectangle",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_RECTANGLE,key:"r",title:"Draw Rectangle",onActivate:function(){return i.setMode({mode:i.statics.constants.modes.DRAW,type:"Rectangle"})},onDeactivate:function(){i.currentMode.deactivate(),i.setMode()}}),v("circle",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_POINT,key:"o",title:"Draw Circle",onActivate:function(){return i.setMode({mode:i.statics.constants.modes.DRAW,type:"Circle"})},onDeactivate:function(){i.currentMode.deactivate(),i.setMode()}}),v("text",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_TEXT,key:"t",title:"Draw Text",onActivate:function(){return i.setMode({mode:i.statics.constants.modes.DRAW,type:"Text"})},onDeactivate:function(){i.currentMode.deactivate(),i.setMode()}}),v("icon",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_ICON,key:"i",title:"Draw Icon",onActivate:async function(){return i.setMode({mode:i.statics.constants.modes.DRAW,type:"Icon"})},onDeactivate:function(){i.currentMode.deactivate(),i.setMode()}})):"utils"===t.type&&(x("zoom",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_ZOOM_IN_FEATURES,key:"x",title:"Zoom to Extent",onActivate:function(){return i.zoomToFeatures()}}),x("refresh",{container:e,className:i.statics.constants.classes.CONTROL_BUTTON_REFRESH,key:"q",title:"Refresh",onActivate:function(){return i.refresh()}}))}function T(){Object.keys(r).forEach((function(t){var e=r[t];e.parentNode?e.parentNode.removeChild(e):e&&e.remove(),delete r[t],delete a[t]}))}function w(t){return!!t&&!(!!(i.options.controls&&"object"==typeof i.options.controls)&&!i.options.controls[t.type]||t.dontShow||!i.options.controls)}function M(){return a}function O(){return r}}(this.control,t),Object.assign(this,e)),this.enable(e)},this.getTheme=function(){return i.options.colors},this.getButtons=function(){return this._buttons},this.getControl=function(t){var e,i=this.control.childNodes;if(i.length)return t&&i.forEach((function(i){i.classList.contains(t)&&(e=i)})),e},this.showControl=function(t){var e=this.getControl(t);return!!e&&(e.style.display=this.position.includes("center")?"flex":"block",e)},this.hideControl=function(t){var e=this.getControl(t);return!!e&&(e.style.display="none",e)},this.setControl(t)},C=function(t){const e=this.geoflo;if(!(window.navigator.getGamepads&&"function"==typeof window.navigator.getGamepads||window.navigator.getGamepads&&"function"==typeof window.navigator.webkitGetGamepads))throw new Error("Gamepads are not supported on your browser!");const i=this;this.options=e.options.gamepad;const o={select:"Select",start:"Start",power:"Power",button0:"B",button1:"A",button2:"Y",button3:"X",button4:"BumpLeft",button5:"BumpRight",button6:"TrigLeft",button7:"TrigRight",button8:"Select",button9:"Start",button10:"JoyLeftClick",button11:"JoyRightClick",button12:"DpadUp",button13:"DpadDown",button14:"DpadLeft",button15:"DpadRight",button16:"Power",button17:"Misc",up0:"JoyLeftUp",down0:"JoyLeftDown",right0:"JoyLeftRight",left0:"JoyLeftLeft",up1:"JoyRightUp",down1:"JoyRightDown",right1:"JoyRightRight",left1:"JoyRightLeft",l1:"BumpLeft",r1:"BumpRight",l2:"TrigLeft",r2:"TrigRight"};function n(t,e){let i=Math.sqrt(t*t+e*e);return i>1&&(t/=i,e/=i),[t,e]}function s(t,e,i=.2){let o=Math.sqrt(t*t+e*e);if(o<i)return[0,0];let n=(o-i)/(1-i);return[t/o*n,e/o*n]}function r(){i.refresh(),requestAnimationFrame(r)}function a(t,e){if(!e||!o)return!1;Object.entries(o).forEach((function(e){var o,n,s=e[0],r=e[1];o=s,n=function(e){return t.onEvent("press",s,r,e)},i.associateEvent(o,n,"before"),function(t,e){i.associateEvent(t,e,"action")}(s,(function(e){return t.onEvent("hold",s,r,e)})),function(t,e){i.associateEvent(t,e,"after")}(s,(function(e){return t.onEvent("release",s,r,e)}))}))}function c(t,e,i){var o=u(t[1]),n=u(t[0]),s=u(e[1]),r=u(e[0]),a=s-o,c=r-n,p=Math.sin(a/2)*Math.sin(a/2)+Math.cos(o)*Math.cos(s)*Math.sin(c/2)*Math.sin(c/2),d=2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),h=Math.sin((1-i)*d)/Math.sin(d),f=Math.sin(i*d)/Math.sin(d),g=h*Math.cos(o)*Math.cos(n)+f*Math.cos(s)*Math.cos(r),m=h*Math.cos(o)*Math.sin(n)+f*Math.cos(s)*Math.sin(r),y=h*Math.sin(o)+f*Math.sin(s),v=Math.atan2(y,Math.sqrt(g*g+m*m));return[l(Math.atan2(m,g)),l(v)]}function u(t){return t*(Math.PI/180)}function l(t){return t*(180/Math.PI)}this.init=function(t,i){return!!t&&(this.options.enable?(e.map.fire(e.id+":gamepad.init",{detail:{gamepad:t}}),this.setGamepad(t),a(this,this.gamepad),requestAnimationFrame(r),this):void 0)},this.refresh=function(){for(var t=window.navigator.getGamepads(),e=0;e<t.length;e++){var i,o=t[this.gamepad.id];if(o&&o.connected){for(i=0;i<o.buttons.length;i++){var r=o.buttons[i],a=r.value,c=this.gamepad.layout[`button${i}`];r.pressed?(this.gamepad.pressed[c]||(this.gamepad.pressed[c]=!0,this.gamepad.buttonActions[i].before&&this.gamepad.buttonActions[i].before(a)),this.gamepad.buttonActions[i].action&&this.gamepad.buttonActions[i].action(a)):this.gamepad.pressed[c]&&(delete this.gamepad.pressed[c],this.gamepad.buttonActions[i].after&&this.gamepad.buttonActions[i].after(a))}var u=(o.axes.length+1)/2|0;for(i=0;i<u;i++){var l,p,d=i==u-1&&o.axes.length%2==1;l=o.axes[2*i],p=d?0:o.axes[2*i+1],[l,p]=s(l,p),[l,p]=n(l,p),a=[Number(l.toFixed(2)),Number(p.toFixed(2))];const t=o.axes[i+u].toFixed(4),e=Math.floor(i/2);this.gamepad.axeValues[e][i%2]=t;var h=a[0]>=this.options.joystick.min,f=a[0]<=-this.options.joystick.min,g=a[1]<=-this.options.joystick.min,m=a[1]>=this.options.joystick.min;this.trigger("right",h,i,a),this.trigger("left",f,i,a),this.trigger("down",m,i,a),this.trigger("up",g,i,a)}}}},this.trigger=function(t,e,i,o){var n=this.gamepad.axesActions,s=this.gamepad.layout[`${t}${i}`],r=this.gamepad.pressed;e?(r[s]||(r[s]=!0,n[i][t].before&&n[i][t].before(o)),o=[this.options.joystick.max*o[0],this.options.joystick.max*o[1]],n[i][t].action&&n[i][t].action(o)):r[s]&&(delete r[s],r.JoyLeftUp||r.JoyLeftDown||r.JoyLeftLeft||r.JoyLeftRight||n[0][t].after&&n[0][t].after(o),r.JoyRightUp||r.JoyRightDown||r.JoyRightLeft||r.JoyRightRight||n[1][t].after&&n[1][t].after(o))},this.remove=function(){this.gamepad.disconnect&&this.gamepad.disconnect(),this.gamepad.remove&&this.gamepad.remove(),this.gamepad=null},this.setMap=function(t){const i=e.map,o=i.transform;this.map=this.map||{center:i.getCenter(),zoom:i.getZoom(),pitch:i.getPitch(),bearing:i.getBearing()};var n=this.map.center.x||this.map.center.lat?this.map.center:new mapboxgl.LngLat(this.map.center[0],this.map.center[1]);return n=n.x?o.pointLocation(n):n,o.center=n,o.bearing=this.map.bearing,o.zoom=this.map.zoom,o.pitch=this.map.pitch,i._update(),this.options.crosshairs&&e.centerMarker&&this.setMarker(),t&&e.currentMode.handleMove({lngLat:this.options.camera.free?i.getCenter():this.map.center,gamepad:this}),this.map},this.setContainer=function(t,e,i){const o=window.document.createElement(t);return void 0!==e&&(o.className=e),i&&i.appendChild(o),this.container=o,o},this.setLocation=function(t){return this.container.style.visibility=this.options.debug?"visible":"hidden",this.container.style.left=(t[0]+1)/2*100+"%",this.container.style.top=(t[1]+1)/2*100+"%",this.container.getBoundingClientRect()},this.setMarker=function(){return e.setCenterMarker({gamepad:!0})},this.setGamepad=function(t){var e={type:t.id,connected:t.connected,id:t.index,buttons:t.buttons.length,layout:o,axes:Math.floor(t.axes.length/2),axeValues:[],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:t.mapping,buttonActions:{},axesActions:{},pressed:{}};for(let t=0;t<e.buttons;t++)e.buttonActions[t]=()=>({action:()=>{},after:()=>{},before:()=>{}});for(let t=0;t<e.axes;t++)e.axesActions[t]={down:()=>({action:()=>{},after:()=>{},before:()=>{}}),left:()=>({action:()=>{},after:()=>{},before:()=>{}}),right:()=>({action:()=>{},after:()=>{},before:()=>{}}),up:()=>({action:()=>{},after:()=>{},before:()=>{}})},e.axeValues[t]=[0,0];return t.hapticActuators&&("function"==typeof t.hapticActuators.pulse?(e.haptic=t.hapticActuators,e.vibrationMode=0,e.vibration=!0):t.hapticActuators[0]&&"function"==typeof t.hapticActuators[0].pulse&&(e.haptic=t.hapticActuators[0],e.vibrationMode=0,e.vibration=!0)),t.vibrationActuator&&"function"==typeof t.vibrationActuator.playEffect&&(e.haptic=t.vibrationActuator,e.vibrationMode=1,e.vibration=!0),this.gamepad=e,this.hasJoysticks=e.axes>0&&Object.values(this.gamepad.layout).map((function(t){return t.includes("Joy")})).filter((function(t){return t})).length>0,this.gamepad},this.setCenter=function(t,i,o){var n,s=e.map.getCenter(),r=this.gamepad.pressed,a=this.hasJoysticks?"Joy":"Dpad",u=Object.keys(r).filter((function(t){return t.includes(a)})).length>1,l=!(!i&&!o)&&s;if(l=(l=!(!e.hotFeature||l)&&(e.lastMove||s))||s,o){var p=this.map.bearing;p=r.Up?p:r.Down?p+180:r.Left?p-90:r.Right?p+90:p;var d=turf.destination(turf.point(l),distance,p).geometry.coordinates;lngLats=i?{lng:d[1],lat:d[0]}:d}else if(t){var h=this.setLocation(t),f=!(!h||!h.x)&&[h.x,h.y];n=e.map.unproject(f);var g=u?this.options.pan.speed/2:this.options.pan.speed,m=c([l.lng,l.lat],[n.lng,n.lat],g);n=m=e.map.getPitch()>60?c([l.lng,l.lat],[m[0],m[1]],.4):m,e.lastMove=n}else{f=!!e.hotFeature&&e.hotFeature.geometry.coordinates;n=i?e.map.getCenter():f?{lat:f[f.length-1][1],lng:f[f.length-1][0]}:e.map.getCenter(),e.lastMove=!1,this.setLocation([0,0])}return this.map.center=n,this.setMap(!0)},this.setBearing=function(t,e,i){var o=this.map.bearing,n=i?t:Math.abs(t[0]);return e?o-=this.options.bearing.speed*n:o+=this.options.bearing.speed*n,this.map.bearing=o,this.setMap()},this.setPitch=function(t,e,i){var o=this.map.pitch,n=i?t:Math.abs(t[1]);return o<0&&(o=0),o>this.options.pitch.max&&(o=this.options.pitch.max),e?o+=this.options.pitch.speed*n:o-=this.options.pitch.speed*n,this.map.pitch=o,this.setMap()},this.setZoom=function(t,e,i){var o=this.map.zoom;return e?o-=this.options.zoom.speed*Math.abs(t):o+=this.options.zoom.speed*Math.abs(t),this.map.zoom=o,this.setMap()},this.setSpeed=function(t,e){var i=this.options.pan.speed>this.options.pan.min?this.options.pan.speed:(this.options.pan.max&&(this.options.pan.speed,this.options.pan.max),this.options.pan.min);return i=(i=e?i-this.options.pan.min:i+this.options.pan.min)<this.options.pan.min?this.options.pan.min:this.options.pan.max&&i>this.options.pan.max?this.options.pan.max:i,this.options.pan.speed=i*Math.abs(t)},this.associateEvent=function(t,e,i){if(t.match(/^button\d+$/)){const o=parseInt(t.match(/^button(\d+)$/)[1]);o>=0&&o<this.gamepad.buttons&&(this.gamepad.buttonActions[o][i]=e)}else if("start"===t)this.gamepad.buttonActions[9][i]=e;else if("select"===t)this.gamepad.buttonActions[8][i]=e;else if("r1"===t)this.gamepad.buttonActions[5][i]=e;else if("r2"===t)this.gamepad.buttonActions[7][i]=e;else if("l1"===t)this.gamepad.buttonActions[4][i]=e;else if("l2"===t)this.gamepad.buttonActions[6][i]=e;else if("power"===t)this.gamepad.buttons>=17?this.gamepad.buttonActions[16][i]=e:error(MESSAGES.INVALID_BUTTON);else if(t.match(/^(up|down|left|right)(\d+)$/)){const o=t.match(/^(up|down|left|right)(\d+)$/),n=o[1],s=parseInt(o[2]);s>=0&&s<this.gamepad.axes?this.gamepad.axesActions[s][n][i]=e:error(MESSAGES.INVALID_BUTTON)}else if(t.match(/^(up|down|left|right)$/)){const o=t.match(/^(up|down|left|right)$/)[1];this.gamepad.axesActions[0][o][i]=e}return this.gamepad},this.onInit=function(t){this.initiated=!0,this.setContainer("div","gamepad",e.map.getContainer()),this.setMarker(),this.setMap()},this.onEvent=function(t,i,o,n){var s={[o]:!0},r=this.options.camera.free?e.map.getCenter():e.lastMove?e.lastMove:e.map.getCenter(),a={name:o,type:t,key:i,value:n,mode:e.currentMode,gamepad:this,lngLat:r,geoflo:e,originalEvent:{}};this.initiated||this.onInit(a),e.map.fire(e.id+":gamepad."+t,{detail:a}),(s.JoyLeftUp||s.JoyLeftDown||s.JoyLeftLeft||s.JoyLeftRight)&&this.options.mapping.JoyLeftMove(a),(s.JoyRightUp||s.JoyRightDown||s.JoyRightLeft||s.JoyRightRight)&&this.options.mapping.JoyRightMove(a),s.JoyLeftClick&&this.options.mapping.JoyLeftClick(a),s.JoyRightClick&&this.options.mapping.JoyRightClick(a),s.BumpLeft&&this.options.mapping.BumpLeft(a),s.BumpRight&&this.options.mapping.BumpRight(a),s.TrigLeft&&this.options.mapping.TrigLeft(a),s.TrigRight&&this.options.mapping.TrigRight(a),s.A&&this.options.mapping.A(a),s.B&&this.options.mapping.B(a),s.X&&this.options.mapping.X(a),s.Y&&this.options.mapping.Y(a),s.Start&&this.options.mapping.Start(a),s.Select&&this.options.mapping.Select(a),s.Power&&this.options.mapping.Power(a),s.Home&&this.options.mapping.Home(a),s.Misc&&this.options.mapping.Misc(a),s.DpadUp&&this.options.mapping.DpadUp(a),s.DpadDown&&this.options.mapping.DpadDown(a),s.DpadLeft&&this.options.mapping.DpadLeft(a),s.DpadRight&&this.options.mapping.DpadRight(a)},this.onDisconnect=function(t){if(!t||!this.gamepad)return!1;if(this.gamepad.id!==t.id)throw new Error("Gamepad id does not match!");this.gamepad.remove(),this.gamepad=null},this.init(t)},E=new function(){const t=this;this.statics=e,this.options=o,this.dev=this.statics.developer,this.id=this.statics.id,this.modes=[],this.plugins={},this.gamepads={},this.enabled=!1,this.mobile=/(iphone|ipod|ipad|android|iemobile|blackberry|bada)/.test(window.navigator.userAgent.toLowerCase())||navigator.userAgent.includes("Mac")&&"ontouchend"in document;var i=[],n=[];this.initialize=function(){return this.initialized||(window[this.id]=this,this.initialized=!0),this},this.init=async function(t,e={},i){if(this.Utilities=new s,!t)throw new Error("No Mapbox Access Token Provided!");if(this.isReady)return this.setOptions(e);const o=e.container||this.options.map.container;if(!o)throw new Error("Element id is required in the DOM for the map!");await async function(t){try{const e=await fetch(t);if(e.ok){const t=await e.text(),i=document.createElement("style");i.textContent=t,document.head.prepend(i)}}catch(t){}}("https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css"),await L("https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js"),await L("https://unpkg.com/@turf/turf@7/turf.min.js"),await L("https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js"),await L("https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"),await L("https://api.mapbox.com/search-js/v1.0.0-beta.18/core.js"),this.styles=[{title:"Standard",uri:"mapbox://styles/solutegrate/clxdoec8x006901qj7wjf8uxo"},{title:"Satellite",uri:"mapbox://styles/solutegrate/clqb11d15005901pdbyb13b5i"},{title:"Dark",uri:"mapbox://styles/solutegrate/clq8l159v003q01qu274z8e8p"},{title:"Light",uri:"mapbox://styles/solutegrate/clq8l4ylp003m01qbapvf6yqn"},{title:"Outdoors",uri:"mapbox://styles/solutegrate/clqb11yad005801nv6p2ke412"},{title:"Streets",uri:"mapbox://styles/solutegrate/clqb0y4iz005901nt0u4h62qd"}],this.options.map.style="Dark",this.setOptions(e);var n=await async function(t){var e=0;return new Promise((async function(i,o){var n=setInterval((function(){var s=document.getElementById(t);return 1e4===e?(clearInterval(n),o(!1)):s?(clearInterval(n),i(s)):e++}),1)}))}(o),r=this.styles.find((t=>t.title===this.options.map.style)).uri;if(this.isReady=!!n,!this.isReady)throw new Error("Element id is required in the DOM for the map!");return n.classList.add(this.statics.id),S.call(this),this.mapbox=new mapboxgl.Map({accessToken:t,container:n,style:r,center:this.options.map.center,zoom:this.options.map.zoom,hash:!0,projection:"mercator",extent:this.options.map.extent}),this.viewport=document.createElement("div"),this.viewportHeightOffset=110,this.viewportWidthOffset=20,this.viewportLeft="10px",this.viewportBottom="5%",this.noSelect=e.noSelect||!1,this.mapbox.on("load",this.onLoad.bind(this)),await async function(t){return new Promise((async function(e,i){var o=setInterval((function(){return!!t.isLoaded&&(clearInterval(o),e(t.isLoaded))}),1)}))}(this),this},this.load=function(t){return this.isLoaded||!this.isReady||(this.map=t,this.locate=new f,this.navigation=new mapboxgl.NavigationControl({visualizePitch:!0,showZoom:!0,showCompass:!0}),this.navigation.hide=function(){this._container.style.display="none"}.bind(this.navigation),this.navigation.show=function(){this._container.style.display="block"}.bind(this.navigation),this.map.addControl(this.navigation,"top-right"),this.mobile||(this.fullscreen=new mapboxgl.FullscreenControl({container:document.querySelector("body")}),this.fullscreen.hide=function(){this._controlContainer.style.display="none"}.bind(this.fullscreen),this.fullscreen.show=function(){this._controlContainer.style.display="block"}.bind(this.fullscreen),this.map.addControl(this.fullscreen,"top-right")),this.styles=new r(this,{styles:this.styles,selected:this.options.map.style}),this.Layers=new a(this),this.Features=new c(this),this.map.addControl(this.styles),this.Events=p(this),this.Events.removeEventListeners(),this.Events.addEventListeners(),this.isLoaded=!0,this.setViewport(),this.setExtent(!1,!0),this.fire("sdk.ready",{enabled:this.enabled,map:this.map,ready:this.isLoaded}),this.enable()),this},this.enable=function(t,e={}){return this.enabled||(this.mode=t&&"select"!==t?"draw":"select",this.type=t,this.setOptions(e),this.setControls(),this.Select=new d(this),this.Draw=new h(this),this.modes=[this.Select,this.Draw],this.enabled=!0,this.fire("map.enable",{enabled:this.enabled,mode:this.mode,type:this.type}),this.redraw(),this.setMode({mode:this.mode,type:this.type})),this},this.disable=function(){return this.enabled?(this.modes=[],this.enabled=!1,this.mode=null,this.options=o,this.fire("map.disable",{enabled:this.enabled,mode:this.mode}),this.doubleClickZoom.enable(this.map),this.Layers.removeEventListeners(),this.Events.removeEventListeners(),this.Layers.removeLayers(),this.removeControls(),this):this},this.redraw=async function(){if(!this.Events)return!1;await this.Layers.refresh(),this.Events.removeEventListeners(),this.Events.addEventListeners(),this.Features.updateSource(),this.doubleClickZoom.disable(this.map),this.setViewport(),this.map.style.glyphManager.urls[""]=`mapbox://fonts/${this.dev}/{fontstack}/{range}.pbf`,this.fire("map.redraw",{enabled:this.enabled,mode:this.mode}),this.onReady&&(await this.onReady(this),delete this.onReady)},this.refresh=async function(){if(this.noRefresh)return!1;await this.redraw(),this.fire("map.refresh",{enabled:this.enabled,mode:this.mode})},this.once=function(t,e){return!(!this.map||!t)&&this.map.once(this.id+":"+t,e)},this.on=function(t,e){if(!e.name)throw new Error("Function must have a name!");return!(!this.map||!t)&&this.map.on(this.id+":"+t,e)},this.off=function(t,e){if(!e.name)throw new Error("Function must have a name!");return!(!this.map||!t)&&this.map.off(this.id+":"+t,e)},this.fire=function(t,e){return!(!this.map||!t)&&this.map.fire(this.id+":"+t,{detail:e})},this.setOptions=function(t={}){return this.options=this.Utilities.assignDeep(this.options||{},t),this.options},this.setMode=function(e={}){e.mode||(e.mode=this.statics.constants.modes.SELECT),e.type||(e.type="Polyline");var i,o=[],n=null,s=e.mode===this.statics.constants.modes.EDIT;if(this.currentMode&&e.mode===this.mode&&e.type===this.currentMode.type)return this.currentMode;if(s){if(!e.feature)return this.currentMode&&this.currentMode.deactivate(),this.setMode();e.feature=t.Utilities.cloneDeep(e.feature),e.mode=this.statics.constants.modes.DRAW,e.type=e.type||e.feature.properties.type,this.editing=t.Utilities.cloneDeep(e.feature),this.removeSelection()}(this.currentMode&&this.currentMode.activated&&this.currentMode.deactivate(),this.container.classList.forEach((function(t){-1!==t.indexOf("mouse-")&&o.push(t)})),o.length>0)&&(i=this.container.classList).remove.apply(i,o);return this.setMapClass("pointer"),this.modes.forEach((function(t){t.canHandle&&t.canHandle(e.mode)&&(n=t)})),n&&(this.fire("mode.change",{old:this.mode,new:e.mode,mode:n,type:e.type}),this.currentMode=n,this.mode=e.mode,n.activate(e)),this.Snapping=new g(this,this.currentMode),this.Pinning=new m(this,this.currentMode),this.Routing=new y(this,this.currentMode),this.Exploring=new v(this,this.currentMode),this.Painting=new b(this,this.currentMode),this.Layers.moveLayers(),this.currentMode},this.setControls=function(t=[]){return this.controls&&this.controls.length?this.controls:!!this.options.controls&&(this.controls=[],(t=t.length?t:this.statics.controls).forEach((function(t){this.controls.push(new x(t))}),this),this.controls)},this.setIcon=function(t){!!this.navigation&&this.navigation._compassIcon,this.Locate&&this.Locate.following},this.setCenterMarker=function(t={}){return},this.setButtons=function(){return!!this.getButtons("select")&&this.getButtons("select").add()},this.setActiveButton=function(t){if(!this.controls||!this.controls.length)return!1;this.controls.forEach((function(e){e.setActiveButton(t.toLowerCase())}))},this.setTheme=function(t){this.Control&&this.Control.setTheme(t)},this.setLayers=async function(t=[],e={}){return this.removeFeatures(t,e),await this.Layers.setCustomLayers(t,e)},this.setSelectedFeatures=function(t=[]){if(!t.length)return!1;i.splice(0,i.length,...t),this.map.getSource(this.statics.constants.sources.SELECT).setData(turf.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(turf.featureCollection(this.getSelectedFeatures())),this.fire("select.load",{features:turf.featureCollection(this.getSelectedFeatures()),source:this.map.getSource(this.statics.constants.sources.SELECT)})},this.setMeshFeatures=function(t=[]){return!!t.length&&(this.updateMeshData(t,!0),this.meshIndex.getFeatures())},this.setMapClass=function(t){if(this.container.classList.forEach((function(t){-1!==t.indexOf("mouse-")&&this.container.classList.remove(t)}),this),!t)return!1;this.container.classList.add("mouse-"+t)},this.setViewport=function(t){var e=t||{position:"absolute",margin:"auto",top:"",left:this.viewportLeft,bottom:this.viewportBottom},i=this.container.getBoundingClientRect().height,o=this.container.getBoundingClientRect().width;return e.height=Number.parseInt(i)-this.viewportHeightOffset+"px",e.width=Number.parseInt(o)-this.viewportWidthOffset+"px",this.Utilities.extend(this.viewport.style,e),this.setPadding(),this.map.resize(),this.viewport},this.setPadding=function(){var t=this.container.getBoundingClientRect().left-this.viewport.getBoundingClientRect().left,e=this.container.getBoundingClientRect().right-this.viewport.getBoundingClientRect().right,i=this.container.getBoundingClientRect().top-this.viewport.getBoundingClientRect().top,o=this.container.getBoundingClientRect().bottom-this.viewport.getBoundingClientRect().bottom,n=this.container.getBoundingClientRect().width<20;return this.padding={left:n?0:Math.abs(t),right:n?0:Math.abs(e),top:n?0:Math.abs(i),bottom:n?0:Math.abs(o)},this.map.setPadding(this.padding),this.padding},this.setStyle=function(t,e){return!!t&&(this.map.setStyle(t,e),this.map.getStyle())},this.setExtent=function(t,e,i={}){this.settingExtent=!0;var o=!t||!t.length,n=i.center;!n&&i.isPoint&&(n=!0),this.setViewport(),e?(this.preventDefault=!0,t=this.options.map.extent?[turf.polygon(this.options.map.extent)]:[]):o&&(t=this.getDrawnFeatures());var s={bearing:i.bearing||this.options.map.bearing||this.map.getBearing(),center:this.options.map.center||this.map.getCenter(),zoom:i.zoom||this.options.map.zoom||this.map.getZoom(),pitch:i.pitch||this.options.map.pitch||this.map.getPitch()};if(!t)return this.map.jumpTo(s);if(t.length){var r=turf.bbox(turf.featureCollection(t));if(n){var a=turf.bboxPolygon(r),c=turf.centroid(a);s.center={lat:c.geometry.coordinates[1],lng:c.geometry.coordinates[0]},s.zoom=i.zoom||this.map.getZoom(),s.pitch=i.pitch||this.map.getPitch(),s.bearing=i.bearing||this.map.getBearing(),this.map.jumpTo(s)}else if(r){var u={padding:this.map.getPadding(),linear:!0};i.bearing&&(u.bearing=i.bearing),i.pitch&&(u.pitch=i.pitch),i.maxZoom&&(u.maxZoom=i.maxZoom),this.map.fitBounds(r,u)}return this.fire("features.zoom",{features:t,center:this.map.getCenter(),bbox:r}),this.settingExtent=!1,this.map}},this.setOpacity=function(t){var e=this.opacity=Number(t);this.map.getStyle().layers.map((t=>{if(!t.id.includes("geoflo")||"background"===t.type){if(t.metadata&&t.metadata.custom)return;"symbol"===t.type?(this.map.setPaintProperty(t.id,"icon-opacity",e),this.map.setPaintProperty(t.id,"text-opacity",e)):this.map.setPaintProperty(t.id,`${t.type}-opacity`,e)}}))},this.hasControls=function(){return this.controls&&this.controls.length},this.hasSelection=function(){return this.getSelectedFeatures().length>0},this.hasSingleSelection=function(){return 1===this.getSelectedFeatures().length},this.activateSnapping=function(){var t=this.getButtons("snapping");if(t)return t.activate(),this.Snapping.activate(),this.fire("snapping.activate",{enabled:!0,mesh:this.meshIndex,snapping:this.Snapping}),this.Snapping},this.activatePinning=function(){var t=this.getButtons("pinning");if(t)return t.activate(),this.activateSnapping(),this.Pinning.activate(),this.fire("pinning.activate",{enabled:!0,pinning:this.Pinning}),this.Pinning},this.activateRouting=function(){var t=this.getButtons("routing");if(t)return t.activate(),this.activateSnapping(),this.deactivatePainting(),this.Routing.activate(),this.fire("routing.activate",{enabled:!0,routing:this.Routing}),this.Routing},this.activateExploring=function(){var t=this.getButtons("exploring");if(t)return t.activate(),this.deactivatePainting(),this.Exploring.activate(),this.fire("exploring.activate",{enabled:!0,exploring:this.Exploring}),this.Exploring},this.activatePainting=function(){var t=this.getButtons("painting");if(t)return t.activate(),this.deactivateRouting(),this.deactivateExploring(),this.Painting.activate(this.drawMode),this.fire("painting.activate",{enabled:!0,painting:this.Painting}),this.Painting},this.deactivateSnapping=function(){var t=this.getButtons("snapping");if(t)return t.deactivate(),this.deleteMeshData(),this.Snapping.deactivate(),this.fire("snapping.deactivate",{enable:!1}),!1},this.deactivatePinning=function(){var t=this.getButtons("pinning");if(t)return t.deactivate(),this.Pinning.deactivate(),this.fire("pinning.deactivate",{enable:!1}),!1},this.deactivateRouting=function(){var t=this.getButtons("routing");if(t)return t.deactivate(),this.Routing.deactivate(),this.fire("routing.deactivate",{enable:!1}),!1},this.deactivateExploring=function(){var t=this.getButtons("exploring");if(t)return t.deactivate(),this.deleteMeshData(),this.Exploring.deactivate(),this.fire("exploring.deactivate",{enable:!1}),!1},this.deactivatePainting=function(){var t=this.getButtons("painting");if(t&&(!this.mobile||this.currentMode.finished||"draw"!==this.currentMode.id||!this.currentMode.type||"Rectangle"!==this.currentMode.type))return t.deactivate(),this.Painting.deactivate(),this.fire("painting.deactivate",{enable:!1}),!1},this.getMap=function(){return this.map},this.getModes=function(t){return t?this.modes.find((function(e){if(e.canHandle&&e.canHandle(t))return e})):this.modes},this.getMode=function(){return this.currentMode},this.getColors=function(){return this.options.colors},this.getButtons=function(t){return!!this.hasControls()&&(this.controls.forEach((function(i){var o=i.getButtonOptions();t?!e&&o[t]&&(e=o[t]):(e||(e={}),Object.entries(o).forEach((function(t){var i=t[0],o=t[1];e[i]=o})))})),e);var e},this.getFeatures=function(){return[this.getDrawnFeatures(),this.getSelectedFeatures()].flat()},this.getDrawnFeatures=function(){return this.Features.getColdFeatures()},this.getRenderedFeatures=function(t,e,i){return[this.getRenderedDrawnFeatures(t,e,i),this.getRenderedSnapFeatures(t,e,i)].flat()},this.getRenderedDrawnFeatures=function(t,e,i){var o,n=this.id,s=[];[n+"-line-cold",n+"-fill-cold",n+"-circle-cold",n+"-icon-cold",n+"-fill-select",n+"-line-select",n+"-point-select",n+"-symbol-select"].forEach((function(t){this.map.getLayer(t)&&s.push(t)}),this),this.Layers.getLayers().forEach((function(t){t.id.includes(n)||this.map.getLayer(t.id)&&s.push(t.id)}),this);var r={layers:s};if(e){var a=turf.distanceToDegrees(e);o=[this.map.project([t.lng-a,t.lat-a]),this.map.project([t.lng+a,t.lat+a])]}else{var c=t?this.map.project([t.lng,t.lat]):null;o=c?[[c.x-5,c.y-5],[c.x+5,c.y+5]]:null}i&&(r.filter=i);var u=this.map.queryRenderedFeatures(o,r),l=u.map((function(t){return t.parent||t.properties.parent||t.id||t.properties.id}));return u&&u.length?this.Features.getFeaturesById(l):[]},this.getRenderedSnapFeatures=function(t,e,i){if(!this.meshIndex)return[];var o=turf.distanceToDegrees(e),n=[this.map.project([t.lng-o,t.lat-o]),this.map.project([t.lng+o,t.lat+o])],s={layers:[this.statics.constants.layers.MESH+"-line",this.statics.constants.layers.MESH+"-circle"]};i&&(s.filter=i);var r=this.map.queryRenderedFeatures(n,s);return r&&r.length?this.meshIndex.getFeaturesFromIndex(r):[]},this.getFeatureById=function(t){return!!t&&this.Features.getFeatureById(t)},this.getFeaturesByLayer=function(t,e,i,o){var n,s=[];this.Layers.getLayers().forEach((function(e){e.id.includes(t)&&s.push(e.id)}));var r={layers:s};if(i){var a=turf.distanceToDegrees(i);n=[this.map.project([e.lng-a,e.lat-a]),this.map.project([e.lng+a,e.lat+a])]}else{var c=e?this.map.project([e.lng,e.lat]):null;n=c?[[c.x-5,c.y-5],[c.x+5,c.y+5]]:null}o&&(r.filter=o);var u=this.map.queryRenderedFeatures(n,r),l=u.map((function(t){return t.parent||t.properties.parent||t.id||t.properties.id}));return u&&u.length?this.Features.getFeaturesById(l):[]},this.getSelectedFeatures=function(){return i},this.getSelectedFeatureIds=function(){return this.getSelectedFeatures().map((t=>t.parent||t.properties.parent||t.id||t.properties.id))},this.getSelectedFeaturesBbox=function(){return this.hasSelection()?turf.bbox(turf.featureCollection(this.getSelectedFeatures())):null},this.getSelectedPropertyNames=function(){const t=this.id,e=[];return this.getSelectedFeatures().forEach((i=>{Object.keys(i.properties).forEach((i=>{-1===e.indexOf(i)&&i!==t&&e.push(i)}))})),e},this.getSelectedPropertyValues=function(){const t=this.id;var e={};return this.getSelectedFeatures().forEach((function(t){Object.assign(e,t.properties)})),void 0!==e[t]&&delete e[t],e},this.getCommonGeometryType=function(){let t=null;return this.getSelectedFeatures().forEach((e=>{null===t?t=e.geometry.type:e.geometry.type!==t&&(t="illegal")})),"illegal"===t?null:t},this.selectFeature=function(t){var e=this.getFeatureById(t);return!!e&&this.Features.selectFeatures([e])},this.editFeature=function(t,e={}){var i=e.feature||this.getFeatureById(t);if(!i){if(!this.hasSingleSelection())return!1;i=this.getSelectedFeatures()[0]}return e.id=i.id,e.mode="edit",e.feature=i,this.fire("feature.edit",{feature:i,id:i.id}),this.setMode(e),i},this.cancelEdit=function(t,e){return"draw"===this.currentMode.id&&this.currentMode.deactivate(!0,t,e||this.editing)},this.saveEdit=function(){return this.currentMode.saveEdit()},this.addFeatures=function(t,e){return!!t&&(t.features&&(t=t.features),Array.isArray(t)||(t=[t]),!!t.length&&(this.Features.addFeatures(t),void(!e&&this.zoomToFeatures())))},this.addFeaturesToSelected=function(t,e={}){if(!t||!t.length)return!1;this.getSelectedFeatures().push(...t),this.setViewport(),this.setButtons(),this.map.getSource(this.statics.constants.sources.SELECT).setData(turf.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(turf.featureCollection(this.getSelectedFeatures())),this.Features.setText(t),this.updateFeatures(t),e.zoom&&this.zoomToFeatures(t,{center:e.center}),e.text&&this.Layers.addTextLayer({select:!0,ids:e.text.ids,field:e.text.field||"text",layout:e.text.layout||{"text-transform":"uppercase","text-size":10,"text-offset":[0,.5]}})},this.addFeaturesToMesh=function(t=[]){return!!t.length&&(this.updateMeshData(t),t)},this.addGamepad=function(t){this.gamepads[t.index]=new C(t),this.fire("gamepad.add",{gamepad:t})},this.addTooltip=function(t,e,i,o){if(!this.setTooltip)return!1;this.setTooltip(e,{parent:t,appendTo:o,options:i})},this.addPlugin=function(t){if(!t.id)throw new Error("No Plugin ID provided");var e=t.id;this.plugins[e]=t},this.removeSelection=function(t,e={}){if(this.removePopup(),!this.hasSelection())return this.Features.setText(),this.updateFeatures();var i=this.Utilities.clone(this.getSelectedFeatures());return this.Features.addFeatures(i,!0,t),this.getSelectedFeatures().splice(0,i.length),this.map.getSource(this.statics.constants.sources.SELECT).setData(turf.featureCollection([])),this.map.getSource(this.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),this.Features.setText(),this.updateFeatures(i),this.setButtons(),e.extent&&(this.setViewport(),this.setExtent()),e.removeText&&this.Layers.removeTextLayer(),i.length},this.removeControls=function(){},this.removeGamepad=function(t){if(!this.gamepads[t.index])return!1;this.gamepads[t.index].onDisconnect(t),delete this.gamepads[t.index],this.fire("gamepad.remove",{gamepad:t})},this.removeFeatures=function(t,e){return t?!!Array.isArray(t)&&void this.Features.removeFeatures(t,!0):this.Features.deleteFeatures()},this.removeFeature=function(t,e){var i=!!t&&this.Features.removeFeatures(t,e);return!e&&this.fire("feature.delete",{id:t,feature:i}),i},this.removePopup=function(){return this.popup&&this.popup.remove?this.popup.remove():!(!this.currentMode.popup||!this.currentMode.popup.remove)&&this.currentMode.popup.remove()},this.updateMeshData=function(t=[],e){this.meshIndex&&!e||(this.meshIndex=new u([])),this.meshIndex.addNewFeatures(t);var i=this.statics.constants.sources.MESH;t=turf.featureCollection(this.meshIndex.getFeatures());return this.map.getSource(i).setData(t),this.fire("mesh.update",{features:t}),t},this.updateSelectedProperties=function(t,e){this.getSelectedFeatures().forEach((i=>{const o=i.parent||i.properties.parent||i.id||i.properties.id,n={};e.forEach((t=>{i.properties[t]&&(n[t]=i.properties[t])})),i.properties=Object.assign(n,t,{id:o})}))},this.updateOrientation=function(t){return!!this.Locate&&(this.Locate.update(t),this.Locate.locate)},this.updateFeatures=function(t){return this.Features.updateFeatures(t)},this.saveFeatures=function(e){const i=this.id;var o,n;if(e){if(!e.id||!e.name)return window.alert("Layer ID and Name are required!");n=e.name+"-"+e.id,o=turf.featureCollection(this.Features.getFeaturesByLayer(e))}else this.hasSelection()?(n="Selected Features",o=turf.featureCollection(this.getSelectedFeatures())):(n=n="All Features",o=turf.featureCollection(this.Features.getColdFeatures()));if(!o.features.length)return window.alert("No Features to Export!");var s=t.Utilities.cloneDeep(o.features);s=s.map((function(t){return t.style={},t.style.stroke=t.properties.style&&t.properties.style.primaryColor?t.properties.style.primaryColor:this.options.colors.primaryColor,t.style["stroke-width"]=3,t.style.fill=t.properties.style&&t.properties.style.secondaryColor?t.properties.style.secondaryColor:this.options.colors.secondaryColor,t.style["fill-opacity"]=1,t.properties.id=t.id,t.properties.unit=t.geometry.unit,t.properties.units=t.geometry.units,delete t.properties.style,delete t.geometry.unit,delete t.geometry.units,t}),this),o=turf.featureCollection(s);var r=new Date,a=i+"_export - "+(r.getMonth()+1)+"."+r.getDate()+"."+r.getFullYear()+"_"+r.getHours()+r.getMinutes();const c=new window.JSZip,u={Id:this.id,Version:this.version,Features:o.features.length};["kmz","gpx","geojson"].forEach((function(t){const e=c.folder(n+" "+t.toUpperCase());switch(t){case"kmz":var i=document.createElement("table"),r=document.createElement("tbody");i.appendChild(r),Object.entries(u).forEach((function(t){var e=t[0],i=t[1],o=document.createElement("tr"),n=document.createElement("th"),s=document.createElement("td");n.textContent=e+": ",s.textContent=i,o.appendChild(n),o.appendChild(s),r.appendChild(o)}));var a=omnivore.toKML(o,{name:"id",simplestyle:!0,description:u.Id,documentName:n,documentDescription:i.innerHTML}),l=new Blob([a],{type:"application/vnd.google-earth.kml+xml"});e.file(n.toLowerCase()+".kml",l);break;case"gpx":s.forEach((function(t){var i=t.id,o=turf.featureCollection([t]),s=omnivore.toGPX(o,{creator:u.Id,featureTitle:function(t){return t.id}});e.file(n.toLowerCase()+"_"+i+".gpx",s)}));break;case"geojson":var p=o;l=new Blob([JSON.stringify(p)],{type:"application/geojson"});e.file(n.toLowerCase()+".geojson",l)}})),c.generateAsync({type:"blob"}).then((function(t){var e=new Blob([t],{type:"application/zip;charset=utf-8"});window.geoflo.fire("features.export",{features:s,blob:e,date:r,name:a});var i=document.createElement("a");i.setAttribute("href",URL.createObjectURL(e)),i.setAttribute("download",a+".zip"),i.click(),URL.revokeObjectURL(i.href)}))},this.loadFeatures=function(){const e=document.createElement("input");function i(e,i,o){var n=[];if("geojson"===o||"json"===o)n=JSON.parse(e);else{if(!omnivore[o])return alert("File type not supported: "+o);omnivore[o].parse(e,null,{addData:function(t){n=t}})}n.features&&(n=n.features),Array.isArray(n)||(n=[n]),n.forEach((function(e){e.properties.import=!0,e.source=e.source||e.properties.source||t.statics.constants.sources.COLD})),t.fire("features.import",{features:n,file:e,ext:o,name:i}),t.addFeatures(n)}e.type="file",e.setAttribute("multiple","multiple"),e.addEventListener("change",(function(e){const o=[];for(let t=0;t<e.target.files.length;t++)o.push(e.target.files[t]);t.Utilities.processFiles(o,i)}),!1),e.click()},this.moveMapAlongLine=function(e){if(!e)return;const i=turf.lineDistance(e),o=turf.lineDistance(e);let n;window.requestAnimationFrame((function s(r){n||(n=r);const a=(r-n)/8e4;a>1&&setTimeout((()=>{n=0}),1500);const c=turf.along(turf.lineString(e),i*a).geometry.coordinates,u=turf.along(turf.lineString(e),o*a).geometry.coordinates,l=t.map.getFreeCameraOptions();l.position=mapboxgl.MercatorCoordinate.fromLngLat({lng:u[0],lat:u[1]},4e3),l.lookAtPoint({lng:c[0],lat:c[1]}),t.map.setFreeCameraOptions(l),window.requestAnimationFrame(s)}))},this.refreshMeshData=function(){this.meshIndex&&(this.mapMoving||this.fire("snapping.refresh",{features:this.meshIndex.getFeatures()}))},this.deleteMeshData=function(){this.updateMeshData([],!0),this.fire("snapping.delete",{features:this.meshIndex.getFeatures()})},this.deleteUserData=function(){var t;if(this.hasSingleSelection()){if(!window.confirm("Delete Selected Feature?"))return;var e=this.getSelectedFeatures()[0];t=e.parent||e.properties.parent||e.id||e.properties.id,this.Features.removeFeatures(t,!0),this.meshIndex&&this.meshIndex.removeFeature(t),this.fire("feature:delete",{features:this.Features.getColdFeatures()})}else{if(!window.confirm("Delete All Features?"))return;this.Features.deleteFeatures(),this.fire("features.delete",{features:this.Features.getColdFeatures()})}this.hotFeature=null,this.snapFeature=null,this.lastClick=null,this.firstClick=null,this.drawStarted=null,this.removeSelection(t),this.map.getSource(this.statics.constants.sources.SNAP).setData(turf.featureCollection([])),this.map.getSource(this.statics.constants.sources.HOT).setData(turf.featureCollection([])),this.map.getSource(this.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([])),this.editMode&&(this.editMode=!1,this.setMode())},this.doubleClickZoom={enable(t){setTimeout((()=>{t&&t.doubleClickZoom&&t.doubleClickZoom.enable()}),0)},disable(t){setTimeout((()=>{t&&t.doubleClickZoom&&t.doubleClickZoom.disable()}),0)}},this.hideSelectedFeatures=function(){n.length>0?(this.getSelectedFeatures().push(...n),n.splice(0,n.length)):this.hasSelection()&&n.push(...this.getSelectedFeatures().splice(0,this.getSelectedFeatures().length)),this.map.getSource(this.statics.constants.sources.SELECT).setData(turf.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(turf.featureCollection(this.getSelectedFeatures()))},this.combineSelectedFeatures=function(){if(this.mode===this.statics.constants.modes.SELECT&&this.hasSelection()){var e=this.getCommonGeometryType();if("Polygon"===e){var i=[];this.forEachSelectedFeature((function(t){i.push.apply(i,consumableArray(t.geometry.coordinates))})),i.length>0&&(this.Features.addFeatures([turf.polygon(i,this.getSelectedPropertyValues())]),this.removeSelection())}else if("LineString"===e){var o=t.Utilities.combineSameTypeFeatures(this.getSelectedFeatures());o.length>0&&(this.Features.addFeatures([turf.lineString(o,this.getSelectedPropertyValues())]),this.removeSelection())}}},this.moveSelectedFeatures=function(t){if(!this.options.moving||!this.options.moving.enable)return!1;var e=this.options.moving.distance;if(this.mode===this.statics.constants.modes.SELECT&&(this.hasSelection()&&"LineString"===this.getCommonGeometryType())){var i=[];this.forEachSelectedFeature((function(o){i.push(turf.lineOffset(o,e*t))})),this.setSelectedFeatures(i)}},this.moveFeature=function(t,e){},this.forEachSelectedFeature=function(t){this.getSelectedFeatures().forEach(t)},this.zoomToFeatures=function(t,e={}){t=t||(this.hasSelection()?this.getSelectedFeatures():this.getDrawnFeatures()),this.setExtent(t,!1,e)},this.createPolygon=function(){if(this.mode===this.statics.constants.modes.SELECT&&(this.hasSelection()&&"LineString"===this.getCommonGeometryType())){var e=t.Utilities.combineSameTypeFeatures(this.getSelectedFeatures());e.length>0&&(t.Utilities.isPointEqual(e[0],e[e.length-1])||e.push(e[0]),this.addFeaturesToSelected([turf.polygon([e],this.getSelectedPropertyValues())]),this.removeSelection())}},this.onLoad=function(t){if(!t.target||!t.target.getContainer)throw new Error("MapboxGL map object is required!");return this.container=t.target._container,this.viewport&&this.container.insertBefore(this.viewport,this.container.firstChild),t.target.off("style.load",this.onStyleLoad.bind(this)),t.target.on("style.load",this.onStyleLoad.bind(this)),this.options.map.maxPitch&&t.target.setMaxPitch(this.options.map.maxPitch),this.options.map.maxZoom&&t.target.setMaxZoom(this.options.map.maxZoom),this.options.map.minPitch&&t.target.setMinPitch(this.options.map.minPitch),this.options.map.minZoom&&t.target.setMinZoom(this.options.map.minZoom),this.load(t.target)},this.onStyleLoad=function(e){setTimeout((function(){t.redraw()}),500)},this.onMapMove=function(t){},this.initialize()};async function L(t){try{const e=await fetch(t);if(e.ok){const t=await e.text(),i=document.createElement("script");i.textContent=t,document.head.appendChild(i)}}catch(t){}}function S(){const t=function(t,e,i){const o=window.document.createElement(t);return void 0!==e&&(o.className=e),i&&i.appendChild(o),o};mapboxgl.Map.prototype._setupContainer=function(){const e=this._container;e.classList.add("mapboxgl-map");(this._missingCSSCanary=t("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=t("div","mapboxgl-canvas-container",e);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=t("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=t("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top-right","top-center","bottom-left","bottom-right"].forEach((e=>{n[e]=t("div",`mapboxgl-ctrl-${e}`,o)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}}s.prototype.geoflo=E,c.prototype.geoflo=E,a.prototype.geoflo=E,x.prototype.geoflo=E,f.prototype.geoflo=E,u.prototype.geoflo=E,h.prototype.geoflo=E,d.prototype.geoflo=E,C.prototype.geoflo=E,r.prototype.geoflo=E,g.prototype.geoflo=E,m.prototype.geoflo=E,y.prototype.geoflo=E,v.prototype.geoflo=E,b.prototype.geoflo=E})();
//# sourceMappingURL=mapboxgl-geoflo.min.js.map