/*! For license information please see mapboxgl-geoflo.min.js.LICENSE.txt */
(()=>{"use strict";var t={805:(t,e,n)=>{n.d(e,{A:()=>i}),t=n.hmd(t);const i=function(e){if(!e)throw new Error("Omnivore is required!");return function(e){if("object"==typeof exports)t.exports=e();else if("function"==typeof define&&n.amdO)define([],e);else{("undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:this).togpx=e()}}((function(){return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};e[s][0].call(u.exports,(function(t){var n=e[s][1][t];return r(n||t)}),u,u.exports,t,e,n,i)}return n[s].exports}for(var o=void 0,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){var i=t("jxon");i.config({attrPrefix:"@"}),e.exports=function(t,e){if("string"==typeof(e=function(t,e){for(var n in t)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}({creator:"togpx",metadata:void 0,featureTitle:function t(e){if(!e)return"";if("object"==typeof e.tags){var n=t(e.tags);if(""!==n)return n}return e.name?e.name:e.ref?e.ref:e.id?e.id:""},featureDescription:function t(e){if(!e)return"";if("object"==typeof e.tags)return t(e.tags);var n="";for(var i in e)"object"!=typeof e[i]&&(n+=i+"="+e[i]+"\n");return n.substr(0,n.length-1)},featureLink:void 0,featureCoordTimes:function(t){return t.properties&&(t.properties.times||t.properties.coordTimes)||null}},e||{})).featureCoordTimes){var n=e.featureCoordTimes;e.featureCoordTimes=function(t){return t.properties[n]}}function r(t,n){e.featureLink&&(t.link={"@href":e.featureLink(n.properties)})}var o={gpx:{"@xmlns":"http://www.topografix.com/GPX/1/1","@xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","@xsi:schemaLocation":"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd","@version":"1.1",metadata:null,wpt:[],trk:[]}};return e.creator&&(o.gpx["@creator"]=e.creator),e.metadata?o.gpx.metadata=e.metadata:delete e.metadata,("FeatureCollection"===t.type?t.features:"Feature"===t.type?[t]:[{type:"Feature",properties:{},geometry:t}]).forEach((function t(n){var i;switch(n.geometry.type){case"Point":case"MultiPoint":var s=n.geometry.coordinates;"Point"==n.geometry.type&&(s=[s]),s.forEach((function(t){i={"@lat":t[1],"@lon":t[0],name:e.featureTitle(n.properties),desc:e.featureDescription(n.properties)},void 0!==t[2]&&(i.ele=t[2]),r(i,n),o.gpx.wpt.push(i)}));break;case"LineString":case"MultiLineString":s=n.geometry.coordinates;var a=e.featureCoordTimes(n);"LineString"==n.geometry.type&&(s=[s]),r(i={name:e.featureTitle(n.properties),desc:e.featureDescription(n.properties)},n),i.trkseg=[],s.forEach((function(t){var e={trkpt:[]};t.forEach((function(t,n){var i={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(i.ele=t[2]),a&&a[n]&&(i.time=a[n]),e.trkpt.push(i)})),i.trkseg.push(e)})),o.gpx.trk.push(i);break;case"Polygon":case"MultiPolygon":r(i={name:e.featureTitle(n.properties),desc:e.featureDescription(n.properties)},n),i.trkseg=[];s=n.geometry.coordinates,a=e.featureCoordTimes(n);"Polygon"==n.geometry.type&&(s=[s]),s.forEach((function(t){t.forEach((function(t){var e={trkpt:[]},n=0;t.forEach((function(t){var i={"@lat":t[1],"@lon":t[0]};void 0!==t[2]&&(i.ele=t[2]),a&&a[n]&&(i.time=a[n]),n++,e.trkpt.push(i)})),i.trkseg.push(e)}))})),o.gpx.trk.push(i);break;case"GeometryCollection":n.geometry.geometries.forEach((function(e){var i={properties:n.properties,geometry:e};t(i)}))}})),i.stringify(o)}},{jxon:2}],2:[function(t,e,n){var i,r;i=this,r=function(t,e){var n,i={valueKey:"_",attrKey:"$",attrPrefix:"$",lowerCaseTags:!1,trueIsEmpty:!1,autoDate:!1,ignorePrefixedNodes:!1,parseValues:!1},r=[],o=/^\s*$/,s=/^(?:true|false)$/i;return new function(){function a(t){return i.parseValues?o.test(t)?null:s.test(t)?"true"===t.toLowerCase():isFinite(t)?parseFloat(t):i.autoDate&&isFinite(Date.parse(t))?new Date(t):t:t}function c(){}function u(t,e,n,o){var s,l,d=r.length,p=t.hasChildNodes(),h=t.nodeType===t.ELEMENT_NODE&&t.hasAttributes(),f=Boolean(2&e),g=0,m="",y=f?{}:!!i.trueIsEmpty||"";if(p)for(var v,b=0;b<t.childNodes.length;b++)4===(v=t.childNodes.item(b)).nodeType?m+=v.nodeValue:3===v.nodeType?m+=v.nodeValue.trim():1!==v.nodeType||i.ignorePrefixedNodes&&v.prefix||r.push(v);var x,E=r.length,C=a(m);f||!p&&!h||(y=0===e?null===(x=C)?new c:x instanceof Object?x:new x.constructor(x):{});for(var M=d;M<E;M++)s=r[M].nodeName,i.lowerCaseTags&&(s=s.toLowerCase()),l=u(r[M],e,n,o),y.hasOwnProperty(s)?(y[s].constructor!==Array&&(y[s]=[y[s]]),y[s].push(l)):(y[s]=l,g++);if(h){for(var S,w,L=t.attributes.length,T=o?"":i.attrPrefix,F=o?{}:y,O=0;O<L;g++,O++)w=(S=t.attributes.item(O)).name,i.lowerCaseTags&&(w=w.toLowerCase()),F[T+w]=a(S.value.trim());o&&(n&&Object.freeze(F),y[i.attrKey]=F,g-=L-1)}return 3===e||(2===e||1===e&&g>0)&&m?y[i.valueKey]=C:!f&&0===g&&m&&(y=C),n&&(f||g>0)&&Object.freeze(y),r.length=d,y}function l(t,n,r){var o,s,a;if(r.constructor===String||r.constructor===Number||r.constructor===Boolean){if(n.appendChild(t.createTextNode(r.toString())),r===r.valueOf())return}else r.constructor===Date&&n.appendChild(t.createTextNode(r.toISOString()));for(var c in r)if(void 0!==(o=r[c])&&(null===o&&(o={}),!(isFinite(c)||o instanceof Function)))if(c===i.valueKey)null!==o&&!0!==o&&n.appendChild(t.createTextNode(o.constructor===Date?o.toISOString():String(o)));else if(c===i.attrKey)for(var u in o)n.setAttribute(u,o[u]);else if(c===i.attrPrefix+"xmlns")e&&n.setAttribute(c.slice(1),o);else if(c.charAt(0)===i.attrPrefix)n.setAttribute(c.slice(1),o);else if(o.constructor===Array)for(var d in o)o.hasOwnProperty(d)&&(s=(a=o[d]&&o[d][i.attrPrefix+"xmlns"]||n.namespaceURI)?t.createElementNS(a,c):t.createElement(c),l(t,s,o[d]||{}),n.appendChild(s));else s=(a=(o||{})[i.attrPrefix+"xmlns"]||n.namespaceURI)?t.createElementNS(a,c):t.createElement(c),o instanceof Object?l(t,s,o):null===o||!0===o&&i.trueIsEmpty||s.appendChild(t.createTextNode(o.toString())),n.appendChild(s)}this.config=function(e){for(var r in e)i[r]=e[r];i.parserErrorHandler&&(n=new t.DOMParser({errorHandler:i.parserErrorHandler,locator:{}}))},c.prototype.toString=function(){return"null"},c.prototype.valueOf=function(){return null},this.xmlToJs=this.build=function(t,e,n,i){var r=arguments.length>1&&"number"==typeof e?3&e:1;return u(t,r,n||!1,arguments.length>3?i:3===r)},this.jsToXml=this.unbuild=function(e,n,i,r){var o=(t.document&&t.document.implementation||new t.DOMImplementation).createDocument(n||null,i||"",r||null);return l(o,o.documentElement||o,e),o},this.stringToXml=function(e){return n||(n=new t.DOMParser),n.parseFromString(e,"application/xml")},this.xmlToString=function(e){return void 0!==e.xml?e.xml:(new t.XMLSerializer).serializeToString(e)},this.stringToJs=function(t){var e=this.stringToXml(t);return this.xmlToJs(e)},this.jsToString=this.stringify=function(t,e,n,i){return this.xmlToString(this.jsToXml(t,e,n,i))},this.each=function(t,e,n){t instanceof Array?t.forEach(e,n):[t].forEach(e,n)}}},"object"==typeof n?"object"==typeof window&&window.DOMImplementation&&window.XMLSerializer&&window.DOMParser?e.exports=r(window):e.exports=r(t("xmldom"),!0):i.JXON=r(window)},{xmldom:3}],3:[function(t,e,n){},{}]},{},[1])(1)})),function(e){"object"==typeof exports?t.exports=e():"function"==typeof define&&n.amdO?define([],e):("undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:this).tokml=e()}((function(){return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};e[s][0].call(u.exports,(function(t){return r(e[s][1][t]||t)}),u,u.exports,t,e,n,i)}return n[s].exports}for(var o=void 0,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){function i(t,e){return function(n){if(!n.properties||!l.valid(n.geometry))return"";var i=l.any(n.geometry);if(!i)return"";var r="",a="";if(t.simplestyle){var d=function(t){var e="";return t["marker-symbol"]&&(e=e+"ms"+t["marker-symbol"]),t["marker-color"]&&(e=e+"mc"+t["marker-color"].replace("#","")),t["marker-size"]&&(e=e+"ms"+t["marker-size"]),t.stroke&&(e=e+"s"+t.stroke.replace("#","")),t["stroke-width"]&&(e=e+"sw"+t["stroke-width"].toString().replace(".","")),t["stroke-opacity"]&&(e=e+"mo"+t["stroke-opacity"].toString().replace(".","")),t.fill&&(e=e+"f"+t.fill.replace("#","")),t["fill-opacity"]&&(e=e+"fo"+t["fill-opacity"].toString().replace(".","")),e}(n.style);d&&(l.isPoint(n.geometry)&&function(t){return!!(t["marker-size"]||t["marker-symbol"]||t["marker-color"])}(n.style)?(-1===e.indexOf(d)&&(r=function(t,e){return c("Style",c("IconStyle",c("Icon",c("href",function(t){var e=t["marker-size"]||"medium",n=t["marker-symbol"]?"-"+t["marker-symbol"]:"",i=(t["marker-color"]||"7e7e7e").replace("#","");return"https://api.tiles.mapbox.com/v3/marker/pin-"+e.charAt(0)+n+"+"+i+".png"}(t))))+c("hotSpot","",[["xunits","fraction"],["yunits","fraction"],["x",.5],["y",.5]]),[["id",e]])}(n.style,d),e.push(d)),a=c("styleUrl","#"+d)):(l.isPolygon(n.geometry)||l.isLine(n.geometry))&&function(t){for(var e in t)if({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0}[e])return!0}(n.style)&&(-1===e.indexOf(d)&&(r=function(t,e){var n=c("LineStyle",[c("color",s(t.stroke,t["stroke-opacity"])||"ff555555")+c("width",void 0===t["stroke-width"]?2:t["stroke-width"])]),i="";return(t.fill||t["fill-opacity"])&&(i=c("PolyStyle",[c("color",s(t.fill,t["fill-opacity"])||"88555555")])),c("Style",n+i,[["id",e]])}(n.style,d),e.push(d)),a=c("styleUrl","#"+d)))}return r+c("Placemark",function(t,e){return t[e.name]?c("name",u(t[e.name])):""}(n.properties,t)+function(t,e){return t[e.description]?c("description",u(t[e.description])):""}(n.properties,t)+function(t){return c("ExtendedData",function(t){var e=[];for(var n in t)e.push([n,t[n]]);return e}(t).map(o).join(""))}(n.properties)+function(t,e){return t[e.timestamp]?c("TimeStamp",c("when",u(t[e.timestamp]))):""}(n.properties,t)+i+a)}}function r(t){return t.map((function(t){return t.join(",")})).join(" ")}function o(t){return c("Data",c("value",u(t[1])),[["name",u(t[0])]])}function s(t,e){if("string"!=typeof t)return"";if(3===(t=t.replace("#","").toLowerCase()).length)t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2];else if(6!==t.length)return"";var n=t[0]+t[1],i=t[2]+t[3],r=t[4]+t[5],o="ff";return"number"==typeof e&&e>=0&&e<=1&&((o=(255*e).toString(16)).indexOf(".")>-1&&(o=o.substr(0,o.indexOf("."))),o.length<2&&(o="0"+o)),o+r+i+n}var a=t("strxml"),c=a.tag,u=a.encode;e.exports=function(t,e){return'<?xml version="1.0" encoding="UTF-8"?>'+c("kml",c("Document",function(t){return void 0!==t.documentName?c("name",t.documentName):""}(e=e||{documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,timestamp:"timestamp"})+function(t){return void 0!==t.documentDescription?c("description",t.documentDescription):""}(e)+function(t,e){if(!t.type)return"";var n=[];switch(t.type){case"FeatureCollection":return t.features?t.features.map(i(e,n)).join(""):"";case"Feature":return i(e,n)(t);default:return i(e,n)({type:"Feature",geometry:t,properties:{}})}}(t,e)),[["xmlns","http://www.opengis.net/kml/2.2"]])};var l={Point:function(t){return c("Point",c("coordinates",t.coordinates.join(",")))},LineString:function(t){return c("LineString",c("coordinates",r(t.coordinates)))},Polygon:function(t){if(!t.coordinates.length)return"";var e=t.coordinates[0],n=t.coordinates.slice(1),i=c("outerBoundaryIs",c("LinearRing",c("coordinates",r(e)))),o=n.map((function(t){return c("innerBoundaryIs",c("LinearRing",c("coordinates",r(t))))})).join("");return c("Polygon",i+o)},MultiPoint:function(t){return t.coordinates.length?c("MultiGeometry",t.coordinates.map((function(t){return l.Point({coordinates:t})})).join("")):""},MultiPolygon:function(t){return t.coordinates.length?c("MultiGeometry",t.coordinates.map((function(t){return l.Polygon({coordinates:t})})).join("")):""},MultiLineString:function(t){return t.coordinates.length?c("MultiGeometry",t.coordinates.map((function(t){return l.LineString({coordinates:t})})).join("")):""},GeometryCollection:function(t){return c("MultiGeometry",t.geometries.map(l.any).join(""))},valid:function(t){return t&&t.type&&(t.coordinates||"GeometryCollection"===t.type&&t.geometries&&t.geometries.every(l.valid))},any:function(t){return l[t.type]?l[t.type](t):""},isPoint:function(t){return"Point"===t.type||"MultiPoint"===t.type},isPolygon:function(t){return"Polygon"===t.type||"MultiPolygon"===t.type},isLine:function(t){return"LineString"===t.type||"MultiLineString"===t.type}}},{strxml:2}],2:[function(t,e,n){function i(t){return t&&t.length?" "+t.map((function(t){return t[0]+'="'+t[1]+'"'})).join(" "):""}e.exports.attr=i,e.exports.tagClose=function(t,e){return"<"+t+i(e)+"/>"},e.exports.tag=function(t,e,n){return"<"+t+i(n)+">"+e+"</"+t+">"},e.exports.encode=function(t){return(null===t?"":t.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},{}]},{},[1])(1)})),e.toGPX=window.togpx,e.toKML=window.tokml,e}(window.omnivore)}},e={};function n(i){var r=e[i];if(void 0!==r)return r.exports;var o=e[i]={id:i,loaded:!1,exports:{}};return t[i](o,o.exports,n),o.loaded=!0,o.exports}n.amdO={},n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{const t=function(t){if(!t)throw new Error("MapboxGL is required!");const e=function(t,e,n){const i=window.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),i};return t.Map.prototype._setupContainer=function(){const t=this._container;t.classList.add("mapboxgl-map");(this._missingCSSCanary=e("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=e("div","mapboxgl-canvas-container",t);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=e("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const i=this._controlContainer=e("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","top-center","bottom-left","bottom-right"].forEach((t=>{r[t]=e("div",`mapboxgl-ctrl-${t}`,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},t}(window.mapboxgl),e=function(t){if(!t)throw new Error("TurfJS is required!");return t}(window.turf);var i=n(805);const r="geoflo",o={developer:"solutegrate",id:r,logo:{full:`https://${r}.s3.amazonaws.com/logos/logo_full_white.png`,icon:`https://${r}.s3.amazonaws.com/logos/logo_icon_white.svg`,fullClass:r+"-logo",iconClass:r+"-icon"},controls:[[{type:"utils",enable:!0,position:"top-center",group:"action",divider:!0,show:!0,buttons:{zoom:!0,refresh:!0,locate:!0}},{type:"modes",enable:!0,group:"control",divider:!0,show:!0,buttons:{select:!0,edit:!0,save:!0}},{type:"options",enable:!0,group:"action",divider:!1,show:!0,buttons:{import:!0,export:!0,clear:!0,undo:!0,redo:!0,cancel:!0}}],[{type:"types",enable:!0,position:"top-center",group:"control",divider:!0,show:!0,buttons:{polyline:!0,polygon:!0,rectangle:!0,circle:!0,text:!0}},{type:"actions",enable:!0,group:"control",divider:!1,show:!0,buttons:{snapping:!0,pinning:!0,routing:!0,exploring:!0,painting:!0}}]],constants:{classes:{PREDEFINED_CONTROL_BASE:"mapboxgl-ctrl",PREDEFINED_CONTROL_GROUP:"mapboxgl-ctrl-group",CONTROL_PREFIX:"mapboxgl-ctrl-",ACTION_BUTTON:r+"-action-btn",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_RECTANGLE:"mapbox-gl-draw_rectangle",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TEXT:"mapbox-gl-draw_text",CONTROL_BUTTON_ICON:"mapbox-gl-draw_icon",CONTROL_BUTTON_CLEAR:r+"-delete-data",CONTROL_BUTTON_DELETE_SNAP:r+"-delete-snap-data",CONTROL_BUTTON_LOCATE:r+"-locate",CONTROL_BUTTON_ZOOM_IN_FEATURES:r+"-zoom-in-features",CONTROL_BUTTON_HIDE_SELECTED:r+"-hide-selected",CONTROL_BUTTON_ADD_FEATURE_TO_GRID:r+"-add-feature-to-grid",CONTROL_BUTTON_CREATE_POLYGON:r+"-create-polygon",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_BUTTON_GROUP_FEATURES:r+"-group-features",CONTROL_BUTTON_UNGROUP_FEATURES:r+"-ungroup-features",CONTROL_BUTTON_DOWNLOAD_WAYS:r+"-download-ways",CONTROL_BUTTON_DOWNLOAD_BUILDINGS:r+"-download-buildings",CONTROL_BUTTON_REFRESH:r+"-refresh",CONTROL_BUTTON_EDIT:r+"-edit",CONTROL_BUTTON_CUT:r+"-cut",CONTROL_BUTTON_SELECT:r+"-select",CONTROL_BUTTON_DOWNLOAD_DATA:r+"-download-data",CONTROL_BUTTON_EXPORT:r+"-export",CONTROL_BUTTON_SAVE_AS_GIST:r+"-save-as-gist",CONTROL_BUTTON_SAVE_AS_GEOJSON:r+"-save-as-geojson",CONTROL_BUTTON_SAVE_AS_KML:r+"-save-as-kml",CONTROL_BUTTON_EXPAND_EDITOR:r+"-expand-editor",CONTROL_BUTTON_IMPORT:r+"-import",CONTROL_BUTTON_FINSIH:r+"-finish",CONTROL_BUTTON_CANCEL:r+"-cancel",CONTROL_BUTTON_UNDO:r+"-undo",CONTROL_BUTTON_REDO:r+"-redo",CONTROL_GROUP:r+"-ctrl-group",DROPDOWN_GROUP:r+"-dropdown-group",DIVIDER:r+"-divider",ACTION_GROUP:r+"-action-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources:{SELECT:r+"-select",SNAP:r+"-snap",ROUTE:r+"-route",HOT:r+"-hot",COLD:r+"-cold",MESH:r+"-mesh",VERTEX:r+"-vertex",HOTTEXT:r+"-text",COLDTEXT:r+"-coldtext",GAMEPAD:r+"-gamepad"},layers:{MESH:r+"-mesh"},cursors:{ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types:{POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes:{FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes:{DRAW:"draw",CUT:"cut",SELECT:"select",DELETE:"delete",EDIT:"edit"},events:{CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions:{MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},meta:{FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates:{ACTIVE:"true",INACTIVE:"false"},LAT_MIN:-90,LAT_RENDERED_MIN:-85,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270,MIN_SEGMENT_LENGTH:1e-6,MIN_DISTANCE:1e-5,CIRCUM:40075017}},s={theme:"dark",controls:{options:!0,modes:!0,utils:!0,types:!0,actions:!0},map:{container:"map",center:[-95.52816680236892,39.56431143986035],zoom:3.5,maxPitch:50,projection:"mercator",style:"mapbox://styles/mapbox/dark-v11",hash:!0,extent:[[[-127.3638459,49.6212752],[-73.7295136,49.6212752],[-73.7295136,24.7473201],[-127.3638459,24.7473201],[-127.3638459,49.6212752]]]},keys:{import:"u",export:"d",delete:"Delete",cancel:"Escape",select:"Escape",edit:"Enter",refresh:"q",zoom:"z",locate:"l",snapping:"!",pinning:"@",routing:"#",exploring:"$",painting:"%",LineString:"1",Polygon:"2",Rectangle:"3",Circle:"4",Text:"5",Icon:"6"},commands:[{key:".",modifier:!1,command:function(t,e,n){var i={lngLat:e.map.getCenter()};"draw"===e.currentMode.id?(e.currentMode.handleUp(i),e.currentMode.handleClick(i)):e.currentMode.handleClick(i)}}],units:{Polyline:"feet",Polygon:"acres",Rectangle:"acres",Icon:"feature",Circle:"feature",Marker:"feature"},colors:{error:"#ff7676",primaryColor:"#d7ef7e",primaryBackground:"#5a5a5a",primaryText:"#c5c5c5",primaryBorder:"#6fafdb",secondaryColor:"#6fafdb",secondaryBackground:"#333333",secondaryText:"#333333",secondaryBorder:"#404040",primarySelect:"#333333",primaryEdit:"#d7ef7e",primaryHot:"#d7ef7e",primaryCold:"#6fafdb",primarySnap:"#c5c5c5",primaryBase:"#c5c5c5",primaryDebug:"#ff7676",primaryVertex:"#c5c5c5",secondarySelect:"#d7ef7e",secondaryEdit:"#c5c5c5",secondaryHot:"#333333",secondaryCold:"#c5c5c5",secondarySnap:"#d7ef7e",secondaryBase:"#242424",secondaryDebug:"#d7ef7e",secondaryVertex:"#333333"},select:{popup:!1,multiple:!1},snapping:{enable:!1,pixels:!1,distance:321.8688,tolerance:.002},routing:{enable:!1,precision:15e-7},pinning:{enable:!1,buffer:50/5280*1.609344,idle:20},exploring:{enable:!1,minZoom:12,buffer:1.5240000000000002,tolerance:1e-5},moving:{enable:!1,distance:9144e-7},painting:{enable:!1,tolerance:5e-6}},a=function(t){this.pointInCoordinates=function(t,e){var n=[];return t.geometry.coordinates.forEach((function(i,r){0!==r&&r!==t.geometry.coordinates.length-1&&i[0]===e[0]&&i[1]===e[1]&&n.push(r)})),n},this.sameBorders=function(t,e){return!(!t||!e)&&(t.border1[0]===e.border1[0]&&t.border1[1]===e.border1[1]&&t.border2[0]===e.border2[0]&&t.border2[1]===e.border2[1]||t.border1[0]===e.border2[0]&&t.border1[1]===e.border2[1]&&t.border2[0]===e.border1[0]&&t.border2[1]===e.border1[1])},this.getRandomColor=function(){for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t},this.createRandomStroke=function(){return{stroke:this.getRandomColor()}},this.createLineAndSaveLength=function(t,e){var n=Object.assign({},e,this.createRandomStroke()),i=turf.lineString(t,n);return n.length=turf.lineDistance(i),i},this.lineSplit=function(t,e){var n=t.properties,i=[].concat(c(t.geometry.coordinates)),r=[],o=0;return e.forEach((function(t){if((t-=o)<i.length-1){var e=i.splice(t,i.length-t);i.length>0&&(i.push(e[0]),r.push(this.createLineAndSaveLength(i,n))),i=e,o+=t}}),this),i.length>0&&r.push(this.createLineAndSaveLength(i,n)),r},this.splitLines=function(t,e){var n=[],i=[];if(t.geometry.coordinates.forEach((function(t,r){var o=this.pointInCoordinates(e,t);o.length>0&&(i.push.apply(i,c(o)),n.push(r))}),this),0===n.length&&0===i.length)return null;var r=[];return r.push.apply(r,c(this.lineSplit(t,n))),r.push.apply(r,c(this.lineSplit(e,i))),r},this.createSimpleMesh=function(t){var e=[];return t.forEach((function(t){for(var n=t.properties,i=t.geometry.coordinates,r=i[0],o=null,s=1;s<i.length;s++)o=i[s],e.push(this.createLineAndSaveLength([r,o],n)),r=o}),this),e},this.createMesh=function(t){var e=[];return t.forEach((function(e){var n=e.properties.cutPoints;n||(n=[],e.properties.cutPoints=n),t.forEach((function(t){if(e!==t){var i=t.properties.cutPoints;i||(i=[],t.properties.cutPoints=i),e.geometry.coordinates.forEach((function(r,o){var s=this.pointInCoordinates(t,r);s.length>0&&(s.forEach((function(t){-1===i.indexOf(t)&&i.push(t)})),0!==o&&o!==e.geometry.coordinates.length-1&&-1===n.indexOf(o)&&n.push(o))}),this)}}),this)}),this),t.forEach((function(t){t.properties.cutPoints.sort((function(t,e){return t-e})),e.push.apply(e,c(this.lineSplit(t,t.properties.cutPoints)))}),this),e},this.setProperty=function(t,e,n){if(!t)return!1;var i=t.properties;i||(i={},t.properties=i),e.includes(".")?(i[(e=e.split("."))[0]]||(i[e[0]]={}),i[e[0]][e[1]]=n):i[e]=n},this.setProperties=function(t,e){t.properties=Object.assign(t.properties||{},e)},this.findClosestFeatures=function(t,e,n){var i=t.pointIndex.within(e.lng,e.lat,n),r={},o=[];return i.forEach((function(e){var n=t.pointFeatureMap[e];r[n]||(o.push(t.featureById[n]),r[n]=!0)})),o},this.isPointEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]},this.isPoint=function(t){return!!t&&"Point"===t.geometry.type},this.isPolygon=function(t){var e=t.geometry.coordinates,n=e[0],i=e[e.length-1];return this.isPointEqual(n,i)},this.isLineString=function(t){return!!t&&"LineString"===t.geometry.type},this.isValidLineString=function(t){return!!this.isLineString(t)&&!(t.geometry.coordinates.length<2)},this.isLastIndex=function(t,e){return!!e&&(this.isLineString(e)?t==e.geometry.coordinates.length-1:this.isPolygon(e)?t==e.geometry.coordinates[0].length-1:0==t)},this.getLastIndexCoords=function(t){return this.isLineString(t)?t.geometry.coordinates[t.geometry.coordinates.length-1]:this.isPolygon(t)?t.geometry.coordinates[0][t.geometry.coordinates.length-1]:t.geometry.coordinates},this.isEmptyLineString=function(t){if("LineString"===t.geometry.type){var e=t.geometry.coordinates;if(2===e.length){var n=e[0],i=e[e.length-1];return this.isPointEqual(n,i)}}return!1},this.isPointAtVertex=function(t,e){var n=t[0],i=t[t.length-1];return this.isPointEqual(n,e)||this.isPointEqual(i,e)},this.isPointNotTooClose=function(t,e){var n=turf.lineString([t,e]);return turf.lineDistance(n)>=statics.constants.MIN_DISTANCE&&!(t[0]===e[0]&&t[1]===e[1])},this.isOverlapping=function(t,e){var n=t.geometry.coordinates,i=e.geometry.coordinates;if(2===n.length&&2===i.length){var r=this.createBbox(n),o=this.createBbox(i);return!(r.east<o.west||r.west>o.east)&&!(r.north<o.south||r.south>o.north)}throw new Error("wrong number of coordinates, expected 2")},this.createLineWithLength=function(t){var e=turf.lineString(t),n=turf.lineDistance(e);return this.setProperties(e,{length:n}),e},this.reducePrecision=function(t){return t[0]=Number(Number(t[0]).toFixed(7)),t[1]=Number(Number(t[1]).toFixed(7)),t},this.createBbox=function(t){var e={};return t[0][0]<t[1][0]?(e.west=t[0][0],e.east=t[1][0]):(e.west=t[1][0],e.east=t[0][0]),t[0][1]<t[1][1]?(e.south=t[0][1],e.north=t[1][1]):(e.south=t[1][1],e.north=t[0][1]),e},this.stringToDOM=function(t){return(new DOMParser).parseFromString(t,"text/xml")},this.processFiles=function(t,e){t.forEach((function(t){var n=t.name,i=n.substring(n.lastIndexOf(".")+1,n.length).toLowerCase(),r=new FileReader;r.onloadend=function(){if(r.readyState===FileReader.DONE)try{e(r.result,n,i)}catch(t){}},r.readAsText(t)}))},this.combineSameTypeFeatures=function(t){var e=[];return t.forEach((function(t){if(0===e.length)e.push.apply(e,c(t.geometry.coordinates));else{var n=e[0],i=e[e.length-1],r=t.geometry.coordinates[0],o=t.geometry.coordinates[t.geometry.coordinates.length-1];if(this.isPointEqual(i,r))e.push.apply(e,c(t.geometry.coordinates.slice(1,t.geometry.coordinates.length)));else if(this.isPointEqual(i,o))e.push.apply(e,c(t.geometry.coordinates.slice(0,t.geometry.coordinates.length-1).reverse()));else if(this.isPointEqual(n,o))e.splice.apply(e,[0,0].concat(c(t.geometry.coordinates.slice(0,t.geometry.coordinates.length-1))));else if(this.isPointEqual(n,r))e.splice.apply(e,[0,1].concat(c(t.geometry.coordinates.reverse())));else{turf.distance(i,r)<turf.distance(i,o)?e.push.apply(e,c(t.geometry.coordinates)):e.push.apply(e,c([].concat(c(t.geometry.coordinates)).reverse()))}}}),this),e},this.degrees2meters=function(t){const e=20037508.34*t[0]/180;let n=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return n=20037508.34*n/180,[e,n]},this.meters2degrees=function(t){return[180*t[0]/20037508.34,360*Math.atan(Math.exp(t[1]*Math.PI/20037508.34))/Math.PI-90]},this.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},this.clone=function(t,e){var n={};return t instanceof Array?t.map((function(t){return this.clone(t,e)}),this):t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t):t instanceof Function?e&&e.newFns?new Function("return "+t.toString())():t:t instanceof Object?(Object.keys(t).forEach((function(i){n[i]=this.clone(t[i],e)}),this),n):[void 0,null].indexOf(t)>-1?t:"Symbol"===t.constructor.name?Symbol(t.toString().replace(/^Symbol\(/,"").slice(0,-1)):t.__proto__.constructor(t)},this.cloneDeep=function(t,e){var n=Object.prototype.hasOwnProperty,i=Object.prototype.toString;function r(t,e){switch(a(t)){case"object":return function(t,e){if(o(t)){var i={};return function(t,e,i){s(t,(function(r,o){if(n.call(t,o))return e.call(i,t[o],o,t)}))}(t,(function(t,n){this[n]=r(t,e)}),i),i}return e?e(t):t}(t,e);case"array":return function(t,e){var n=t.length,i=[],o=-1;for(;++o<n;)i[o]=r(t[o],e);return i}(t,e);default:return l(t)}}function o(t){return null!=t&&"object"==typeof t&&!1===Array.isArray(t)}function s(t,e,n){for(var i in t)if(!1===e.call(n,t[i],i,t))break}function a(t){if(void 0===t)return"undefined";if(null===t)return"null";if(!0===t||!1===t||t instanceof Boolean)return"boolean";if("string"==typeof t||t instanceof String)return"string";if("number"==typeof t||t instanceof Number)return"number";if("function"==typeof t||t instanceof Function)return"function";if(void 0!==Array.isArray&&Array.isArray(t))return"array";if(t instanceof RegExp)return"regexp";if(t instanceof Date)return"date";var e=i.call(t);return"[object RegExp]"===e?"regexp":"[object Date]"===e?"date":"[object Arguments]"===e?"arguments":"[object Error]"===e?"error":c(t)?"buffer":"[object Set]"===e?"set":"[object WeakSet]"===e?"weakset":"[object Map]"===e?"map":"[object WeakMap]"===e?"weakmap":"[object Symbol]"===e?"symbol":"[object Int8Array]"===e?"int8array":"[object Uint8Array]"===e?"uint8array":"[object Uint8ClampedArray]"===e?"uint8clampedarray":"[object Int16Array]"===e?"int16array":"[object Uint16Array]"===e?"uint16array":"[object Int32Array]"===e?"int32array":"[object Uint32Array]"===e?"uint32array":"[object Float32Array]"===e?"float32array":"[object Float64Array]"===e?"float64array":"object"}function c(t){return null!=t&&(function(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&c(t.slice(0,0))}(t)||!!t._isBuffer)}function u(t){return null!=t&&("object"==typeof t||"function"==typeof t)}function l(t){var e=a(t);return l.hasOwnProperty(e)?l[e](t):t}return l.array=function(t){return t.slice()},l.date=function(t){return new Date(+t)},l.object=function(t){return u(t)?function(t,e){if(!u(t))throw new TypeError("mixin-object expects the first argument to be an object.");for(var n=arguments.length,i=0;++i<n;){var r=arguments[i];u(r)&&s(r,copy,t)}return t}({},t):t},l.regexp=function(t){var e="";return e+=t.multiline?"m":"",e+=t.global?"g":"",e+=t.ignorecase?"i":"",new RegExp(t.source,e)},r(t,e)},this.assignDeep=function(t,e,{isMutatingOk:n=!1,isStrictlySafe:i=!1}={}){t=n?t:this.cloneDeep(t);for(const[n,i]of Object.entries(e))null!==i&&"object"==typeof i?(void 0===t[n]&&(t[n]={}),t[n]=this.assignDeep(t[n],i,{isMutatingOk:!0})):t[n]=i;return t},this.compareDeep=function(){var t,e,n,i;function r(t,e){var o;if(isNaN(t)&&isNaN(e)&&"number"==typeof t&&"number"==typeof e)return!0;if(t===e)return!0;if("function"==typeof t&&"function"==typeof e||t instanceof Date&&e instanceof Date||t instanceof RegExp&&e instanceof RegExp||t instanceof String&&e instanceof String||t instanceof Number&&e instanceof Number)return t.toString()===e.toString();if(!(t instanceof Object&&e instanceof Object))return!1;if(t.isPrototypeOf(e)||e.isPrototypeOf(t))return!1;if(t.constructor!==e.constructor)return!1;if(t.prototype!==e.prototype)return!1;if(n.indexOf(t)>-1||i.indexOf(e)>-1)return!1;for(o in e){if(e.hasOwnProperty(o)!==t.hasOwnProperty(o))return!1;if(typeof e[o]!=typeof t[o])return!1}for(o in t){if(e.hasOwnProperty(o)!==t.hasOwnProperty(o))return!1;if(typeof e[o]!=typeof t[o])return!1;switch(typeof t[o]){case"object":case"function":if(n.push(t),i.push(e),!r(t[o],e[o]))return!1;n.pop(),i.pop();break;default:if(t[o]!==e[o])return!1}}return!0}if(arguments.length<1)return!0;for(t=1,e=arguments.length;t<e;t++)if(n=[],i=[],!r(arguments[0],arguments[t]))return!1;return!0},this.consumableArray=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}};function c(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}const u=function(t,e){this.init=function(e={}){return this.options=t.Utilities.extend({},e),this.mapbox=new t.Mapbox.Map(this.options),this.sdk=!(!window.mapboxSdk||!this.options.sdkToken)&&window.mapboxSdk({accessToken:this.options.sdkToken}),this.viewport=document.createElement("div"),this.viewportHeightOffset=110,this.viewportWidthOffset=20,this.viewportLeft="10px",this.viewportBottom="5%",this.mapbox.on("load",this.onLoad.bind(this)),this},this.getMap=function(){return this.map},this.getContainer=function(){return this.container},this.getViewport=function(){return this.viewport},this.setStyle=function(t){return!!t&&(this.map.setStyle(t,{}),this.map.getStyle())},this.setExtent=function(e,n,i={}){var r=!e||!e.length,o=i.center;!o&&i.isPoint&&(o=!0),n?(this.preventDefault=!0,e=this.options.extent?[turf.polygon(this.options.extent)]:[]):r&&(e=t.getRenderedDrawnFeatures());var s={bearing:i.bearing||this.options.bearing||this.map.getBearing(),center:this.options.center||this.map.getCenter(),zoom:i.zoom||this.options.zoom||this.map.getZoom(),pitch:i.pitch||this.options.pitch||this.map.getPitch()};if(!e)return this.map.jumpTo(s);var a=t.Utilities.clone(turf.bbox(turf.featureCollection(e))),c=turf.bboxPolygon(a),u=turf.centroid(c);return this.setViewport(),s.center={lat:u.geometry.coordinates[1],lng:u.geometry.coordinates[0]},s.zoom=i.zoom||this.map.getZoom(),s.pitch=i.pitch||this.map.getPitch(),s.bearing=i.bearing||this.map.getBearing(),!o&&a?this.map.fitBounds(a):this.map.jumpTo(s),t.fire("features.zoom",{features:e,center:this.map.getCenter(),bbox:a}),this.map},this.setViewport=function(e){var n=e||{position:"absolute",margin:"auto",top:"",left:this.viewportLeft,bottom:this.viewportBottom},i=this.container.getBoundingClientRect().height,r=this.container.getBoundingClientRect().width;return n.height=Number.parseInt(i)-this.viewportHeightOffset+"px",n.width=Number.parseInt(r)-this.viewportWidthOffset+"px",t.Utilities.extend(this.viewport.style,n),this.setPadding(),this.viewport},this.setOptions=function(t){(t=t||this.options).maxPitch&&this.map.setMaxPitch(t.maxPitch),t.maxZoom&&this.map.setMaxZoom(t.maxZoom),t.minPitch&&this.map.setMinPitch(t.minPitch),t.minZoom&&this.map.setMinZoom(t.minZoom)},this.setPadding=function(){var t=this.container.getBoundingClientRect().left-this.viewport.getBoundingClientRect().left,e=this.container.getBoundingClientRect().right-this.viewport.getBoundingClientRect().right,n=this.container.getBoundingClientRect().top-this.viewport.getBoundingClientRect().top,i=this.container.getBoundingClientRect().bottom-this.viewport.getBoundingClientRect().bottom,r=this.container.getBoundingClientRect().width<20;return this.padding={left:r?0:Math.abs(t),right:r?0:Math.abs(e),top:r?0:Math.abs(n),bottom:r?0:Math.abs(i)},this.map.setPadding(this.padding),this.padding},this.onEvent=function(t){},this.onLoad=function(e){if(!e.target||!e.target.getContainer)throw new Error("MapboxGL map object is required!");return this.map=e.target,this.container=this.map._container,this.container.insertBefore(this.viewport,this.container.firstChild),this.setOptions(),this.setViewport(),this.map.off("style.load",this.onStyleLoad.bind(this)),this.map.on("style.load",this.onStyleLoad.bind(this)),t.load()},this.onStyleLoad=function(e){this.map.style&&this.map.style.glyphManager&&this.map.style.glyphManager.setURL(`mapbox://fonts/${t.dev}/{fontstack}/{range}.pbf`,t.dev),setTimeout((function(){t.redraw()}),500)},this.onMapMove=function(t){},this.init(e)},l=function(t){if(!t.map)throw new Error("No map object provided!");const e=this,n=t.map,i=t.id,r=t.statics,o={Polygon:["-fill","-border"],Polyline:["-line","-dash","-buffer"],Point:["-circle","-icon","-cluster-circle","-cluster-icon","-count-icon","-count-text"]};async function s(t=[],e={}){if(!t.length)return!1;for(const n of t)await a.call(this,n,e);return this.moveLayers(),this.getLayers()}async function a(e,n){var i,r=e.details||{},s=e.options||{},a=e.layers||[],d=e.features||[],h=d&&d.length;r.id&&r.type||(i=!0);const f=this.getType(r.type);f||(i=!0);var g={};r.default?g.default=!0:g.custom=!0,r.name&&(g.name=r.name);var m=r.source||r.id;return g.source=m,a=a.length?a:"Polygon"===f?c.call(this,m,r,o[f],s):"Polyline"===f?u.call(this,m,r,o[f],s):"Point"===f?l.call(this,m,r,o[f],s):[],this.removeLayers(a),this.removeSource(m),this.addSource(m,f,s),this.addLayers(a,g),p.call(this,{layer:r.id,source:m}),this._layers.push({id:r.id,details:r,layers:a,options:s}),this._sources.push({id:m,type:f,options:s}),h&&t.Features.addFeatures(d),new Promise((async function(n,r){if(i)return n(i);var o=setInterval((function(){var i=t.Layers.getFeatures(m);if(!h||i.length)return clearInterval(o),n({layer:e,features:i})}),1)}))}function c(t,e,n,i={}){if(!t)return[];var r=[];return n.forEach((function(n){var o,s=e.id+n;n.includes("border")?o={id:s,type:"line",slot:i.slot||"middle",source:t,filter:["==","$type","Polygon"],layout:{visibility:i.visibility||"visible"},paint:{"line-color":["get","primaryColor",["get","style",["properties"]]],"line-width":["case",["boolean",["has","width",["get","style",["properties"]]],!0],["get","width",["get","style",["properties"]]],2],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.8]}}:n.includes("fill")&&(o={id:s,type:"fill",source:t,filter:["==","$type","Polygon"],layout:{visibility:i.visibility||"visible"},paint:{"fill-color":["get","secondaryColor",["get","style",["properties"]]],"fill-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.5]}}),o&&r.push(o)}),this),r}function u(t,e,n,i={}){if(!t)return[];var r=[];return n.forEach((function(n){var o,s=e.id+n;n.includes("line")&&(o={id:s,type:"line",slot:i.slot||"middle",source:t,filter:["==","$type","LineString"],layout:{visibility:i.visibility||"visible","line-miter-limit":2,"line-join":"round","line-cap":"round"},paint:{"line-color":["get","primaryColor",["get","style",["properties"]]],"line-width":["case",["boolean",["has","width",["get","style",["properties"]]],!0],["get","width",["get","style",["properties"]]],4],"line-offset":["case",["boolean",["has","offset"],!0],["get","offset"],0],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}}),o&&r.push(o)}),this),r}function l(e,i,r,o={}){if(!e)return[];var s=[],a=n.getStyle(),c=a.imports&&a.imports.length;return r.forEach((function(n){var r,a=i.id+n;n.includes("circle")?(r={id:a,type:"circle",source:e,filter:["==","$type","Point"],layout:{visibility:o.visibility},paint:{"circle-radius":10,"circle-stroke-width":2,"circle-color":["get","secondaryColor",["get","style",["properties"]]],"circle-stroke-color":["get","primaryColor",["get","style",["properties"]]],"circle-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1],"circle-stroke-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},n.includes("cluster")&&!o.noCluster&&(r.filter=["has","point_count"],r.paint["circle-color"]=o.secondaryColor||t.options.colors.secondaryColor,r.paint["circle-stroke-color"]=o.primaryColor||t.options.colors.primaryColor)):!c&&n.includes("icon")?(r={id:a,type:"symbol",source:e,filter:["==","$type","Point"],layout:{visibility:o.visibility,"icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-rotate":["get","rotate",["get","style",["properties"]]],"text-rotation-alignment":"map","text-size":20,"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":["get","primaryColor",["get","style",["properties"]]],"text-halo-width":0,"text-color":t.options.colors.secondaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},n.includes("cluster")&&!o.noCluster?(r.filter=["has","point_count"],r.layout["text-field"]=o.primaryIcon||"",r.paint["text-halo-color"]=o.secondaryColor||t.options.colors.secondaryCold,r.paint["text-color"]=o.primaryColor||t.options.colors.secondaryText):n.includes("count")&&!o.noCluster&&(r.filter=["has","point_count"],r.layout={visibility:o.visibility,"icon-optional":!0,"text-field":o.countIcon||"","text-size":{base:14,stops:[[10,16],[14,14]]},"text-line-height":1,"text-padding":0,"text-offset":[.5,-.6],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},r.paint={"text-translate-anchor":"viewport","text-color":o.countIconColor||t.options.colors.primaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]})):!c&&n.includes("text")&&n.includes("count")&&!o.noCluster&&(r={id:a,type:"symbol",source:e,filter:["has","point_count"],layout:{"text-field":["get","point_count_abbreviated"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":{base:14,stops:[[10,14],[14,12]]},"text-offset":[.55,-.9]},paint:{"text-color":o.countTextColor||t.options.colors.secondaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}}),r&&s.push(r)}),this),s}function d(t={}){var e=this.getLayerIds();e.length&&(t.off?(n.off("mousemove",e,this.onLayerMouseover),n.off("mouseleave",e,this.onLayerMouseout)):t.on?(n.on("mousemove",e,this.onLayerMouseover),n.on("mouseleave",e,this.onLayerMouseout)):t||(d({off:!0}),d({on:!0})))}function p(t){if(!t)return!1;var e=this._layers.findIndex((e=>e.id===t.layer)),n=this._sources.findIndex((e=>e.id===t.source));-1!==e&&this._layers.splice(e,1),-1!==n&&this._sources.splice(n,1)}this.sources=[],this.layers=[],this._layers=[],this._sources=[],this.defaultLayers=[{source:r.constants.sources.COLD,id:i+"-fill-cold",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":t.options.colors.secondaryCold,"fill-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.3]}},{source:r.constants.sources.COLD,id:i+"-line-cold",type:"line",layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":t.options.colors.primaryCold,"line-width":4,"line-gap-width":["match",["get","type"],"Polygon",0,0],"line-offset":["case",["boolean",["has","offset"],!0],["get","offset"],0],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:r.constants.sources.COLD,id:i+"-circle-cold",filter:["all",["==",["get","type"],"Circle"],["!=",["geometry-type"],"Polygon"]],type:"circle",paint:{"circle-radius":{base:6,stops:[[10,6],[14,10]]},"circle-stroke-width":1,"circle-color":t.options.colors.primaryCold,"circle-stroke-color":t.options.colors.secondaryCold,"circle-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1],"circle-stroke-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:r.constants.sources.COLD,id:i+"-icon-cold",type:"symbol",filter:["==",["get","type"],"Icon"],layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-width":0,"text-halo-color":t.options.colors.primaryCold,"text-color":t.options.colors.secondaryBackground,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:r.constants.sources.COLD,id:i+"-text-cold",type:"symbol",filter:["==","$type","Point"],layout:{"symbol-placement":"point","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-size":18,"text-justify":["get","justify"],"text-letter-spacing":.05,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,0],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":t.options.colors.primaryCold,"text-halo-color":t.options.colors.primaryText,"text-halo-width":.5,"text-opacity":1,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{id:r.constants.layers.MESH+"-line",source:r.constants.sources.MESH,type:"line",paint:{"line-color":t.options.colors.primaryBase,"line-width":2,"line-opacity":.3}},{id:r.constants.layers.MESH+"-circle",source:r.constants.sources.MESH,type:"circle",paint:{"circle-radius":2,"circle-color":t.options.colors.primaryBase,"circle-opacity":.3}},{source:r.constants.sources.HOT,id:i+"-fill-hot",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":t.options.colors.secondaryHot,"fill-opacity":["case",["boolean",["has","new"],!0],.5,.1]}},{source:r.constants.sources.HOT,id:i+"-line-hot",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.primaryHot,"line-width":4,"line-dasharray":[1,2]}},{source:r.constants.sources.HOT,id:i+"-point-hot",filter:["==","$type","Point"],type:"circle",paint:{"circle-radius":["match",["get","type"],"Circle",8,4],"circle-stroke-width":1,"circle-color":t.options.colors.primaryHot,"circle-stroke-color":t.options.colors.secondaryHot}},{source:r.constants.sources.HOT,id:i+"-icon-hot",filter:["==",["get","type"],"Icon"],type:"symbol",layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":t.options.colors.primaryHot,"text-halo-width":0,"text-color":t.options.colors.secondaryHot}},{source:r.constants.sources.HOTTEXT,id:i+"-text-hot",type:"symbol",layout:{"symbol-placement":"point","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-anchor":["get","anchor"],"text-size":14,"text-justify":["get","justify"],"text-letter-spacing":0,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,0],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":t.options.colors.primaryText,"text-halo-color":t.options.colors.primaryBackground,"text-halo-width":0,"text-opacity":1}},{source:r.constants.sources.SNAP,id:i+"-point-snap",type:"circle",filter:["==","$type","Point"],paint:{"circle-radius":["match",["get","type"],"Circle",6,"Icon",0,6],"circle-stroke-width":2,"circle-color":t.options.colors.primarySnap,"circle-stroke-color":t.options.colors.secondarySnap}},{source:r.constants.sources.SNAP,id:i+"-icon-snap",type:"symbol",filter:["==",["get","type"],"Icon"],layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:18,stops:[[10,18],[14,16]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":t.options.colors.primarySnap,"text-halo-width":0,"text-color":t.options.colors.secondarySnap}},{source:r.constants.sources.SNAP,id:i+"-line-snap",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.secondarySnap,"line-width":4,"line-dasharray":[1,2]}},{source:r.constants.sources.ROUTE,id:i+"-line-route",type:"line",filter:["==","$type","LineString"],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.error,"line-width":4,"line-dasharray":[]}},{source:r.constants.sources.SELECT,id:i+"-line-select",type:"line",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":t.options.colors.secondarySelect,"line-width":4}},{source:r.constants.sources.SELECT,id:i+"-fill-select",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":t.options.colors.primarySelect,"fill-opacity":.4}},{source:r.constants.sources.SELECT,id:i+"-point-select",filter:["all",["!=",["get","type"],"Text"],["!=",["get","type"],"Icon"],["==",["geometry-type"],"Point"]],type:"circle",paint:{"circle-radius":{base:6,stops:[[10,6],[14,10]]},"circle-stroke-width":2,"circle-color":t.options.colors.secondarySelect,"circle-stroke-color":t.options.colors.primarySelect}},{source:r.constants.sources.SELECT,id:i+"-symbol-select",filter:["==",["get","type"],"Icon"],type:"symbol",layout:{"icon-optional":!0,"text-field":["get","secondaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":t.options.colors.primaryBackground,"text-halo-width":0,"text-color":t.options.colors.secondarySelect}},{source:r.constants.sources.SELECT,id:i+"-text-select",filter:["==",["get","type"],"Text"],type:"symbol",layout:{"symbol-placement":"point","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-size":18,"text-justify":["get","justify"],"text-letter-spacing":.05,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,0],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":t.options.colors.secondarySelect,"text-halo-color":t.options.colors.secondaryText,"text-halo-width":.5,"text-opacity":1}},{source:r.constants.sources.VERTEX,id:i+"-point-vertex",type:"circle",filter:["==","$type","LineString"],paint:{"circle-radius":4,"circle-stroke-width":3,"circle-color":t.options.colors.primaryVertex,"circle-stroke-color":t.options.colors.secondaryVertex}},{source:r.constants.sources.GAMEPAD,id:i+"-gamepad",type:"symbol",layout:{"icon-image":"gamepad","icon-size":.25}}],this.init=function(t={}){return this.options=t,this.refresh()},this.refresh=async function(e={}){var n=t.Utilities.cloneDeep(this._layers);return this._layers=[],this._sources=[],this.removeEventListeners(),this.removeLayers(this.defaultLayers),this.removeSources(Object.values(t.statics.constants.sources)),this.addEventListeners(),this.addSources(Object.values(t.statics.constants.sources)),this.addLayers(this.defaultLayers,this.options),await s.call(this,n),setTimeout((function(){t.Layers.moveLayers()}),250),setTimeout((function(){t.zoomToFeatures(t.getRenderedDrawnFeatures())}),350),this.getLayers()},this.setCustomLayers=async function(t,e){return t?await s.call(this,t,e):[]},this.getCustomLayers=function(){return this._layers},this.hasCustomLayers=function(){return this.getCustomLayers().length},this.getFeatures=function(t){var e=this.getSource(t);return e&&e._data?e._data.features:[]},this.getSelection=function(t=[],n){var i=!(!t||!t.length)&&t[0];return!!i&&(!i.properties.cluster||(e.onClusterClick(i,n),!1))},this.getType=function(t){return"Polygon"===t||"Rectangle"===t?"Polygon":"Polyline"===t||"LineString"===t||"Line"===t?"Polyline":("Point"===t||"Circle"===t||"Marker"===t||"Icon"===t||"Text"===t)&&"Point"},this.getSources=function(){return this.sources},this.getSource=function(t){return!!t&&this.getSources().find((function(e){return e.id===t}))},this.getSourceIds=function(){return this.getSources().map((function(t){return t.id}))},this.getLayers=function(){return this.layers},this.getLayer=function(t){if(!t)return!1;var e=this.getLayers(),n=e.find((function(e){return e.id===t}));return n||(n=e.filter((function(e){return e.source===t}))),n},this.getLayerIds=function(t){return(t||this.getLayers()).map((function(t){return t.id}))},this.addSources=function(e=[],n={}){return e.forEach((function(t){this.addSource(t,!1,n)}),this),t.fire("sources.add",{sources:this.getSources()}),this.getSources()},this.addSource=function(e,i,r={}){if(!e)throw new Error("No source was provided!");var o={type:r.type||"geojson",data:turf.featureCollection(r.features||[]),promoteId:r.promoteId||"id"};return i&&"Point"===i&&!r.noCluster&&(o=Object.assign(o,{cluster:!0,clusterMaxZoom:r.clusterMaxZoom||14,clusterRadius:r.clusterRadius||50})),n.addSource(e,o),this.sources.push(n.getSource(e)),t.fire("source.add",{id:e,source:this.getSource(e)}),this.getSource(e)},this.addLayers=function(e=[],n={}){return e.forEach((function(t){this.addLayer(t,n)}),this),t.fire("layers.add",{layers:this.getLayers()}),d.call(this),this.getLayers()},this.addLayer=function(e,i={}){return!(!e||!e.id)&&(e.metadata=i,n.addLayer(e),(e=n.getLayer(e.id))?(this.layers.push(e),t.fire("layer.add",{id:e.id,layer:this.getLayer(e.id)}),this.getLayer(e.id)):void 0)},this.removeSources=function(e){(e=e||this.getSourceIds()).forEach((function(t){this.removeSource(t)}),this),t.fire("sources.remove",{removed:!0})},this.removeSource=function(e){if(!e)return!1;n.getSource(e)&&n.removeSource(e);var i;return(i=this.sources.findIndex((function(t){return t.id===e})))>-1&&this.sources.splice(i,1),t.fire("source.remove",{removed:e}),e},this.removeLayers=function(e){var n=this.getLayerIds(e);return n.forEach((function(t){this.removeLayer(t)}),this),t.fire("layers.remove",{removed:n}),n},this.removeLayer=function(e){if(!e)return!1;n.getLayer(e)&&n.removeLayer(e);var i;return(i=this.layers.findIndex((function(t){return t.id===e})))>-1&&this.layers.splice(i,1),t.fire("layer.remove",{removed:e}),e},this.moveLayers=function(e){(e=e||this.defaultLayers).forEach((function(e){t.map.getLayer(e.id)&&t.map.moveLayer(e.id)}))},this.addEventListeners=function(t={}){return d.call(this,{on:!0})},this.removeEventListeners=function(t={}){return d.call(this,{off:!0})},this.onClusterClick=function(t){if(!t.source)return!1;n.getSource(t.source).getClusterExpansionZoom(t.properties.cluster_id,(function(e,i){e||n.easeTo({center:t.geometry.coordinates,zoom:i+2})}))},this.onLayerMouseover=function(t){},this.onLayerMouseout=function(t){}},d=function(t){if(!t.map)throw new Error("No map object provided!");const e=[];function n(n){var i=e.find((t=>t.id===n||t.properties.id===n));return i=i||t.getSelectedFeatures().find((t=>t.id===n||t.properties.id===n))}function i(n=[]){var i={},r=[],s=t.map.getSource(t.statics.constants.sources.COLDTEXT),a=t.map.getSource(t.statics.constants.sources.COLD);return t.updatingSource=!0,s&&s.setData(turf.featureCollection([])),a&&a.setData(turf.featureCollection([])),e.forEach((t=>{delete t.properties.new,delete t.properties.offset;var e=t.source;if(!n.length||n.includes(e)){if(!e)return r.push(t);i[e]||(i[e]=[]),i[e].push(t)}})),Object.entries(i).forEach((e=>{var n=e[0],i=e[1];if(!t.map.getSource(n))return r.push(i);o(i,n)})),o(r.flat(),t.statics.constants.sources.COLD),setTimeout((()=>{this.setFeaturesState(e,{hidden:!1})}),100),t.fire("features.update",{features:e}),i=null,r=null,t.updatingSource=!1,e}function r(e){(e=t.Utilities.cloneDeep(e)).properties.type=this.currentType;var n=turf.point(e.geometry.coordinates[1]),i=this.getUnits(e),r="feet";return i=this.convertUnits(e,i,r),n.properties.units=i,n.properties.unit=r,n.properties.text=`${i} ${r}`,n.properties.transform="uppercase",n.properties.anchor="bottom-left",this.textFeatures.push(n),n}function o(e,n){if(!(e&&e.length&&n&&t.map.getSource(n)))return!1;if(!t.options.offsetOverlappingLines)return t.map.getSource(n).setData(turf.featureCollection(e));var i=new t.Mesh(e,!0),r=i.getFeatures();r.forEach((function(i){var o=e.find((function(t){return t.id===i.parent}));o&&(i.source=n,i.properties.style=o.properties.style||i.properties.style,function(e,n){if(!t.options.offsetOverlappingLines)return!1;if(!s(n))return!1;if(n.properties.offset)return!1;var i=6,r=[];e.forEach((function(t){return!!s(t)&&(t.parent!==n.parent&&(!t.properties.offset&&(!(!turf.booleanOverlap(t,n)&&!turf.booleanWithin(t,n))&&void r.push(t))))}),this),r.forEach((function(t){t.properties.offset=i,i*=2}),this)}(r,i))})),t.map.getSource(n).setData(turf.featureCollection(r)),t.fire("features.offset",{features:e,offset:r,source:n}),i=null,r=null}function s(t){return!!t&&"LineString"===turf.getType(t)}this.offsetLines=this.getColdFeatures=function(){return e},this.getFeatureById=function(t){return Array.isArray(t)&&t.length>1?this.getFeaturesById(t):("object"==typeof t&&(t=t.parent||t.properties.parent||t.id||t.properties.id),n(t))},this.getFeaturesById=function(t){const e=[],n=[];return t.forEach((t=>{const i=this.getFeatureById(t);i&&!e.includes(t)&&(e.push(t),n.push(i))}),this),n},this.getType=function(t){return function(t){return t?function(t){return!!t&&("Polygon"===turf.getType(t)&&"Rectangle"===t.properties.type)}(t)?"Rectangle":function(t){return!!t&&("Polygon"===turf.getType(t)||"Polygon"===t.properties.type)}(t)?"Polygon":s(t)?"Polyline":function(t){return!!t&&("Point"===turf.getType(t)&&"Text"===t.properties.type)}(t)?"Text":function(t){return!!t&&("Point"===turf.getType(t)&&"Icon"===t.properties.type)}(t)?"Icon":function(t){return!!t&&(!("Point"!==turf.getType(t)||t.properties.type&&"Circle"!==t.properties.type)||"Point"===turf.getType(t)&&"Text"!==t.properties.type&&"Icon"!==t.properties.type)}(t)?"Circle":null:null}(t)},this.getUnit=function(e){if(!e)return!1;var n=e.properties.type;return!!n&&(!(!t.options.units||!t.options.units[n])&&t.options.units[n])},this.getUnits=function(t){if(!this.getUnit(t)||!t)return!1;var e=1,n=t.properties.type;return"Polyline"===n?e=turf.length(t,{units:"meters"}):("Polygon"===n||"Rectangle"===n)&&(e=turf.area(t)),e},this.setFeaturesState=function(e=[],n){return n&&e.length?(e.forEach((function(e){var i=e.id||e.properties.id;t.hotFeature&&t.hotFeature.id===i||this.setFeatureState(i,n)}),this),e):[]},this.setFeatureState=function(e,i){if(!i||!e)return!1;var r=function(e){var i="object"==typeof e&&e.id?e:n(e);if(!i||!i.source)return[];var r=t.options.offsetOverlappingLines?"parent":"id",o=t.map.getSource(i.source)._data.features.filter((function(t){return t[r]===e||t.properties[r]===e}));return o}(e);return r.forEach((function(e){var n=e.id||e.properties.id;t.map.setFeatureState({source:e.source,id:n},i)})),r},this.setText=function(e){var n=t.statics.constants.sources.HOTTEXT;return this.textFeatures=[],t.map.getSource(n).setData(turf.featureCollection(this.textFeatures)),!!e&&(e.features&&(e=e.features),Array.isArray(e)||(e=[e]),!!e.length&&(e.forEach((function(e){var n=e.properties.type;n&&(this.currentType=n,"Polyline"===n&&t.Utilities.isValidLineString(e)&&turf.segmentEach(e,r.bind(this)))}),this),t.map.getSource(n).setData(turf.featureCollection(this.textFeatures)),delete this.textFeatures,void delete this.currentType))},this.addFeature=function(e,n={}){return!(!e||!e.properties)&&(e=turf.cleanCoords(e),(e=turf.truncate(e,{precision:6,coordinates:3,mutate:!0})).properties=t.Utilities.assignDeep(n,e.properties),e.source=e.source||e.properties.source||t.statics.constants.sources.COLD,delete e.properties.source,delete e.properties.painting,delete e.properties.edit,delete e.properties.new,delete e.properties.selected,delete e.properties.hidden,delete e.properties.offset,e.properties.style=e.properties.style||{},this.addUnits(e),this.addFeatures([e]),e)},this.addFeatures=function(n,i){var r,o=[];return n.forEach((n=>{n.id=n.id||n.properties.id||URL.createObjectURL(new Blob([])).slice(-36),n.source=n.source||n.properties.source||t.statics.constants.sources.COLD,n.properties.id=n.id,n.properties.type=this.getType(n);var s=e.findIndex((function(t){if(t.id===n.id||t.properties.id===n.id)return t}));s>-1?(this.setFeatureState(n.id,{hidden:!i}),e[s]=n,r=!i):(r=!0,e.push(n)),r&&!o.includes(n.source)&&o.push(n.source)}),this),r&&this.updateSource(o),n},this.addUnits=function(t,e){var n=e||this.getUnit(t);if(!n)return!1;var i=this.convertUnits(t,null,e);return t.geometry.units=i,t.geometry.unit=n,t},this.updateFeatures=function(t,e){var n=[];t.forEach((function(t){var i=t.id||t.properties.id;if(!i)return!1;var r=this.getFeatureById(i);if(!r||void 0===r)return this.addFeature(t);n.includes(r.source)||n.push(r.source),"Point"===r.geometry.type?r.geometry.coordinates=e||t.geometry.coordinates:"Polygon"===r.geometry.type&&e?r.geometry.coordinates[0][t.index]=e:"LineString"===r.geometry.type&&e&&(r.geometry.coordinates[t.index]=e),this.addUnits(r)}),this),this.updateSource(n)},this.updateSource=function(t){return i.call(this,t)},this.removeFeatures=function(t,n){const i=[];var r,o;return Array.isArray(t)&&n?(o=t.map((function(t){return t.details?t.details.id:t.id?t.id:t})),e.forEach((t=>{if(o.includes(t.source)){var n=e.findIndex((e=>t.id===e.id||t.properties.id===e.id));n>-1&&i.push(...e.splice(n,1))}})),this.updateSource(o)):(r=n?e.findIndex((e=>e.id===t||e.properties.id===t)):e.find((e=>e.id===t||e.properties.id===t)),n?(r>-1&&(i.push(...e.splice(r,1)),o=[i[0].source]),this.updateSource(o)):(i.push(r),this.setFeatureState(t,{hidden:!0}))),i},this.deleteFeatures=function(){e.splice(0,e.length),this.updateSource()},this.convertUnits=function(t,e,n){var i=t.properties.type,r=n||this.getUnit(t);return e=e||this.getUnits(t),"Polyline"===i?e=Math.round(turf.convertLength(e,"meters",r)):("Polygon"===i||"Rectangle"===i)&&(e=Math.round(turf.convertArea(e,"meters",r))),e=e?Number(e.toFixed(2)):0}},p=function(t,e){var n=1,i=[],r={};const o=this.geoflo;function s(t,e){return!r[n]&&!h(n)&&(r[n]=t,t.id=n,t.parent=e,o.Utilities.setProperty(t,"id",n),o.Utilities.setProperty(t,"parent",e),n++,!0)}function a(t,e,n){for(var i=turf.truncate(turf.point(t[0]),{precision:7,coordinates:2,mutate:!0}),r=null,a=1;a<t.length;a++){if(r=turf.truncate(turf.point(t[a]),{precision:7,coordinates:2,mutate:!0}),!o.Utilities.isPointEqual(i.geometry.coordinates,r.geometry.coordinates)){var c=turf.lineString([i.geometry.coordinates,r.geometry.coordinates]);s(c,n)&&e.push(c)}i=r}}function c(t){var n=[];return t&&t.length?(t.forEach((function(t){var i=t.geometry.type,r=t.parent||t.properties.parent||t.id||t.properties.id;if(e&&"LineString"!==i&&!t.properties.unfill)return!!s(t=o.Utilities.cloneDeep(t),r)&&n.push(t);"MultiPolygon"===i?t.geometry.coordinates.forEach((function(t){t.forEach((function(t){a(t,n,r)}))})):"Polygon"===i||"MultiLineString"===i?t.geometry.coordinates.forEach((function(t){a(t,n,r)})):"LineString"===i?a(t.geometry.coordinates,n,r):"Point"===i&&s(t=o.Utilities.cloneDeep(t),r)&&n.push(t)})),n):n}function u(t,e,n){var i=e.id||e.properties.id,r=t[i];void 0===r&&(r=[],t[i]=r),n.forEach((function(t){var e=o.Utilities.reducePrecision(t.geometry.coordinates);-1===r.findIndex((function(t){return t[0]===e[0]&&t[1]===e[1]}))&&r.push(e)}))}function l(t,e){for(var n={},r=function(t,e,i){var r=t.geometry.coordinates,s=e.geometry.coordinates,a=i.geometry.coordinates,c=!1,l=!1,d=!1;if(!o.Utilities.isPointEqual(r,s[0])&&!o.Utilities.isPointEqual(r,s[1])){var p=turf.point(s[0]),h=turf.point(s[1]),f=turf.distance(t,p)<turf.distance(t,h)?p:h;turf.pointOnLine(i,f).properties.dist<o.statics.constants.MIN_DISTANCE?(u(n,i,[f]),d=!0):c=!0}if(!o.Utilities.isPointEqual(r,a[0])&&!o.Utilities.isPointEqual(r,a[1])){var g=turf.point(a[0]),m=turf.point(a[1]),y=turf.distance(t,g)<turf.distance(t,m)?g:m;turf.pointOnLine(e,y).properties.dist<o.statics.constants.MIN_DISTANCE?(u(n,e,[y]),d=!0):l=!0}d||(c&&u(n,e,[t]),l&&u(n,i,[t]))},s=function(t,e){var i=turf.pointOnLine(t,turf.point(e));return i.properties.dist<o.statics.constants.MIN_DISTANCE&&!o.Utilities.isPointAtVertex(t.geometry.coordinates,e)&&(u(n,t,[i]),!0)},a=t===e,c=0;c<t.length;c++)for(var l=t[c],d=l.geometry.type,p=a?c+1:0;p<e.length;p++){var f=e[p],g=f.geometry.type,m=f.id||f.properties.id;if("LineString"===d&&"LineString"===g){if(o.Utilities.isOverlapping(l,f)){var y=turf.lineIntersect(l,f).features;if(y.length>0){y.length,r(y[0],l,f)}else{var v=l.geometry.coordinates,b=f.geometry.coordinates;s(l,b[0]),s(l,b[1]),s(f,v[0]),s(f,v[1])}if(h(m)){var x=i.indexOf(h(m));i.splice(x,1)}}}else if("Point"===d||"Point"===g){if("Point"===g&&"Point"===g);else{var E="Point"===d?l:f,C="LineString"===d?l:f;m=E.id||E.properties.id,s(C,E.geometry.coordinates)&&(n[m]=[])}if(h(m)){x=i.indexOf(h(m));i.splice(x,1)}}}return n}function d(t,e){var n=[];return t.forEach((function(t){var i=t.id||t.properties.id;if("LineString"===t.geometry.type){var r=e[i];if(void 0!==r){var a=turf.lineSplit(t,turf.multiPoint(r));turf.featureEach(a,(function(t){var e=turf.lineDistance(t);e>o.statics.constants.MIN_SEGMENT_LENGTH&&(o.Utilities.setProperties(t,{length:e}),s(t),n.push(t))}))}else{var c=turf.lineDistance(t);c>o.statics.constants.MIN_SEGMENT_LENGTH&&(o.Utilities.setProperties(t,{length:c}),n.push(t))}}else{void 0===e[i]&&n.push(t)}})),n}function p(t){var n=c(t);return e?n:d(n,l(n,n))}function h(t){return i.find((function(e){return e.id===t||e.properties.id===t}))}function f(t){return i.filter((function(e){return e.parent===t||e.properties.parent===t}))}this.addNewFeatures=function(t){var e=c(p(t)),n=l(e,i);return i=[].concat(o.Utilities.consumableArray(d(i,n)),o.Utilities.consumableArray(d(e,n))),this.getFeatures()},this.getFeatures=function(){return i},this.splitSegmentAtPoint=function(t,e){var n=r[t];if(void 0!==n){var a=i.indexOf(n);i.splice(a,1);var c=o.Utilities.createLineWithLength([e,n.geometry.coordinates[0]]),u=o.Utilities.createLineWithLength([e,n.geometry.coordinates[1]]);s(c),s(u),i.push(c,u)}},this.getFeaturesFromIndex=function(t){var e=[];return t.forEach((function(t){var n=t.id||t.properties.id,i=r[n];void 0!==i&&e.push(i)})),e},this.getFeatureById=function(t){return h(t)},this.getFeaturesByParentId=function(t){return f(t)},this.removeFeature=function(t){return function(t){var e=f(t);e&&e.length&&(e.forEach((function(t){var e=i.indexOf(t);i.splice(e,1)})),o.updateMeshData());return i}(t)},t&&(i=p(t))},h=["map.enable","map.disable","map.ready","map.redraw","map.refresh","mode.change","theme.change","sources.add","source.add","source.hot","layers.add","layers.remove","layer.add","control.add","control.remove","features.zoom","features.add","features.delete","features.update","features.import","features.export","features.offset","feature.add","feature.delete","feature.select","feature.deselect","feature.update","feature.history","select.load","select.add","select.remove","select.activate","select.deactivate","draw.activate","draw.deactivate","draw.start","draw.finish","draw.cancel","mesh.load","text.add","icon.add","vertex.find","vertex.on","vertex.off","vertex.add","vertex.drag","vertex.dragsnap","vertex.delete","overpass.add","snapping.activate","snapping.deactivate","snapping.add","snapping.refresh","snapping.delete","pinning.activate","pinning.deactivate","pinning.add","pinning.update","routing.activate","routing.deactivate","routing.add","painting.activate","painting.deactivate","painting.start","painting.update","gamepad.init","gamepad.add","gamepad.remove","gamepad.hold","gamepad.press","gamepad.release","gamepad.connect","gamepad.disconnect"],f=function(t,e,n){var i=["mouse"],r={mode:null,feature:null,mouse:null},o={mode:null,feature:null,mouse:null};const s=function(e){if(!t.currentMode)return!1;t.currentMode.handleOffMap&&t.currentMode.handleOffMap(e)},a=function(e){if(!t.currentMode)return!1;t.currentMode.handleOnMap&&t.currentMode.handleOnMap(e)},c=function(t){};return function(e){var i=document.createElement("img"),r=n.icon?"icon":"",o=n.rotate;i.className="mapboxgl-ctrl-logo "+t.id,r&&(i.className+=`-${r}`),i.setAttribute("target","_blank"),i.setAttribute("src",n.attribution),o&&(i.style.rotate=o+"deg"),e.appendChild(i),e.style.display=n.show?n.position.includes("center")?"flex":"block":"none",e.addEventListener("click",c),e.addEventListener("mouseover",a),e.addEventListener("mouseleave",s)}(e),{queueMapClasses:function(e){o=t.Utilities.extend(o,e)},updateMapClasses:function(){if(t.container){var e,n,s=[],a=[];if(i.forEach((function(t){o[t]!==r[t]&&(s.push(t+"-"+r[t]),null!==o[t]&&a.push(t+"-"+o[t]))})),s.length>0)(e=t.container.classList).remove.apply(e,s);if(a.length>0)(n=t.container.classList).add.apply(n,a);r=t.Utilities.extend(r,o)}},position:n.position}},g=function(t,e,n){if(!n||!e)return!1;var i,r,o=["mode","feature","mouse"],s={},a={},c=null,u={mode:null,feature:null,mouse:null},l={mode:null,feature:null,mouse:null};const d=function(e){if(!t.currentMode)return!1;t.currentMode.handleOffMap&&t.currentMode.handleOffMap(e)},p=function(e){if(!t.currentMode)return!1;t.currentMode.handleOnMap&&t.currentMode.handleOnMap(e)};return n.forEach((function(n){(function(e){if(!e)return!1;var n=t.options.controls&&"object"==typeof t.options.controls,i=!!n&&!t.options.controls[e.type];return!(i||e.dontShow||!t.options.controls)})(n)||(n.show=!1),function(t){if(!r){if(!t.position)throw new Error("The first control needs to have a position");r=t.position}}(n),function(e,n){var o=document.createElement("div"),s=(n.group?n.group.toUpperCase():n.attribution?"ATTR":"NONE")+"_GROUP";e.appendChild(o),o.className=t.statics.constants.classes[s]+" "+n.type,o.style.display=n.show?r.includes("center")?"flex":"block":"none",n.show&&n.divider&&e.appendChild(function(){var e=document.createElement("div");return e.className=""+t.statics.constants.classes.DIVIDER,e}()),o.addEventListener("mouseover",p),o.addEventListener("mouseleave",d),function(e,n){i=e,"modes"===e.type?(g("select",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_SELECT,key:"s",title:"Select Features",onAdd:function(){t.editMode||t.drawMode?(t.getButtons("edit").remove(),t.getButtons("save").add()):t.hasSelection()?(t.getButtons("save").remove(),t.getButtons("edit").add()):(t.getButtons("save").remove(),t.getButtons("edit").remove(),t.getButtons("undo").remove(),t.getButtons("cancel").remove(),t.getButtons("redo").remove(),t.getButtons("import").add(),t.getButtons("export").add(),t.getButtons("clear").add())},onActivate:function(){return t.noSelect=!1,t.setMode(),!0},onDeactivate:function(){t.noSelect=!0}}),g("edit",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_EDIT,key:"Enter",title:"Edit Feature",dontShow:!0,onAdd:function(){t.getButtons("select").remove(),this.button.classList.remove(t.statics.constants.classes.ACTIVE_BUTTON),this.button.style.display="flex",this.button.style["background-color"]=t.options.colors.secondaryBackground},onActivate:function(){t.editFeature(),t.getButtons("save").add()},onDeactivate:function(){t.currentMode.deactivate()},onRemove:function(e){!t.getButtons("save")&&createSelect(e)}}),g("save",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_FINSIH,key:"Enter",title:"Save Edit",dontShow:!0,onAdd:function(e){t.getButtons("select").remove(),t.getButtons("edit").remove(),t.getButtons("import").remove(),t.getButtons("export").remove(),t.getButtons("clear").remove(),t.getButtons("undo").add(),t.getButtons("cancel").add(),t.getButtons("redo").add(),this.button.style["background-color"]=t.options.colors.secondaryColor},onActivate:function(e){t.currentMode.handleClick({finish:!0})}})):"options"===e.type?(y("import",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_IMPORT,key:"u",title:"Import Features",onActivate:function(){return t.loadFeatures()}}),y("export",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_EXPORT,key:"d",title:"Export Features",onActivate:function(){return t.saveFeatures()}}),y("clear",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_CLEAR,key:"Delete",title:"Delete Selected or All Features",onActivate:function(){return t.deleteMeshData(),t.deleteUserData(),t.getButtons("select").add(),!0}}),y("undo",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_UNDO,key:"u",title:"Undo Edit",dontShow:!0,onActivate:function(){return t.currentMode.handleUndo()}}),y("redo",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_REDO,key:"r",title:"Redo Edit",dontShow:!0,onActivate:function(){return t.currentMode.handleRedo()}}),y("cancel",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_CANCEL,key:"Escape",title:"Cancel Edit",dontShow:!0,onActivate:function(){return t.cancelEdit()}})):"actions"===e.type?(m("snapping",{container:n,name:"snapping",title:"Enable/Disable Snapping",activeClass:t.id+"-snapping-enabled",inactiveClass:t.id+"-snapping-disabled",onActivate:function(){return t.activateSnapping()},onDeactivate:function(){return t.deactivateSnapping()}}),m("pinning",{container:n,name:"pinning",title:"Enable/Disable Pinning",activeClass:t.id+"-pinning-enabled",inactiveClass:t.id+"-pinning-disabled",onActivate:function(){return t.activatePinning()},onDeactivate:function(){return t.deactivatePinning()}}),m("routing",{container:n,name:"routing",title:"Enable/Disable Routing",activeClass:t.id+"-routing-enabled",inactiveClass:t.id+"-routing-disabled",onActivate:function(){return t.activateRouting()},onDeactivate:function(){return t.deactivateRouting()}}),m("exploring",{container:n,name:"exploring",title:"Enable/Disable Exploring",activeClass:t.id+"-exploring-enabled",inactiveClass:t.id+"-exploring-disabled",onActivate:function(){return t.activateExploring()},onDeactivate:function(){return t.deactivateExploring()}}),m("painting",{container:n,name:"painting",title:"Enable/Disable Painting",activeClass:t.id+"-painting-enabled",inactiveClass:t.id+"-painting-disabled",onActivate:function(){return t.activatePainting()},onDeactivate:function(){return t.deactivatePainting()}})):"types"===e.type?(g("polyline",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_LINE,key:"l",title:"Draw Polyline",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Polyline"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("polygon",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_POLYGON,key:"p",title:"Draw Polygon",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Polygon"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("rectangle",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_RECTANGLE,key:"r",title:"Draw Rectangle",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Rectangle"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("circle",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_POINT,key:"o",title:"Draw Circle",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Circle"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("text",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_TEXT,key:"t",title:"Draw Text",onActivate:function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Text"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}}),g("icon",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_ICON,key:"i",title:"Draw Icon",onActivate:async function(){return t.setMode({mode:t.statics.constants.modes.DRAW,type:"Icon"})},onDeactivate:function(){t.currentMode.deactivate(),t.setMode()}})):"utils"===e.type&&(y("zoom",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_ZOOM_IN_FEATURES,key:"x",title:"Zoom to Extent",onActivate:function(){return t.zoomToFeatures()}}),y("locate",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_LOCATE,key:"u",title:"Locate User",button:t.Locate.getButton(),onActivate:function(){t.Locate.onControlEvent(this)}}),y("refresh",{container:n,className:t.statics.constants.classes.CONTROL_BUTTON_REFRESH,key:"q",title:"Refresh",onActivate:function(){return t.refresh()}}))}(n,o)}(e,n)})),{setActiveButton:b,queueMapClasses:function(e){l=t.Utilities.extend(l,e)},updateMapClasses:function(){if(!t.container)return;var e,n,i=[],r=[];o.forEach((function(t){l[t]!==u[t]&&(i.push(t+"-"+u[t]),null!==l[t]&&r.push(t+"-"+l[t]))})),i.length>0&&(e=t.container.classList).remove.apply(e,i);r.length>0&&(n=t.container.classList).add.apply(n,r);u=t.Utilities.extend(u,l)},removeButtons:function(){Object.keys(s).forEach((function(t){var e=s[t];e.parentNode?e.parentNode.removeChild(e):e&&e.remove(),delete s[t],delete a[t]}))},getButtonOptions:function(){return a},getButtonElements:function(){return s},position:r};function h(t){return t.title+(t.key?" ("+t.key+")":"")}function f(e,n){if(!i||!i.buttons[e])return!1;var r=n.position,o=n.button||document.createElement("button");return n.key=t.options.keys&&t.options.keys[e]?t.options.keys[e]:n.key,n.title&&o.setAttribute("title",h(n)),n.container.appendChild(o),n.id=e,n.button=o,n.add=function(t={}){this.button.style.display="flex",this.onAdd&&this.onAdd(t)},n.remove=function(t={}){this.button.style.display="none",this.onRemove&&this.onRemove(t)},n.activate=function(){this.button.classList.remove(n.inactiveClass),this.button.classList.add(n.activeClass),this.button.classList.add(t.statics.constants.classes.ACTIVE_BUTTON)},n.deactivate=function(){o.classList.remove(n.activeClass),o.classList.remove(t.statics.constants.classes.ACTIVE_BUTTON),o.classList.add(n.inactiveClass)},n.dontShow&&(o.style.display="none"),s[e]=o,a[e]=n,r&&(r=r.includes("right")?"left":r.includes("left")?"right":r.includes("bottom")?"top":r.includes("top")?"bottom":"absolute"),n.container.tooltipPosition=r,t.addTooltip(n.container,o,h(n)),o}function g(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=f(e,n);return!!i&&(i.className=t.statics.constants.classes.CONTROL_BUTTON+" "+n.className,i.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),t.target===c?(v(),n.onDeactivate&&n.onDeactivate(n)):n.onActivate(n)&&b(e)}),!0),i)}function m(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=f(e,n);return!!i&&(i.className=""+t.statics.constants.classes.CONTROL_BUTTON,t.options[n.name]&&t.options[n.name].enable?(i.classList.add(n.activeClass),i.classList.add(t.statics.constants.classes.ACTIVE_BUTTON)):i.classList.add(n.inactiveClass),i.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),t.options[n.name]||(t.options[n.name]={}),t.options[n.name].enable?n.onDeactivate&&n.onDeactivate(n):n.onActivate(n)}),!0),i)}function y(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=f(e,n);return!!i&&(i.className=t.statics.constants.classes.ACTION_BUTTON+" "+n.className,"locate"===e&&t.Locate&&t.Locate.control&&t.Locate.control._container.remove(),i.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),n.onActivate(n)}),!0),i)}function v(){c&&(c.classList.remove(t.statics.constants.classes.ACTIVE_BUTTON),c=null)}function b(e){v();var n=!e&&t.editMode?s.edit:e?"edit"===e?s.select:s[e]:s.select;n&&n&&"trash"!==e&&(n.title.includes("Draw ")?n.title.includes(t.currentMode.type)&&(n.classList.add(t.statics.constants.classes.ACTIVE_BUTTON),c=n):n.classList.add(t.statics.constants.classes.ACTIVE_BUTTON))}},m=function(t,e,n={}){this.controls=e,this.options=n;var i=function(t,e){if((t=t.trim()).includes("rgba"))t=this.hex(t);else{if(!t||-1===[4,7].indexOf(t.length))return!1;3===(t=t.substr(1)).length&&(t=t.split("").map((function(t){return t+t+""})).join(""))}var n=parseInt(t.slice(0,2),16),i=parseInt(t.slice(2,4),16),r=parseInt(t.slice(4,6),16);return void 0!==e?"rgba("+n+" "+i+" "+r+" / "+e+"%)":"rgb("+n+" "+i+" "+r+")"};this.enable=function(e){if(!e)return null;this.position=e.position,t.map.addControl(this,e.position)},this.disable=function(){t.map.removeControl(this)},this.onAdd=function(e){return!!this.options&&(this.options.attribution?this.setAttribution(e):(this.setTheme(n.colors||t.options.colors),t.fire("control.add",{control:this,element:this.element}),this.element))},this.onRemove=function(){t.buttons.removeButtons(),t.fire("control.remove",{element:this.element}),t.disable()},this.setAttribution=function(){var e=f(t,this.control,n);return Object.assign(this,e),this.setTheme(n.colors||t.options.colors),t.fire("control.add",{control:this,element:this.element}),this.element},this.setMode=function(e){t.setActiveButton(e||"select")},this.setTheme=function(e){if(e)return e.primaryColor&&document.documentElement.style.setProperty("--"+t.id+"-primary-color",i(e.primaryColor)),e.primaryBackground&&document.documentElement.style.setProperty("--"+t.id+"-primary-background",i(e.primaryBackground)),e.primaryText&&document.documentElement.style.setProperty("--"+t.id+"-primary-text",i(e.primaryText)),e.primaryBorder&&document.documentElement.style.setProperty("--"+t.id+"-primary-border",i(e.primaryBorder)),e.secondaryColor&&document.documentElement.style.setProperty("--"+t.id+"-secondary-color",i(e.secondaryColor)),e.secondaryBackground&&document.documentElement.style.setProperty("--"+t.id+"-secondary-background",i(e.secondaryBackground)),e.secondaryText&&document.documentElement.style.setProperty("--"+t.id+"-secondary-text",i(e.secondaryText)),e.secondaryBorder&&document.documentElement.style.setProperty("--"+t.id+"-secondary-border",i(e.secondaryBorder)),t.fire("theme.change",{colors:e}),this.getTheme()},this.setControl=function(e){if(!e)return!1;var n;this.element=document.createElement("div"),this.element.className=t.id+"-control-wrap",this.control=document.createElement("div"),this.control.className=t.statics.constants.classes.PREDEFINED_CONTROL_BASE+" "+t.statics.constants.classes.PREDEFINED_CONTROL_GROUP,this.element.appendChild(this.control),Array.isArray(e)?(n=g(t,this.control,e),Object.assign(this,n)):e.attribution&&(n=f(t,this.control,e),Object.assign(this,n)),this.enable(n)},this.getTheme=function(){return t.options.colors},this.getButtons=function(){return this._buttons},this.getControl=function(t){var e,n=this.control.childNodes;if(n.length)return t&&n.forEach((function(n){n.classList.contains(t)&&(e=n)})),e},this.showControl=function(t){var e=this.getControl(t);return!!e&&(e.style.display=this.position.includes("center")?"flex":"block",e)},this.hideControl=function(t){var e=this.getControl(t);return!!e&&(e.style.display="none",e)},this.setControl(e)},y=function(t,e={}){this.options=e,this.init=function(e={}){return t.Utilities.extend(this.options,e),this.styles=this.options.styles||[{title:"Dark",uri:"mapbox://styles/mapbox/dark-v11"},{title:"Light",uri:"mapbox://styles/mapbox/light-v11"},{title:"Outdoors",uri:"mapbox://styles/mapbox/outdoors-v11"},{title:"Satellite",uri:"mapbox://styles/mapbox/satellite-streets-v11"},{title:"Streets",uri:"mapbox://styles/mapbox/streets-v11"}],this.defaultStyle="Dark",this.onDocumentClick=this.onDocumentClick.bind(this),this.events=this.options.eventListeners,this},this.select=function(t){if(!this.mapStyleContainer)return;const e=this.mapStyleContainer.getElementsByClassName(t);e.length>0&&e[0].click()},this.getDefaultPosition=function(){return"top-right"},this.onAdd=function(t){this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mapStyleContainer=document.createElement("div"),this.styleButton=document.createElement("button"),this.styleButton.type="button",this.mapStyleContainer.classList.add("mapboxgl-style-list");for(const t of this.styles){const e=document.createElement("button");e.type="button",e.classList.add(t.title.replace(/[^a-z0-9-]/gi,"_")),e.dataset.uri=JSON.stringify(t.uri),e.addEventListener("click",(t=>{const e=t.target||t.srcElement;if(this.closeModal(),e.classList.contains("active"))return;if(this.events&&this.events.onOpen&&this.events.onOpen(t))return;const n=JSON.parse(e.dataset.uri);this.map.setStyle(n);const i=this.mapStyleContainer.getElementsByClassName("active");for(;i[0];)i[0].classList.remove("active");e.classList.add("active"),this.events&&this.events.onChange&&this.events.onChange(t,n)})),t.title===this.defaultStyle&&e.classList.add("active"),this.mapStyleContainer.appendChild(e)}return this.styleButton.classList.add("mapboxgl-ctrl-icon"),this.styleButton.classList.add("mapboxgl-style-switcher"),this.styleButton.addEventListener("click",(t=>{this.events&&this.events.onSelect&&this.events.onSelect(t)||this.openModal()})),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.styleButton),this.controlContainer.appendChild(this.mapStyleContainer),this.closeModal(),this.controlContainer},this.onRemove=function(){this.controlContainer&&this.controlContainer.parentNode&&this.map&&this.styleButton&&(this.styleButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)},this.closeModal=function(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="none",this.styleButton.style.display="block")},this.openModal=function(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="block",this.styleButton.style.display="none")},this.onDocumentClick=function(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.closeModal()},this.init()},v={enable:!0,debug:!1,crosshairs:!0,joystick:{min:.2,max:.7},camera:{free:!0},pan:{speed:.001,min:.001,max:.05},bearing:{speed:.8},pitch:{speed:1.5,max:70},zoom:{speed:.008},rumble:{startDelay:0,duration:200,weakMagnitude:1,strongMagnitude:1},mapping:{Select:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&t.ctx.getButtons("clear").button.click()},Start:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type&&t.gamepad.hasJoysticks){var e="select"===t.mode.id?"edit":"select";t.ctx.getButtons(e).button.click()}},Power:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&t.ctx.getButtons("save").button.click()},Menu:function(t){"press"===t.type||"hold"===t.type||t.type},Misc:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type&&t.gamepad.hasJoysticks){t.ctx.getButtons("zoom").button.click();var e=setInterval((function(){ctx.mapMoving||(clearInterval(e),t.gamepad.map.center=t.ctx.map.getCenter(),t.gamepad.map.zoom=t.ctx.map.getZoom())}),1)}},A:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type)if(t.gamepad.hasJoysticks)t.ctx.getButtons("routing").button.click();else if(!t.gamepad.pressed.BumpLeft&&!t.gamepad.pressed.BumpRight)return this.JoyLeftClick(t)},B:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type)if(t.gamepad.hasJoysticks)t.ctx.getButtons("painting").button.click();else if(!t.gamepad.pressed.BumpLeft&&!t.gamepad.pressed.BumpRight)return this.JoyRightClick(t)},Y:function(t){"press"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft||t.gamepad.pressed.BumpRight)&&t.gamepad.setSpeed(t.value,!1):"hold"===t.type||"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("snapping").button.click()},X:function(t){"press"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft||t.gamepad.pressed.BumpRight)&&t.gamepad.setSpeed(t.value,!0):"hold"===t.type||"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("pinning").button.click()},JoyLeftMove:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setCenter(t.value,t.gamepad.options.camera.free):"release"===t.type&&t.gamepad.setCenter(!1,t.gamepad.options.camera.free))},JoyRightMove:function(t){"press"===t.type||("hold"===t.type?t.name.includes("Up")||t.name.includes("Down")?t.gamepad.setPitch(t.value,t.name.includes("Up")):(t.name.includes("Left")||t.name.includes("Right"))&&t.gamepad.setBearing(t.value,t.name.includes("Left")):t.type)},JoyLeftClick:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&"draw"===t.mode.id&&t.mode.deleteVertex()},JoyRightClick:function(t){if("press"===t.type){if("draw"===t.mode.id)return!!t.lngLat&&t.mode.handleDown(t)}else if("hold"===t.type);else if("release"===t.type){if(!t.lngLat)return!1;"draw"===t.mode.id?(t.mode.handleUp(t),t.mode.handleClick(t)):t.mode.handleClick(t)}},BumpLeft:function(t){if("press"===t.type){if(t.gamepad.hasJoysticks)return t.gamepad.setSpeed(t.value,!0);if(t.gamepad.pressed.BumpRight)return!1}else"hold"===t.type?t.gamepad.hasJoysticks:t.type},BumpRight:function(t){if("press"===t.type){if(t.gamepad.hasJoysticks)return t.gamepad.setSpeed(t.value,!1);if(t.gamepad.pressed.BumpLeft)return!1}else"hold"===t.type||t.type},TrigLeft:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setZoom(t.value,!0):t.type)},TrigRight:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setZoom(t.value,!1):t.type)},DpadUp:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setPitch(t.value,!0):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Polygon").button.click())},DpadDown:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setPitch(t.value,!1):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Circle").button.click())},DpadLeft:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setBearing(t.value,!0):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Polyline").button.click())},DpadRight:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setBearing(t.value,!1):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.ctx.getButtons("Rectangle").button.click())}}};function b(t){var e,n,i,r=[],o=[],s=[];function a(t,e){var n=document.createElement("tr");if(n.classList.add("popup-table-row"),t){var i=document.createElement("th");i.classList.add("popup-table-header"),i.appendChild(document.createTextNode(t)),n.appendChild(i)}var r=document.createElement("td");return r.classList.add("popup-table-data"),r.classList.add(t),r.appendChild(document.createTextNode(e)),n.appendChild(r),n}function c(e){s=e,r=void 0===r?[]:r,e.length>=r.length&&r.splice(0,e.length-r.length+1),i=e[0].id||e[0].properties.id,e.length>1&&e.forEach((t=>{const e=t.id||t.properties.id;-1===r.indexOf(e)&&(i=e)})),n||t.currentMode.deselectCurrentFeature(),t.currentMode.selectFeature(i)}this.id="select",this.activate=function(e={}){return!this.activated&&(t.currentMode.id!==this.id?(e.mode=this.id,t.setMode(e)):(this.activated=!0,t.map.dragPan.enable(),t.setButtons(),t.setActiveButton("select"),t.fire("select.activate",{activated:!0,options:e}),this.gamepad,void setTimeout((function(t){t.selectFeature(e.id?e.id:!!e.feature&&e.feature.id)}),5,this)))},this.deactivate=function(){if(!this.activated)return!1;this.activated=!1,this.deselectCurrentFeature(),t.setButtons(),t.fire("select.deactivate",{activated:!0})},this.canHandle=function(e){return t.statics.constants.modes.SELECT===e},this.selectFeature=function(e){const n=t.options.select.popup;return!!e&&(-1===r.indexOf(e)&&r.push(e),t.hasSelection()&&t.forEachSelectedFeature((t=>{})),o=t.Features.removeFeatures(e),t.addFeaturesToSelected(o),n&&this.addPopup(o),t.wantingToEdit?(1==o.length&&e===o[0].id&&(i=o[0],t.wantingToEdit=!1,t.setMode("edit",i.properties.type,i)),o):o);var i},this.deselectCurrentFeature=function(){t.removeSelection()},this.addPopup=function(n){this.popupElement=function(e){const n=document.createElement("div");n.classList.add("popup-table-holder");const i=function(e){var n=document.createElement("table"),i=["id","type"];n.style.width="100%",n.style.height="100%",n.setAttribute("border","1"),n.classList.add("popup-table");var r=document.createElement("tbody");return e.forEach((function(e,n){var o=e.properties.type;i.forEach((function(t){r.appendChild(a(t,e.properties[t]))})),r.appendChild(a("geometry",e.geometry.type)),"LineString"===e.geometry.type?(t.Features.addUnits(e,"feet"),r.appendChild(a("unit",e.geometry.unit)),r.appendChild(a("units",e.geometry.units))):"Text"===o?r.appendChild(a("content",e.properties.text)):"Polygon"===e.geometry.type&&(t.Features.addUnits(e,"acres"),r.appendChild(a("unit",e.geometry.unit)),r.appendChild(a("units",e.geometry.units)))})),n.appendChild(r),n}(e);if(n.appendChild(i),s.length>1){var r=document.createElement("div");r.classList.add("popup-table-button"),r.innerHTML="<button> Next </button>",r.addEventListener("click",c.bind(this)),n.appendChild(r)}return n}(n),this.popup=new mapboxgl.Popup({closeOnClick:!1}).setLngLat(e).setDOMContent(this.popupElement).addTo(t.map).setOffset(12),this.popup._container.style["margin-bottom"]="10px"},this.removePopup=function(){return!(!this.popup||!this.popup.remove)&&this.popup.remove()},this.handleMove=function(t){},this.handleClick=function(o){if(t.noSelect)return!1;var a=t.getRenderedDrawnFeatures(o.lngLat);if(e=[o.lngLat.lng,o.lngLat.lat],n=o.originalEvent&&o.originalEvent.shiftKey&&t.options.select.multiple,a.length>0){if(!t.Layers.getSelection(a,e))return;c.call(this,a)}else n||(r=[],s=[],e=!1,i=!1,this.deselectCurrentFeature())},this.handleDrag=function(t){}}function x(t){function e(e,i,r){var o,s=t.currentMode.cancelled;if(t.editMode&&!t.currentMode.savingEdit&&!s)return t.currentMode.saveEdit(i);if(s||!e)return n(),t.hotFeature&&(t.removeSelection(),t.removeFeature(t.hotFeature.id,!0),t.addFeatures([t.hotFeature],!0)),t.Pinning.resetFeatures(),t.editMode||t.fire("draw.cancel",{cancel:!0,feature:t.hotFeature}),!1;if("Text"===e&&!r)return a.call(t.currentMode,e,i);if(t.hotFeature){if(t.Utilities.isPoint(t.hotFeature,e)){var u=Array.isArray(t.hotFeature.geometry.coordinates[0])?t.hotFeature.geometry.coordinates[0]:[t.hotFeature.geometry.coordinates[0],t.hotFeature.geometry.coordinates[1]];o=i=t.Painting.enabled||t.currentMode.savingEdit?i:turf.point(u)}else t.Utilities.isPolygon(t.hotFeature,e)?(t.hotFeature.geometry.type="Polygon","Rectangle"===e?t.endPoint&&c(t.hotFeature,"0.2",t.endPoint[0],t.endPoint[1]):(t.hotFeature.geometry.coordinates.push(t.hotFeature.geometry.coordinates[0]),t.hotFeature.geometry.coordinates=[t.hotFeature.geometry.coordinates])):t.Utilities.isLineString(t.hotFeature,e)?"Polygon"===e?(t.hotFeature.geometry.type=e,t.hotFeature.geometry.coordinates.push(t.hotFeature.geometry.coordinates[0]),t.hotFeature.geometry.coordinates=[t.hotFeature.geometry.coordinates]):"Rectangle"===e&&t.endPoint&&c(t.hotFeature,"0.2",t.endPoint[0],t.endPoint[1]):i&&(o=i);if(t.Painting.enabled){var l=t.options.painting.tolerance;t.hotFeature="Circle"===e?t.hotFeature:turf.simplify(t.hotFeature,{mutate:!0,tolerance:"function"==typeof l?l(t.map):l,highQuality:!0}),t.startPoint&&(t.hotFeature.geometry.coordinates[0]=t.startPoint)}}else i&&(o=i);return(o=t.Exploring.currentFeature||o||t.hotFeature)&&t.currentMode.activated?(o=t.Features.addFeature(o,t.currentMode.properties),t.fire("draw.finish",{feature:o,pinned:t.Pinning.getFeatures(),type:e,editing:t.editMode}),t.currentMode.deactivate()):t.currentMode.deactivate()}function n(n,i,r){var o=t.textMarker;if(!o)return!1;var s=o.getElement(),c=s.value;if(!c.length||t.currentMode.cancelled)return o.remove(),t.textInput=!1,a.call(this,i,r);var u=[s.getAttribute("lng"),s.getAttribute("lat")];i=i||s.getAttribute("type"),t.currentMode.properties.text=c;r={type:"Feature",properties:{type:i,text:c},geometry:{type:"Point",coordinates:u}};o.remove(),e(i,r,c)}function i(e){var n,i=t.hotFeature;if(t.dragMoving)return!1;if(!i)return!1;var r=t.Snapping.getClosest(e.geometry.coordinates),o=r.coords,s=!!r.point&&r.point.type;if(!s)return!1;if(!o&&"linepoint"===s&&r.point.borders){var a=turf.lineString([r.point.border1,r.point.border2]);o=(n=turf.along(a,r.point.distance1)).geometry.coordinates}return!!o&&((n=t.Utilities.isLineString(i)&&"vertex"===s?turf.pointOnLine(i,turf.point(o)):turf.point(o)).properties.type=s,t.fire("vertex.find",{vertex:n,feature:t.hotFeature,closest:r}),n)}function r(e,n){var i;if(n&&e){var r=t.hotFeature.geometry.coordinates,o=turf.lineString(r),s=turf.point(r[0]),a=turf.lineSlice(s,e,o),c=a.geometry.coordinates.length-1,u=a.geometry.coordinates[c];e=turf.point(u),o.geometry.coordinates.splice.apply(o.geometry.coordinates,[c,0].concat([u])),o=turf.cleanCoords(o),i=turf.truncate(o,{precision:6,coordinates:2,mutate:!0}),t.hotFeature.geometry.coordinates=i.geometry.coordinates,t.hotFeature=t.Utilities.cloneDeep(t.hotFeature)}else e&&(t.canDragMove=!0,t.canAddVertex=e);return e}function o(e,n){var i,o=t.hotFeature;if(t.dragMoving)return s();if(!o||!e)return s();t.updateMeshData();var a=e.properties.type;if(i=e.properties.index||0==e.properties.index?e.properties.index:"Circle"===t.currentMode.type&&0,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([e])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),"linepoint"===a)return r(e);t.map.dragPan.disable(),t.dragIndex=i,t.addedVertexOnLine=!!n&&e,t.canAddVertex=!1,t.canDragMove=!0,t.snappedVertex=e.geometry.coordinates,t.Pinning.setFeatures(t.snappedVertex),t.fire("vertex.on",{vertex:e,index:i,feature:t.hotFeature})}function s(){if(t.hotFeature){if(t.mouseIsDown&&t.Painting.enabled)return!1;t.snappedVertex&&(t.lastIndex&&(t.lastClick={coords:t.snappedVertex}),t.fire("vertex.off",{vertex:!1,index:t.dragIndex,feature:t.hotFeature})),t.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.snappedVertex=null,t.dragIndex=-1,t.mouseIsDown=t.touchDown||!1,t.pinableFeatures=[],t.lastIndex=!1,t.canAddVertex=!1,t.addedVertexOnLine=!1}}function a(e,i){if(!(i=i||t.hotFeature))return!1;if(e=e||i.properties.type,i.properties.type=e,"Text"!==e)return t.Features.setText(i);if(t.textInput)return n(0,e,i);var r={lng:i.geometry.coordinates[0],lat:i.geometry.coordinates[1]},o=t.textInput=document.createElement("input");o.value=i.properties.text||"",o.className="text-marker",o.setAttribute("contenteditable","true"),o.setAttribute("autocorrect","off"),o.setAttribute("spellcheck","false"),o.setAttribute("placeholder","Press Enter or Select Button When Done..."),o.setAttribute("type",e),o.setAttribute("lng",r.lng),o.setAttribute("lat",r.lat),t.textMarker=new t.Mapbox.Marker(o).setLngLat(r).addTo(t.map),t.textMarker.setOffset([0,-25]),o.addEventListener("submit",n),o.addEventListener("keydown",(function(t){[32,37,38,39,40].indexOf(t.keyCode)>-1?t.stopPropagation():13===t.keyCode&&(t.preventDefault(),n())})),o.addEventListener("paste",(function(t){var e,n;t.stopImmediatePropagation(),t.preventDefault(),e=t.clipboardData||window.clipboardData,n=e.getData("text/plain").slice(0,CHAR_LIMIT),t.target.innerText=n})),o.focus(),t.fire("text.add",{feature:i,marker:t.textMarker,type:e})}function c(t,e,n,i){var r=e.split("."),o=parseInt(r[0],10),s=parseInt(r[1],10);void 0===t.geometry.coordinates[o]&&(t.geometry.coordinates[o]=[]),t.geometry.coordinates[o][s]=[n,i]}this.id="draw",this.canHandle=function(e){return t.statics.constants.modes.DRAW===e},this.activate=function(e={}){if(this.activated)return!1;if(t.currentMode.id!==this.id)return e.mode=this.id,t.setMode(e);this.activated=!0,this._handleHistory=this.handleHistory.bind(this),this.history=[],this.undo=[],e.feature&&(e.type=function(e){var n=t.Features.getType(e);if(!n)return alert("No Feature Type Found");t.currentMode.type=n,t.editMode=!0,t.hotFeature=e,t.Utilities.setProperty(t.hotFeature,"type",n),t.Utilities.setProperty(t.hotFeature,"edit",!0),t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),"Polygon"===n?t.hotFeature=turf.polygonToLine(t.hotFeature):"Circle"===n?t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])):"Text"===n?(t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([t.hotFeature])),a.call(t.currentMode,n,t.hotFeature)):(t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])));var i=t.Utilities.isPoint(t.hotFeature,n)?t.hotFeature.geometry.coordinates:t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1];return t.lastClick={coords:i},t.Features.removeFeatures(t.hotFeature.properties.id),t.refreshMeshData(),t.currentMode.type}(e.feature)),t.drawMode=!t.editMode;var n=e.lngLat;delete e.lngLat;var i=this.type=e.type,r=e.feature?e.feature.properties:e;this.properties=t.Utilities.cloneDeep(r),delete this.properties.mode;const o=e.id||r.id||URL.createObjectURL(new Blob([])).slice(-36);return this.properties.id=o,this.properties.type=i,this.properties.style={},t.setButtons(),t.setActiveButton(i),t.Utilities.isPoint(t.hotFeature,i)&&(this.isPoint=!0),t.fire("draw.activate",{id:o,type:i,activated:this.activated,editing:t.editMode,feature:t.hotFeature||e.feature,properties:this.properties}),t.on("source.hot",this._handleHistory),n&&this.handleMove({lngLat:n}),(t.options.painting.enable||t.mobile&&"Rectangle"===i)&&t.activatePainting(),this.updateHotSource(),this},this.deactivate=function(e,n,i){if(!this.activated)return!1;var r;e&&this.cancelEdit(n,i),r=this,t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([])),t.deleteMeshData(),r.history=[],r.undo=[],r.type=null,r.cancelled=!1,r.activated=!1,r.savingEdit=!1,t.editMode=!1,t.drawMode=!1,delete t.startPoint,delete t.lastClick,delete t.firstClick,delete t.endPoint,delete t.snapFeature,delete t.hotFeature,delete t.drawStarted,delete t.dragMoving,delete t.editing,delete t.textMarker,delete t.textInput,delete t.touchMoving,delete t.touchDown,delete t.pinningFeatures,delete t.pinnedFeatures,delete t.canDragMove,delete t.canAddVertex,delete t.dragIndex,delete t.addedVertexOnLine,delete t.snappedVertex,t.setButtons(),t.off("source.hot",this._handleHistory),t.fire("draw.deactivate",{activated:this.activated}),t.options.repeatDraw?this.activate(this.properties):t.setMode()},this.updateHotSource=function(e,n){if(e&&(t.hotFeature=e),t.hotFeature&&!t.overpassDownloading)return t.hotFeature.properties=t.Utilities.assignDeep(t.hotFeature.properties,n||{}),t.hotFeature.properties.style=t.hotFeature.properties.style||{},t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.hotFeature},this.deleteVertex=function(e){if(t.hotFeature){const n=t.hotFeature.geometry.coordinates;e=void 0!==e?e:n.length-1,n.length>1&&(n.splice(e,1),t.lastClick={coords:n[n.length-1]},n.length>0?t.snapFeature=turf.point(n[n.length-1]):t.snapFeature=null,n.length>1?t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])):(t.hotFeature=null,t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([]))),t.fire("vertex.delete",{coords:n,index:e,feature:t.hotFeature})),t.lastMouseEvent&&t.currentMode.handleMove&&t.currentMode.handleMove(t.lastMouseEvent)}else t.snapFeature&&(t.snapFeature=null,t.lastClick=null,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])))},this.getFeature=function(){return t.hotFeature},this.selectFeature=function(e){return!!e&&(t.setMode(),t.currentMode.selectFeature(e))},this.saveEdit=function(n){var i=t.hotFeature;if(!i)return!1;var r=i.properties.type||n.properties.type||this.type;return n=n||i,this.savingEdit=!0,e(r,n)},this.cancelEdit=function(n,i){return this.cancelled=!0,i&&i.properties.type?(this.standby=n,t.hotFeature=i,t.fire("draw.cancel",{feature:i}),e()):(t.hotFeature=null,e())},this.handleDown=function(e){if(t.mouseIsDown=[e.lngLat.lng,e.lngLat.lat],e.touch&&(t.touchDown=!0,o(i(turf.point(t.mouseIsDown)))),t.canAddVertex)return o(i(r(t.canAddVertex,e)),!0);t.Pinning.setFeatures(t.snappedVertex),function(){var e=setInterval((function(){t.mouseIsDown?(t.lastDragMove+=1,t.lastDragMove<t.options.pinning.idle?t.mouseIsIdle=!1:(t.mouseIsIdle=!0,t.Snapping.setVertex(),t.Pinning.updateFeatures())):(t.lastDragMove=0,t.mouseIsIdle=!1,clearInterval(e))}),1)}()},this.handleUp=function(n){if(t.mouseIsDown=!1,t.touchDown=!1,t.Painting.enabled)return t.Painting.handleUp(n);if(!t.addedVertexOnLine||t.dragMoving){if(n.touch&&t.touchMoving)return t.dragMoving=!1;if(t.Utilities.isPoint(t.hotFeature,this.type)&&t.snappedVertex)return t.editMode?this.saveEdit():e(this.type);if(t.snappedVertex&&t.dragMoving&&!t.mapMoving&&"Rectangle"!==this.type){t.gamepadDrag=n.gamepad;var r=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);r=r||!(!t.Utilities.isPolygon(t.hotFeature)||0!=t.dragIndex);var s=t.Utilities.getLastIndexCoords(t.hotFeature);o(i(turf.point(t.snappedVertex))),this.updateHotSource(),r&&setTimeout((function(){t.lastClick={coords:s}}),100)}t.pinableFeatures=[],t.mouseIsIdle=!1,a.call(this,this.type),t.refreshMeshData()}},this.handleClick=function(n){if(n.finish)return t.editMode?this.saveEdit():e(this.type);if(n.touch&&t.touchMoving)return t.touchMoving=!1,t.Snapping.setFeature(),this.updateHotSource();if(n.touch&&(t.touchClick=!0),t.addedVertexOnLine)return t.Snapping.setFeature(),this.updateHotSource(),o(i(t.addedVertexOnLine)),this.handleDrag(n),t.dragMoving=!1,t.gamepadDrag=!1,t.mouseIsIdle=!1,n;if(t.gamepadDrag)return t.gamepadDrag=!1;if(!t.editMode||"Polygon"!==this.type&&"Text"!==this.type){this.firstClick||t.drawStarted?t.fire("vertex.add",{type:this.type,coords:[n.lngLat.lng,n.lngLat.lat]}):(t.drawStarted=!0,t.fire("draw.start",{type:this.type,editing:t.editMode,coords:[n.lngLat.lng,n.lngLat.lat]}));var r,s,c,u=t.closestPoint||{coords:[n.lngLat.lng,n.lngLat.lat]},l=turf.point(u.coords);if(l.properties=this.properties,t.lastMove=u.coords.length>1&&{lat:u.coords[u.coords.length-1][1],lng:u.coords[u.coords.length-1][0]},!t.startPoint){if("Rectangle"===this.type)return t.startPoint=u.coords,t.hotFeature=turf.polygon([[t.startPoint,[n.lngLat.lng,n.lngLat.lat],[t.startPoint[0],n.lngLat.lat],t.startPoint]]),t.Utilities.setProperty(t.hotFeature,"type",this.type);"Polygon"===this.type&&(t.startPoint=u.coords)}return!t.snapFeature&&u&&(t.snapFeature=u),r=this.type,s=u.coords,c=["Circle","Icon","Text"],!r||c.includes(r)||("Rectangle"===r&&t.startPoint?(t.endPoint=s,1):"Polygon"===r&&t.snappedVertex&&t.startPoint&&t.Utilities.isPointEqual(t.startPoint,t.snappedVertex)||t.snappedVertex&&t.Utilities.isLastIndex(t.dragIndex,t.hotFeature)||t.lastClick&&t.Utilities.isPointEqual(t.lastClick.coords,s))?e(this.type,l):(this.firstClick=!t.firstClick&&{coords:u.coords},t.lastClick=u,t.firstClick=t.firstClick?t.firstClick:{coords:u.coords},t.Snapping.setFeature(),a.call(this,this.type),t.Exploring.setFeatures(u.coords,{set:!0}),delete t.touchClick,this.updateHotSource())}},this.handleMove=function(e){if(e.touch&&t.mouseIsDown&&(t.touchMoving=!0),t.overpassDownloading)return!1;if(t.mouseIsDown&&t.canAddVertex)return!1;if(t.canDragMove&&t.snappedVertex&&t.mouseIsDown)return this.handleDrag(e);if(t.mouseIsDown&&t.Painting.enabled)return this.handlePainting(e);if(e.touch&&t.touchMoving)return t.snapFeature=!1;if(1===(!!e.originalEvent&&(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which)))return!1;var n=t.Routing.enabled;e.originalEvent&&e.originalEvent.altKey&&(n=!1);var r=t.Snapping.enabled;e.originalEvent&&e.originalEvent.shiftKey&&(r=!1);var s=[e.lngLat.lng,e.lngLat.lat],a=t.Utilities.isPoint(t.hotFeature,this.type),c=t.editMode&&("Polygon"===this.type||"Rectangle"===this.type),u=turf.point(s),l=null;return c?l=u:r?l=t.Snapping.setClosest(s,a):a?a&&(l=u):l=t.Snapping.updateFeature(s),n&&(l=t.Routing.getClosest()||l),l||(l=u),t.Snapping.addFeature(l,this.properties,c),o(i(u)),!l&&this.isPoint&&delete this.isPoint,c&&n&&t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),"Rectangle"===this.type?this.handleRectangle(e):"Icon"===this.type?this.handleIcon(e,t.snapFeature):"Text"===this.type?this.handleText(e,t.snapFeature):void 0},this.handleDrag=function(e){if(!(t.dragIndex>-1))return s(),t.mouseIsDown&&t.Painting.enabled&&this.handlePainting(e),!1;!e.gamepad&&e.originalEvent.stopPropagation(),t.dragMoving=!0,t.lastDragMove=0,t.snappedVertex=[e.lngLat.lng,e.lngLat.lat],t.bypassRouting=!0,t.bypassSnapping=!e.gamepad&&e.originalEvent.shiftKey,t.lastIndex=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);var n=turf.point(t.snappedVertex);if(t.lastIndex&&(t.lastClick={coords:t.snappedVertex}),"Circle"===this.type||"Icon"===this.type)t.Painting.enabled||(t.hotFeature.geometry.coordinates=t.snappedVertex);else{var i=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);t.hotFeature.geometry.coordinates[t.dragIndex]=t.snappedVertex,"Polygon"===this.type&&(i&&(t.hotFeature.geometry.coordinates[0]=t.snappedVertex),0==t.dragIndex&&(t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1]=t.snappedVertex))}t.Utilities.setProperty(t.hotFeature,"type",this.type),t.Utilities.setProperty(n,"type",this.type),t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([n])),t.fire("vertex.drag",{type:this.type,coords:[e.lngLat.lng,e.lngLat.lat],feature:t.hotFeature,vertex:n}),t.Pinning.updateFeatures()},this.handleTouch=function(t){t.touch=!0,"touchstart"===t.type?this.handleDown(t):"touchend"===t.type?(this.handleUp(t),this.handleClick(t)):"touchmove"===t.type&&this.handleMove(t)},this.handleOffMap=function(e){t.map.getSource(t.statics.constants.sources.SNAP)&&t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))},this.handleOnMap=function(e){t.map.getSource(t.statics.constants.sources.SNAP)&&t.snapFeature&&t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([t.snapFeature]))},this.handlePainting=function(e){if(!t.mouseIsDown)return!1;t.map.dragPan.disable(),t.setMapClass("painting");var n=t.snapFeature&&!t.Painting.feature,i=!(!e.lngLat||!e.lngLat.lng)&&[e.lngLat.lng,e.lngLat.lat];return n&&(i=t.snapFeature.geometry.coordinates),!!i&&t.Painting.updateFeature(i)},this.handleRectangle=function(e){if(t.editMode&&t.hotFeature&&(t.startPoint=t.hotFeature.geometry.coordinates[0][0]),t.startPoint){t.dragMoving||t.Utilities.setProperty(t.hotFeature,"type",this.type),t.dragMoving=!0;var n=t.snapFeature?t.snapFeature.geometry.coordinates:[e.lngLat.lng,e.lngLat.lat];if(t.dragIndex>-1){var i=0==t.dragIndex||4==t.dragIndex?4:t.dragIndex,r=1==i?3:2==i?4:3==i?1:2,o=1==r?4:2==r?1:3==r?2:3,s=1==o?3:2==o?4:3==o?1:2;c(t.hotFeature,"0."+i,n[0],n[1]),c(t.hotFeature,"0."+o,n[0],t.startPoint[1]),c(t.hotFeature,"0."+s,t.startPoint[0],n[1]),c(t.hotFeature,"0."+r,t.startPoint[0],t.startPoint[1])}else c(t.hotFeature,"0.1",n[0],t.startPoint[1]),c(t.hotFeature,"0.2",n[0],n[1]),c(t.hotFeature,"0.3",t.startPoint[0],n[1]),c(t.hotFeature,"0.4",t.startPoint[0],t.startPoint[1]);t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature]))}},this.handleText=function(t,e){},this.handleIcon=function(t,e){},this.handleContext=function(e){t.canDragMove&&t.snappedVertex&&(t.dragIndex>-1&&(t.hotFeature.geometry.coordinates.splice(t.dragIndex,1),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))))},this.handleHistory=function(e){if(!t.dragMoving){var n=t.currentMode.history,i=new Date,r=e.detail.data.features;if(r&&r.length){var o=t.Utilities.cloneDeep(r[0]);o.historyDate=i,n.push(o),t.fire("feature.history",{type:t.currentMode.type,feature:o,history:n})}}},this.handleUndo=function(){return alert("UNDER DEVELOPMENT")},this.handleRedo=function(){return alert("UNDER DEVELOPMENT")}}function E(t){this.init=function(t){}}const C=function(t,e){function n(e,n,r,o){const s=function(t,e){const n=[],r={},o=function(t,e){function n(t,e){return new i(t,e)}function i(t,e){var n={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254};if(void 0===t)throw new Error("No latitude given.");if(e&&!n[e])throw new Error("Unknown unit "+e+". Use one of: "+Object.keys(n));var i=e?n[e]:1,r=Math.cos(t*Math.PI/180),o=2*r*r-1,s=2*r*o-r,a=2*r*s-o,c=2*r*a-s;this.kx=i*(111.41513*r-.09455*s+12e-5*c),this.ky=i*(111.13209-.56605*o+.0012*a)}return n.fromTile=function(t,e,n){var r=Math.PI*(1-2*(t+.5)/Math.pow(2,e));return new i(180*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))/Math.PI,n)},n.units={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},i.prototype={equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},interpolate:function(t,e,n){var i=e[0]-t[0],r=e[1]-t[1];return[t[0]+i*n,t[1]+r*n]},distance:function(t,e){var n=(t[0]-e[0])*this.kx,i=(t[1]-e[1])*this.ky;return Math.sqrt(n*n+i*i)},bearing:function(t,e){var n=(e[0]-t[0])*this.kx,i=(e[1]-t[1])*this.ky;if(!n&&!i)return 0;var r=180*Math.atan2(-i,n)/Math.PI+90;return r>180&&(r-=360),r},destination:function(t,e,n){var i=(90-n)*Math.PI/180;return this.offset(t,Math.cos(i)*e,Math.sin(i)*e)},offset:function(t,e,n){return[t[0]+e/this.kx,t[1]+n/this.ky]},lineDistance:function(t){for(var e=0,n=0;n<t.length-1;n++)e+=this.distance(t[n],t[n+1]);return e},area:function(t){for(var e=0,n=0;n<t.length;n++)for(var i=t[n],r=0,o=i.length,s=o-1;r<o;s=r++)e+=(i[r][0]-i[s][0])*(i[r][1]+i[s][1])*(n?-1:1);return Math.abs(e)/2*this.kx*this.ky},along:function(t,e){var n=0;if(e<=0)return t[0];for(var i=0;i<t.length-1;i++){var r=t[i],o=t[i+1],s=this.distance(r,o);if((n+=s)>e)return this.interpolate(r,o,(e-(n-s))/s)}return t[t.length-1]},pointOnLine:function(t,e){for(var n,i,r,o,s=1/0,a=0;a<t.length-1;a++){var c=t[a][0],u=t[a][1],l=(t[a+1][0]-c)*this.kx,d=(t[a+1][1]-u)*this.ky;if(0!==l||0!==d){var p=((e[0]-c)*this.kx*l+(e[1]-u)*this.ky*d)/(l*l+d*d);p>1?(c=t[a+1][0],u=t[a+1][1]):p>0&&(c+=l/this.kx*p,u+=d/this.ky*p)}var h=(l=(e[0]-c)*this.kx)*l+(d=(e[1]-u)*this.ky)*d;h<s&&(s=h,n=c,i=u,r=a,o=p)}return{point:[n,i],index:r,t:o}},lineSlice:function(t,e,n){var i=this.pointOnLine(n,t),r=this.pointOnLine(n,e);if(i.index>r.index||i.index===r.index&&i.t>r.t){var o=i;i=r,r=o}var s=[i.point],a=i.index+1,c=r.index;!this.equals(n[a],s[0])&&a<=c&&s.push(n[a]);for(var u=a+1;u<=c;u++)s.push(n[u]);return this.equals(n[c],r.point)||s.push(r.point),s},lineSliceAlong:function(t,e,n){for(var i=0,r=[],o=0;o<n.length-1;o++){var s=n[o],a=n[o+1],c=this.distance(s,a);if((i+=c)>t&&0===r.length&&r.push(this.interpolate(s,a,(t-(i-c))/c)),i>=e)return r.push(this.interpolate(s,a,(e-(i-c))/c)),r;i>t&&r.push(a)}return r},bufferPoint:function(t,e){var n=e/this.ky,i=e/this.kx;return[t[0]-i,t[1]-n,t[0]+i,t[1]+n]},bufferBBox:function(t,e){var n=e/this.ky,i=e/this.kx;return[t[0]-i,t[1]-n,t[2]+i,t[3]+n]},insideBBox:function(t,e){return t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}},n(t,e)}(e[1]);return t.forEach((t=>{const s=t.id||t.properties.id;if(void 0===r[s]){r[s]=!0;const a=t.geometry.type;if("LineString"===a)t.geometry.coordinates&&i(o,t.geometry.coordinates,e).forEach((t=>{t.id=s,t.dist=o.distance(t.coords,e),n.push(t)}));else if("Point"===a){const i={id:s,type:"vertex",coords:t.geometry.coordinates,lineEdge:!0};i.dist=o.distance(i.coords,e),n.push(i)}else if("Polygon"===a){if(turf.booleanWithin(turf.point(e),t))return;t.geometry.coordinates.forEach(((t,r)=>{i(o,t,e).forEach((t=>{t.id=s,t.polygonCoordsArray=r,t.dist=o.distance(t.coords,e),n.push(t)}))}))}}})),n}(e,n);let a,c=null,u=null,l=t.id||"id";return s.forEach((t=>{const e=t.dist;null!==e&&("vertex"===t.type?null===c?c=t:void 0!==o?1e3*e<o&&c&&c.lineEdge&&(c=t):e<=c.dist&&(e===c.dist?c.lineEdge&&(c=t):c=t):e<r&&(null!==u&&e===u.dist&&u[l]!==t[l]&&"linepoint"===u.type&&(t.distance1<=u.distance1&&t.distance2<=u.distance2||t.distance2<=u.distance1&&t.distance1<=u.distance2)&&(u=t),(null===u||e<u.dist)&&(u=t,a=t.border1&&t.border2?{border1:t.border1,border2:t.border2,distance1:t.distance1,distance2:t.distance2}:null)))})),null!==c?null!==u?c.dist<r?Object.assign({borders:null},c):Object.assign({borders:a},u):Object.assign({borders:null},c):null!==u?Object.assign({borders:a},u):null}function i(t,e,n){const i=[],r=t.pointOnLine(e,n),o=r.point,s=r.index,a={type:"linepoint",coords:o},c=e[s],u=e[s+1],l=t.distance(c,n),d=t.distance(u,n);let p=!1,h=null;return l<d?(p=0===s,h=c):(p=s+1===e.length-1,h=u),a.border1=c,a.distance1=l,a.border2=u,a.distance2=d,i.push(a),i.push({type:"vertex",coords:h,lineEdge:p}),i}function r(e,n){return t.statics.constants.CIRCUM*Math.cos(e*(Math.PI/180))/Math.pow(2,n+8)}function o(e){return e?(t.Utilities.setProperty(e,"type",t.currentMode.type),t.Utilities.setProperty(e,"style",{primaryColor:t.options.colors.primarySnap,secondaryColor:t.options.colors.secondarySnap}),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([e])),e):(t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.snapFeature)}this.type=e.type,this.activate=function(){this.enabled=!0,t.options.snapping.enable=!0},this.deactivate=function(){this.enabled=!1,t.options.snapping.enable=!1,t.updateMeshData([],!0)},this.getClosest=function(e,i){var o=t.options.snapping.distance*Math.pow(2,Math.max(1,19-t.map.getZoom()))/1e5,s=!!t.options.snapping.pixels&&t.options.snapping.pixels*r(e[1],t.map.getZoom()),a=n(i=i?t.getRenderedSnapFeatures({lng:e[0],lat:e[1]},o):[t.hotFeature],e,o,s);return{point:a,coords:e=!!a&&((s||"vertex"===a.type&&a.dist<=o)&&a.coords)}},this.setClosest=function(e,i,o){var s,a=null,c=t.options.snapping.distance*Math.pow(2,Math.max(1,19-t.map.getZoom()))/1e5,u=!!t.options.snapping.pixels&&t.options.snapping.pixels*r(e[1],t.map.getZoom()),l=!(!t.pinableFeatures||!t.pinableFeatures.length)&&["case",["any",...t.pinableFeatures.map((t=>["==",["get","id"],t.id||t.properties.id]))],!1,!0],d=t.getRenderedFeatures({lng:e[0],lat:e[1]},c,l),p=!(!d||!d.length)&&n(d,e,c,u);if(t.closestPoint=p,!d&&!i||!p&&!i)return this.updateFeature(e);if(!p||!p.coords)return a;if(o||!t.lastClick)a=turf.point(p.coords);else{if(Array.isArray(t.lastClick.coords)&&Array.isArray(t.lastClick.coords[0])&&(t.lastClick.coords=t.lastClick.coords[0]),s=turf.distance(turf.point(e),turf.point(t.lastClick.coords)),t.Utilities.isPointEqual(t.lastClick.coords,p.coords)&&s>t.options.snapping.tolerance)return this.updateFeature(e);a=turf.lineString([t.lastClick.coords,p.coords])}return t.fire("snapping.add",{closest:p,snapped:a}),a},this.setFeature=function(e,n){if(t.touchClick)return null;if(!(e=e||t.snapFeature)&&n)return o(turf.point(n));if(!e)return t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),null;var i=e.geometry.coordinates,r=n||t.lastClick.coords,s=t.firstClick.coords,a="Polygon"===this.type;if(!("LineString"===e.geometry.type)||i.length<2)e=o(a?turf.lineString([s,r]):turf.point(r));else if(t.hotFeature){var c=t.hotFeature.geometry.coordinates;a&&i.pop(),c.splice.apply(c,[-1,1].concat(t.Utilities.consumableArray(i)))}else t.hotFeature=turf.lineString(i);return t.Utilities.setProperty(t.hotFeature,"type",this.type),t.Utilities.setProperty(t.hotFeature,"style",{primaryColor:t.options.colors.primaryHot,secondaryColor:t.options.colors.secondaryHot}),e=o(a?turf.lineString([s,r]):turf.point(r)),t.snapFeature=e,t.snapFeature},this.setVertex=function(){var e=t.Snapping.enabled;t.bypassSnapping&&(e=!1);var n=t.Routing.enabled;return t.bypassRouting&&(n=!1),!(!e||!t.snappedVertex)&&(t.snapFeature=this.setClosest(t.snappedVertex,!0,!0),n&&(t.snapFeature=t.Routing.getClosest()||t.snapFeature),t.snapFeature?(t.Utilities.setProperty(t.snapFeature,"type",t.currentMode.type),t.map.getSource(t.statics.constants.sources[n?"ROUTE":"SNAP"]).setData(turf.featureCollection([t.snapFeature])),t.hotFeature.geometry.coordinates[t.dragIndex]=t.snapFeature.geometry.coordinates,t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),void t.fire("vertex.dragsnap",{feature:t.hotFeature,vertex:turf.point(t.snappedVertex)})):t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])))},this.addFeature=function(e,n={},i){if(t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),!e||i)return!1;n&&(e.properties=t.Utilities.assignDeep(t.Utilities.cloneDeep(n),e.properties)),t.snapFeature=e,t.map.getSource(t.statics.constants.sources[e.properties.routing?"ROUTE":"SNAP"]).setData(turf.featureCollection([t.snapFeature]))},this.updateFeature=function(e){if(t.closestPoint=null,!t.lastClick)return null;if(!t.firstClick||t.mouseIsDown)return null;var n=t.Features.getType(t.hotFeature)||t.currentMode.type,i=t.hotFeature?t.Utilities.getLastIndexCoords(t.hotFeature):t.lastClick.coords,r=turf.point(e),o=n&&"Polygon"===n&&t.hotFeature?[i,e,t.firstClick.coords]:[i,e],s=turf.lineString(o);s.properties.type=n,s.properties.hint=!0,s.properties.style={primaryColor:t.options.colors.primarySnap,secondaryColor:t.options.colors.secondarySnap};var a="feet",c=t.Features.getUnits(s);return r=function(e,n={}){var i=t.map.getSource(t.statics.constants.sources.HOTTEXT)._data.features;i.length&&i[i.length-1].properties.mouseLine&&i.pop();return e.properties.units=n.units,e.properties.unit=n.unit,e.properties.text=`${n.units} ${n.unit}`,e.properties.transform="uppercase",e.properties.anchor="bottom-left",e.properties.mouseLine=!0,i.push(e),t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection(i)),e}(r,{units:c=t.Features.convertUnits(s,c,a),unit:a}),s},t.options.snapping.enable&&this.activate()},M=function(t,e){function n(e){if(!e||!e.length)return!1;e.forEach((function(e){this.updatedFeatures.find((function(t){return t.id===e.id}))||this.updatedFeatures.push(t.Utilities.cloneDeep(e.feature))}),this)}this.type=e.type,this.updatedFeatures=[],this.activate=function(){this.updatedFeatures=[],this.enabled=!0,t.options.pinning.enable=!0},this.deactivate=function(){this.enabled=!1,t.options.pinning.enable=!1,this.resetFeatures(),delete this.buffer,delete t.pinableFeatures,delete t.pinningFeatures,this.updatedFeatures=[]},this.getFeatures=function(){return t.pinnedFeatures&&t.pinnedFeatures.length?t.pinnedFeatures.map((function(t){return t.feature})):[]},this.setBuffer=function(e){if(delete this.buffer,!this.enabled)return!1;if(!e||!t.options.pinning.buffer)return!1;var n=turf.buffer(turf.point(e),t.options.pinning.buffer),i=turf.polygon(n.geometry.coordinates);return this.buffer={feature:n,radius:i,coords:e},this.buffer},this.setFeatures=function(e){return t.pinableFeatures=[],!(!this.enabled||!e)&&(t.pinableFeatures=this.getNearByFeatures(e),t.fire("pinning.add",{features:t.pinableFeatures,buffer:this.buffer}),t.pinableFeatures)},this.resetFeatures=function(){if(!this.updatedFeatures.length)return!1;t.addFeatures(this.updatedFeatures,!0)},this.updateFeatures=function(){return!!this.enabled&&(t.pinableFeatures&&t.pinableFeatures.length?(n.call(this,t.pinableFeatures),t.Features.updateFeatures(t.pinableFeatures,t.snappedVertex),t.pinnedFeatures=t.Utilities.cloneDeep(t.pinableFeatures),t.fire("pinning.update",{feature:t.hotFeature,vertex:turf.point(t.snappedVertex),features:t.pinnedFeatures}),t.pinningFeatures):(delete t.pinningFeatures,!1))},this.getNearByFeatures=function(e){if(!this.enabled||!e)return!1;var n=t.hotFeature,i=t.options.snapping.distance*Math.pow(2,Math.max(1,19-t.map.getZoom()))/1e5,r=this.setBuffer(e),o=t.getRenderedDrawnFeatures({lng:e[0],lat:e[1]},i),s=[];return o.forEach((function(e){turf.coordEach(e,(function(i,o){var a=!1;r.radius&&turf.booleanWithin(turf.point(i),r.radius)&&(a=!0),!a&&r.coords&&t.Utilities.isPointEqual(i,r.coords)&&(a=!0),a&&(n&&n.id===e.id||s.push({id:e.id||e.properties.id,type:e.properties.type,index:o,feature:e}))}))})),s},t.options.pinning.enable&&this.activate()},S=function(t,e){function n(t,e){if(e=e||{},t.compactedVertices||(t=function(t,e){var n;e=e||{};var i=e.weightFn||function(t,e){return turf.distance(turf.point(t),turf.point(e))};"FeatureCollection"===t.type?n=function(t,e){e=e||{};var n=e.keyFn||function(t){return t.join(",")},i=e.precision||1e-5,r=function(t,e){var n=[];"FeatureCollection"===t.type&&(n=n.concat(t.features.filter(e)));return{type:"FeatureCollection",features:n}}(t,a),c=turf.explode(r).features.reduce((function(t,r,s,a){var c=o(r.geometry.coordinates,i);return t[n(c)]=r.geometry.coordinates,s%1e3==0&&e.progress&&e.progress("topo:vertices",s,a.length),t}),{}),u=s(r,(function(t,r,s,a){return r.geometry.coordinates.forEach((function(e,s,a){if(s>0){var c=n(o(a[s-1],i)),u=n(o(e,i));t.push([c,u,r.properties])}})),s%1e3==0&&e.progress&&e.progress("topo:edges",s,a.length),t}),[]);return{vertices:c,edges:u}}(t,e):t.edges&&(n=t);t=n.edges.reduce((function(t,r,o,s){var a=r[0],c=r[1],u=r[2],l=i(n.vertices[a],n.vertices[c],u),d=function(n){t.vertices[n]||(t.vertices[n]={},e.edgeDataReduceFn&&(t.edgeData[n]={}))},p=function(n,i,r){t.vertices[n][i]=r,e.edgeDataReduceFn&&(t.edgeData[n][i]=e.edgeDataReduceFn(e.edgeDataSeed,u))};return l&&(d(a),d(c),l instanceof Object?(l.forward&&p(a,c,l.forward),l.backward&&p(c,a,l.backward)):(p(a,c,l),p(c,a,l))),o%1e3==0&&e.progress&&e.progress("edgeweights",o,s.length),t}),{edgeData:{},vertices:{}});var c=function(t,e,n,i){i=i||{};var o=i.progress,s=Object.keys(t).reduce((function(e,n,r,s){var a,c=t[n],u=Object.keys(c),l=u.length;if(!1===i.compact)a=!1;else if(1===l){a=!t[u[0]][n]}else a=2===l&&u.filter((function(e){return t[e][n]})).length===l;return a||(e[n]=c),r%1e3==0&&o&&o("compact:ends",r,s.length),e}),{});return Object.keys(s).reduce((function(a,c,u,l){var d=r(c,t,s,e,n,!1,i);return a.graph[c]=d.edges,a.coordinates[c]=d.coordinates,i.edgeDataReduceFn&&(a.reducedEdges[c]=d.reducedEdges),u%1e3==0&&o&&o("compact:nodes",u,l.length),a}),{graph:{},coordinates:{},reducedEdges:{}})}(t.vertices,n.vertices,t.edgeData,e);return{vertices:t.vertices,edgeData:t.edgeData,sourceVertices:n.vertices,compactedVertices:c.graph,compactedCoordinates:c.coordinates,compactedEdges:e.edgeDataReduceFn?c.reducedEdges:null}}(t,e)),this._graph=t,this._keyFn=e.keyFn||function(t){return t.join(",")},this._precision=e.precision||1e-5,this._options=e,0===Object.keys(this._graph.compactedVertices).filter((function(t){return"edgeData"!==t})).length)return null;this.findPath=function(t,e){var n=this._keyFn(o(t.coords,this._precision)),r=this._keyFn(o(e.coords,this._precision));if(!this._graph.vertices[n]||!this._graph.vertices[r])return null;this._createPhantom(n),this._createPhantom(r);var s=function(t,e,n){var r={};r[e]=0;var o=[0,[e],e],s=new i([o],(function(t,e){return t[0]-e[0]}));for(;s.length;){var a=s.pop(),c=a[0],u=a[2];if(u===n)return a.slice(0,2);var l=t[u];Object.keys(l).forEach((function(t){var e=c+l[t];if(!(t in r)||e<r[t]){r[t]=e;var n=[e,a[1].concat([t]),t];s.push(n)}}))}return null}(this._graph.compactedVertices,n,r);if(s){var a=s[0];return{fullPath:s=s[1],path:s.reduce(function(t,e,n,i){return n>0&&(t=t.concat(this._graph.compactedCoordinates[i[n-1]][e])),t}.bind(this),[]).concat([this._graph.sourceVertices[r]]),weight:a,edgeDatas:this._graph.compactedEdges?s.reduce(function(t,e,n,i){return n>0&&t.push({reducedEdge:this._graph.compactedEdges[i[n-1]][e]}),t}.bind(this),[]):void 0}}return null},this.serialize=function(){return this._graph},this._createPhantom=function(t){if(this._graph.compactedVertices[t])return null;var e=r(t,this._graph.vertices,this._graph.compactedVertices,this._graph.sourceVertices,this._graph.edgeData,!0,this._options);return this._graph.compactedVertices[t]=e.edges,this._graph.compactedCoordinates[t]=e.coordinates,this._graph.compactedEdges&&(this._graph.compactedEdges[t]=e.reducedEdges),Object.keys(e.incomingEdges).forEach(function(n){this._graph.compactedVertices[n][t]=e.incomingEdges[n],this._graph.compactedCoordinates[n][t]=[this._graph.sourceVertices[n]].concat(e.incomingCoordinates[n].slice(0,-1)),this._graph.compactedEdges&&(this._graph.compactedEdges[n][t]=e.reducedEdges[n])}.bind(this)),t},this._removePhantom=function(t){t&&(Object.keys(this._graph.compactedVertices[t]).forEach(function(e){delete this._graph.compactedVertices[e][t]}.bind(this)),Object.keys(this._graph.compactedCoordinates[t]).forEach(function(e){delete this._graph.compactedCoordinates[e][t]}.bind(this)),this._graph.compactedEdges&&Object.keys(this._graph.compactedEdges[t]).forEach(function(e){delete this._graph.compactedEdges[e][t]}.bind(this)),delete this._graph.compactedVertices[t],delete this._graph.compactedCoordinates[t],this._graph.compactedEdges&&delete this._graph.compactedEdges[t])}}function i(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=function(t,e){return t<e?-1:t>e?1:0}),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n);this.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},this.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},this.peek=function(){return this.data[0]},this._up=function(t){for(var e=this.data,n=this.compare,i=e[t];t>0;){var r=t-1>>1,o=e[r];if(n(i,o)>=0)break;e[t]=o,t=r}e[t]=i},this._down=function(t){for(var e=this.data,n=this.compare,i=this.length>>1,r=e[t];t<i;){var o=1+(t<<1),s=e[o],a=o+1;if(a<this.length&&n(e[a],s)<0&&(o=a,s=e[a]),n(s,r)>=0)break;e[t]=s,t=o}e[t]=r}}function r(t,e,n,i,r,o,s){s=s||{};var a=e[t];return Object.keys(a).reduce((function(a,c){var u=function(t,e,n,i,r,o,s,a){var c=n[t][e],u=n[e][t],l=[],d=[],p=a.edgeDataSeed;for(a.edgeDataReduceFn&&(p=a.edgeDataReduceFn(p,o[e][t]));!i[e];){var h=n[e];if(!h)break;var f=Object.keys(h).filter((function(e){return e!==t}))[0];if(c+=h[f],s){if(u+=n[f][e],d.indexOf(e)>=0){i[e]=n[e];break}d.push(e)}a.edgeDataReduceFn&&(p=a.edgeDataReduceFn(p,o[e][f])),l.push(r[e]),t=e,e=f}return{vertex:e,weight:c,reverseWeight:u,coordinates:l,reducedEdge:p}}(t,c,e,n,i,r,o,s),l=u.weight,d=u.reverseWeight;if(u.vertex!==t&&((!a.edges[u.vertex]||a.edges[u.vertex]>l)&&(a.edges[u.vertex]=l,a.coordinates[u.vertex]=[i[t]].concat(u.coordinates),a.reducedEdges[u.vertex]=u.reducedEdge),o&&!isNaN(d)&&(!a.incomingEdges[u.vertex]||a.incomingEdges[u.vertex]>d))){a.incomingEdges[u.vertex]=d;var p=[i[t]].concat(u.coordinates);p.reverse(),a.incomingCoordinates[u.vertex]=p}return a}),{edges:{},incomingEdges:{},coordinates:{},incomingCoordinates:{},reducedEdges:{}})}function o(t,e){return[Math.round(t[0]/e)*e,Math.round(t[1]/e)*e]}function s(t,e,n){return"FeatureCollection"===t.type?t.features.reduce((function(t,n){return s(n,e,t)}),n):e(n,t)}function a(t){return"LineString"===t.geometry.type}function c(t,e,n){return(!e||"linepoint"!==e.type)&&(!(!(n&&n.path&&n.path.length)||n.path.length<2)&&n)}this.type=e.type,this.graphData={},this.features=t.Features.getColdFeatures(),this.activate=function(){this.enabled=!0,t.options.routing.enable=!0},this.deactivate=function(){this.enabled=!1,t.options.routing.enable=!1,t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([]))},this.getRoute=function(e,i){if(!this.enabled||t.mapMoving)return!1;var r=new n(turf.featureCollection(this.getFeatures()),t.options.routing),o=!!r.findPath&&r.findPath(e,i);return o=c(e,i,o),t.fire("routing.add",{from:e,to:i,path:o}),o},this.getMatch=async function(e){var n=await t.Exploring.getMatch(e,{set:!0,start:t.startPoint});return n.properties.routing=!0,n},this.getClosest=function(){if(!t.closestPoint||!t.lastClick)return!1;var e=this.getRoute(t.lastClick,t.closestPoint);if(!e||!e.path)return!1;var n=turf.lineString(e.path);return n.properties.routing=!0,n},this.getFeatures=function(){return[t.meshIndex.getFeatures(),this.features].flat().filter((function(t){return"LineString"===t.geometry.type}))},t.options.routing.enable&&this.activate()},w=function(t,e){function n(t,e,n,i){var r=e.split("."),o=parseInt(r[0],10),s=parseInt(r[1],10);void 0===t.geometry.coordinates[o]&&(t.geometry.coordinates[o]=[]),t.geometry.coordinates[o][s]=[n,i]}this.type=e.type,this.feature=!1,this.currentCoords=[],this.activate=function(){this.deactivate(),this.enabled=!0,t.options.painting.enable=!0,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))},this.deactivate=function(){this.enabled=!1,t.options.painting.enable=!1,t.map.dragPan.enable(),delete this.feature},this.getFeature=function(){return this.feature},this.setFeature=function(e){if(!this.type||!e)return!1;if(!t.mouseIsDown)return t.hotFeature;var n=this.type,i=function(e,n){var i;"Rectangle"===e?i=turf.polygon([[t.mouseIsDown,n,n,t.mouseIsDown]]):"Circle"===e?(i=turf.polygon([[t.mouseIsDown,n,n,t.mouseIsDown]]),t.Utilities.setProperty(i,"center",t.mouseIsDown)):i=turf.lineString([t.mouseIsDown,n]);return t.Utilities.setProperty(i,"type",e),t.Utilities.setProperty(i,"painting",1),i}(n,e);return this.feature||(this.currentCoords=[],t.startPoint=e,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([i])),t.fire("painting.start",{type:n,coords:e,feature:i})),this.currentCoords.push(e),this.feature=i,this.feature},this.updateFeature=function(e){if(!this.enabled)return t.hotFeature;if(!this.feature)return this.setFeature(e);var i=this.feature,r=this.type;if(this.currentCoords.push(e),"Rectangle"===r)n(i,"0.1",e[0],t.mouseIsDown[1]),n(i,"0.2",e[0],e[1]),n(i,"0.3",t.mouseIsDown[0],e[1]),n(i,"0.4",t.mouseIsDown[0],t.mouseIsDown[1]);else if("Circle"===r){var o=i.properties.center;if(!o||!o.length)return i;const n=turf.distance(turf.point(o),turf.point(e),{units:"kilometers"}),r=turf.circle(o,n);i.geometry.coordinates=r.geometry.coordinates,t.Utilities.setProperty(i,"radiusInKm",n)}else i.geometry.coordinates.push(e);return t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([this.feature])),t.fire("painting.update",{type:r,coords:e,feature:i}),i},this.handleUp=async function(n){return!!this.feature&&(t.Exploring.enabled&&(this.feature=await t.Exploring.getMatch(this.currentCoords,{set:!0,start:t.startPoint})),i=e.updateHotSource(this.feature),i=t.Utilities.cloneDeep(i),t.lastClick={coords:i.geometry.coordinates[i.geometry.coordinates.length-1]},this.currentCoords=[],this.feature=i,i);var i},t.options.painting.enable&&this.activate()},L=function(t,e){this.type=e.type,this.activate=function(){this.enabled=!0,t.options.exploring.enable=!0},this.deactivate=function(){this.enabled=!1,this.currentMatch=!1,t.options.exploring.enable=!1},this.setFeatures=function(e,n={}){if(t.mapMoving||!this.enabled||"draw"!==t.currentMode.id)return!1;if(!t.Routing.enabled){t.hotFeature&&t.hotFeature.geometry.coordinates.pop();e=[t.currentMode.firstClick||!t.hotFeature?t.firstClick.coords:t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1],e];return!t.Utilities.isPointEqual(e[0],e[1])&&this.getRoute(e,n)}if(t.map.getZoom()<t.options.exploring.minZoom)return alert(`Zoom must be lower than ${t.options.exploring.minZoom}`);var i=n.buffer||t.options.exploring.buffer*Math.pow(2,Math.max(1,19-t.map.getZoom()))/100,r=turf.bboxPolygon([t.map.getBounds().getWest(),t.map.getBounds().getSouth(),t.map.getBounds().getEast(),t.map.getBounds().getNorth()]);e&&(r=turf.polygon(turf.buffer(turf.point(e),i).geometry.coordinates)),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([r])),this.getFeatures(turf.bbox(r)).then((e=>{!function(e=[]){if(t.overpassDownloading=!1,t.mapMoving||!t.Exploring.enabled||"draw"!==t.currentMode.id)return t.updateMeshData([],!0);if(t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),t.Snapping.addFeature(t.snapFeature),t.setMeshFeatures(e),t.currentMode.updateHotSource(),t.fire("overpass.add",{features:e}),!t.currentMode.firstClick)return e;var n=turf.explode(turf.featureCollection(e)),i=turf.nearestPoint(turf.point(t.currentMode.firstClick.coords),n);t.lastClick={coords:i.geometry.coordinates}}(e)}))},this.setFeature=function(n=[],i={}){if(!n.length)return t.hotFeature;var r=turf.lineString(n);return r.geometry.coordinates[0]=i.start||r.geometry.coordinates[0],this.currentMatch&&(r=turf.lineString(t.Utilities.combineSameTypeFeatures([this.currentMatch,r]))),this.currentMatch=r,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.fire("exploring.match",{route:this.currentMatch}),e.updateHotSource(this.currentMatch)},this.getFeatures=async function(e){if(!e||!e.length||4!=e.length)return!1;var n=`way["highway"](${e[1]} , ${e[0]} , ${e[3]} , ${e[2]});`;t.map.getZoom()<12&&(n=`way["highway"="motorway"](${e[1]} , ${e[0]} , ${e[3]} , ${e[2]});`),t.overpassDownloading=!0;const i="[out:json][timeout:25];("+n+");out body;>;out skel qt;",r=await fetch("//overpass-api.de/api/interpreter?data="+i,{method:"GET"}),o=function(e){const n={};e.elements.forEach((t=>{const e=`${t.type}-${t.id}`;n[e]=t}));const i=function(t){const e=[];return t.nodes.forEach((t=>{const i=n[`node-${t}`];i&&e.push([i.lon,i.lat])})),e},r=[];return e.elements.forEach((t=>{if("way"===t.type){const e=i(t);e.length>1&&r.push(turf.lineString(e,t.tags))}else"relation"===t.type&&t.members.forEach((e=>{if("way"===e.type){const o=`way-${e.ref}`,s=n[o],a=i(s);a.length>1&&r.push(turf.lineString(a,t.tags))}}))})),t.turf.featureCollection(r)}(await r.json());return o&&o.features?o.features:[]},this.getMatch=async function(e=[],n={}){if(!e.length)return!1;var i=t.options.exploring.tolerance,r=n.feature||turf.cleanCoords(turf.lineString(e)),o=(r=turf.simplify(r,{mutate:!0,tolerance:"function"==typeof i?i(t.map):i,highQuality:!0})).geometry.coordinates;if(o.length<2)return!1;t.overpassDownloading=!0,n.radius=n.radius||50,n.profile=n.profile||"driving",e=o.join(";");const s=o.map((()=>n.radius)).join(";"),a="https://router.project-osrm.org/match/v1/"+n.profile+"/"+e+"?overview=simplified&radiuses="+s+"&generate_hints=false&skip_waypoints=true&gaps=ignore&annotations=nodes&tidy=true&geometries=geojson",c=await fetch(a,{method:"GET"}),u=await c.json();return t.overpassDownloading=!1,"Ok"!==u.code&&alert(`${u.code} - ${u.message}.`),n.set?u.matchings&&u.matchings.length?this.setFeature(u.matchings[0].geometry.coordinates,n):r:u},this.getRoute=async function(e=[],n={}){if(!e.length)return!1;var i=n.feature||turf.cleanCoords(turf.lineString(e)),r=i.geometry.coordinates;if(r.length<2)return!1;t.overpassDownloading=!0,n.profile=n.profile||"driving",e=r.join(";");const o="https://router.project-osrm.org/route/v1/"+n.profile+"/"+e+"?overview=simplified&continue_straight=true&annotations=nodes&geometries=geojson",s=await fetch(o,{method:"GET"}),a=await s.json();return t.overpassDownloading=!1,"Ok"!==a.code&&alert(`${a.code} - ${a.message}.`),n.set?a.routes&&a.routes.length?this.setFeature(a.routes[0].geometry.coordinates,n):i:a},t.options.exploring.enable&&this.activate()};var T=[],F=[];const O=function(){if(!t)throw new Error("MapboxGL script is required!");if(!e)throw new Error("TurfJS script is required!");if(!i.A)throw new Error("Omnivore script is required!");const n=this,r=this.turf=e,o=this.omnivore=i.A;this.version="1.0.3",this.Mapbox=t,this.options=s,this.dev=this.statics.dev,this.id=this.statics.id,this.modes=[],this.plugins={},this.gamepads={},this.enabled=!1,this.mobile=/(iphone|ipod|ipad|android|iemobile|blackberry|bada)/.test(window.navigator.userAgent.toLowerCase())||navigator.userAgent.includes("Mac")&&"ontouchend"in document,this.initialize=function(){return this.initialized||(window[this.id]=this,this.Utilities=new a(this),this.initialized=!0),this},this.init=function(t={},e){if(this.isReady)return this.setOptions(t);if(!t.accessToken)throw new Error("No Mapbox Access Token Provided!");const i=t.container||this.options.map.container;if(!i)throw new Error("Element id is required in the DOM for the map!");return this.options.map.accessToken=t.accessToken,this.options.map.container=i,this.styles=t.styles,delete t.accessToken,delete t.container,delete t.styles,this.setOptions(t),this.onReady=!(!e||"function"!=typeof e)&&e,async function(t){var e=0;return new Promise((async function(n,i){var r=setInterval((function(){var o=document.getElementById(t);return 1e4===e?(clearInterval(r),i(!1)):o?(clearInterval(r),n(o)):e++}),1)}))}(this.options.map.container).then((function(t,e){if(!t||e)throw new Error(`Element with id "${i}" is required in the DOM for the map!`);n.isReady=!0,n._container=t,n._container.classList.add(n.statics.id),n.Map=new u(n,n.options.map)})),this},this.load=function(){return!this.isLoaded&&this.isReady&&this.Map.getMap()?(this.map=this.Map.getMap(),this.container=this.Map.getContainer(),this.fullscreen=new t.FullscreenControl({container:document.querySelector("body")}),this.navigation=new t.NavigationControl({visualizePitch:!0,showZoom:!0,showCompass:!0}),this.map.addControl(this.navigation,"top-right"),this.mobile||this.map.addControl(this.fullscreen,"top-right"),this.locate=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!1}),this.map.addControl(this.locate,"top-right"),this.styles=new y(this,{styles:this.styles}),this.Styles=this.map.addControl(this.styles),this.Layers=new l(this),this.Features=new d(this),this.Events=function(t){const e=function(e){t.mapMoving=e,t.Locate&&t.Locate.onMapMove(e),t.setIcon(e)},n=function(e){t.mapMoving=e,t.setIcon(e),t.setCenterMarker(),t.Locate&&t.Locate.following&&t.setMapClass("disable")},i=function(e){t.mapMoving=!1,t.Map.onMapMove(e),t.Locate&&t.Locate.onMapMove(e),t.setIcon(e)},r=function(e){var n=t.options.painting&&t.options.painting.enable;n=n&&t.currentMode&&"draw"===t.currentMode.id,t.Locate&&t.Locate.following?t.setMapClass("disable"):t.dragMoving?t.setMapClass("grabbing"):t.addingVertexOnLine||t.canAddVertex?t.setMapClass("pointer"):t.canDragMove?t.setMapClass("grab"):n?t.setMapClass("painting"):t.setMapClass("pointer"),t.lastMouseEvent=e,t.currentMode.handleMove&&t.currentMode.handleMove(e)},o=function(e){var n=t.options.painting&&t.options.painting.enable;n=n&&t.currentMode&&"draw"===t.currentMode.id,t.Locate&&t.Locate.following?t.setMapClass("disable"):n?t.setMapClass("painting"):t.dragMoving||t.addingVertexOnLine?t.setMapClass("grabbing"):t.canDragMove?t.setMapClass("grab"):t.lastClick?t.setMapClass("grabbing"):t.setMapClass("pointer"),t.mouseIsDown=[e.lngLat.lng,e.lngLat.lat],t.currentMode.handleDown&&t.currentMode.handleDown(e)},s=function(e){t.mouseIsDown=!1,t.Locate&&t.Locate.following?t.setMapClass("disable"):t.setMapClass("pointer"),t.currentMode.handleUp&&t.currentMode.handleUp(e)},a=async function(e){if(e.type.includes("preclick"))return!!t.currentMode.handlePreclick&&t.currentMode.handlePreclick(e);t.currentMode.handleClick&&t.currentMode.handleClick(e)},c=function(e){t.Locate&&t.Locate.following?t.setMapClass("disable"):t.dragMoving?t.setMapClass("grabbing"):t.canDragMove?t.setMapClass("grab"):t.setMapClass("move"),t.currentMode.handleDrag&&t.currentMode.handleDrag(e)},u=function(e){t.currentMode.handleOffMap&&t.currentMode.handleOffMap(e)},l=function(e){t.currentMode.handleOnMap&&t.currentMode.handleOnMap(e)},d=function(e){if(t.textMarker)return;const n=t.getButtons();let i=!1;if(Object.keys(n).forEach((r=>{const o=n[r],s=t.options.keys[r];(s===e.key||s===e.keyCode||o.keycode&&o.keycode===e.keyCode)&&(o.button.click(),i=!0)})),t.options.commands&&t.options.commands.forEach((function(n){if(n.key===e.keyCode||n.key===e.key||n.key===e.code){if(!n.command||"function"!=typeof n.command)return;n.command(e,t,n),i=!0}})),i)return i;switch(e.key.includes("Arrow"),e.code){case"Enter":case"NumpadEnter":t.setMode();break;case"Escape":t.hotFeature=null,t.setMode();break;case"Home":t.moveSelectedFeatures(1);break;case"End":t.moveSelectedFeatures(-1);break;case"Delete":t.mode===t.statics.constants.modes.SELECT?t.hasSelection()&&t.removeSelection():t.mode===t.statics.constants.modes.DRAW&&t.currentMode.deleteVertex()}},p=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},f=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},g=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},m=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},y=function(e){t.addGamepad(e.gamepad||e.detail.gamepad)},v=function(e){t.removeGamepad(e.gamepad||e.detail.gamepad)},b=function(e){t.updateOrientation({alpha:e.alpha,beta:e.beta,gamma:e.gamma})},x=function(t){},E=function(e){t.setMapClass("grabbing"),t.setIcon(e),t.setCenterMarker({transform:!0})},C=function(e){const n=e.type.split(":")[1],i={data:e.detail,type:n.split(".")[0],action:n.split(".")[1],target:t},r={name:n,detail:i};t.map.fire(t.id,r)},M=function(e){t.currentMode.handleContext&&t.currentMode.handleContext(e)},S=function(e){if(!e.sourceDataType||"content"===!e.sourceDataType||!e.sourceId)return!1;const n=e.sourceId,i={id:n,data:e.source.data,type:e.type,target:t};n===t.statics.constants.sources.HOT&&t.fire("source.hot",i)};return{addEventListeners:function(){t.map.on("movestart",e),t.map.on("move",n),t.map.on("moveend",i),t.map.on("mousemove",r),t.map.on("preclick",a),t.map.on("click",a),t.map.on("tap",a),t.map.on("dragstart",x),t.map.on("drag",c),t.map.on("mousedown",o),t.map.on("mouseup",s),t.map.on("rotatestart",E),t.map.on("pitchstart",E),t.map.on("rotate",E),t.map.on("pitch",E),t.map.on("touchstart",p),t.map.on("touchend",f),t.map.on("touchmove",g),t.map.on("touchcancel",m),t.map.on("contextmenu",M),t.map.on("sourcedata",S),h.forEach((function(e){t.map.on(t.id+":"+e,C)})),t.container.addEventListener("keydown",d),t.container.addEventListener("mouseover",l),t.container.addEventListener("mouseleave",u),window.addEventListener("gamepadconnected",y),window.addEventListener("gamepaddisconnected",v),window.addEventListener("deviceorientation",b,!0)},removeEventListeners:function(){t.map.off("movestart",e),t.map.off("move",n),t.map.off("moveend",i),t.map.off("mousemove",r),t.map.off("preclick",a),t.map.off("click",a),t.map.off("tap",a),t.map.off("dragstart",x),t.map.off("drag",c),t.map.off("mousedown",o),t.map.off("mouseup",s),t.map.off("rotatestart",E),t.map.off("pitchstart",E),t.map.off("touchstart",p),t.map.off("touchend",f),t.map.off("touchmove",g),t.map.off("touchcancel",m),t.map.off("contextmenu",M),t.map.off("sourcedata",S),h.forEach((function(e){t.map.off(t.id+":"+e,C)})),t.container.removeEventListener("keydown",d),t.container.removeEventListener("mouseover",l),t.container.removeEventListener("mouseleave",u),window.removeEventListener("gamepadconnected",y),window.removeEventListener("gamepaddisconnected",v),window.removeEventListener("deviceorientation",b,!0)}}}(this),this.Events.removeEventListeners(),this.Events.addEventListeners(),this.isLoaded=!0,this.Map.setExtent(!1,!0),this.fire("sdk.ready",{enabled:this.enabled,map:this.map,ready:this.isLoaded}),this.enable(),this):this},this.enable=function(t,e={}){return this.enabled||(this.mode=t&&"select"!==t?"draw":"select",this.type=t,this.setOptions(e),this.setControls(),this.Select=new b(this),this.Draw=new x(this),this.Edit=new E(this),this.modes=[this.Select,this.Draw,this.Edit],this.enabled=!0,this.fire("map.enable",{enabled:this.enabled,mode:this.mode,type:this.type}),this.redraw(),this.setMode({mode:this.mode,type:this.type})),this},this.disable=function(){return this.enabled?(this.modes=[],this.enabled=!1,this.mode=null,this.options=s,this.fire("map.disable",{enabled:this.enabled,mode:this.mode}),this.doubleClickZoom.enable(this.map),this.Layers.removeEventListeners(),this.Events.removeEventListeners(),this.Layers.removeLayers(),this.removeControls(),this):this},this.redraw=async function(){if(!this.Events)return!1;await this.Layers.refresh(),this.Events.removeEventListeners(),this.Events.addEventListeners(),this.Features.updateSource(),this.doubleClickZoom.disable(this.map),this.Map.setViewport(),this.map.resize(),this.fire("map.redraw",{enabled:this.enabled,mode:this.mode}),this.onReady&&(await this.onReady(this),delete this.onReady)},this.refresh=async function(){if(this.noRefresh)return!1;await this.redraw()},this.once=function(t,e){return!(!this.map||!t)&&this.map.once(this.id+":"+t,e)},this.on=function(t,e){if(!e.name)throw new Error("Function must have a name!");return!(!this.map||!t)&&this.map.on(this.id+":"+t,e)},this.off=function(t,e){if(!e.name)throw new Error("Function must have a name!");return!(!this.map||!t)&&this.map.off(this.id+":"+t,e)},this.fire=function(t,e){return!(!this.map||!t)&&this.map.fire(this.id+":"+t,{detail:e})},this.setOptions=function(t={}){return this.options=n.Utilities.assignDeep(this.options||{},t),this.options},this.setMode=function(t={}){t.mode||(t.mode=this.statics.constants.modes.SELECT),t.type||(t.type="Polyline");var e,i=[],r=null,o=t.mode===this.statics.constants.modes.EDIT;if(this.currentMode&&t.mode===this.mode&&t.type===this.currentMode.type)return this.currentMode;if(o){if(!t.feature)return this.currentMode&&this.currentMode.deactivate(),this.setMode();t.feature=n.Utilities.cloneDeep(t.feature),t.mode=this.statics.constants.modes.DRAW,t.type=t.type||t.feature.properties.type,this.editing=n.Utilities.cloneDeep(t.feature),this.removeSelection()}(this.currentMode&&this.currentMode.activated&&this.currentMode.deactivate(),this.container.classList.forEach((function(t){-1!==t.indexOf("mouse-")&&i.push(t)})),i.length>0)&&(e=this.container.classList).remove.apply(e,i);return this.setMapClass("pointer"),this.modes.forEach((function(e){e.canHandle&&e.canHandle(t.mode)&&(r=e)})),r&&(this.fire("mode.change",{old:this.mode,new:t.mode,mode:r,type:t.type}),this.currentMode=r,this.mode=t.mode,r.activate(t)),this.Snapping=new C(this,this.currentMode),this.Pinning=new M(this,this.currentMode),this.Routing=new S(this,this.currentMode),this.Exploring=new L(this,this.currentMode),this.Painting=new w(this,this.currentMode),this.Layers.moveLayers(),this.currentMode},this.setControls=function(t=[]){return this.controls&&this.controls.length?this.controls:!!this.options.controls&&(this.controls=[],(t=t.length?t:this.statics.controls).forEach((function(t){this.controls.push(new m(this,t))}),this),this.controls)},this.setIcon=function(t){!!this.navigation&&this.navigation._compassIcon,this.Locate&&this.Locate.following},this.setCenterMarker=function(t={}){return},this.setButtons=function(){return!!this.getButtons("select")&&this.getButtons("select").add()},this.setActiveButton=function(t){if(!this.controls||!this.controls.length)return!1;this.controls.forEach((function(e){e.setActiveButton(t.toLowerCase())}))},this.setTheme=function(t){this.Control&&this.Control.setTheme(t)},this.setCustomLayers=async function(t=[],e={}){return this.removeFeatures(t,e),await this.Layers.setCustomLayers(t,e)},this.setSelectedFeatures=function(t=[]){if(!t.length)return!1;T.splice(0,T.length,...t),this.map.getSource(this.statics.constants.sources.SELECT).setData(r.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(r.featureCollection(this.getSelectedFeatures())),this.fire("select.load",{features:r.featureCollection(this.getSelectedFeatures()),source:this.map.getSource(this.statics.constants.sources.SELECT)})},this.setMeshFeatures=function(t=[]){return!!t.length&&(this.updateMeshData(t,!0),this.meshIndex.getFeatures())},this.setMapClass=function(t){if(this.container.classList.forEach((function(t){-1!==t.indexOf("mouse-")&&this.container.classList.remove(t)}),this),!t)return!1;this.container.classList.add("mouse-"+t)},this.hasControls=function(){return this.controls&&this.controls.length},this.hasSelection=function(){return this.getSelectedFeatures().length>0},this.hasSingleSelection=function(){return 1===this.getSelectedFeatures().length},this.activateSnapping=function(){var t=this.getButtons("snapping");if(t)return t.activate(),this.Snapping.activate(),this.fire("snapping.activate",{enabled:!0,mesh:this.meshIndex,snapping:this.Snapping}),this.Snapping},this.activatePinning=function(){var t=this.getButtons("pinning");if(t)return t.activate(),this.activateSnapping(),this.Pinning.activate(),this.fire("pinning.activate",{enabled:!0,pinning:this.Pinning}),this.Pinning},this.activateRouting=function(){var t=this.getButtons("routing");if(t)return t.activate(),this.activateSnapping(),this.deactivatePainting(),this.Routing.activate(),this.fire("routing.activate",{enabled:!0,routing:this.Routing}),this.Routing},this.activateExploring=function(){var t=this.getButtons("exploring");if(t)return t.activate(),this.deactivatePainting(),this.Exploring.activate(),this.fire("exploring.activate",{enabled:!0,exploring:this.Exploring}),this.Exploring},this.activatePainting=function(){var t=this.getButtons("painting");if(t)return t.activate(),this.deactivateRouting(),this.deactivateExploring(),this.Painting.activate(this.drawMode),this.fire("painting.activate",{enabled:!0,painting:this.Painting}),this.Painting},this.deactivateSnapping=function(){var t=this.getButtons("snapping");if(t)return t.deactivate(),this.deleteMeshData(),this.Snapping.deactivate(),this.fire("snapping.deactivate",{enable:!1}),!1},this.deactivatePinning=function(){var t=this.getButtons("pinning");if(t)return t.deactivate(),this.Pinning.deactivate(),this.fire("pinning.deactivate",{enable:!1}),!1},this.deactivateRouting=function(){var t=this.getButtons("routing");if(t)return t.deactivate(),this.Routing.deactivate(),this.fire("routing.deactivate",{enable:!1}),!1},this.deactivateExploring=function(){var t=this.getButtons("exploring");if(t)return t.deactivate(),this.deleteMeshData(),this.Exploring.deactivate(),this.fire("exploring.deactivate",{enable:!1}),!1},this.deactivatePainting=function(){var t=this.getButtons("painting");if(t&&(!this.mobile||this.currentMode.finished||"draw"!==this.currentMode.id||!this.currentMode.type||"Rectangle"!==this.currentMode.type))return t.deactivate(),this.Painting.deactivate(),this.fire("painting.deactivate",{enable:!1}),!1},this.getMap=function(){return this.Map.map},this.getModes=function(t){return t?this.modes.find((function(e){if(e.canHandle&&e.canHandle(t))return e})):this.modes},this.getMode=function(){return this.currentMode},this.getColors=function(){return this.options.colors},this.getButtons=function(t){return!!this.hasControls()&&(this.controls.forEach((function(n){var i=n.getButtonOptions();t?!e&&i[t]&&(e=i[t]):(e||(e={}),Object.entries(i).forEach((function(t){var n=t[0],i=t[1];e[n]=i})))})),e);var e},this.getFeatures=function(){return[this.getDrawnFeatures(),this.getSelectedFeatures()].flat()},this.getDrawnFeatures=function(){return this.Features.getColdFeatures()},this.getRenderedFeatures=function(t,e,n){return[this.getRenderedDrawnFeatures(t,e,n),this.getRenderedSnapFeatures(t,e,n)].flat()},this.getRenderedDrawnFeatures=function(t,e,n){var i,o=this.id,s=[];[o+"-line-cold",o+"-fill-cold",o+"-circle-cold",o+"-icon-cold",o+"-fill-select",o+"-line-select",o+"-point-select",o+"-symbol-select"].forEach((function(t){this.map.getLayer(t)&&s.push(t)}),this),this.Layers.getLayers().forEach((function(t){t.id.includes(o)||this.map.getLayer(t.id)&&s.push(t.id)}),this);var a={layers:s};if(e){var c=r.distanceToDegrees(e);i=[this.map.project([t.lng-c,t.lat-c]),this.map.project([t.lng+c,t.lat+c])]}else{var u=t?this.map.project([t.lng,t.lat]):null;i=u?[[u.x-5,u.y-5],[u.x+5,u.y+5]]:null}n&&(a.filter=n);var l=this.map.queryRenderedFeatures(i,a),d=l.map((function(t){return t.parent||t.properties.parent||t.id||t.properties.id}));return l&&l.length?this.Features.getFeaturesById(d):[]},this.getRenderedSnapFeatures=function(t,e,n){if(!this.meshIndex)return[];var i=r.distanceToDegrees(e),o=[this.map.project([t.lng-i,t.lat-i]),this.map.project([t.lng+i,t.lat+i])],s={layers:[this.statics.constants.layers.MESH+"-line",this.statics.constants.layers.MESH+"-circle"]};n&&(s.filter=n);var a=this.map.queryRenderedFeatures(o,s);return a&&a.length?this.meshIndex.getFeaturesFromIndex(a):[]},this.getFeatureById=function(t){return!!t&&this.Features.getFeatureById(t)},this.getFeaturesByLayer=function(t,e,n,i){var o,s=[];this.Layers.getLayers().forEach((function(e){e.id.includes(t)&&s.push(e.id)}));var a={layers:s};if(n){var c=r.distanceToDegrees(n);o=[this.map.project([e.lng-c,e.lat-c]),this.map.project([e.lng+c,e.lat+c])]}else{var u=e?this.map.project([e.lng,e.lat]):null;o=u?[[u.x-5,u.y-5],[u.x+5,u.y+5]]:null}i&&(a.filter=i);var l=this.map.queryRenderedFeatures(o,a),d=l.map((function(t){return t.parent||t.properties.parent||t.id||t.properties.id}));return l&&l.length?this.Features.getFeaturesById(d):[]},this.getSelectedFeatures=function(){return T},this.getSelectedFeatureIds=function(){return this.getSelectedFeatures().map((t=>t.parent||t.properties.parent||t.id||t.properties.id))},this.getSelectedFeaturesBbox=function(){return this.hasSelection()?r.bbox(r.featureCollection(this.getSelectedFeatures())):null},this.getSelectedPropertyNames=function(){const t=this.id,e=[];return this.getSelectedFeatures().forEach((n=>{Object.keys(n.properties).forEach((n=>{-1===e.indexOf(n)&&n!==t&&e.push(n)}))})),e},this.getSelectedPropertyValues=function(){const t=this.id;var e={};return this.getSelectedFeatures().forEach((function(t){Object.assign(e,t.properties)})),void 0!==e[t]&&delete e[t],e},this.getCommonGeometryType=function(){let t=null;return this.getSelectedFeatures().forEach((e=>{null===t?t=e.geometry.type:e.geometry.type!==t&&(t="illegal")})),"illegal"===t?null:t},this.editFeature=function(t,e={}){var n=e.feature||this.getFeatureById(t);if(!n){if(!this.hasSingleSelection())return!1;n=this.getSelectedFeatures()[0]}return e.id=n.id,e.mode="edit",e.feature=n,this.fire("feature.edit",{feature:n,id:n.id}),this.setMode(e),n},this.cancelEdit=function(t,e){return"draw"===this.currentMode.id&&this.currentMode.deactivate(!0,t,e||this.editing)},this.saveEdit=function(){return this.currentMode.saveEdit()},this.addFeatures=function(t,e){return!!t&&(t.features&&(t=t.features),Array.isArray(t)||(t=[t]),!!t.length&&(this.Features.addFeatures(t),void(!e&&this.zoomToFeatures())))},this.addFeaturesToSelected=function(t){this.getSelectedFeatures().push(...t),this.setButtons(),this.map.getSource(this.statics.constants.sources.SELECT).setData(r.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(r.featureCollection(this.getSelectedFeatures())),this.Features.setText(t),this.fire("feature.select",{ids:this.getSelectedFeatureIds(),features:this.getSelectedFeatures()})},this.addFeaturesToMesh=function(t=[]){return!!t.length&&(this.updateMeshData(t),t)},this.addGamepad=function(t){this.gamepads[t.index]=new this.Gamepad(this,t),this.fire("gamepad.add",{gamepad:t})},this.addTooltip=function(t,e,n,i){if(!this.setTooltip)return!1;this.setTooltip(e,{parent:t,appendTo:i,options:n})},this.addPlugin=function(t){if(!t.id)throw new Error("No Plugin ID provided");var e=t.id;this.plugins[e]=t},this.removeSelection=function(t){if(this.removePopup(),!this.hasSelection())return this.Features.setText();var e=n.Utilities.clone(this.getSelectedFeatureIds()),i=n.Utilities.clone(this.getSelectedFeatures());return t||i.forEach((function(t){this.Features.addFeatures([t],!0)}),this),this.getSelectedFeatures().splice(0,i.length),this.setButtons(),this.map.getSource(this.statics.constants.sources.SELECT).setData(r.featureCollection([])),this.map.getSource(this.statics.constants.sources.VERTEX).setData(r.featureCollection([])),this.Features.setText(),this.fire("feature.deselect",{ids:e,features:i}),i.length},this.removeControls=function(){},this.removeGamepad=function(t){if(!this.gamepads[t.index])return!1;this.gamepads[t.index].onDisconnect(t),delete this.gamepads[t.index],this.fire("gamepad.remove",{gamepad:t})},this.removeFeatures=function(t,e){return t?!!Array.isArray(t)&&void this.Features.removeFeatures(t,!0):this.Features.deleteFeatures()},this.removeFeature=function(t,e){var n=!!t&&this.Features.removeFeatures(t,e);return!e&&this.fire("feature.delete",{id:t,feature:n}),n},this.removePopup=function(){return this.popup&&this.popup.remove?this.popup.remove():!(!this.currentMode.popup||!this.currentMode.popup.remove)&&this.currentMode.popup.remove()},this.updateMeshData=function(t=[],e){this.meshIndex&&!e||(this.meshIndex=new this.Mesh([])),this.meshIndex.addNewFeatures(t);var n=this.statics.constants.sources.MESH;t=r.featureCollection(this.meshIndex.getFeatures());return this.map.getSource(n).setData(t),this.fire("mesh.update",{features:t}),t},this.updateSelectedProperties=function(t,e){this.getSelectedFeatures().forEach((n=>{const i=n.parent||n.properties.parent||n.id||n.properties.id,r={};e.forEach((t=>{n.properties[t]&&(r[t]=n.properties[t])})),n.properties=Object.assign(r,t,{id:i})}))},this.updateOrientation=function(t){return!!this.Locate&&(this.Locate.update(t),this.Locate.locate)},this.saveFeatures=function(t){const e=this.id;var i,s;if(t){if(!t.id||!t.name)return window.alert("Layer ID and Name are required!");s=t.name+"-"+t.id,i=r.featureCollection(this.Features.getFeaturesByLayer(t))}else this.hasSelection()?(s="Selected Features",i=r.featureCollection(this.getSelectedFeatures())):(s=s="All Features",i=r.featureCollection(this.Features.getColdFeatures()));if(!i.features.length)return window.alert("No Features to Export!");var a=n.Utilities.cloneDeep(i.features);a=a.map((function(t){return t.style={},t.style.stroke=t.properties.style&&t.properties.style.primaryColor?t.properties.style.primaryColor:this.options.colors.primaryColor,t.style["stroke-width"]=3,t.style.fill=t.properties.style&&t.properties.style.secondaryColor?t.properties.style.secondaryColor:this.options.colors.secondaryColor,t.style["fill-opacity"]=1,t.properties.id=t.id,t.properties.unit=t.geometry.unit,t.properties.units=t.geometry.units,delete t.properties.style,delete t.geometry.unit,delete t.geometry.units,t}),this),i=r.featureCollection(a);var c=new Date,u=e+"_export - "+(c.getMonth()+1)+"."+c.getDate()+"."+c.getFullYear()+"_"+c.getHours()+c.getMinutes();const l=new window.JSZip,d={Id:this.id,Version:this.version,Features:i.features.length};["kmz","gpx","geojson"].forEach((function(t){const e=l.folder(s+" "+t.toUpperCase());switch(t){case"kmz":var n=document.createElement("table"),c=document.createElement("tbody");n.appendChild(c),Object.entries(d).forEach((function(t){var e=t[0],n=t[1],i=document.createElement("tr"),r=document.createElement("th"),o=document.createElement("td");r.textContent=e+": ",o.textContent=n,i.appendChild(r),i.appendChild(o),c.appendChild(i)}));var u=o.toKML(i,{name:"id",simplestyle:!0,description:d.Id,documentName:s,documentDescription:n.innerHTML}),p=new Blob([u],{type:"application/vnd.google-earth.kml+xml"});e.file(s.toLowerCase()+".kml",p);break;case"gpx":a.forEach((function(t){var n=t.id,i=r.featureCollection([t]),a=o.toGPX(i,{creator:d.Id,featureTitle:function(t){return t.id}});e.file(s.toLowerCase()+"_"+n+".gpx",a)}));break;case"geojson":var h=i;p=new Blob([JSON.stringify(h)],{type:"application/geojson"});e.file(s.toLowerCase()+".geojson",p)}})),l.generateAsync({type:"blob"}).then((function(t){var e=new Blob([t],{type:"application/zip;charset=utf-8"});window.geoflo.fire("features.export",{features:a,blob:e,date:c,name:u});var n=document.createElement("a");n.setAttribute("href",URL.createObjectURL(e)),n.setAttribute("download",u+".zip"),n.click(),URL.revokeObjectURL(n.href)}))},this.loadFeatures=function(){const t=document.createElement("input");function e(t,e,i){var r=[];if("geojson"===i||"json"===i)r=JSON.parse(t);else{if(!o[i])return alert("File type not supported: "+i);o[i].parse(t,null,{addData:function(t){r=t}})}r.features&&(r=r.features),Array.isArray(r)||(r=[r]),r.forEach((function(t){t.properties.import=!0,t.source=t.source||t.properties.source||n.statics.constants.sources.COLD})),n.fire("features.import",{features:r,file:t,ext:i,name:e}),n.addFeatures(r)}t.type="file",t.setAttribute("multiple","multiple"),t.addEventListener("change",(function(t){const i=[];for(let e=0;e<t.target.files.length;e++)i.push(t.target.files[e]);n.Utilities.processFiles(i,e)}),!1),t.click()},this.moveMapAlongLine=function(t){if(!t)return;const e=r.lineDistance(t),i=r.lineDistance(t);let o;window.requestAnimationFrame((function s(a){o||(o=a);const c=(a-o)/8e4;c>1&&setTimeout((()=>{o=0}),1500);const u=r.along(r.lineString(t),e*c).geometry.coordinates,l=r.along(r.lineString(t),i*c).geometry.coordinates,d=n.map.getFreeCameraOptions();d.position=mapboxgl.MercatorCoordinate.fromLngLat({lng:l[0],lat:l[1]},4e3),d.lookAtPoint({lng:u[0],lat:u[1]}),n.map.setFreeCameraOptions(d),window.requestAnimationFrame(s)}))},this.refreshMeshData=function(){this.meshIndex&&(this.mapMoving||this.fire("snapping.refresh",{features:this.meshIndex.getFeatures()}))},this.deleteMeshData=function(){this.updateMeshData([],!0),this.fire("snapping.delete",{features:this.meshIndex.getFeatures()})},this.deleteUserData=function(){var t;if(this.hasSingleSelection()){if(!window.confirm("Delete Selected Feature?"))return;var e=this.getSelectedFeatures()[0];t=e.parent||e.properties.parent||e.id||e.properties.id,this.Features.removeFeatures(t,!0),this.meshIndex&&this.meshIndex.removeFeature(t),this.fire("feature:delete",{features:this.Features.getColdFeatures()})}else{if(!window.confirm("Delete All Features?"))return;this.Features.deleteFeatures(),this.fire("features.delete",{features:this.Features.getColdFeatures()})}this.hotFeature=null,this.snapFeature=null,this.lastClick=null,this.firstClick=null,this.drawStarted=null,this.removeSelection(t),this.map.getSource(this.statics.constants.sources.SNAP).setData(r.featureCollection([])),this.map.getSource(this.statics.constants.sources.HOT).setData(r.featureCollection([])),this.map.getSource(this.statics.constants.sources.HOTTEXT).setData(r.featureCollection([])),this.editMode&&(this.editMode=!1,this.setMode())},this.doubleClickZoom={enable(t){setTimeout((()=>{t&&t.doubleClickZoom&&t.doubleClickZoom.enable()}),0)},disable(t){setTimeout((()=>{t&&t.doubleClickZoom&&t.doubleClickZoom.disable()}),0)}},this.hideSelectedFeatures=function(){F.length>0?(this.getSelectedFeatures().push(...F),F.splice(0,F.length)):this.hasSelection()&&F.push(...this.getSelectedFeatures().splice(0,this.getSelectedFeatures().length)),this.map.getSource(this.statics.constants.sources.SELECT).setData(r.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(r.featureCollection(this.getSelectedFeatures()))},this.combineSelectedFeatures=function(){if(this.mode===this.statics.constants.modes.SELECT&&this.hasSelection()){var t=this.getCommonGeometryType();if("Polygon"===t){var e=[];this.forEachSelectedFeature((function(t){e.push.apply(e,consumableArray(t.geometry.coordinates))})),e.length>0&&(this.Features.addFeatures([r.polygon(e,this.getSelectedPropertyValues())]),this.removeSelection())}else if("LineString"===t){var i=n.Utilities.combineSameTypeFeatures(this.getSelectedFeatures());i.length>0&&(this.Features.addFeatures([r.lineString(i,this.getSelectedPropertyValues())]),this.removeSelection())}}},this.moveSelectedFeatures=function(t){if(!this.options.moving||!this.options.moving.enable)return!1;var e=this.options.moving.distance;if(this.mode===this.statics.constants.modes.SELECT&&(this.hasSelection()&&"LineString"===this.getCommonGeometryType())){var n=[];this.forEachSelectedFeature((function(i){n.push(r.lineOffset(i,e*t))})),this.setSelectedFeatures(n)}},this.moveFeature=function(t,e){},this.forEachSelectedFeature=function(t){this.getSelectedFeatures().forEach(t)},this.zoomToFeatures=function(t,e={}){if((t=t||(this.hasSelection()?this.getSelectedFeatures():this.getRenderedDrawnFeatures())).properties&&(t=[t]),t&&t.length||(t=this.Map.options.extent?[r.polygon(this.Map.options.extent)]:[]),t.length<1)return!1;this.Map.setExtent(t,!1,e)},this.createPolygon=function(){if(this.mode===this.statics.constants.modes.SELECT&&(this.hasSelection()&&"LineString"===this.getCommonGeometryType())){var t=n.Utilities.combineSameTypeFeatures(this.getSelectedFeatures());t.length>0&&(n.Utilities.isPointEqual(t[0],t[t.length-1])||t.push(t[0]),this.addFeaturesToSelected([r.polygon([t],this.getSelectedPropertyValues())]),this.removeSelection())}},this.initialize()};O.prototype.statics=o,O.prototype.Gamepad=function(t,e){if(!(window.navigator.getGamepads&&"function"==typeof window.navigator.getGamepads||window.navigator.getGamepads&&"function"==typeof window.navigator.webkitGetGamepads))throw new Error("Gamepads are not supported on your browser!");const n=this;this.options=v;const i={select:"Select",start:"Start",power:"Power",button0:"B",button1:"A",button2:"Y",button3:"X",button4:"BumpLeft",button5:"BumpRight",button6:"TrigLeft",button7:"TrigRight",button8:"Select",button9:"Start",button10:"JoyLeftClick",button11:"JoyRightClick",button12:"DpadUp",button13:"DpadDown",button14:"DpadLeft",button15:"DpadRight",button16:"Power",button17:"Misc",up0:"JoyLeftUp",down0:"JoyLeftDown",right0:"JoyLeftRight",left0:"JoyLeftLeft",up1:"JoyRightUp",down1:"JoyRightDown",right1:"JoyRightRight",left1:"JoyRightLeft",l1:"BumpLeft",r1:"BumpRight",l2:"TrigLeft",r2:"TrigRight"};function r(t,e){let n=Math.sqrt(t*t+e*e);return n>1&&(t/=n,e/=n),[t,e]}function o(t,e,n=.2){let i=Math.sqrt(t*t+e*e);if(i<n)return[0,0];let r=(i-n)/(1-n);return[t/i*r,e/i*r]}function s(){n.refresh(),requestAnimationFrame(s)}function a(t,e){if(!e||!i)return!1;Object.entries(i).forEach((function(e){var i,r,o=e[0],s=e[1];i=o,r=function(e){return t.onEvent("press",o,s,e)},n.associateEvent(i,r,"before"),function(t,e){n.associateEvent(t,e,"action")}(o,(function(e){return t.onEvent("hold",o,s,e)})),function(t,e){n.associateEvent(t,e,"after")}(o,(function(e){return t.onEvent("release",o,s,e)}))}))}function c(t,e,n){var i=u(t[1]),r=u(t[0]),o=u(e[1]),s=u(e[0]),a=o-i,c=s-r,d=Math.sin(a/2)*Math.sin(a/2)+Math.cos(i)*Math.cos(o)*Math.sin(c/2)*Math.sin(c/2),p=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),h=Math.sin((1-n)*p)/Math.sin(p),f=Math.sin(n*p)/Math.sin(p),g=h*Math.cos(i)*Math.cos(r)+f*Math.cos(o)*Math.cos(s),m=h*Math.cos(i)*Math.sin(r)+f*Math.cos(o)*Math.sin(s),y=h*Math.sin(i)+f*Math.sin(o),v=Math.atan2(y,Math.sqrt(g*g+m*m));return[l(Math.atan2(m,g)),l(v)]}function u(t){return t*(Math.PI/180)}function l(t){return t*(180/Math.PI)}this.init=function(e,n){return!!e&&(v.enable?(t.map.fire(t.id+":gamepad.init",{detail:{gamepad:e}}),this.setGamepad(e),a(this,this.gamepad),requestAnimationFrame(s),this):void 0)},this.refresh=function(){for(var t=window.navigator.getGamepads(),e=0;e<t.length;e++){var n,i=t[this.gamepad.id];if(i&&i.connected){for(n=0;n<i.buttons.length;n++){var s=i.buttons[n],a=s.value,c=this.gamepad.layout[`button${n}`];s.pressed?(this.gamepad.pressed[c]||(this.gamepad.pressed[c]=!0,this.gamepad.buttonActions[n].before&&this.gamepad.buttonActions[n].before(a)),this.gamepad.buttonActions[n].action&&this.gamepad.buttonActions[n].action(a)):this.gamepad.pressed[c]&&(delete this.gamepad.pressed[c],this.gamepad.buttonActions[n].after&&this.gamepad.buttonActions[n].after(a))}var u=(i.axes.length+1)/2|0;for(n=0;n<u;n++){var l,d,p=n==u-1&&i.axes.length%2==1;l=i.axes[2*n],d=p?0:i.axes[2*n+1],[l,d]=o(l,d),[l,d]=r(l,d),a=[Number(l.toFixed(2)),Number(d.toFixed(2))];const t=i.axes[n+u].toFixed(4),e=Math.floor(n/2);this.gamepad.axeValues[e][n%2]=t;var h=a[0]>=v.joystick.min,f=a[0]<=-v.joystick.min,g=a[1]<=-v.joystick.min,m=a[1]>=v.joystick.min;this.trigger("right",h,n,a),this.trigger("left",f,n,a),this.trigger("down",m,n,a),this.trigger("up",g,n,a)}}}},this.trigger=function(t,e,n,i){var r=this.gamepad.axesActions,o=this.gamepad.layout[`${t}${n}`],s=this.gamepad.pressed;e?(s[o]||(s[o]=!0,r[n][t].before&&r[n][t].before(i)),i=[v.joystick.max*i[0],v.joystick.max*i[1]],r[n][t].action&&r[n][t].action(i)):s[o]&&(delete s[o],s.JoyLeftUp||s.JoyLeftDown||s.JoyLeftLeft||s.JoyLeftRight||r[0][t].after&&r[0][t].after(i),s.JoyRightUp||s.JoyRightDown||s.JoyRightLeft||s.JoyRightRight||r[1][t].after&&r[1][t].after(i))},this.remove=function(){this.gamepad.disconnect&&this.gamepad.disconnect(),this.gamepad.remove&&this.gamepad.remove(),this.gamepad=null},this.setMap=function(e){const n=t.map,i=n.transform;this.map=this.map||{center:n.getCenter(),zoom:n.getZoom(),pitch:n.getPitch(),bearing:n.getBearing()};var r=this.map.center.x||this.map.center.lat?this.map.center:new mapboxgl.LngLat(this.map.center[0],this.map.center[1]);return r=r.x?i.pointLocation(r):r,i.center=r,i.bearing=this.map.bearing,i.zoom=this.map.zoom,i.pitch=this.map.pitch,n._update(),v.crosshairs&&t.centerMarker&&this.setMarker(),e&&t.currentMode.handleMove({lngLat:v.camera.free?n.getCenter():this.map.center,gamepad:this}),this.map},this.setContainer=function(t,e,n){const i=window.document.createElement(t);return void 0!==e&&(i.className=e),n&&n.appendChild(i),this.container=i,i},this.setLocation=function(t){return this.container.style.visibility=v.debug?"visible":"hidden",this.container.style.left=(t[0]+1)/2*100+"%",this.container.style.top=(t[1]+1)/2*100+"%",this.container.getBoundingClientRect()},this.setMarker=function(){return t.setCenterMarker({gamepad:!0})},this.setGamepad=function(t){var e={type:t.id,connected:t.connected,id:t.index,buttons:t.buttons.length,layout:i,axes:Math.floor(t.axes.length/2),axeValues:[],hapticActuator:null,vibrationMode:-1,vibration:!1,mapping:t.mapping,buttonActions:{},axesActions:{},pressed:{}};for(let t=0;t<e.buttons;t++)e.buttonActions[t]=()=>({action:()=>{},after:()=>{},before:()=>{}});for(let t=0;t<e.axes;t++)e.axesActions[t]={down:()=>({action:()=>{},after:()=>{},before:()=>{}}),left:()=>({action:()=>{},after:()=>{},before:()=>{}}),right:()=>({action:()=>{},after:()=>{},before:()=>{}}),up:()=>({action:()=>{},after:()=>{},before:()=>{}})},e.axeValues[t]=[0,0];return t.hapticActuators&&("function"==typeof t.hapticActuators.pulse?(e.haptic=t.hapticActuators,e.vibrationMode=0,e.vibration=!0):t.hapticActuators[0]&&"function"==typeof t.hapticActuators[0].pulse&&(e.haptic=t.hapticActuators[0],e.vibrationMode=0,e.vibration=!0)),t.vibrationActuator&&"function"==typeof t.vibrationActuator.playEffect&&(e.haptic=t.vibrationActuator,e.vibrationMode=1,e.vibration=!0),this.gamepad=e,this.hasJoysticks=e.axes>0&&Object.values(this.gamepad.layout).map((function(t){return t.includes("Joy")})).filter((function(t){return t})).length>0,this.gamepad},this.setCenter=function(e,n,i){var r,o=t.map.getCenter(),s=this.gamepad.pressed,a=this.hasJoysticks?"Joy":"Dpad",u=Object.keys(s).filter((function(t){return t.includes(a)})).length>1,l=!(!n&&!i)&&o;if(l=(l=!(!t.hotFeature||l)&&(t.lastMove||o))||o,i){var d=this.map.bearing;d=s.Up?d:s.Down?d+180:s.Left?d-90:s.Right?d+90:d;var p=turf.destination(turf.point(l),distance,d).geometry.coordinates;lngLats=n?{lng:p[1],lat:p[0]}:p}else if(e){var h=this.setLocation(e),f=!(!h||!h.x)&&[h.x,h.y];r=t.map.unproject(f);var g=u?v.pan.speed/2:v.pan.speed,m=c([l.lng,l.lat],[r.lng,r.lat],g);r=m=t.map.getPitch()>60?c([l.lng,l.lat],[m[0],m[1]],.4):m,t.lastMove=r}else{f=!!t.hotFeature&&t.hotFeature.geometry.coordinates;r=n?t.map.getCenter():f?{lat:f[f.length-1][1],lng:f[f.length-1][0]}:t.map.getCenter(),t.lastMove=!1,this.setLocation([0,0])}return this.map.center=r,this.setMap(!0)},this.setBearing=function(t,e,n){var i=this.map.bearing,r=n?t:Math.abs(t[0]);return e?i-=v.bearing.speed*r:i+=v.bearing.speed*r,this.map.bearing=i,this.setMap()},this.setPitch=function(t,e,n){var i=this.map.pitch,r=n?t:Math.abs(t[1]);return i<0&&(i=0),i>v.pitch.max&&(i=v.pitch.max),e?i+=v.pitch.speed*r:i-=v.pitch.speed*r,this.map.pitch=i,this.setMap()},this.setZoom=function(t,e,n){var i=this.map.zoom;return e?i-=v.zoom.speed*Math.abs(t):i+=v.zoom.speed*Math.abs(t),this.map.zoom=i,this.setMap()},this.setSpeed=function(t,e){var n=v.pan.speed>v.pan.min?v.pan.speed:(v.pan.max&&(v.pan.speed,v.pan.max),v.pan.min);return n=(n=e?n-v.pan.min:n+v.pan.min)<v.pan.min?v.pan.min:v.pan.max&&n>v.pan.max?v.pan.max:n,v.pan.speed=n*Math.abs(t)},this.associateEvent=function(t,e,n){if(t.match(/^button\d+$/)){const i=parseInt(t.match(/^button(\d+)$/)[1]);i>=0&&i<this.gamepad.buttons&&(this.gamepad.buttonActions[i][n]=e)}else if("start"===t)this.gamepad.buttonActions[9][n]=e;else if("select"===t)this.gamepad.buttonActions[8][n]=e;else if("r1"===t)this.gamepad.buttonActions[5][n]=e;else if("r2"===t)this.gamepad.buttonActions[7][n]=e;else if("l1"===t)this.gamepad.buttonActions[4][n]=e;else if("l2"===t)this.gamepad.buttonActions[6][n]=e;else if("power"===t)this.gamepad.buttons>=17?this.gamepad.buttonActions[16][n]=e:error(MESSAGES.INVALID_BUTTON);else if(t.match(/^(up|down|left|right)(\d+)$/)){const i=t.match(/^(up|down|left|right)(\d+)$/),r=i[1],o=parseInt(i[2]);o>=0&&o<this.gamepad.axes?this.gamepad.axesActions[o][r][n]=e:error(MESSAGES.INVALID_BUTTON)}else if(t.match(/^(up|down|left|right)$/)){const i=t.match(/^(up|down|left|right)$/)[1];this.gamepad.axesActions[0][i][n]=e}return this.gamepad},this.onInit=function(e){this.initiated=!0,this.setContainer("div","gamepad",t.map.getContainer()),this.setCenterMarker(),this.setMap()},this.onEvent=function(e,n,i,r){var o={[i]:!0},s=v.camera.free?t.map.getCenter():t.lastMove?t.lastMove:t.map.getCenter(),a={name:i,type:e,key:n,value:r,mode:t.currentMode,gamepad:this,lngLat:s,ctx:t,originalEvent:{}};this.initiated||this.onInit(a),t.map.fire(t.id+":gamepad."+e,{detail:a}),(o.JoyLeftUp||o.JoyLeftDown||o.JoyLeftLeft||o.JoyLeftRight)&&v.mapping.JoyLeftMove(a),(o.JoyRightUp||o.JoyRightDown||o.JoyRightLeft||o.JoyRightRight)&&v.mapping.JoyRightMove(a),o.JoyLeftClick&&v.mapping.JoyLeftClick(a),o.JoyRightClick&&v.mapping.JoyRightClick(a),o.BumpLeft&&v.mapping.BumpLeft(a),o.BumpRight&&v.mapping.BumpRight(a),o.TrigLeft&&v.mapping.TrigLeft(a),o.TrigRight&&v.mapping.TrigRight(a),o.A&&v.mapping.A(a),o.B&&v.mapping.B(a),o.X&&v.mapping.X(a),o.Y&&v.mapping.Y(a),o.Start&&v.mapping.Start(a),o.Select&&v.mapping.Select(a),o.Power&&v.mapping.Power(a),o.Home&&v.mapping.Home(a),o.Misc&&v.mapping.Misc(a),o.DpadUp&&v.mapping.DpadUp(a),o.DpadDown&&v.mapping.DpadDown(a),o.DpadLeft&&v.mapping.DpadLeft(a),o.DpadRight&&v.mapping.DpadRight(a)},this.onDisconnect=function(t){if(!t||!this.gamepad)return!1;if(this.gamepad.id!==t.id)throw new Error("Gamepad id does not match!");this.gamepad.remove(),this.gamepad=null},this.init(e)},O.prototype.Mesh=p;const P=new O;p.prototype[P.id]=P})()})();
//# sourceMappingURL=mapboxgl-geoflo.min.js.map