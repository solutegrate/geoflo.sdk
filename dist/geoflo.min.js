/*! For license information please see https://sdk.geoflo.pro/geoflo.min.js.LICENSE.txt */

/*! 
 * GeoFlo SDK
 * Version 1.1.0
 * Generated on: 2025-03-14T20:32:26.107Z
 * Copyright (c) 2022 - present | @solutegrate/geoflo
 */

(()=>{"use strict";var t,e,r={},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={exports:{}};return r[t](i,i.exports,o),i.exports}o.m=r,o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,r)=>(o.f[r](t,e),e)),[])),o.u=t=>"geoflo."+{38:"pinning",91:"routing",173:"exploring",320:"gaming",759:"painting"}[t]+".min.js",o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),t={},e="@solutegrate/geoflo:",o.l=(r,n,i,a)=>{if(t[r])t[r].push(n);else{var s,c;if(void 0!==i)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var p=u[l];if(p.getAttribute("src")==r||p.getAttribute("data-webpack")==e+i){s=p;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.setAttribute("data-webpack",e+i),s.src=r),t[r]=[n];var d=(e,n)=>{s.onerror=s.onload=null,clearTimeout(f);var o=t[r];if(delete t[r],s.parentNode&&s.parentNode.removeChild(s),o&&o.forEach((t=>t(n))),e)return e(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=d.bind(null,s.onerror),s.onload=d.bind(null,s.onload),c&&document.head.appendChild(s)}},o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.p="https://sdk.geoflo.pro/",(()=>{var t={792:0};o.f.j=(e,r)=>{var n=o.o(t,e)?t[e]:void 0;if(0!==n)if(n)r.push(n[2]);else{var i=new Promise(((r,o)=>n=t[e]=[r,o]));r.push(n[2]=i);var a=o.p+o.u(e),s=new Error;o.l(a,(r=>{if(o.o(t,e)&&(0!==(n=t[e])&&(t[e]=void 0),n)){var i=r&&("load"===r.type?"missing":r.type),a=r&&r.target&&r.target.src;s.message="Loading chunk "+e+" failed.\n("+i+": "+a+")",s.name="ChunkLoadError",s.type=i,s.request=a,n[1](s)}}),"chunk-"+e,e)}};var e=(e,r)=>{var n,i,[a,s,c]=r,u=0;if(a.some((e=>0!==t[e]))){for(n in s)o.o(s,n)&&(o.m[n]=s[n]);if(c)c(o)}for(e&&e(r);u<a.length;u++)i=a[u],o.o(t,i)&&t[i]&&t[i][0](),t[i]=0},r=self.webpackChunk_solutegrate_geoflo=self.webpackChunk_solutegrate_geoflo||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})();var i="geoflo";const a={developer:"solutegrate",id:i,logo:{full:"https://".concat(i,".s3.amazonaws.com/logos/logo_full_white.png"),icon:"https://".concat(i,".s3.amazonaws.com/logos/logo_icon_white.svg"),fullClass:i+"-logo",iconClass:i+"-icon"},controls:[[{type:"utils",enable:!0,position:"top-center",group:"action",divider:!0,show:!0,buttons:{repeat:!0,zoom:!0,refresh:!0,locate:!0}},{type:"modes",enable:!0,group:"control",divider:!0,show:!0,buttons:{select:!0,edit:!0,save:!0}},{type:"options",enable:!0,group:"action",divider:!1,show:!0,buttons:{import:!0,export:!0,clear:!0,undo:!0,redo:!0,cancel:!0}}],[{type:"types",enable:!0,position:"top-center",group:"control",divider:!0,show:!0,buttons:{polyline:!0,polygon:!0,rectangle:!0,circle:!0,text:!0}},{type:"actions",enable:!0,group:"control",divider:!1,show:!0,buttons:{snapping:!0,pinning:!0,routing:!0,exploring:!0,painting:!0}}]],constants:{classes:{PREDEFINED_CONTROL_BASE:"mapboxgl-ctrl",PREDEFINED_CONTROL_GROUP:"mapboxgl-ctrl-group",CONTROL_PREFIX:"mapboxgl-ctrl-",ACTION_BUTTON:i+"-action-btn",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_RECTANGLE:"mapbox-gl-draw_rectangle",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TEXT:"mapbox-gl-draw_text",CONTROL_BUTTON_ICON:"mapbox-gl-draw_icon",CONTROL_BUTTON_CLEAR:i+"-delete-data",CONTROL_BUTTON_DELETE_SNAP:i+"-delete-snap-data",CONTROL_BUTTON_LOCATE:i+"-locate",CONTROL_BUTTON_ZOOM_IN_FEATURES:i+"-zoom-in-features",CONTROL_BUTTON_HIDE_SELECTED:i+"-hide-selected",CONTROL_BUTTON_ADD_FEATURE_TO_GRID:i+"-add-feature-to-grid",CONTROL_BUTTON_CREATE_POLYGON:i+"-create-polygon",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_BUTTON_GROUP_FEATURES:i+"-group-features",CONTROL_BUTTON_UNGROUP_FEATURES:i+"-ungroup-features",CONTROL_BUTTON_DOWNLOAD_WAYS:i+"-download-ways",CONTROL_BUTTON_DOWNLOAD_BUILDINGS:i+"-download-buildings",CONTROL_BUTTON_REFRESH:i+"-refresh",CONTROL_BUTTON_EDIT:i+"-edit",CONTROL_BUTTON_CUT:i+"-cut",CONTROL_BUTTON_SELECT:i+"-select",CONTROL_BUTTON_DOWNLOAD_DATA:i+"-download-data",CONTROL_BUTTON_EXPORT:i+"-export",CONTROL_BUTTON_SAVE_AS_GIST:i+"-save-as-gist",CONTROL_BUTTON_SAVE_AS_GEOJSON:i+"-save-as-geojson",CONTROL_BUTTON_SAVE_AS_KML:i+"-save-as-kml",CONTROL_BUTTON_EXPAND_EDITOR:i+"-expand-editor",CONTROL_BUTTON_IMPORT:i+"-import",CONTROL_BUTTON_FINSIH:i+"-finish",CONTROL_BUTTON_CANCEL:i+"-cancel",CONTROL_BUTTON_UNDO:i+"-undo",CONTROL_BUTTON_REDO:i+"-redo",CONTROL_BUTTON_SNAPPING:i+"-snapping",CONTROL_BUTTON_PINNING:i+"-pinning",CONTROL_BUTTON_ROUTING:i+"-routing",CONTROL_BUTTON_EXPLORING:i+"-exploring",CONTROL_BUTTON_PAINTING:i+"-painting",CONTROL_BUTTON_REPEAT:i+"-repeat",CONTROL_GROUP:i+"-ctrl-group",DROPDOWN_GROUP:i+"-dropdown-group",DIVIDER:i+"-divider",ACTION_GROUP:i+"-action-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources:{SELECT:i+"-select",SNAP:i+"-snap",PIN:i+"-pin",ROUTE:i+"-route",HOT:i+"-hot",COLD:i+"-cold",MESH:i+"-mesh",VERTEX:i+"-vertex",HOTTEXT:i+"-text",COLDTEXT:i+"-coldtext",GAMEPAD:i+"-gamepad"},layers:{MESH:i+"-mesh"},cursors:{ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types:{POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes:{FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes:{DRAW:"draw",CUT:"cut",SELECT:"select",DELETE:"delete",EDIT:"edit"},events:{CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions:{MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},meta:{FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates:{ACTIVE:"true",INACTIVE:"false"},LAT_MIN:-90,LAT_RENDERED_MIN:-85,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270,MIN_SEGMENT_LENGTH:1e-6,MIN_DISTANCE:1e-5,CIRCUM:40075017}};var s={theme:"dark",showLineUnits:!1,showFeatureText:!0,controls:!1,map:{container:"map",center:[-95.52816680236892,39.56431143986035],zoom:3.5,opacity:1,maxPitch:70,projection:"mercator",style:"Dark",hash:!0,extent:[[[-127.3638459,49.6212752],[-73.7295136,49.6212752],[-73.7295136,24.7473201],[-127.3638459,24.7473201],[-127.3638459,49.6212752]]]},styles:[{title:"Dark",uri:"mapbox://styles/mapbox/dark-v11"},{title:"Light",uri:"mapbox://styles/mapbox/light-v11"},{title:"Outdoors",uri:"mapbox://styles/mapbox/outdoors-v12"},{title:"Streets",uri:"mapbox://styles/mapbox/navigation-night-v1"},{title:"Satellite",uri:"mapbox://styles/mapbox/standard-satellite"},{title:"Standard",uri:"mapbox://styles/mapbox/standard"}],layers:{custom:[]},keys:{import:"u",export:"d",delete:"Delete",cancel:"Escape",select:"Escape",edit:"Enter",refresh:"r",snapping:"!",pinning:"@",routing:"#",exploring:"$",painting:"%",polyline:"1",polygon:"2",rectangle:"3",circle:"4",text:"5"},commands:[{key:".",modifier:!1,command:function(t,e,r){var n={lngLat:e.map.getCenter()};"draw"===e.currentMode.id?(e.currentMode.handleUp(n),e.currentMode.handleClick(n)):e.currentMode.handleClick(n)}}],units:{Polyline:"feet",Polygon:"acres",Rectangle:"acres",Icon:"feature",Circle:"feature",Marker:"feature"},colors:{error:"#ff7676",primaryColor:"#d7ef7e",primaryBackground:"#5a5a5a",primaryText:"#c5c5c5",primaryBorder:"#6fafdb",secondaryColor:"#6fafdb",secondaryBackground:"#333333",secondaryText:"#333333",secondaryBorder:"#404040",primarySelect:"#333333",primaryEdit:"#d7ef7e",primaryHot:"#d7ef7e",primaryCold:"#6fafdb",primarySnap:"#d7ef7e",primaryBase:"#c5c5c5",primaryDebug:"#ff7676",primaryVertex:"#d7ef7e",secondarySelect:"#c5c5c5",secondaryEdit:"#c5c5c5",secondaryHot:"#242424",secondaryCold:"#c5c5c5",secondarySnap:"#6fafdb",secondaryBase:"#5a5a5a",secondaryDebug:"#d7ef7e",secondaryVertex:"#333333"},select:{popup:!1,multiple:!1},snapping:{enable:!1,pixels:!1,distance:321.8688,tolerance:.002},routing:{enable:!1,precision:15e-7},pinning:{enable:!1,buffer:50/5280*1.609344,idle:20},exploring:{enable:!1,minZoom:9,buffer:1.5240000000000002,tolerance:1e-5},moving:{enable:!1,distance:9144e-7},painting:{enable:!1,tolerance:5e-6},gaming:{enable:!0,debug:!1,crosshairs:!0,joystick:{min:.2,max:.7},camera:{free:!0},pan:{speed:.001,min:.001,max:.05},bearing:{speed:.8},pitch:{speed:1.5,max:70},zoom:{speed:.008},rumble:{startDelay:0,duration:200,weakMagnitude:1,strongMagnitude:1},mapping:{Select:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&t.geoflo.getButtons("clear").button.click()},Start:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type&&t.gamepad.hasJoysticks){var e="select"===t.mode.id?"edit":"select";t.geoflo.getButtons(e).button.click()}},Power:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&t.geoflo.getButtons("save").button.click()},Menu:function(t){"press"===t.type||"hold"===t.type||t.type},Misc:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type&&t.gamepad.hasJoysticks){t.geoflo.getButtons("zoom").button.click();var e=setInterval((function(){ctx.mapMoving||(clearInterval(e),t.gamepad.map.center=t.geoflo.map.getCenter(),t.gamepad.map.zoom=t.geoflo.map.getZoom())}),1)}},A:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type)if(t.gamepad.hasJoysticks)t.geoflo.getButtons("routing").button.click();else if(!t.gamepad.pressed.BumpLeft&&!t.gamepad.pressed.BumpRight)return this.JoyLeftClick(t)},B:function(t){if("press"===t.type);else if("hold"===t.type);else if("release"===t.type)if(t.gamepad.hasJoysticks)t.geoflo.getButtons("painting").button.click();else if(!t.gamepad.pressed.BumpLeft&&!t.gamepad.pressed.BumpRight)return this.JoyRightClick(t)},Y:function(t){"press"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft||t.gamepad.pressed.BumpRight)&&t.gamepad.setSpeed(t.value,!1):"hold"===t.type||"release"===t.type&&t.gamepad.hasJoysticks&&t.geoflo.getButtons("snapping").button.click()},X:function(t){"press"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft||t.gamepad.pressed.BumpRight)&&t.gamepad.setSpeed(t.value,!0):"hold"===t.type||"release"===t.type&&t.gamepad.hasJoysticks&&t.geoflo.getButtons("pinning").button.click()},JoyLeftMove:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setCenter(t.value,t.gamepad.options.camera.free):"release"===t.type&&t.gamepad.setCenter(!1,t.gamepad.options.camera.free))},JoyRightMove:function(t){"press"===t.type||("hold"===t.type?t.name.includes("Up")||t.name.includes("Down")?t.gamepad.setPitch(t.value,t.name.includes("Up")):(t.name.includes("Left")||t.name.includes("Right"))&&t.gamepad.setBearing(t.value,t.name.includes("Left")):t.type)},JoyLeftClick:function(t){"press"===t.type||"hold"===t.type||"release"===t.type&&"draw"===t.mode.id&&t.mode.deleteVertex()},JoyRightClick:function(t){if("press"===t.type){if("draw"===t.mode.id)return!!t.lngLat&&t.mode.handleDown(t)}else if("hold"===t.type);else if("release"===t.type){if(!t.lngLat)return!1;"draw"===t.mode.id?(t.mode.handleUp(t),t.mode.handleClick(t)):t.mode.handleClick(t)}},BumpLeft:function(t){if("press"===t.type){if(t.gamepad.hasJoysticks)return t.gamepad.setSpeed(t.value,!0);if(t.gamepad.pressed.BumpRight)return!1}else"hold"===t.type?t.gamepad.hasJoysticks:t.type},BumpRight:function(t){if("press"===t.type){if(t.gamepad.hasJoysticks)return t.gamepad.setSpeed(t.value,!1);if(t.gamepad.pressed.BumpLeft)return!1}else"hold"===t.type||t.type},TrigLeft:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setZoom(t.value,!0):t.type)},TrigRight:function(t){"press"===t.type||("hold"===t.type?t.gamepad.setZoom(t.value,!1):t.type)},DpadUp:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setPitch(t.value,!0):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.geoflo.getButtons("polygon").button.click())},DpadDown:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setPitch(t.value,!1):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.geoflo.getButtons("circle").button.click())},DpadLeft:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setBearing(t.value,!0):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.geoflo.getButtons("polyline").button.click())},DpadRight:function(t){"press"===t.type||("hold"===t.type?t.gamepad.hasJoysticks||(t.gamepad.pressed.BumpLeft&&t.gamepad.pressed.BumpRight?t.gamepad.setBearing(t.value,!1):t.gamepad.setCenter(t.value,t.gamepad.options.camera.free)):"release"===t.type&&t.gamepad.hasJoysticks&&t.geoflo.getButtons("rectangle").button.click())}}}};const c=s;function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?l(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function d(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}const f=function(){this.geoflo;this.getRandomColor=function(){for(var t="#",e=0;e<6;e++)t+="0123456789ABCDEF"[Math.floor(16*Math.random())];return t},this.getFeatureId=function(t){return t.parent||t.properties.parent||t.id||t.properties.id},this.setProperty=function(t,e,r){if(!t)return!1;var n=t.properties;n||(n={},t.properties=n),e.includes(".")?(n[(e=e.split("."))[0]]||(n[e[0]]={}),n[e[0]][e[1]]=r):n[e]=r},this.setProperties=function(t,e){t.properties=Object.assign(t.properties||{},e)},this.isPointEqual=function(t,e){return t[0]===e[0]&&t[1]===e[1]},this.isPoint=function(t){return!!t&&"Point"===t.geometry.type},this.isPolygon=function(t){var e=t.geometry.coordinates,r=e[0],n=e[e.length-1];return this.isPointEqual(r,n)},this.isLineString=function(t){return!!t&&"LineString"===t.geometry.type},this.isValidLineString=function(t){return!!this.isLineString(t)&&!(t.geometry.coordinates.length<2)},this.isLastIndex=function(t,e){return!!e&&(this.isLineString(e)?t==e.geometry.coordinates.length-1:this.isPolygon(e)?t==e.geometry.coordinates[0].length-1:0==t)},this.getLastIndexCoords=function(t){return this.isLineString(t)?t.geometry.coordinates[t.geometry.coordinates.length-1]:this.isPolygon(t)?t.geometry.coordinates[0][t.geometry.coordinates.length-1]:t.geometry.coordinates},this.isEmptyLineString=function(t){if("LineString"===t.geometry.type){var e=t.geometry.coordinates;if(2===e.length){var r=e[0],n=e[e.length-1];return this.isPointEqual(r,n)}}return!1},this.reducePrecision=function(t){return t[0]=Number(Number(t[0]).toFixed(7)),t[1]=Number(Number(t[1]).toFixed(7)),t},this.stringToDOM=function(t){return(new DOMParser).parseFromString(t,"text/xml")},this.combineSameTypeFeatures=function(t){var e=[];return t.forEach((function(t){if(0===e.length)e.push.apply(e,d(t.geometry.coordinates));else{var r=e[0],n=e[e.length-1],o=t.geometry.coordinates[0],i=t.geometry.coordinates[t.geometry.coordinates.length-1];if(this.isPointEqual(n,o))e.push.apply(e,d(t.geometry.coordinates.slice(1,t.geometry.coordinates.length)));else if(this.isPointEqual(n,i))e.push.apply(e,d(t.geometry.coordinates.slice(0,t.geometry.coordinates.length-1).reverse()));else if(this.isPointEqual(r,i))e.splice.apply(e,[0,0].concat(d(t.geometry.coordinates.slice(0,t.geometry.coordinates.length-1))));else if(this.isPointEqual(r,o))e.splice.apply(e,[0,1].concat(d(t.geometry.coordinates.reverse())));else{turf.distance(n,o)<turf.distance(n,i)?e.push.apply(e,d(t.geometry.coordinates)):e.push.apply(e,d([].concat(d(t.geometry.coordinates)).reverse()))}}}),this),e},this.degrees2meters=function(t){var e=20037508.34*t[0]/180,r=Math.log(Math.tan((90+t[1])*Math.PI/360))/(Math.PI/180);return[e,r=20037508.34*r/180]},this.meters2degrees=function(t){return[180*t[0]/20037508.34,360*Math.atan(Math.exp(t[1]*Math.PI/20037508.34))/Math.PI-90]},this.extend=function(){for(var t=1;t<arguments.length;t++)for(var e in arguments[t])arguments[t].hasOwnProperty(e)&&(arguments[0][e]=arguments[t][e]);return arguments[0]},this.clone=function(t,e){var r={};return t instanceof Array?t.map((function(t){return this.clone(t,e)}),this):t instanceof Date?new Date(t):t instanceof RegExp?new RegExp(t):t instanceof Function?e&&e.newFns?new Function("return "+t.toString())():t:t instanceof Object?(Object.keys(t).forEach((function(n){r[n]=this.clone(t[n],e)}),this),r):[void 0,null].indexOf(t)>-1?t:"Symbol"===t.constructor.name?Symbol(t.toString().replace(/^Symbol\(/,"").slice(0,-1)):t.__proto__.constructor(t)},this.cloneDeep=function(t,e){var r=Object.prototype.hasOwnProperty,n=Object.prototype.toString;function o(t,e){switch(s(t)){case"object":return function(t,e){if(i(t)){var n={};return function(t,e,n){a(t,(function(o,i){if(r.call(t,i))return e.call(n,t[i],i,t)}))}(t,(function(t,r){this[r]=o(t,e)}),n),n}return e?e(t):t}(t,e);case"array":return function(t,e){var r=t.length,n=[],i=-1;for(;++i<r;)n[i]=o(t[i],e);return n}(t,e);default:return l(t)}}function i(t){return null!=t&&"object"===p(t)&&!1===Array.isArray(t)}function a(t,e,r){for(var n in t)if(!1===e.call(r,t[n],n,t))break}function s(t){if(void 0===t)return"undefined";if(null===t)return"null";if(!0===t||!1===t||t instanceof Boolean)return"boolean";if("string"==typeof t||t instanceof String)return"string";if("number"==typeof t||t instanceof Number)return"number";if("function"==typeof t||t instanceof Function)return"function";if(void 0!==Array.isArray&&Array.isArray(t))return"array";if(t instanceof RegExp)return"regexp";if(t instanceof Date)return"date";var e=n.call(t);return"[object RegExp]"===e?"regexp":"[object Date]"===e?"date":"[object Arguments]"===e?"arguments":"[object Error]"===e?"error":c(t)?"buffer":"[object Set]"===e?"set":"[object WeakSet]"===e?"weakset":"[object Map]"===e?"map":"[object WeakMap]"===e?"weakmap":"[object Symbol]"===e?"symbol":"[object Int8Array]"===e?"int8array":"[object Uint8Array]"===e?"uint8array":"[object Uint8ClampedArray]"===e?"uint8clampedarray":"[object Int16Array]"===e?"int16array":"[object Uint16Array]"===e?"uint16array":"[object Int32Array]"===e?"int32array":"[object Uint32Array]"===e?"uint32array":"[object Float32Array]"===e?"float32array":"[object Float64Array]"===e?"float64array":"object"}function c(t){return null!=t&&(function(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&c(t.slice(0,0))}(t)||!!t._isBuffer)}function u(t){return null!=t&&("object"===p(t)||"function"==typeof t)}function l(t){var e=s(t);return l.hasOwnProperty(e)?l[e](t):t}return l.array=function(t){return t.slice()},l.date=function(t){return new Date(+t)},l.object=function(t){return u(t)?function(t,e){if(!u(t))throw new TypeError("mixin-object expects the first argument to be an object.");for(var r=arguments.length,n=0;++n<r;){var o=arguments[n];u(o)&&a(o,copy,t)}return t}({},t):t},l.regexp=function(t){var e="";return e+=t.multiline?"m":"",e+=t.global?"g":"",e+=t.ignorecase?"i":"",new RegExp(t.source,e)},o(t,e)},this.assignDeep=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.isMutatingOk,o=void 0!==n&&n;r.isStrictlySafe;t=o?t:this.cloneDeep(t);for(var i=0,a=Object.entries(e);i<a.length;i++){var s=u(a[i],2),c=s[0],l=s[1];null!==l&&"object"===p(l)?(void 0===t[c]&&(t[c]={}),t[c]=this.assignDeep(t[c],l,{isMutatingOk:!0})):t[c]=l}return t},this.compareDeep=function(){var t,e,r,n;function o(t,e){var i;if(isNaN(t)&&isNaN(e)&&"number"==typeof t&&"number"==typeof e)return!0;if(t===e)return!0;if("function"==typeof t&&"function"==typeof e||t instanceof Date&&e instanceof Date||t instanceof RegExp&&e instanceof RegExp||t instanceof String&&e instanceof String||t instanceof Number&&e instanceof Number)return t.toString()===e.toString();if(!(t instanceof Object&&e instanceof Object))return!1;if(t.isPrototypeOf(e)||e.isPrototypeOf(t))return!1;if(t.constructor!==e.constructor)return!1;if(t.prototype!==e.prototype)return!1;if(r.indexOf(t)>-1||n.indexOf(e)>-1)return!1;for(i in e){if(e.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;if(p(e[i])!==p(t[i]))return!1}for(i in t){if(e.hasOwnProperty(i)!==t.hasOwnProperty(i))return!1;if(p(e[i])!==p(t[i]))return!1;switch(p(t[i])){case"object":case"function":if(r.push(t),n.push(e),!o(t[i],e[i]))return!1;r.pop(),n.pop();break;default:if(t[i]!==e[i])return!1}}return!0}if(arguments.length<1)return!0;for(t=1,e=arguments.length;t<e;t++)if(r=[],n=[],!o(arguments[0],arguments[t]))return!1;return!0},this.consumableArray=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)},this.rgba=function(t,e){if(!t)return!1;if(t=t.trim(),/^rgba?\(/.test(t))return t;var r=t.match(/^#([\da-f]{3,8})$/i);if(!r)return!1;var n,o,i,a=r[1],s=255;if(3===a.length)n=parseInt(a[0]+a[0],16),o=parseInt(a[1]+a[1],16),i=parseInt(a[2]+a[2],16);else if(4===a.length)n=parseInt(a[0]+a[0],16),o=parseInt(a[1]+a[1],16),i=parseInt(a[2]+a[2],16),s=parseInt(a[3]+a[3],16);else if(6===a.length)n=parseInt(a.slice(0,2),16),o=parseInt(a.slice(2,4),16),i=parseInt(a.slice(4,6),16);else{if(8!==a.length)return!1;n=parseInt(a.slice(0,2),16),o=parseInt(a.slice(2,4),16),i=parseInt(a.slice(4,6),16),s=parseInt(a.slice(6,8),16)}var c=void 0!==e?e/100:s/255;return"rgba(".concat(n,", ").concat(o,", ").concat(i,", ").concat(c.toFixed(2),")")},this.hex=function(t,e){if(!t)return!1;if(t=t.trim(),/^#([\da-f]{3,8})$/i.test(t))return t;var r=t.match(/^rgba?\(\s*(\d+),\s*(\d+),\s*(\d+),?\s*([\d.]+)?\s*\)$/i);if(!r)return!1;var n=parseInt(r[1]).toString(16).padStart(2,"0"),o=parseInt(r[2]).toString(16).padStart(2,"0"),i=parseInt(r[3]).toString(16).padStart(2,"0"),a=void 0!==e?Math.round(255*e).toString(16).padStart(2,"0"):"";return"#".concat(n).concat(o).concat(i).concat(a)}};function h(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return g(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function g(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}const m=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.geoflo;this.options=t,this.init=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=Object.assign(this.options,t),this.selected=this.options.selected||"Dark",this.onDocumentClick=this.onDocumentClick.bind(this),this.events=this.options.eventListeners,this},this.select=function(t){if(!this.mapStyleContainer||!this.mapStyleContainer.checkVisibility()){var e=this.options.styles.find((function(e){return e.title===t}));if(e&&(this.map.setStyle(e.uri),this.selected=t),this.events&&this.events.onChange&&this.events.onChange({style:e},e))return}var r=this.mapStyleContainer.getElementsByClassName(t);r.length>0&&r[0].click()},this.hide=function(){this.controlContainer&&(this.controlContainer.style.display="none")},this.show=function(){this.controlContainer&&(this.controlContainer.style.display="block")},this.getDefaultPosition=function(){return"top-right"},this.onAdd=function(t){var e=this;this.map=t,this.controlContainer=document.createElement("div"),this.controlContainer.classList.add("mapboxgl-ctrl"),this.controlContainer.classList.add("mapboxgl-ctrl-group"),this.mapStyleContainer=document.createElement("div"),this.styleButton=document.createElement("button"),this.styleButton.type="button",this.mapStyleContainer.classList.add("mapboxgl-style-list");var r,n=h(this.options.styles);try{for(n.s();!(r=n.n()).done;){var o=r.value,i=document.createElement("button");i.type="button",i.classList.add(o.title.replace(/[^a-z0-9-]/gi,"_")),i.dataset.uri=JSON.stringify(o.uri),i.addEventListener("click",(function(t){var r=t.target||t.srcElement;if(e.closeModal(),!(r.classList.contains("active")||e.events&&e.events.onOpen&&e.events.onOpen(t))){var n=JSON.parse(r.dataset.uri);e.map.setStyle(n);for(var o=e.mapStyleContainer.getElementsByClassName("active");o[0];)o[0].classList.remove("active");r.classList.add("active"),e.events&&e.events.onChange&&e.events.onChange(t,n)}})),o.title===this.selected&&i.classList.add("active"),this.mapStyleContainer.appendChild(i)}}catch(t){n.e(t)}finally{n.f()}return this.styleButton.classList.add("mapboxgl-ctrl-icon"),this.styleButton.classList.add("mapboxgl-style-switcher"),this.styleButton.addEventListener("click",(function(t){e.events&&e.events.onSelect&&e.events.onSelect(t)||e.openModal()})),document.addEventListener("click",this.onDocumentClick),this.controlContainer.appendChild(this.styleButton),this.controlContainer.appendChild(this.mapStyleContainer),this.closeModal(),this.controlContainer},this.onRemove=function(){this.controlContainer&&this.controlContainer.parentNode&&this.map&&this.styleButton&&(this.styleButton.removeEventListener("click",this.onDocumentClick),this.controlContainer.parentNode.removeChild(this.controlContainer),document.removeEventListener("click",this.onDocumentClick),this.map=void 0)},this.closeModal=function(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="none",this.styleButton.style.display="block")},this.openModal=function(){this.mapStyleContainer&&this.styleButton&&(this.mapStyleContainer.style.display="block",this.styleButton.style.display="none")},this.onDocumentClick=function(t){this.controlContainer&&!this.controlContainer.contains(t.target)&&this.closeModal()},this.init()};function y(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,e)||b(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=b(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function b(t,e){if(t){if("string"==typeof t)return x(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?x(t,e):void 0}}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function E(){E=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof y?e:y,a=Object.create(i.prototype),s=new N(n||[]);return o(a,"_invoke",{value:O(t,r,s)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",f="suspendedYield",h="executing",g="completed",m={};function y(){}function v(){}function b(){}var x={};u(x,a,(function(){return this}));var L=Object.getPrototypeOf,C=L&&L(L(D([])));C&&C!==r&&n.call(C,a)&&(x=C);var S=b.prototype=y.prototype=Object.create(x);function T(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function r(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==w(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function O(e,r,n){var o=d;return function(i,a){if(o===h)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=F(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?g:f,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function F(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,F(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function D(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(w(e)+" is not iterable")}return v.prototype=b,o(S,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(S),t},e.awrap=function(t){return{__await:t}},T(M.prototype),u(M.prototype,s,(function(){return this})),e.AsyncIterator=M,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new M(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},T(S),u(S,c,"Generator"),u(S,a,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=D,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),P(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:D(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function L(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function C(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){L(i,n,o,a,s,"next",t)}function s(t){L(i,n,o,a,s,"throw",t)}a(void 0)}))}}function S(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function T(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?S(Object(r),!0).forEach((function(e){M(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):S(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function M(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=w(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=w(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==w(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const O=function(){var t=this,e=this.geoflo;if(!e.map)throw new Error("No map object provided!");var r=e.map,n=e.id,o={Polygon:["-fill","-border"],Polyline:["-line","-dash","-buffer"],Point:["-circle","-icon","-cluster-circle","-cluster-icon","-count-icon","-count-text"],Image:["-image"],All:["-fill","-border","-line","-dash","-buffer","-circle","-icon","-cluster-circle","-cluster-icon","-count-icon","-count-text","-image"]};function i(){return a.apply(this,arguments)}function a(){return a=C(E().mark((function t(){var e,r,n=this,o=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=o.length>0&&void 0!==o[0]?o[0]:[],r=o.length>1&&void 0!==o[1]?o[1]:{},t.next=4,u.call(this);case 4:if(e.length){t.next=6;break}return t.abrupt("return",!1);case 6:return t.next=8,Promise.all(e.map((function(t){return s.call(n,t,r)})));case 8:return setTimeout((function(){n.moveLayers()}),250),t.abrupt("return",this.getLayers());case 10:case"end":return t.stop()}}),t,this)}))),a.apply(this,arguments)}function s(t,e){return c.apply(this,arguments)}function c(){return c=C(E().mark((function t(n,i){var a,s,c,u,l,d,h,m,y,v,x,w,S,M=this;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=!n.details&&n.id?n:n.details||{},c=n.options||{},u=n.layers||[],l=n.features||[],d=l&&l.length,h=n.style||!1,s.id&&s.type||(a=!0),(m="ALL"===s.type?"ALL":this.getType(s.type))||(a=!0),y={type:s.type},s.default?y.default=!0:y.custom=!0,s.name&&(y.name=s.name),v=s.source||s.id,y.source=v,s.style&&delete s.style,!(x={type:m,source:v,id:s.id,types:o[m],style:h||{},filter:n.filter,images:n.images,details:s,options:c,layers:u}).images){t.next=19;break}return t.next=19,L(x.images);case 19:if("ALL"!==m){t.next=27;break}return w=Object.keys(o).filter((function(t){return"All"!==t})).map(function(){var t=C(E().mark((function t(e){var r;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=T(T({},x),{},{type:e,types:o[e]}),"Image"!==e){t.next=5;break}return t.abrupt("return",p.call(M,r,c));case 5:if("Polygon"!==e){t.next=9;break}return t.abrupt("return",f.call(M,r,c));case 9:if("Polyline"!==e){t.next=13;break}return t.abrupt("return",g.call(M,r,c));case 13:if("Point"!==e){t.next=17;break}return t.abrupt("return",b.call(M,r,c));case 17:return t.abrupt("return",[]);case 18:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=23,Promise.all(w);case 23:S=t.sent,u=S.flat(),t.next=56;break;case 27:if("Image"!==m){t.next=33;break}return t.next=30,p.call(this,x,c);case 30:t.t0=t.sent,t.next=55;break;case 33:if("Polygon"!==m){t.next=39;break}return t.next=36,f.call(this,x,c);case 36:t.t1=t.sent,t.next=54;break;case 39:if("Polyline"!==m){t.next=45;break}return t.next=42,g.call(this,x,c);case 42:t.t2=t.sent,t.next=53;break;case 45:if("Point"!==m){t.next=51;break}return t.next=48,b.call(this,x,c);case 48:t.t3=t.sent,t.next=52;break;case 51:t.t3=[];case 52:t.t2=t.t3;case 53:t.t1=t.t2;case 54:t.t0=t.t1;case 55:u=t.t0;case 56:return x.metadata=y,this.addSource(v,m,c),this.addLayers(u,y,x),d&&e.Features.addFeatures(l.map((function(t){return T(T({},t),{},{source:v})}))),t.abrupt("return",new Promise((function(t,n){if(a)return t(a);var o=setInterval((function(){var n=e.Layers.getFeatures(v);d&&!n.length||r.getSource(v)&&(clearInterval(o),t({layer:x,features:n}))}),1)})));case 61:case"end":return t.stop()}}),t,this)}))),c.apply(this,arguments)}function u(){return l.apply(this,arguments)}function l(){return(l=C(E().mark((function t(){return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,e){if(r.hasImage("text-marker"))return t(!0);r.loadImage("https://docs.mapbox.com/mapbox-gl-js/assets/popup.png",(function(n,o){return n?e(n):r.hasImage("text-marker")?t(o):(r.addImage("text-marker",o,{content:[25,25,115,100],stretchX:[[25,115]],stretchY:[[25,100]],pixelRatio:2,sdf:!1}),void t(o))}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(){return d.apply(this,arguments)}function d(){return d=C(E().mark((function t(){var e,r,n,o,i,a,s,c,u,l,p,d,f,h=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=h.length>1&&void 0!==h[1]?h[1]:{},(e=h.length>0&&void 0!==h[0]?h[0]:{}).source){t.next=4;break}return t.abrupt("return",[]);case 4:n=[],o=e.source,i=v(e.types);try{for(i.s();!(a=i.n()).done;)u=a.value,l=e.style,p=e.id+u,d=T(T({},d={visibility:r.visibility||"visible","icon-image":["get","primaryImage",["get","style",["properties"]]],"icon-size":["interpolate",["linear"],["zoom"],1,.6,10,.8,15,1],"icon-allow-overlap":!0,"icon-anchor":"bottom"}),(null===(s=l.image)||void 0===s?void 0:s.layout)||{}),f=T(T({},f={"icon-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]]}),(null===(c=l.image)||void 0===c?void 0:c.paint)||{}),(l={id:p,type:"symbol",source:o,slot:l.slot||"top",filter:e.filter||["==","$type","Point"],layout:d,paint:f}).minzoom&&(l.minzoom=l.minzoom),l.maxzoom&&(l.maxzoom=l.maxzoom),n.push(l)}catch(t){i.e(t)}finally{i.f()}return t.abrupt("return",n);case 9:case"end":return t.stop()}}),t)}))),d.apply(this,arguments)}function f(){return h.apply(this,arguments)}function h(){return h=C(E().mark((function t(){var e,r,n,o,i,a,s,c,u,l,p,d=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:{},(e=d.length>0&&void 0!==d[0]?d[0]:{}).source){t.next=4;break}return t.abrupt("return",[]);case 4:n=[],o=e.source,i=v(e.types);try{for(i.s();!(a=i.n()).done;)s=a.value,c=e.style,u=e.id+s,l=void 0,p=void 0,s.includes("border")?(l=T({visibility:r.visibility||"visible"},c.border&&c.border.layout||{}),p=T({"line-color":["get","primaryColor",["get","style",["properties"]]],"line-width":["case",["boolean",["has","width",["get","style",["properties"]]],!0],["get","width",["get","style",["properties"]]],2],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.8]},c.border&&c.border.paint||{}),c={id:u,type:"line",source:o,slot:c.slot||"bottom",filter:c.border&&c.border.filter||["==","$type","Polygon"],layout:l,paint:p}):s.includes("fill")&&(l=T({visibility:r.visibility||"visible"},c.fill&&c.fill.layout||{}),p=T({"fill-color":["get","secondaryColor",["get","style",["properties"]]],"fill-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.5]},c.fill&&c.fill.paint||{}),c={id:u,type:"fill",source:o,slot:c.slot||"bottom",filter:c.fill&&c.fill.filter||["==","$type","Polygon"],layout:l,paint:p}),e.style.minzoom&&(c.minzoom=e.style.minzoom),e.style.maxzoom&&(c.maxzoom=e.style.maxzoom),n.push(c)}catch(t){i.e(t)}finally{i.f()}return t.abrupt("return",n);case 9:case"end":return t.stop()}}),t)}))),h.apply(this,arguments)}function g(){return m.apply(this,arguments)}function m(){return m=C(E().mark((function t(){var e,r,n,o,i,a,s,c,u,l,p,d=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=d.length>1&&void 0!==d[1]?d[1]:{},(e=d.length>0&&void 0!==d[0]?d[0]:{}).source){t.next=4;break}return t.abrupt("return",[]);case 4:n=[],o=e.source,i=v(e.types);try{for(i.s();!(a=i.n()).done;)s=a.value,c=e.style,u=e.id+s,l=void 0,p=void 0,s.includes("line")&&(l=T({visibility:r.visibility||"visible","line-miter-limit":2,"line-join":"round","line-cap":"round"},c.line&&c.line.layout||{}),p=T({"line-color":["get","primaryColor",["get","style",["properties"]]],"line-width":["case",["boolean",["has","width",["get","style",["properties"]]],!0],["get","width",["get","style",["properties"]]],4],"line-offset":["case",["boolean",["has","offset"],!0],["get","offset"],0],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]},c.line&&c.line.paint||{}),c={id:u,type:"line",source:o,slot:c.slot||"middle",filter:c.line&&c.line.filter||["==","$type","LineString"],layout:l,paint:p}),e.style.minzoom&&(c.minzoom=e.style.minzoom),e.style.maxzoom&&(c.maxzoom=e.style.maxzoom),n.push(c)}catch(t){i.e(t)}finally{i.f()}return t.abrupt("return",n);case 9:case"end":return t.stop()}}),t)}))),m.apply(this,arguments)}function b(){return x.apply(this,arguments)}function x(){return x=C(E().mark((function t(){var r,n,o,i,a,s,c,u,l,p,d,f,h=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=h.length>1&&void 0!==h[1]?h[1]:{},(r=h.length>0&&void 0!==h[0]?h[0]:{}).source){t.next=4;break}return t.abrupt("return",[]);case 4:o=[],i=r.source,a=!1,s=v(r.types),t.prev=8,s.s();case 10:if((c=s.n()).done){t.next=68;break}if(u=c.value,l=r.style,p=r.id+u,d=void 0,f=void 0,!u.includes("circle")){t.next=29;break}if(!n.noCircle){t.next=18;break}return t.abrupt("continue",66);case 18:if(d=T({visibility:n.visibility||"visible"},l.circle&&l.circle.layout||{}),f=T({"circle-radius":10,"circle-stroke-width":2,"circle-color":["get","secondaryColor",["get","style",["properties"]]],"circle-stroke-color":["get","primaryColor",["get","style",["properties"]]],"circle-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]],"circle-stroke-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]]},l.circle&&l.circle.paint||{}),l={id:p,type:"circle",source:i,slot:l.slot||"top",filter:l.circle&&l.circle.filter||["==","$type","Point"],layout:d,paint:f},!u.includes("cluster")){t.next=27;break}if(!n.noCluster){t.next=24;break}return t.abrupt("continue",66);case 24:l.filter=["has","point_count"],l.paint["circle-color"]=n.secondaryColor||e.options.colors.secondaryColor,l.paint["circle-stroke-color"]=n.primaryColor||e.options.colors.primaryColor;case 27:t.next=61;break;case 29:if(!u.includes("icon")){t.next=52;break}if(!a){t.next=32;break}return t.abrupt("continue",66);case 32:if(d=T({visibility:n.visibility||"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-rotate":["get","rotate",["get","style",["properties"]]],"text-rotation-alignment":"viewport","text-size":14,"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},l.icon&&l.icon.layout||{}),f=T({"text-translate-anchor":"viewport","text-halo-color":["get","primaryColor",["get","style",["properties"]]],"text-halo-width":0,"text-color":["get","primaryColor",["get","style",["properties"]]],"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]]},l.icon&&l.icon.paint||{}),l={id:p,type:"symbol",source:i,slot:l.slot||"top",filter:l.icon&&l.icon.filter||["==","$type","Point"],layout:d,paint:f},!u.includes("cluster")){t.next=44;break}if(!n.noCluster){t.next=38;break}return t.abrupt("continue",66);case 38:l.filter=["has","point_count"],l.layout["text-field"]=n.primaryIcon||"",l.paint["text-halo-color"]=n.secondaryColor||e.options.colors.secondaryCold,l.paint["text-color"]=n.primaryColor||e.options.colors.secondaryText,t.next=50;break;case 44:if(!u.includes("count")){t.next=50;break}if(!n.noCluster){t.next=47;break}return t.abrupt("continue",66);case 47:l.filter=["has","point_count"],l.layout={visibility:n.visibility||"visible","icon-optional":!0,"text-field":n.countIcon||"","text-size":{base:14,stops:[[10,16],[14,14]]},"text-line-height":1,"text-padding":0,"text-offset":[.5,-.6],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},l.paint={"text-translate-anchor":"viewport","text-color":n.countIconColor||e.options.colors.primaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]};case 50:t.next=61;break;case 52:if(!u.includes("text")){t.next=61;break}if(!a){t.next=55;break}return t.abrupt("continue",66);case 55:if(!u.includes("count")){t.next=61;break}if(!n.noCluster){t.next=58;break}return t.abrupt("continue",66);case 58:d=T({"text-field":["get","point_count_abbreviated"],"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":{base:14,stops:[[10,14],[14,12]]},"text-offset":[.55,-.9]},l.text&&l.text.layout||{}),f=T({"text-color":n.countTextColor||e.options.colors.secondaryText,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,["get","opacity",["get","style",["properties"]]]]},l.text&&l.text.paint||{}),l={id:p,type:"symbol",source:i,slot:l.slot||"top",filter:["has","point_count"],layout:d,paint:f};case 61:if(l){t.next=63;break}return t.abrupt("continue",66);case 63:r.style.minzoom&&(l.minzoom=r.style.minzoom),r.style.maxzoom&&(l.maxzoom=r.style.maxzoom),o.push(l);case 66:t.next=10;break;case 68:t.next=73;break;case 70:t.prev=70,t.t0=t.catch(8),s.e(t.t0);case 73:return t.prev=73,s.f(),t.finish(73);case 76:return t.abrupt("return",o);case 77:case"end":return t.stop()}}),t,null,[[8,70,73,76]])}))),x.apply(this,arguments)}function L(){return S.apply(this,arguments)}function S(){return S=C(E().mark((function t(){var e,n,o,i,a=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=v(a.length>0&&void 0!==a[0]?a[0]:[]),t.prev=2,e.s();case 4:if((n=e.n()).done){t.next=15;break}if(o=n.value){t.next=8;break}return t.abrupt("continue",13);case 8:if(r.hasImage(o.id)){t.next=13;break}return t.next=11,M(o);case 11:(i=t.sent)&&r.addImage(o.id,i,{pixelRatio:2});case 13:t.next=4;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(2),e.e(t.t0);case 20:return t.prev=20,e.f(),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[2,17,20,23]])}))),S.apply(this,arguments)}function M(){return O.apply(this,arguments)}function O(){return O=C(E().mark((function t(){var e,n=arguments;return E().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((e=n.length>0&&void 0!==n[0]?n[0]:{}).url&&e.id){t.next=3;break}return t.abrupt("return",!1);case 3:return t.abrupt("return",new Promise((function(t,n){var o=e.url+"?"+(new Date).getTime();r.loadImage(o,(function(e,r){return e?n(e):t(r)}))})));case 4:case"end":return t.stop()}}),t)}))),O.apply(this,arguments)}function F(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getLayerIds();n.length&&n.forEach((function(n){e.off?(r.off("mousemove",n,t.onLayerMouseover),r.off("mouseleave",n,t.onLayerMouseout)):e.on&&(r.on("mousemove",n,t.onLayerMouseover),r.on("mouseleave",n,t.onLayerMouseout))}))}this.options={},this.layersMap=new Map,this.customLayersMap=new Map,this.sourcesMap=new Map,this.init=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=T(T({},this.options),t),this.defaultLayers=[{source:e.statics.constants.sources.COLD,id:n+"-fill-cold",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":e.options.colors.secondaryCold,"fill-opacity":["case",["boolean",["feature-state","hidden"],!0],0,.3]}},{source:e.statics.constants.sources.COLD,id:n+"-line-cold",type:"line",layout:{"line-cap":"round","line-join":"miter"},paint:{"line-color":e.options.colors.primaryCold,"line-width":4,"line-gap-width":["match",["get","type"],"Polygon",0,0],"line-offset":["case",["boolean",["has","offset"],!0],["get","offset"],0],"line-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:e.statics.constants.sources.COLD,id:n+"-circle-cold",filter:["all",["==",["get","type"],"Circle"],["!=",["geometry-type"],"Polygon"]],type:"circle",paint:{"circle-radius":{base:6,stops:[[10,8],[14,10]]},"circle-stroke-width":2,"circle-color":e.options.colors.primaryCold,"circle-stroke-color":e.options.colors.secondaryCold,"circle-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1],"circle-stroke-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:e.statics.constants.sources.COLD,id:n+"-icon-cold",type:"symbol",filter:["==",["get","type"],"Icon"],layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-width":0,"text-halo-color":e.options.colors.primaryCold,"text-color":e.options.colors.secondaryBackground,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:e.statics.constants.sources.COLD,id:n+"-text-cold",type:"symbol",filter:["==","$type","Point"],layout:{"symbol-placement":"point","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-size":18,"text-justify":["get","justify"],"text-letter-spacing":.05,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,0],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":e.options.colors.primaryCold,"text-halo-color":e.options.colors.primaryBackground,"text-halo-width":.5,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{source:e.statics.constants.sources.COLD,id:n+"-text-icon-cold",type:"symbol",filter:["==",["get","type"],"Text"],layout:{visibility:"visible","icon-optional":!0,"text-field":["get","primaryIcon",["get","style",["properties"]]],"text-size":{base:16,stops:[[10,16],[14,12]]},"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-width":0,"text-halo-color":e.options.colors.primaryCold,"text-color":e.options.colors.secondaryBackground,"text-opacity":["case",["boolean",["feature-state","hidden"],!0],0,1]}},{id:e.statics.constants.layers.MESH+"-line",source:e.statics.constants.sources.MESH,type:"line",paint:{"line-color":e.options.colors.primaryBase,"line-width":2,"line-opacity":.3}},{id:e.statics.constants.layers.MESH+"-circle",source:e.statics.constants.sources.MESH,type:"circle",paint:{"circle-radius":2,"circle-color":e.options.colors.primaryBase,"circle-opacity":.3}}],this.selectLayers=[{source:e.statics.constants.sources.SELECT,id:n+"-line-select-background",type:"line",layout:{visibility:"visible","line-cap":"round","line-join":"round"},paint:{"line-color":e.options.colors.primarySelect,"line-width":6,"line-opacity":.4},metadata:{types:["Polyline","Polygon","Rectangle"]}},{source:e.statics.constants.sources.SELECT,id:n+"-line-select",type:"line",layout:{visibility:"visible","line-cap":"round","line-join":"round"},paint:{"line-color":e.options.colors.secondarySelect,"line-width":6,"line-dasharray":[0,4,3]},metadata:{types:["Polyline","Polygon","Rectangle"]}},{source:e.statics.constants.sources.SELECT,id:n+"-fill-select",type:"fill",layout:{},filter:["==","$type","Polygon"],paint:{"fill-color":e.options.colors.primarySelect,"fill-opacity":.4},metadata:{types:["Polygon","Rectangle"]}},{source:e.statics.constants.sources.SELECT,id:n+"-point-select",filter:["all",["!=",["get","type"],"Text"],["==",["geometry-type"],"Point"]],type:"circle",layout:{visibility:"visible"},paint:{"circle-radius":10,"circle-stroke-width":3,"circle-color":e.options.colors.primarySelect,"circle-stroke-color":e.options.colors.secondarySelect,"circle-stroke-opacity":1,"circle-opacity":.8},metadata:{types:["Point","Circle","Marker","Icon"]}},{source:e.statics.constants.sources.SELECT,id:n+"-symbol-select",filter:["==",["get","type"],"Icon"],type:"symbol",layout:{visibility:"visible","icon-optional":!0,"symbol-placement":"point","text-rotation-alignment":"viewport","text-field":["get","primaryIcon",["get","style",["properties"]]],"text-rotate":["get","rotate",["get","style",["properties"]]],"text-size":14,"text-line-height":1,"text-padding":0,"text-offset":[0,.2],"text-justify":"auto","text-anchor":"center","text-allow-overlap":!0,"text-font":["Font Awesome 6 Pro Solid"],"text-ignore-placement":!0},paint:{"text-translate-anchor":"viewport","text-halo-color":e.options.colors.secondarySelect,"text-halo-width":2,"text-color":e.options.colors.primaryBackground},metadata:{types:["Icon"]}},{source:e.statics.constants.sources.SELECT,id:n+"-text-point-select",filter:["==",["get","type"],"Text"],type:"circle",layout:{visibility:"visible"},paint:{"circle-radius":4,"circle-stroke-width":1,"circle-color":e.options.colors.primaryColor,"circle-stroke-color":e.options.colors.primaryBackground,"circle-stroke-opacity":1,"circle-opacity":1},metadata:{types:["Text"]}},{source:e.statics.constants.sources.SELECT,id:n+"-text-select",filter:["==",["get","type"],"Text"],type:"symbol",layout:{visibility:"visible","symbol-placement":"point","text-rotation-alignment":"viewport","text-field":["get","text"],"text-font":["DIN Pro Regular","DIN Pro Italic","Arial Unicode MS Regular","DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-keep-upright":!0,"text-allow-overlap":!0,"text-size":18,"text-justify":["get","justify"],"text-letter-spacing":.13,"text-line-height":1.2,"text-max-angle":10,"text-offset":[0,-1],"text-padding":2,"text-rotate":0,"text-transform":["get","transform"]},paint:{"text-color":e.options.colors.primaryColor,"text-halo-color":e.options.colors.primaryBackground,"text-halo-width":2,"text-opacity":1},metadata:{types:["Text"]}},{source:e.statics.constants.sources.SELECT,id:n+"-image-select",filter:["==",["get","type"],"Image"],type:"symbol",layout:{visibility:"visible","icon-image":["get","primaryImage",["get","style",["properties"]]],"icon-size":["interpolate",["linear"],["zoom"],1,.4,15,1],"icon-allow-overlap":!0,"icon-anchor":"bottom"},metadata:{types:["Image"]}}],this.refresh({init:!0})},this.refresh=C(E().mark((function r(){var n,o,i,a,s,c=arguments;return E().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=c.length>0&&void 0!==c[0]?c[0]:{}).select){r.next=6;break}return o=t.selectLayers.map((function(t){return t.id})),i=o.map((function(e){return t.layersMap.get(e)})).filter(Boolean),t.moveLayers(i),r.abrupt("return",i);case 6:if(n.init){r.next=8;break}return r.abrupt("return",t.init(n));case 8:if(a=Array.from(t.customLayersMap.values()),t.removeEventListeners(),t.removeCustomLayers(),t.removeLayers(t.defaultLayers.map((function(t){return t.id}))),t.removeLayers(t.selectLayers.map((function(t){return t.id}))),s=Object.values(e.statics.constants.sources),t.removeSources(s),t.addSources(s),t.addLayers(t.defaultLayers,t.options),!a.length){r.next=20;break}return r.next=20,t.setCustomLayers(a,t.options);case 20:return t.addLayers(t.selectLayers,t.options),r.next=23,t.refresh({select:!0});case 23:return t.addEventListeners(),r.abrupt("return",t.getLayers());case 25:case"end":return r.stop()}}),r)}))),this.addEventListeners=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return F.call(t,T({on:!0},e))},this.removeEventListeners=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return F.call(t,T({off:!0},e))},this.hasCustomLayers=function(){return t.customLayersMap.size},this.getCustomLayers=function(){return Array.from(t.customLayersMap.values())},this.getCustomLayer=function(e){return!!e&&t.customLayersMap.get(e)},this.getSources=function(){return Array.from(t.sourcesMap.values())},this.getSource=function(e){return!!e&&t.sourcesMap.get(e)},this.getSourceIds=function(){return Array.from(t.sourcesMap.keys())},this.getLayers=function(){return Array.from(t.layersMap.values())},this.getLayer=function(e){return!!e&&(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?t.customLayersMap.get(e):t.layersMap.get(e))},this.getLayerIds=function(e){return Array.isArray(e)?e.map((function(t){return"object"===w(t)?t.id:t})):Array.from(t.layersMap.keys())},this.getLayerType=function(e){var r;return(null===(r=t.getLayer(e,!0))||void 0===r||null===(r=r.details)||void 0===r?void 0:r.type)||""},this.getLayerTypes=function(){return Array.from(t.layersMap.values()).map((function(t){var e;return(null===(e=t.details)||void 0===e?void 0:e.type)||""}))},this.getLayerTypesBySource=function(e){return Array.from(t.layersMap.values()).filter((function(t){return t.source===e})).map((function(t){var e;return(null===(e=t.details)||void 0===e?void 0:e.type)||""}))},this.getLayerByType=function(e){return Array.from(t.layersMap.values()).filter((function(t){var r;return(null===(r=t.details)||void 0===r?void 0:r.type)===e}))},this.getLayerBySource=function(e){return Array.from(t.layersMap.values()).filter((function(t){return t.source===e}))},this.getLayerById=function(e){return t.layersMap.get(e)},this.getFeatures=function(e){var r;return(null===(r=t.getSource(e))||void 0===r||null===(r=r._data)||void 0===r?void 0:r.features)||[]},this.getFeature=function(e){var r;return(null===(r=t.getSource(e))||void 0===r||null===(r=r._data)||void 0===r||null===(r=r.features)||void 0===r?void 0:r.find((function(t){return t.id===e})))||!1},this.getSelection=function(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;return null===(e=r[0])||void 0===e||null===(e=e.properties)||void 0===e||!e.cluster||(t.onClusterClick(r[0],n),!1)},this.getType=function(t){return["Polygon","Rectangle"].includes(t)?"Polygon":["Polyline","LineString","Line"].includes(t)?"Polyline":["Point","Circle","Marker","Icon","Text"].includes(t)?"Point":"Image"===t&&"Image"},this.setCustomLayers=function(){var e=C(E().mark((function e(r){var n,o=arguments;return E().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:{},t.removeCustomLayers(),r&&0!==r.length){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,i.call(t,r,n);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.addSources=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(e){t.sourcesMap.has(e)||t.addSource(e)})),e.fire("sources.add",{sources:t.getSources()})},this.addSource=function(n,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!n)throw new Error("No source was provided!");var a=r.getSource(n);if(a)return t.sourcesMap.set(n,t.getSource(n)||a),t.getSource(n);var s={type:i.type||"geojson",data:turf.featureCollection(i.features||[]),promoteId:i.promoteId||"id",cluster:!1};"Point"!==o&&"Image"!==o||i.noCluster||(s=T(T({},s),{},{cluster:!0,clusterMaxZoom:i.clusterMaxZoom||14,clusterRadius:i.clusterRadius||50})),r.addSource(n,s);var c=r.getSource(n);return t.sourcesMap.set(n,c),e.fire("source.add",{id:n,source:c}),c},this.addLayers=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2?arguments[2]:void 0;return requestAnimationFrame((function(){r.forEach((function(e){return t.addLayer(e,n)})),o&&t.customLayersMap.set(o.id,o),e.fire("layers.add",{layers:t.getLayers()}),F.call(t)})),t.getLayers()},this.addLayer=function(n){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!(!n||!n.id)&&(n.metadata=n.metadata||o,r.getLayer(n.id)?(n.layer=r.getLayer(n.id),t.layersMap.has(n.id)||t.layersMap.set(n.id,n),t.getLayer(n.id)):(r.addLayer(n),n.layer=r.getLayer(n.id),t.layersMap.set(n.id,n),e.fire("layer.add",{id:n.id,layer:n}),n))},this.addTextLayer=function(){},this.removeSources=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).forEach((function(e){t.sourcesMap.has(e)&&t.removeSource(e)})),e.fire("sources.remove",{removed:!0})},this.removeSource=function(n){return!!n&&(r.getSource(n)&&r.removeSource(n),t.sourcesMap.delete(n),e.fire("source.remove",{removed:n}),n)},this.removeLayers=function(r){var n=Array.isArray(r)?r.map((function(t){return"object"===w(t)?t.id:t})):[];return t.removeTextLayer(),n.forEach((function(e){return t.removeLayer(e)})),e.fire("layers.remove",{removed:n}),n},this.removeLayer=function(n){return!!n&&(r.getLayer(n)&&r.removeLayer(n),t.layersMap.delete(n),t.customLayersMap.delete(n),e.fire("layer.remove",{removed:n}),n)},this.removeTextLayer=function(){var e,n=v(t.layersMap.entries());try{for(n.s();!(e=n.n()).done;){var o=y(e.value,2),i=o[0],a=o[1];a.metadata&&a.metadata.text&&r.getLayer(i)&&(r.removeLayer(i),t.layersMap.delete(i))}}catch(t){n.e(t)}finally{n.f()}t.showTextLayers=!1},this.removeCustomLayers=function(){var e,r=v(t.customLayersMap.entries());try{for(r.s();!(e=r.n()).done;){var n=y(e.value,2),o=n[0],i=n[1];t.removeLayer(o),t.removeSource(i.source)}}catch(t){r.e(t)}finally{r.f()}return t.customLayersMap.clear(),!0},this.moveLayers=function(e){(e||t.getLayers()).forEach((function(t){r.getLayer(t.id)&&r.moveLayer(t.id)}))},this.onClusterClick=function(t){if(!t.source)return!1;var e=r.getSource(t.source);return!!e&&(e.getClusterExpansionZoom(t.properties.cluster_id,(function(e,n){e||r.easeTo({center:t.geometry.coordinates,zoom:n+2})})),!1)},this.onLayerMouseover=function(t){},this.onLayerMouseout=function(t){},this.init()};function F(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,e)||function(t,e){if(t){if("string"==typeof t)return k(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function P(t){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},P(t)}const N=function(){var t=this.geoflo;if(!t.map)throw new Error("No map object provided!");function e(e){var r=this.featuresMap.get(e);return r||(r=t.getSelectedFeatures().find((function(t){return t.id===e||t.properties.id===e}))),r}function r(r){var n,o="object"===P(r)&&r.id?r:e.call(this,r);if(!o||!o.source)return[];var i=null===(n=t.map.getSource(o.source))||void 0===n?void 0:n._data;if(!i)return[];var a=t.options.offsetOverlappingLines?"parent":"id";return i.features.filter((function(t){return t[a]===r||t.properties[a]===r}))}function n(e){var r=t.Utilities.cloneDeep(e);r.properties.type=this.currentType;var n=turf.point(r.geometry.coordinates[1]),o=this.getUnits(r),i="feet";return o=this.convertUnits(r,o,i),n.properties.units=o,n.properties.unit=i,n.properties.text="".concat(o," ").concat(i),n.properties.transform="uppercase",n.properties.anchor="bottom-left",this.textFeatures.push(n),n}function o(e,r){if(!(e&&e.length&&r&&t.map.getSource(r)))return!1;if(!t.options.offsetOverlappingLines)return t.map.getSource(r).setData(turf.featureCollection(e));var n=new t.Mesh(e,!0).getFeatures();n.forEach((function(o){var a=e.find((function(t){return t.id===o.parent}));a&&(o.source=r,o.properties.style=a.properties.style||o.properties.style,function(e,r){if(!t.options.offsetOverlappingLines)return!1;if(!i(r))return!1;if(r.properties.offset)return!1;var n=6,o=[];e.forEach((function(t){return!!i(t)&&(t.parent!==r.parent&&(!t.properties.offset&&(!(!turf.booleanOverlap(t,r)&&!turf.booleanWithin(t,r))&&void o.push(t))))})),o.forEach((function(t){t.properties.offset=n,n*=2}))}(n,o))})),t.map.getSource(r).setData(turf.featureCollection(n)),t.fire("features.offset",{features:e,offset:n,source:r})}function i(e){if(!e)return!1;t.Layers.getLayerType(e.source);return"LineString"===turf.getType(e)}this.featuresMap=new Map,this.getFeatures=function(){return Array.from(this.featuresMap.values())},this.getFeatureById=function(t){return Array.isArray(t)&&t.length>1?this.getFeaturesById(t):("object"===P(t)&&(t=t.parent||t.properties.parent||t.id||t.properties.id),e.call(this,t))},this.getFeaturesById=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=new Set,n=[];return e.forEach((function(e){var o=t.getFeatureById(e);o&&!r.has(e)&&(r.add(e),n.push(o))})),n},this.getType=function(e){return function(e){return e?function(e){if(!e)return!1;var r=t.Layers.getLayerType(e.source);return"Polygon"===turf.getType(e)&&"Rectangle"===e.properties.type||"Rectangle"===r}(e)?"Rectangle":function(e){if(!e)return!1;var r=t.Layers.getLayerType(e.source);return"Polygon"===turf.getType(e)||"Polygon"===e.properties.type||"Polygon"===r}(e)?"Polygon":i(e)?"Polyline":function(e){if(!e)return!1;var r=t.Layers.getLayerType(e.source);return"Text"===r||"Point"===turf.getType(e)&&"Text"===e.properties.type}(e)?"Text":function(e){if(!e)return!1;var r=t.Layers.getLayerType(e.source);return"Icon"===r||"Point"===turf.getType(e)&&"Icon"===e.properties.type}(e)?"Icon":function(e){if(!e)return!1;var r=t.Layers.getLayerType(e.source);return"Image"===r||"Point"===turf.getType(e)&&"Image"===e.properties.type}(e)?"Image":function(e){if(!e)return!1;var r=t.Layers.getLayerType(e.source);return!("Point"!==turf.getType(e)||e.properties.type&&"Circle"!==e.properties.type)||("Point"===turf.getType(e)&&("Point"===r||"Circle"===r)||"Point"===turf.getType(e)&&"Text"!==e.properties.type&&"Icon"!==e.properties.type&&"Image"!==e.properties.type)}(e)?"Circle":null:null}(e)},this.getUnit=function(e){if(!e)return!1;var r=e.properties.type;return!!r&&(!(!t.options.units||!t.options.units[r])&&t.options.units[r])},this.getUnits=function(t){if(!this.getUnit(t)||!t)return!1;var e=1,r=t.properties.type;return"Polyline"===r?e=turf.length(t,{units:"meters"}):"Polygon"!==r&&"Rectangle"!==r||(e=turf.area(t)),e},this.getFeatureState=function(e){return!!e&&t.map.getFeatureState({source:t.statics.constants.sources.COLD,id:e})},this.setFeaturesState=function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;return n&&0!==r.length?(r.forEach((function(r){var o=r.id||r.properties.id;t.hotFeature&&t.hotFeature.id===o||e.setFeatureState(o,n)})),r):[]},this.setFeatureState=function(e,n){if(!n||!e)return!1;var o=r.call(this,e);return o.forEach((function(e){var r=e.id||e.properties.id;t.map.setFeatureState({source:e.source,id:r},n)})),o},this.setText=function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!t.options.showFeatureText)return!1;var o=t.statics.constants.sources.HOTTEXT;return r.features&&(r=r.features),Array.isArray(r)||(r=[r]),r.forEach((function(r){var o=r.properties.type;o&&(e.currentType=o,"Polyline"===o&&t.Utilities.isValidLineString(r)&&t.options.showLineUnits&&turf.segmentEach(r,n.bind(e)))})),t.map.getSource(o).setData(turf.featureCollection([])),delete this.currentType,!0},this.addFeature=function(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return!(!e||!e.properties)&&(e=turf.cleanCoords(e),(e=turf.truncate(e,{precision:6,coordinates:3,mutate:!0})).properties=t.Utilities.assignDeep(n,e.properties),e.source=r||e.source||e.properties.source||t.statics.constants.sources.COLD,delete e.properties.source,delete e.properties.painting,delete e.properties.edit,delete e.properties.new,delete e.properties.hidden,delete e.properties.offset,e.properties.style=e.properties.style||{},this.addUnits(e),this.addFeatures([e]),e)},this.addFeatures=function(e){var r=this,n=!this.updatingFeatures,o=new Set;return e.forEach((function(e){e.id=e.id||e.properties.id||URL.createObjectURL(new Blob([])).slice(-36),e.source=e.source||e.properties.source||t.statics.constants.sources.COLD,e.properties.id=e.id,e.properties.type=r.getType(e),r.featuresMap.set(e.id,e),r.setFeatureState(e.id,{hidden:!1}),o.add(e.source)})),n&&this.updateSource(Array.from(o)),e},this.addUnits=function(t,e){var r=e||this.getUnit(t);if(!r)return!1;var n=this.convertUnits(t,null,e);return t.geometry.units=n,t.geometry.unit=r,t},this.isFeatureHidden=function(t){return!!t&&this.getFeatureState(t).hidden},this.updateFeatures=function(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=e||[].concat(t.getDrawnFeatures(),t.getSelectedFeatures());var o=new Set,i=t.getSelectedFeatures();this.updatingFeatures=!0,e.forEach((function(e){var a=e.id||e.properties.id;if(a){var s=r.getFeatureById(a);if(!s)return r.addFeature(e);var c=i.find((function(t){return t.id===a||t.properties.id===a}));if(c&&!t.noSelect)return c.geometry.coordinates=e.geometry.coordinates,c.properties=e.properties,t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection(i)),void t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection(i));o.has(s.source)||o.add(s.source),s.geometry.coordinates=e.geometry.coordinates,s.properties=e.properties,n.addUnits&&r.addUnits(s)}})),o.size>0&&requestAnimationFrame((function(){r.updateSource(Array.from(o))})),this.updatingFeatures=!1},this.updateSource=function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this._updateSourceTimeout&&clearTimeout(this._updateSourceTimeout),this._updateSourceTimeout=setTimeout((function(){var n={},i=[],a=t.map.getSource(t.statics.constants.sources.COLDTEXT),s=t.map.getSource(t.statics.constants.sources.COLD);t.updatingSource=!0,a&&a.setData(turf.featureCollection([])),s&&s.setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),Array.from(e.featuresMap.values()).forEach((function(t){delete t.properties.new,delete t.properties.offset;var e=t.source;if(!r.length||r.includes(e)){if(!e)return i.push(t);n[e]||(n[e]=[]),n[e].push(t)}})),0===e.featuresMap.size&&t.Layers.getCustomLayers().forEach((function(e){if(e.details&&e.details.source){var r=e.details.source;t.map.getSource(r)&&t.map.getSource(r).setData(turf.featureCollection([]))}})),Object.entries(n).forEach((function(e){var r=F(e,2),n=r[0],a=r[1];if(!t.map.getSource(n))return i.push(a);o(a,n)})),o(i.flat(),t.statics.constants.sources.COLD),setTimeout((function(){e.setFeaturesState(Array.from(e.featuresMap.values()),{hidden:!1})}),100),t.fire("features.update",{features:Array.from(e.featuresMap.values())}),t.updatingSource=!1}),50),Array.from(this.featuresMap.values())},this.removeFeature=function(t){var e=[];if(!this.featuresMap.has(t))return e;var r=this.featuresMap.get(t);return this.featuresMap.delete(t),e.push(r),this.updateSource([r.source]),e},this.removeLayers=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if((arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).reset)return this.deleteFeatures();var r=[];this.featuresMap.forEach((function(n,o){e.includes(n.source)&&(r.push(n),t.featuresMap.delete(o))})),this.updateSource(Array.from(new Set(r.map((function(t){return t.source})))))},this.deleteFeatures=function(){this.featuresMap.clear(),this.updateSource()},this.convertUnits=function(t,e,r){if(!t)return 0;var n=t.properties.type,o=r||this.getUnit(t);return e=e||this.getUnits(t),"Polyline"===n?e=Math.round(turf.convertLength(e,"meters",o)):"Polygon"!==n&&"Rectangle"!==n||(e=Math.round(turf.convertArea(e,"meters",o))),e=e?Number(e.toFixed(2)):0}};const D=function(t,e){var r=1,n=[],o={},i=this.geoflo;function a(t,e){return!o[r]&&!f(r)&&(o[r]=t,t.id=r,t.parent=e,i.Utilities.setProperty(t,"id",r),i.Utilities.setProperty(t,"parent",e),r++,!0)}function s(t,e,r){for(var n=turf.truncate(turf.point(t[0]),{precision:7,coordinates:2,mutate:!0}),o=null,s=1;s<t.length;s++){if(o=turf.truncate(turf.point(t[s]),{precision:7,coordinates:2,mutate:!0}),!i.Utilities.isPointEqual(n.geometry.coordinates,o.geometry.coordinates)){var c=turf.lineString([n.geometry.coordinates,o.geometry.coordinates]);a(c,r)&&e.push(c)}n=o}}function c(t){var r=[];return t&&t.length?(t.forEach((function(t){var n=t.geometry.type,o=t.parent||t.properties.parent||t.id||t.properties.id;if(e&&"LineString"!==n&&!t.properties.unfill)return!!a(t=i.Utilities.cloneDeep(t),o)&&r.push(t);"MultiPolygon"===n?t.geometry.coordinates.forEach((function(t){t.forEach((function(t){s(t,r,o)}))})):"Polygon"===n||"MultiLineString"===n?t.geometry.coordinates.forEach((function(t){s(t,r,o)})):"LineString"===n?s(t.geometry.coordinates,r,o):"Point"===n&&a(t=i.Utilities.cloneDeep(t),o)&&r.push(t)})),r):r}function u(t,e,r){var n=e.id||e.properties.id,o=t[n];void 0===o&&(o=[],t[n]=o),r.forEach((function(t){var e=i.Utilities.reducePrecision(t.geometry.coordinates);-1===o.findIndex((function(t){return t[0]===e[0]&&t[1]===e[1]}))&&o.push(e)}))}function l(t,e){for(var r={},o=function(t,e,n){var o=t.geometry.coordinates,a=e.geometry.coordinates,s=n.geometry.coordinates,c=!1,l=!1,p=!1;if(!i.Utilities.isPointEqual(o,a[0])&&!i.Utilities.isPointEqual(o,a[1])){var d=turf.point(a[0]),f=turf.point(a[1]),h=turf.distance(t,d)<turf.distance(t,f)?d:f;turf.pointOnLine(n,h).properties.dist<i.statics.constants.MIN_DISTANCE?(u(r,n,[h]),p=!0):c=!0}if(!i.Utilities.isPointEqual(o,s[0])&&!i.Utilities.isPointEqual(o,s[1])){var g=turf.point(s[0]),m=turf.point(s[1]),y=turf.distance(t,g)<turf.distance(t,m)?g:m;turf.pointOnLine(e,y).properties.dist<i.statics.constants.MIN_DISTANCE?(u(r,e,[y]),p=!0):l=!0}p||(c&&u(r,e,[t]),l&&u(r,n,[t]))},a=function(t,e){var n,o,a,s,c=turf.pointOnLine(t,turf.point(e));return c.properties.dist<i.statics.constants.MIN_DISTANCE&&(n=t.geometry.coordinates,o=e,a=n[0],s=n[n.length-1],!i.Utilities.isPointEqual(a,o)&&!i.Utilities.isPointEqual(s,o))&&(u(r,t,[c]),!0)},s=t===e,c=0;c<t.length;c++)for(var l=t[c],p=l.geometry.type,d=s?c+1:0;d<e.length;d++){var h=e[d],g=h.geometry.type,y=h.id||h.properties.id;if("LineString"===p&&"LineString"===g){if(m(l,h)){var v=turf.lineIntersect(l,h).features;if(v.length>0){v.length,o(v[0],l,h)}else{var b=l.geometry.coordinates,x=h.geometry.coordinates;a(l,x[0]),a(l,x[1]),a(h,b[0]),a(h,b[1])}if(f(y)){var w=n.indexOf(f(y));n.splice(w,1)}}}else if("Point"===p||"Point"===g){if("Point"===g&&"Point"===g);else{var E="Point"===p?l:h,L="LineString"===p?l:h;y=E.id||E.properties.id,a(L,E.geometry.coordinates)&&(r[y]=[])}if(f(y)){w=n.indexOf(f(y));n.splice(w,1)}}}return r}function p(t,e){var r=[];return t.forEach((function(t){var n=t.id||t.properties.id;if("LineString"===t.geometry.type){var o=e[n];if(void 0!==o){var s=turf.lineSplit(t,turf.multiPoint(o));turf.featureEach(s,(function(t){var e=turf.lineDistance(t);e>i.statics.constants.MIN_SEGMENT_LENGTH&&(i.Utilities.setProperties(t,{length:e}),a(t),r.push(t))}))}else{var c=turf.lineDistance(t);c>i.statics.constants.MIN_SEGMENT_LENGTH&&(i.Utilities.setProperties(t,{length:c}),r.push(t))}}else{void 0===e[n]&&r.push(t)}})),r}function d(t){var r=c(t);return e?r:p(r,l(r,r))}function f(t){return n.find((function(e){return e.id===t||e.properties.id===t}))}function h(t){return n.filter((function(e){return e.parent===t||e.properties.parent===t}))}function g(t){var e=turf.lineString(t),r=turf.lineDistance(e);return i.Utilities.setProperties(e,{length:r}),e}function m(t,e){var r=t.geometry.coordinates,n=e.geometry.coordinates;if(2===r.length&&2===n.length){var o=y(r),i=y(n);return!(o.east<i.west||o.west>i.east)&&!(o.north<i.south||o.south>i.north)}throw new Error("wrong number of coordinates, expected 2")}function y(t){var e={};return t[0][0]<t[1][0]?(e.west=t[0][0],e.east=t[1][0]):(e.west=t[1][0],e.east=t[0][0]),t[0][1]<t[1][1]?(e.south=t[0][1],e.north=t[1][1]):(e.south=t[1][1],e.north=t[0][1]),e}this.addNewFeatures=function(t){var e=c(d(t)),r=l(e,n);return n=[].concat(i.Utilities.consumableArray(p(n,r)),i.Utilities.consumableArray(p(e,r))),this.getFeatures()},this.getFeatures=function(){return n},this.splitSegmentAtPoint=function(t,e){var r=o[t];if(void 0!==r){var i=n.indexOf(r);n.splice(i,1);var s=g([e,r.geometry.coordinates[0]]),c=g([e,r.geometry.coordinates[1]]);a(s),a(c),n.push(s,c)}},this.getFeaturesFromIndex=function(t){var e=[];return t.forEach((function(t){var r=t.id||t.properties.id,n=o[r];void 0!==n&&e.push(n)})),e},this.getFeatureById=function(t){return f(t)},this.getFeaturesByParentId=function(t){return h(t)},this.removeFeature=function(t){return function(t){var e=h(t);e&&e.length&&(e.forEach((function(t){var e=n.indexOf(t);n.splice(e,1)})),i.updateMeshData());return n}(t)},t&&(n=d(t))};function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function _(){_=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof y?e:y,a=Object.create(i.prototype),s=new k(n||[]);return o(a,"_invoke",{value:T(t,r,s)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",f="suspendedYield",h="executing",g="completed",m={};function y(){}function v(){}function b(){}var x={};u(x,a,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(P([])));E&&E!==r&&n.call(E,a)&&(x=E);var L=b.prototype=y.prototype=Object.create(x);function C(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==I(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=d;return function(i,a){if(o===h)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=M(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?g:f,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function M(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,M(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function F(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function P(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(I(e)+" is not iterable")}return v.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},C(S.prototype),u(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},C(L),u(L,c,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=P,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),F(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;F(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:P(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function A(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}var R=["contextmenu","map.enable","map.disable","map.ready","map.redraw","map.refresh","mode.change","theme.change","sources.add","source.add","source.hot","layers.add","layers.remove","layer.add","control.add","control.remove","features.zoom","features.add","features.removeAll","features.remove","features.update","features.import","features.export","features.offset","features.hide","feature.add","feature.remove","feature.select","feature.deselect","feature.update","feature.history","select.load","select.add","select.remove","select.activate","select.deactivate","draw.activate","draw.deactivate","draw.start","draw.finish","draw.cancel","mesh.load","text.add","icon.add","vertex.find","vertex.on","vertex.off","vertex.add","vertex.drag","vertex.dragsnap","vertex.delete","overpass.add","snapping.activate","snapping.deactivate","snapping.add","snapping.refresh","snapping.delete","pinning.activate","pinning.deactivate","pinning.add","pinning.update","routing.activate","routing.deactivate","routing.add","painting.activate","painting.deactivate","painting.start","painting.update","gamepad.init","gamepad.add","gamepad.remove","gamepad.hold","gamepad.press","gamepad.release","gamepad.connect","gamepad.disconnect","locate.on","locate.off","locate.update"];const B=function(t){var e=function(e){t.mapMoving=e,t.settingExtent||(t.locate&&t.locate.onMapMove(e),t.setIcon(e))},r=function(e){t.mapMoving=e,t.settingExtent||(t.setIcon(e),t.setCenterMarker(),t.locate&&t.locate.following&&t.setMapClass("disable"))},n=function(e){t.mapMoving=!1,t.settingExtent||(t.locate&&t.locate.onMapMove(e),t.setIcon(e))},o=function(e){var r=t.options.painting&&t.options.painting.enable;r=r&&t.currentMode&&"draw"===t.currentMode.id,t.locate&&t.locate.following?t.setMapClass("disable"):t.dragMoving?t.setMapClass("grabbing"):t.addingVertexOnLine||t.canAddVertex?t.setMapClass("pointer"):t.canDragMove?t.setMapClass("grab"):r?t.setMapClass("painting"):t.setMapClass("pointer"),t.lastMouseEvent=e,t.currentMode&&t.currentMode.handleMove&&t.currentMode.handleMove(e)},i=function(e){var r=t.options.painting&&t.options.painting.enable;r=r&&t.currentMode&&"draw"===t.currentMode.id,t.locate&&t.locate.following?t.setMapClass("disable"):r?t.setMapClass("painting"):t.dragMoving||t.addingVertexOnLine?t.setMapClass("grabbing"):t.canDragMove?t.setMapClass("grab"):t.lastClick?t.setMapClass("grabbing"):t.setMapClass("pointer"),t.mouseIsDown=[e.lngLat.lng,e.lngLat.lat],t.currentMode.handleDown&&t.currentMode.handleDown(e)},a=function(e){t.mouseIsDown=!1,t.locate&&t.locate.following?t.setMapClass("disable"):t.setMapClass("pointer"),t.currentMode.handleUp&&t.currentMode.handleUp(e)},s=function(){var e,r=(e=_().mark((function e(r){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.type.includes("preclick")){e.next=2;break}return e.abrupt("return",!!t.currentMode.handlePreclick&&t.currentMode.handlePreclick(r));case 2:t.currentMode.handleClick&&t.currentMode.handleClick(r);case 3:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,o){var i=e.apply(t,r);function a(t){A(i,n,o,a,s,"next",t)}function s(t){A(i,n,o,a,s,"throw",t)}a(void 0)}))});return function(t){return r.apply(this,arguments)}}(),c=function(e){t.locate&&t.locate.following?t.setMapClass("disable"):t.dragMoving?t.setMapClass("grabbing"):t.canDragMove?t.setMapClass("grab"):t.setMapClass("move"),t.currentMode.handleDrag&&t.currentMode.handleDrag(e)},u=function(e){t.currentMode&&t.currentMode.handleOffMap&&t.currentMode.handleOffMap(e)},l=function(e){t.currentMode&&t.currentMode.handleOnMap&&t.currentMode.handleOnMap(e)},p=function(e){if(!t.textMarker){var r=t.getButtons(),n=!1;if(Object.keys(r).forEach((function(o){var i=r[o],a=t.options.keys[o];(a===e.key||a===e.keyCode||i.keycode&&i.keycode===e.keyCode)&&(i.button.click(),n=!0)})),t.options.commands&&t.options.commands.forEach((function(r){if(r.key===e.keyCode||r.key===e.key||r.key===e.code){if(!r.command||"function"!=typeof r.command)return;r.command(e,t,r),n=!0}})),n)return n;switch(e.key.includes("Arrow"),t.currentKeyPress=e.key,e.code){case"Enter":case"NumpadEnter":t.setMode();break;case"Escape":t.hotFeature=null,t.setMode();break;case"Home":t.moveSelectedFeatures(1);break;case"End":t.moveSelectedFeatures(-1);break;case"Delete":t.mode===t.statics.constants.modes.SELECT?t.hasSelection()&&t.removeSelection():t.mode===t.statics.constants.modes.DRAW&&t.currentMode.deleteVertex()}}},d=function(e){t.currentKeyPress=!1},f=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},h=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},g=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},m=function(e){t.currentMode.handleTouch&&t.currentMode.handleTouch(e)},y=function(e){var r=e.gamepad||e.detail.gamepad;if(!t.license||!t.license.enabled||!t.premiumModules)throw new Error("GeoFlo Premium Required!");t.gamepads[r.index]=new t.premiumModules.Gaming(r),t.fire("gamepad.add",{gamepad:r})},v=function(e){var r=e.gamepad||e.detail.gamepad;if(!t.gamepads[r.index])return!1;t.gamepads[r.index].onDisconnect(r),delete t.gamepads[r.index],t.fire("gamepad.remove",{gamepad:r})},b=function(e){t.updateOrientation({alpha:e.alpha,beta:e.beta,gamma:e.gamma})},x=function(t){},w=function(e){t.setMapClass("grabbing"),t.setIcon(e),t.setCenterMarker({transform:!0})},E=function(e){var r=e.type.split(":")[1],n={data:e.detail,type:r.split(".")[0],action:r.split(".")[1],target:t},o={name:r,detail:n};t.map.fire(t.id,o)},L=function(e){t.currentMode.handleContext&&t.currentMode.handleContext(e),t.fire("contextmenu",e)},C=function(e){if(!e.sourceDataType||"content"===!e.sourceDataType||!e.sourceId)return!1;var r=e.sourceId,n={id:r,data:e.source.data,type:e.type,target:t};r===t.statics.constants.sources.HOT&&t.fire("source.hot",n)};return{addEventListeners:function(){t.map.on("movestart",e),t.map.on("move",r),t.map.on("moveend",n),t.map.on("mousemove",o),t.map.on("preclick",s),t.map.on("click",s),t.map.on("tap",s),t.map.on("dragstart",x),t.map.on("drag",c),t.map.on("mousedown",i),t.map.on("mouseup",a),t.map.on("rotatestart",w),t.map.on("pitchstart",w),t.map.on("rotate",w),t.map.on("pitch",w),t.map.on("touchstart",f),t.map.on("touchend",h),t.map.on("touchmove",g),t.map.on("touchcancel",m),t.map.on("contextmenu",L),t.map.on("sourcedata",C),R.forEach((function(e){t.map.on(t.id+":"+e,E)})),t.container.addEventListener("keydown",p),t.container.addEventListener("keyup",d),t.container.addEventListener("mouseover",l),t.container.addEventListener("mouseleave",u),window.addEventListener("gamepadconnected",y),window.addEventListener("gamepaddisconnected",v),window.addEventListener("deviceorientation",b,!0)},removeEventListeners:function(){t.map.off("movestart",e),t.map.off("move",r),t.map.off("moveend",n),t.map.off("mousemove",o),t.map.off("preclick",s),t.map.off("click",s),t.map.off("tap",s),t.map.off("dragstart",x),t.map.off("drag",c),t.map.off("mousedown",i),t.map.off("mouseup",a),t.map.off("rotatestart",w),t.map.off("pitchstart",w),t.map.off("touchstart",f),t.map.off("touchend",h),t.map.off("touchmove",g),t.map.off("touchcancel",m),t.map.off("contextmenu",L),t.map.off("sourcedata",C),R.forEach((function(e){t.map.off(t.id+":"+e,E)})),t.container.removeEventListener("keydown",p),t.container.removeEventListener("mouseover",l),t.container.removeEventListener("mouseleave",u),window.removeEventListener("gamepadconnected",y),window.removeEventListener("gamepaddisconnected",v),window.removeEventListener("deviceorientation",b,!0)}}};const U=function(){var t,e,r=this.geoflo,n=[],o=[],i=[],a=!1,s=0,c=[[0,4,3],[.5,4,2.5],[1,4,2],[1.5,4,1.5],[2,4,1],[2.5,4,.5],[3,4,0],[0,.5,3,3.5],[0,1,3,3],[0,1.5,3,2.5],[0,2,3,2],[0,2.5,3,1.5],[0,3,3,1],[0,3.5,3,.5]];function u(t,e){var r=document.createElement("tr");if(r.classList.add("popup-table-row"),t){var n=document.createElement("th");n.classList.add("popup-table-header"),n.appendChild(document.createTextNode(t)),r.appendChild(n)}var o=document.createElement("td");return o.classList.add("popup-table-data"),o.classList.add(t),o.appendChild(document.createTextNode(e)),r.appendChild(o),r}function l(t,n){if((i=t).length){var o=r.getSelectedFeatures(),a=i.findIndex((function(t){return t.id===e})),s=e,c=a,u=0;if(!i.every((function(t){return o.some((function(e){return e.id===t.id}))}))){do{if(c=(c+1)%i.length,++u>i.length)return}while(o.some((function(t){var e;return t.id===(null===(e=i[c])||void 0===e?void 0:e.id)}))&&c!==a);var l;if(i[c])s=i[c].id||(null===(l=i[c].properties)||void 0===l?void 0:l.id);r.currentMode.selectFeature(s,{multipleSelect:n})}}}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!a)return d();var e=parseInt(t/50%c.length);e!==s&&(r.map.setPaintProperty(r.id+"-line-select","line-dasharray",c[s]),s=e),requestAnimationFrame(p)}function d(){a=!1,r.map.setPaintProperty(r.id+"-line-select","line-dasharray",[0,0])}this.id="select",this.activate=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!this.activated&&(r.currentMode.id!==this.id?(t.mode=this.id,r.setMode(t)):(this.activated=!0,r.map.dragPan.enable(),r.setButtons(),r.setActiveButton("select"),r.fire("select.activate",{activated:!0,options:t}),this.gamepad,r.map.getSource(r.statics.constants.sources.SELECT).setData(turf.featureCollection([])),void setTimeout((function(e){e.selectFeature(t.id?t.id:!!t.feature&&t.feature.id)}),5,this)))},this.deactivate=function(){if(!this.activated)return!1;this.activated=!1,this.deselectCurrentFeature(),r.setButtons(),r.fire("select.deactivate",{activated:!0})},this.canHandle=function(t){return r.statics.constants.modes.SELECT===t},this.animate=function(t){if(!(t=t||r.getSelectedFeatures()[0])||"LineString"!==t.geometry.type)return d();a?d():(a=!0,requestAnimationFrame(p))},this.selectFeature=function(t){var i,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=r.options.select.popup;return s.multipleSelect||r.options.select.multiple||r.currentMode.deselectCurrentFeature(),t?(-1===n.indexOf(t)&&n.push(t),e=t,o=r.hideFeatures([t]),r.addFeaturesToSelected(o,s),c&&this.addPopup(o),"LineString"!==(null===(i=o[0])||void 0===i?void 0:i.geometry.type)&&d(),r.fire("feature.select",{ids:r.getSelectedFeatureIds(),features:r.getSelectedFeatures()}),r.wantingToEdit?(1===o.length&&t===o[0].id&&(a=o[0],r.wantingToEdit=!1,r.setMode("edit",a.properties.type,a)),o):o):(d(),!1)},this.deselectCurrentFeature=function(){var t=r.getSelectedFeatureIds(),e=r.getSelectedFeatures();this.removePopup(),r.removeSelection(),r.fire("feature.deselect",{ids:t,features:e})},this.addPopup=function(e){this.popupElement=function(t){var e=document.createElement("div");e.classList.add("popup-table-holder");var n=function(t){var e=document.createElement("table"),n=["id","type"];e.style.width="100%",e.style.height="100%",e.setAttribute("border","1"),e.classList.add("popup-table");var o=document.createElement("tbody");return t.forEach((function(t,e){var i=t.properties.type;n.forEach((function(e){o.appendChild(u(e,t.properties[e]))})),o.appendChild(u("geometry",t.geometry.type)),"LineString"===t.geometry.type?(r.Features.addUnits(t,"feet"),o.appendChild(u("unit",t.geometry.unit)),o.appendChild(u("units",t.geometry.units))):"Text"===i?o.appendChild(u("content",t.properties.text)):"Polygon"===t.geometry.type&&(r.Features.addUnits(t,"acres"),o.appendChild(u("unit",t.geometry.unit)),o.appendChild(u("units",t.geometry.units)))})),e.appendChild(o),e}(t);if(e.appendChild(n),i.length>1){var o=document.createElement("div");o.classList.add("popup-table-button"),o.innerHTML="<button> Next </button>",o.addEventListener("click",l.bind(this)),e.appendChild(o)}return e}(e),this.popup=new mapboxgl.Popup({closeOnClick:!1}).setLngLat(t).setDOMContent(this.popupElement).addTo(r.map).setOffset(12),this.popup._container.style["margin-bottom"]="10px"},this.removePopup=function(){return!(!this.popup||!this.popup.remove)&&this.popup.remove()},this.handleMove=function(t){},this.handleClick=function(o){if(r.noSelect)return!1;var a=r.getRenderedDrawnFeatures(o.lngLat),s=o.originalEvent&&o.originalEvent.shiftKey;if(t=[o.lngLat.lng,o.lngLat.lat],a.length>0){if(!r.Layers.getSelection(a,t))return;JSON.stringify(a)!==JSON.stringify(i)&&(i=a,e=null),l.call(this,i,s)}else s||(n=[],i=[],t=!1,e=!1,this.deselectCurrentFeature())},this.handleDrag=function(t){}};const j=function(){var t=this.geoflo;function e(e,r,n){var o,i=t.currentMode.cancelled;if(t.editMode&&!t.currentMode.savingEdit&&!i)return t.currentMode.saveEdit(r);if(i||!e)return t.textMarker&&(t.textMarker.remove(),t.textInput=!1),t.hotFeature&&(t.removeSelection(),t.addFeatures([t.editing||t.hotFeature],!0)),t.Pinning&&t.Pinning.resetFeatures(),t.editMode||t.fire("draw.cancel",{cancel:!0,feature:t.hotFeature}),!1;if("Text"===e&&!n&&!t.currentMode.savingEdit)return s.call(t.currentMode,e,r);if(t.hotFeature){if(t.Utilities.isPoint(t.hotFeature)){var a=Array.isArray(t.hotFeature.geometry.coordinates[0])?t.hotFeature.geometry.coordinates[0]:[t.hotFeature.geometry.coordinates[0],t.hotFeature.geometry.coordinates[1]];o=r=t.Painting&&t.Painting.enabled||t.currentMode.savingEdit||"Text"===e?r:turf.point(a)}else t.Utilities.isPolygon(t.hotFeature,e)?(t.hotFeature.geometry.type="Polygon","Rectangle"===e?(t.endPoint&&c(t.hotFeature,"0.2",t.endPoint[0],t.endPoint[1]),c(t.hotFeature,"0.5",t.hotFeature.geometry.coordinates[0][0][0],t.hotFeature.geometry.coordinates[0][0][1])):(t.hotFeature.geometry.coordinates.push(t.hotFeature.geometry.coordinates[0]),t.hotFeature.geometry.coordinates=[t.hotFeature.geometry.coordinates])):t.Utilities.isLineString(t.hotFeature,e)?"Polygon"===e?(t.hotFeature.geometry.type=e,t.hotFeature.geometry.coordinates.push(t.hotFeature.geometry.coordinates[0]),t.hotFeature.geometry.coordinates=[t.hotFeature.geometry.coordinates]):"Rectangle"===e&&(t.endPoint&&c(t.hotFeature,"0.2",t.endPoint[0],t.endPoint[1]),c(t.hotFeature,"0.5",t.hotFeature.geometry.coordinates[0][0][0],t.hotFeature.geometry.coordinates[0][0][1])):r&&(o=r);if(t.Painting&&t.Painting.enabled){var u=t.options.painting.tolerance;t.hotFeature="Circle"===e?t.hotFeature:turf.simplify(t.hotFeature,{mutate:!0,tolerance:"function"==typeof u?u(t.map):u,highQuality:!0}),t.startPoint&&(t.hotFeature.geometry.coordinates[0]=t.startPoint)}}else r&&(o=r);var l=!1;if(t.Exploring&&(l=t.Exploring.currentFeature),!(o=l||o||t.hotFeature)||!t.currentMode.activated)return t.currentMode.deactivate();t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),o=t.Features.addFeature(o,t.currentMode.source,t.currentMode.properties);var p=[];return t.Pinning&&t.Pinning.enabled&&(p=t.Pinning.saveFeatures()),t.fire("draw.finish",{feature:o,pinned:p,type:e,editing:t.editMode}),t.currentMode.deactivate(),{feature:o,type:e,pinned:p}}function r(r,n,o,i){if(t.finishingText)return!1;var a=t.textMarker;if(!a)return!1;var c=a.getElement(),u=c.value;if(!u.length)return a.remove(),t.textInput=!1,s.call(this,n,o);i=i||[c.getAttribute("lng"),c.getAttribute("lat")],n=n||c.getAttribute("type"),t.currentMode.properties.text=u;o={type:"Feature",properties:{type:n,text:u},geometry:{type:"Point",coordinates:i}};a.remove(),t.finishingText=!0,e(n,o,u)}function n(e){var r,n=t.hotFeature;if(t.dragMoving)return!1;if(!n)return!1;var o={};t.Snapping&&(o=t.Snapping.getClosest(e.geometry.coordinates));var i=o.coords,a=!!o.point&&o.point.type;if(!a)return!1;if(!i&&"linepoint"===a&&o.point.borders){var s=turf.lineString([o.point.border1,o.point.border2]);i=(r=turf.along(s,o.point.distance1)).geometry.coordinates}return!!i&&(e=turf.point(i),(r=!!(t.Utilities.isLineString(n)&&"vertex"===a)&&turf.nearestPointOnLine(n,e)||e).properties.type=a,t.fire("vertex.find",{vertex:r,feature:t.hotFeature,closest:o}),r)}function o(e,r){var n;if(r&&e){var o=t.hotFeature.geometry.coordinates,i=turf.lineString(o),a=turf.point(o[0]),s=turf.lineSlice(a,e,i),c=s.geometry.coordinates.length-1,u=s.geometry.coordinates[c];e=turf.point(u),i.geometry.coordinates.splice.apply(i.geometry.coordinates,[c,0].concat([u])),i=turf.cleanCoords(i),n=turf.truncate(i,{precision:6,coordinates:2,mutate:!0}),t.hotFeature.geometry.coordinates=n.geometry.coordinates,t.hotFeature=t.Utilities.cloneDeep(t.hotFeature)}else e&&(t.canDragMove=!0,t.canAddVertex=e);return e}function i(e,r){var n,i=t.hotFeature;if(t.dragMoving)return a();if(!i||!e)return a();t.updateMeshData();var s=e.properties.type;if(n=e.properties.index||0==e.properties.index?e.properties.index:("Circle"===t.currentMode.type||"Icon"===t.currentMode.type||"Image"===t.currentMode.type)&&0,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([e])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([i])),"linepoint"===s)return o(e);t.map.dragPan.disable(),t.dragIndex=n,t.addedVertexOnLine=!!r&&e,t.canAddVertex=!1,t.canDragMove=!0,t.snappedVertex=e.geometry.coordinates,t.Pinning&&t.Pinning.setFeatures(t.snappedVertex),t.fire("vertex.on",{vertex:e,index:n,feature:i})}function a(){if(t.mouseIsDown&&t.Painting&&t.Painting.enabled)return!1;t.hotFeature&&t.snappedVertex&&(t.lastIndex&&(t.lastClick={coords:t.snappedVertex}),t.fire("vertex.off",{vertex:!1,index:t.dragIndex,feature:t.hotFeature})),t.map.dragPan.enable(),t.dragMoving=!1,t.canDragMove=!1,t.snappedVertex=null,t.dragIndex=-1,t.mouseIsDown=t.touchDown||!1,t.lastIndex=!1,t.canAddVertex=!1,t.addedVertexOnLine=!1}function s(e,n,o){if(!(n=n||t.hotFeature))return!1;if(e=e||n.properties.type,n.properties.type=e,"Text"===e){if(t.textInput)return r(0,e,n,o);var i={lng:n.geometry.coordinates[0],lat:n.geometry.coordinates[1]},a=t.textInput=document.createElement("input");a.value=n.properties.text||"",a.className="text-marker",a.setAttribute("contenteditable","true"),a.setAttribute("autocorrect","off"),a.setAttribute("spellcheck","false"),a.setAttribute("placeholder","Press Enter or Select Button When Done..."),a.setAttribute("type",e),a.setAttribute("lng",i.lng),a.setAttribute("lat",i.lat),t.textMarker=new mapboxgl.Marker(a).setLngLat(i).addTo(t.map),t.textMarker.setOffset([0,-25]),a.addEventListener("submit",r),a.addEventListener("keydown",(function(t){[32,37,38,39,40].indexOf(t.keyCode)>-1?t.stopPropagation():13===t.keyCode&&(t.preventDefault(),r())})),a.addEventListener("paste",(function(t){var e,r;t.stopImmediatePropagation(),t.preventDefault(),e=t.clipboardData||window.clipboardData,r=e.getData("text/plain").slice(0,CHAR_LIMIT),t.target.innerText=r})),a.focus(),t.fire("text.add",{feature:n,marker:t.textMarker,type:e})}}function c(t,e,r,n){var o=e.split("."),i=parseInt(o[0],10),a=parseInt(o[1],10);void 0===t.geometry.coordinates[i]&&(t.geometry.coordinates[i]=[]),t.geometry.coordinates[i][a]=[r,n]}this.id="draw",this.canHandle=function(e){return t.statics.constants.modes.DRAW===e},this.activate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.activated)return!1;if(t.currentMode.id!==this.id)return e.mode=this.id,t.setMode(e);this.activated=!0,this._handleHistory=this.handleHistory.bind(this),this.history=[],this.undo=[],e.feature&&function(e){var r=t.Features.getType(e);if(!r)throw new Error("No Feature Type Found to edit");var n=t.Utilities.getFeatureId(e);if(!n)throw new Error("No Feature ID Found to edit");t.currentMode.type=r,t.currentMode.source=e.source,t.editMode=!0,t.hotFeature=e,t.Utilities.setProperty(t.hotFeature,"type",r),t.Utilities.setProperty(t.hotFeature,"edit",!0),t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),"Polygon"===r&&(t.hotFeature=turf.polygonToLine(t.hotFeature));"Circle"===r||"Icon"===r||"Image"===r?t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])):"Text"===r?(t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([t.hotFeature])),s.call(t.currentMode,r,t.hotFeature)):(t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])));var o=t.Utilities.isPoint(t.hotFeature)?t.hotFeature.geometry.coordinates:t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1];t.lastClick={coords:o},t.firstClick={coords:o},setTimeout((function(){t.hideFeatures([n])}),100),t.currentMode.type}(e.feature),t.drawMode=!t.editMode;var r=e.lngLat;delete e.lngLat;var n=this.type=e.type,o=e.feature?e.feature.properties:e;this.source=o.source||this.source,this.properties=Object.assign({},o),delete this.properties.mode,delete this.properties.source,delete this.properties.location;var i=e.id||o.id||URL.createObjectURL(new Blob([])).slice(-36);return this.properties.id=i,this.properties.type=n,t.setButtons(),t.setActiveButton(n),t.Utilities.isPoint(t.hotFeature,n)&&(this.isPoint=!0),t.fire("draw.activate",{id:i,type:n,activated:this.activated,editing:t.editMode,feature:t.hotFeature||e.feature,properties:this.properties}),t.on("source.hot",this._handleHistory),r&&this.handleMove({lngLat:r}),(t.options.painting.enable||t.mobile&&"Rectangle"===n)&&t.activatePainting(),t.refreshMeshData(),this.updateHotSource(),this},this.deactivate=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.activated)return!1;var r,n=e.type||this.type;e.cancel&&this.cancelEdit(e.standby,e.feature),r=this,t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([])),t.deleteMeshData(),r.history=[],r.undo=[],r.type=null,r.cancelled=!1,r.activated=!1,r.savingEdit=!1,t.editMode=!1,t.drawMode=!1,delete t.startPoint,delete t.lastClick,delete t.firstClick,delete t.endPoint,delete t.snapFeature,delete t.hotFeature,delete t.drawStarted,delete t.dragMoving,delete t.editing,delete t.textMarker,delete t.textInput,delete t.touchMoving,delete t.touchDown,delete t.canDragMove,delete t.canAddVertex,delete t.dragIndex,delete t.addedVertexOnLine,delete t.snappedVertex,delete t.drawClickCoords,delete t.finishingText,t.setButtons(),t.off("source.hot",this._handleHistory),t.fire("draw.deactivate",{activated:this.activated}),setTimeout((function(){t.map.getSource(t.statics.constants.sources.SELECT).setData(turf.featureCollection([]))}),300),t.options.repeatDraw?t.setMode({mode:t.statics.constants.modes.DRAW,type:n}):t.setMode()},this.updateHotSource=function(e,r){if(e&&(t.hotFeature=e),t.hotFeature&&!t.overpassDownloading)return t.hotFeature.properties=t.Utilities.assignDeep(t.hotFeature.properties,r||{}),t.hotFeature.properties.style=t.hotFeature.properties.style||{},t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.hotFeature},this.deleteVertex=function(e){if(t.hotFeature){var r=t.hotFeature.geometry.coordinates;e=void 0!==e?e:r.length-1,r.length>1&&(r.splice(e,1),t.lastClick={coords:r[r.length-1]},r.length>0?t.snapFeature=turf.point(r[r.length-1]):t.snapFeature=null,r.length>1?t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])):(t.hotFeature=null,t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([]))),t.fire("vertex.delete",{coords:r,index:e,feature:t.hotFeature})),t.lastMouseEvent&&t.currentMode.handleMove&&t.currentMode.handleMove(t.lastMouseEvent)}else t.snapFeature&&(t.snapFeature=null,t.lastClick=null,t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])))},this.getFeature=function(){return t.hotFeature},this.selectFeature=function(e){return!!e&&(t.setMode(),t.currentMode.selectFeature(e))},this.saveEdit=function(r,n){if(r||(r=t.hotFeature),!r)return!1;var o=this.type;return"Text"===o&&n&&(r.geometry.coordinates=n),this.savingEdit=!0,e(o,r)},this.cancelEdit=function(r,n){return this.cancelled=!0,n&&n.properties.type?(this.standby=r,t.hotFeature=n,t.fire("draw.cancel",{feature:n}),e()):(t.hotFeature=null,e())},this.handleDown=function(e){if(t.mouseIsDown=[e.lngLat.lng,e.lngLat.lat],e.touch&&(t.touchDown=!0,i(n(turf.point(t.mouseIsDown)))),t.canAddVertex)return i(n(o(t.canAddVertex,e)),!0);t.Pinning&&t.Pinning.setFeatures(t.snappedVertex),function(){var e=setInterval((function(){t.mouseIsDown?(t.lastDragMove+=1,function(){if(t.lastDragMove<t.options.pinning.idle)return t.mouseIsIdle=!1,!1;t.mouseIsIdle=!0,t.Snapping&&t.Snapping.setVertex();if(!t.snappedVertex)return!1;var e=turf.point(t.snappedVertex);t.Pinning&&t.Pinning.updateFeatures(e)}()):(t.lastDragMove=0,t.mouseIsIdle=!1,clearInterval(e))}),1)}()},this.handleUp=function(r){if(t.mouseIsDown=!1,t.touchDown=!1,t.Painting&&t.Painting.enabled)return t.Painting.handleUp(r);if(!t.addedVertexOnLine||t.dragMoving){if(r.touch&&t.touchMoving)return t.dragMoving=!1;if(t.Utilities.isPoint(t.hotFeature)&&t.snappedVertex)return t.editMode?this.saveEdit(null,[r.lngLat.lng,r.lngLat.lat]):e(this.type);if(t.snappedVertex&&t.dragMoving&&!t.mapMoving&&"Rectangle"!==this.type){t.gamepadDrag=r.gamepad;var o=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);o=o||!(!t.Utilities.isPolygon(t.hotFeature)||0!=t.dragIndex);var a=t.Utilities.getLastIndexCoords(t.hotFeature);i(n(turf.point(t.snappedVertex))),this.updateHotSource(),o&&setTimeout((function(){t.lastClick={coords:a}}),100)}t.mouseIsIdle=!1,s.call(this,this.type,t.snapFeature,[r.lngLat.lng,r.lngLat.lat]),t.refreshMeshData()}},this.handleClick=function(r){if(r.finish)return t.editMode?this.saveEdit():e(this.type);if(r.touch&&t.touchMoving)return t.touchMoving=!1,t.Snapping&&t.Snapping.setFeature(),this.updateHotSource();if(r.touch&&(t.touchClick=!0),t.addedVertexOnLine)return t.Snapping&&t.Snapping.setFeature(),this.updateHotSource(),i(n(t.addedVertexOnLine)),this.handleDrag(r),t.dragMoving=!1,t.gamepadDrag=!1,t.mouseIsIdle=!1,r;if(t.gamepadDrag)return t.gamepadDrag=!1;if(!t.editMode||"Polygon"!==this.type&&"Text"!==this.type){this.firstClick||t.drawStarted?t.fire("vertex.add",{type:this.type,coords:[r.lngLat.lng,r.lngLat.lat]}):(t.drawStarted=!0,t.fire("draw.start",{type:this.type,editing:t.editMode,coords:[r.lngLat.lng,r.lngLat.lat]}));var o,a,c,u=t.closestPoint||{coords:[r.lngLat.lng,r.lngLat.lat]},l=turf.point(u.coords);if(l.properties=this.properties,l.source=this.source||l.properties.source,t.lastMove=u.coords.length>1&&{lat:u.coords[u.coords.length-1][1],lng:u.coords[u.coords.length-1][0]},!t.startPoint){if("Rectangle"===this.type)return t.startPoint=u.coords,t.hotFeature=turf.polygon([[t.startPoint,[r.lngLat.lng,r.lngLat.lat],[t.startPoint[0],r.lngLat.lat],t.startPoint]]),t.Utilities.setProperty(t.hotFeature,"type",this.type);"Polygon"===this.type&&(t.startPoint=u.coords)}return!t.snapFeature&&u&&(t.snapFeature=u),o=this.type,a=u.coords,c=["Circle","Icon","Text","Image"],!o||c.includes(o)||("Rectangle"===o&&t.startPoint?(t.endPoint=a,1):"Polygon"===o&&t.snappedVertex&&t.startPoint&&t.Utilities.isPointEqual(t.startPoint,t.snappedVertex)||t.snappedVertex&&t.Utilities.isLastIndex(t.dragIndex,t.hotFeature)||t.lastClick&&t.Utilities.isPointEqual(t.lastClick.coords,a))?e(this.type,l):(this.firstClick=!t.firstClick&&{coords:u.coords},t.lastClick=u,t.firstClick=t.firstClick?t.firstClick:{coords:u.coords},t.Snapping&&t.Snapping.setFeature(),s.call(this,this.type),t.Exploring&&t.Exploring.setFeatures(u.coords,{set:!0}),delete t.touchClick,this.updateHotSource())}},this.handleMove=function(e){if(e.touch&&t.mouseIsDown&&(t.touchMoving=!0),t.overpassDownloading)return!1;if(t.mouseIsDown&&t.canAddVertex)return!1;if(t.canDragMove&&t.snappedVertex&&t.mouseIsDown)return this.handleDrag(e);if(t.mouseIsDown&&t.Painting&&t.Painting.enabled)return this.handlePainting(e);if(e.touch&&t.touchMoving)return t.snapFeature=!1;if(1===(!!e.originalEvent&&(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which)))return!1;var r=t.Routing&&t.Routing.enabled;e.originalEvent&&e.originalEvent.altKey&&(r=!1);var o=!1;t.Snapping&&(o=t.Snapping.enabled),e.originalEvent&&e.originalEvent.shiftKey&&(o=!1);var a=[e.lngLat.lng,e.lngLat.lat],s=t.Utilities.isPoint(t.hotFeature),c=t.editMode&&("Polygon"===this.type||"Rectangle"===this.type),u=turf.point(a),l=null;return c?l=u:o?t.Snapping&&(l=t.Snapping.setClosest(a,s)):s||t.Snapping&&(l=t.Snapping.updateFeature(a)),s&&(l=l||(t.firstClick?turf.lineString([t.firstClick.coords,a]):u)),r&&(l=t.Routing.getClosest()||l),l||(l=u),t.Snapping&&t.Snapping.addFeature(l,this.properties,c),i(n(u)),!l&&this.isPoint&&delete this.isPoint,c&&r&&t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),"Rectangle"===this.type?this.handleRectangle(e):"Icon"===this.type?this.handleIcon(e,l):"Text"===this.type?this.handleText(e,l):void 0},this.handleDrag=function(e){var r=t.dragIndex>-1,n=t.map;if(!r)return a(),t.mouseIsDown&&t.Painting&&t.Painting.enabled&&this.handlePainting(e),!1;!e.gamepad&&e.originalEvent.stopPropagation(),t.dragMoving=!0,t.lastDragMove=0,t.snappedVertex=[e.lngLat.lng,e.lngLat.lat],t.bypassRouting=!0,t.bypassSnapping=!e.gamepad&&e.originalEvent.shiftKey,t.lastIndex=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);var o=turf.point(t.snappedVertex);if(t.lastIndex&&(t.lastClick={coords:t.snappedVertex}),"Circle"===this.type||"Icon"===this.type||"Image"===this.type)t.Painting&&t.Painting.enabled||(t.hotFeature.geometry.coordinates=t.snappedVertex);else if("Rectangle"===this.type){var i,s,u,l=n.project(t.startPoint),p=n.project(t.snappedVertex),d=t.dragIndex;switch(d){case 1:i=3,s=2,u=4;break;case 2:i=4,s=1,u=3;break;case 3:i=1,s=4,u=2;break;case 4:i=2,s=3,u=1}var f=[p,{x:p.x,y:l.y},{x:l.x,y:p.y},{x:l.x,y:l.y}].map((function(t){return n.unproject(t)}));f.push(f[0]),c(t.hotFeature,"0.".concat(d),f[0].lng,f[0].lat),c(t.hotFeature,"0.".concat(s),f[1].lng,f[1].lat),c(t.hotFeature,"0.".concat(u),f[2].lng,f[2].lat),c(t.hotFeature,"0.".concat(i),f[3].lng,f[3].lat)}else{var h=t.Utilities.isLastIndex(t.dragIndex,t.hotFeature);t.hotFeature.geometry.coordinates[t.dragIndex]=t.snappedVertex,"Polygon"===this.type&&(h&&(t.hotFeature.geometry.coordinates[0]=t.snappedVertex),0==t.dragIndex&&(t.hotFeature.geometry.coordinates[t.hotFeature.geometry.coordinates.length-1]=t.snappedVertex))}t.Utilities.setProperty(t.hotFeature,"type",this.type),t.Utilities.setProperty(o,"type",this.type),t.map.getSource(t.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([])),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([o])),t.fire("vertex.drag",{type:this.type,coords:[e.lngLat.lng,e.lngLat.lat],feature:t.hotFeature,vertex:o}),t.Pinning&&t.Pinning.updateFeatures(o)},this.handleTouch=function(t){t.touch=!0,"touchstart"===t.type?this.handleDown(t):"touchend"===t.type?(this.handleUp(t),this.handleClick(t)):"touchmove"===t.type&&this.handleMove(t)},this.handleOffMap=function(e){t.map.getSource(t.statics.constants.sources.SNAP)&&t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))},this.handleOnMap=function(e){t.map.getSource(t.statics.constants.sources.SNAP)&&t.snapFeature&&t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([t.snapFeature]))},this.handlePainting=function(e){if(!t.mouseIsDown||!t.Painting)return!1;t.map.dragPan.disable(),t.setMapClass("painting");var r=t.Painting&&t.Painting.feature,n=t.snapFeature&&!r,o=!(!e.lngLat||!e.lngLat.lng)&&[e.lngLat.lng,e.lngLat.lat];return n&&(o=t.snapFeature.geometry.coordinates),!!o&&t.Painting.updateFeature(o)},this.handleRectangle=function(e){if(t.editMode&&t.hotFeature&&(t.startPoint=t.hotFeature.geometry.coordinates[0][0]),t.startPoint){t.dragMoving||t.Utilities.setProperty(t.hotFeature,"type",this.type),t.dragMoving=!0;var r=t.map,n=r.project(t.startPoint),o=r.project([e.lngLat.lng,e.lngLat.lat]);if(t.dragIndex>-1){var i=0==t.dragIndex||4==t.dragIndex?4:t.dragIndex,a=1==i?3:2==i?4:3==i?1:2,s=1==a?4:2==a?1:3==a?2:3,u=1==s?3:2==s?4:3==s?1:2,l=[o,{x:o.x,y:n.y},{x:n.x,y:o.y},n].map((function(t){return r.unproject(t)}));c(t.hotFeature,"0.".concat(i),l[0].lng,l[0].lat),c(t.hotFeature,"0.".concat(s),l[1].lng,l[1].lat),c(t.hotFeature,"0.".concat(u),l[2].lng,l[2].lat),c(t.hotFeature,"0.".concat(a),l[3].lng,l[3].lat)}else{l=[o,{x:o.x,y:n.y},{x:n.x,y:o.y},n].map((function(t){return r.unproject(t)}));c(t.hotFeature,"0.1",l[1].lng,l[1].lat),c(t.hotFeature,"0.2",l[0].lng,l[0].lat),c(t.hotFeature,"0.3",l[2].lng,l[2].lat),c(t.hotFeature,"0.4",l[3].lng,l[3].lat)}t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature]))}},this.handleText=function(e,r){if(r&&r.geometry&&t.hotFeature){var n=r.geometry.coordinates[1],o=turf.point(n);o.properties=this.properties,t.map.getSource(t.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([o]))}},this.handleIcon=function(t,e){},this.handleContext=function(e){t.canDragMove&&t.snappedVertex&&(t.dragIndex>-1&&(t.hotFeature.geometry.coordinates.splice(t.dragIndex,1),t.map.getSource(t.statics.constants.sources.HOT).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.VERTEX).setData(turf.featureCollection([t.hotFeature])),t.map.getSource(t.statics.constants.sources.SNAP).setData(turf.featureCollection([]))))},this.handleHistory=function(e){if(!t.dragMoving){var r=t.currentMode.history,n=new Date,o=e.detail.data.features;if(o&&o.length){var i=t.Utilities.cloneDeep(o[0]);i.historyDate=n,r.push(i),t.fire("feature.history",{type:t.currentMode.type,feature:i,history:r})}}},this.handleUndo=function(){return!1},this.handleRedo=function(){return!1}};const V=function(){var t=this.geoflo;function e(t){t&&(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).forEach((function(e){e&&t.classList.add(e)}))}this.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.options=t.Utilities.extend({},e),this.control=new mapboxgl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0,showAccuracyCircle:!1}),this.control.on("geolocate",this.onControlEvent.bind(this)),t.map.addControl(this.control,"top-right"),this},this.hide=function(){this.control._container.style.display="none"},this.show=function(){this.control._container.style.display="block"},this.ready=function(){var t=this,e=this.control,r=setInterval((function(){if(e._geolocateButton)return t.build(),clearInterval(r)}),1)},this.build=function(){this.button=this.control._geolocateButton,this.marker=this.control._userLocationDotMarker,this.button.addEventListener("click",this.onControlEvent.bind(this))},this.update=function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).alpha;var e=this.heading(),r=(this.bearing(),this.following);e&&r&&!t.mapMoving&&(t.map.setBearing(e-1),t.map.setCenter(this.marker._lngLat))},this.heading=function(){return this.control._heading},this.bearing=function(){return t.map.getBearing()},this.locate=function(){return this.locating=!0,this.unlocated=!1,this.control._follow=this.following=!1,e(this.button,["mapboxgl-ctrl-geolocate-waiting"]),t.fire("locate.on",{state:this.state()}),this.control.trigger()},this.relocate=function(){return this.following&&this.state("ACTIVE_LOCK"),e(this.button,["mapboxgl-ctrl-geolocate-active"]),this.control.trigger()},this.unlocate=function(){return this.state("ACTIVE_LOCK"),this.control._follow=this.following=!1,t.map.dragPan.enable(),this.unlocated=!0,t.fire("locate.off",{state:this.state()}),this.control.trigger()},this.follow=function(){return e(this.button,["mapboxgl-ctrl-geolocate-follow"]),t.map.dragPan.disable(),this.control._follow=this.following=!0},this.state=function(t){return t?this.control._watchState=t:this.control._watchState},this.getButton=function(){return this.control._geolocateButton},this.removeClasses=function(){var t=this.button;t&&(t.classList.remove("mapboxgl-ctrl-geolocate-waiting"),t.classList.remove("mapboxgl-ctrl-geolocate-active"),t.classList.remove("mapboxgl-ctrl-geolocate-active-error"),t.classList.remove("mapboxgl-ctrl-geolocate-background"),t.classList.remove("mapboxgl-ctrl-geolocate-background-error"),t.classList.remove("mapboxgl-ctrl-geolocate-follow"))},this.onAdd=function(t){},this.onControlEvent=function(e){if(this.marker=this.control._userLocationDotMarker,this.removeClasses(),e.coords)this.onLocate(e);else if(e.target===this.button){if(t.map.dragPan.enable(),"OFF"===this.state())return this.locate();if("BACKGROUND"===this.state()&&!this.following)return this.relocate();if("ACTIVE_LOCK"===this.state()&&!this.following)return this.follow();this.unlocate()}},this.onLocate=function(r){"ACTIVE_LOCK"===this.state()&&this.locating&&(this.locating=!1,this.currentLocation=r.coords,e(this.button,["mapboxgl-ctrl-geolocate-active"])),t.fire("locate.update",{locating:this.locating,coords:r.coords,state:this.state()})},this.onMapMove=function(t){if(this.button&&!this.following&&!this.unlocated)return"ACTIVE_LOCK"===this.state()?e(this.button,["mapboxgl-ctrl-geolocate-active"]):void e(this.button,["mapboxgl-ctrl-geolocate-background"])},this.init()};function G(t){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},G(t)}function z(){z=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof y?e:y,a=Object.create(i.prototype),s=new k(n||[]);return o(a,"_invoke",{value:T(t,r,s)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",f="suspendedYield",h="executing",g="completed",m={};function y(){}function v(){}function b(){}var x={};u(x,a,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(P([])));E&&E!==r&&n.call(E,a)&&(x=E);var L=b.prototype=y.prototype=Object.create(x);function C(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==G(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=d;return function(i,a){if(o===h)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=M(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?g:f,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function M(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,M(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function F(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function P(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(G(e)+" is not iterable")}return v.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},C(S.prototype),u(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},C(L),u(L,c,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=P,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),F(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;F(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:P(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function H(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}const q=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.geoflo;this.controls=t,this.options=e;this.enable=function(t){this.position=t||"top-center",r.map.addControl(this,this.position)},this.disable=function(){r.map.removeControl(this)},this.onAdd=function(t){return!!this.options&&(this.options.attribution?this.setAttribution(t):(r.setTheme(this.options.colors||r.options.colors),r.fire("control.add",{control:this,element:this.element}),this.element))},this.onRemove=function(){r.fire("control.remove",{element:this.element,control:this})},this.setAttribution=function(){var t=Attr(r,this.control,this.options);return Object.assign(this,t),r.setTheme(this.options.colors||r.options.colors),r.fire("control.add",{control:this,element:this.element}),this.element},this.setMode=function(t){r.setActiveButton(t||"select")},this.setControl=function(t){if(!t)return!1;var e;this.element=document.createElement("div"),this.element.className=r.id+"-control-wrap",this.control=document.createElement("div"),this.control.className=r.statics.constants.classes.PREDEFINED_CONTROL_BASE+" "+r.statics.constants.classes.PREDEFINED_CONTROL_GROUP,this.element.appendChild(this.control),Array.isArray(t)&&(e=X(this.control,t),Object.assign(this,e)),this.enable(e.position)},this.getButtons=function(){return this._buttons},this.getControl=function(t){var e,r=this.control.childNodes;if(r.length)return t&&r.forEach((function(r){r.classList.contains(t)&&(e=r)})),e},this.showControl=function(t){var e=this.getControl(t);return!!e&&(e.style.display=this.position.includes("center")?"flex":"block",e)},this.hideControl=function(t){var e=this.getControl(t);return!!e&&(e.style.display="none",e)},this.setControl(t)};function X(t,e){if(!e||!t)return!1;var r,n,o=["mode","feature","mouse"],i={},a={},s=null,c={mode:null,feature:null,mouse:null},u={mode:null,feature:null,mouse:null},l=function(t){if(!geoflo.currentMode)return!1;geoflo.currentMode.handleOffMap&&geoflo.currentMode.handleOffMap(t)},p=function(t){if(!geoflo.currentMode)return!1;geoflo.currentMode.handleOnMap&&geoflo.currentMode.handleOnMap(t)};return e.forEach((function(e){(function(t){if(!t)return!1;var e=geoflo.options.controls&&"object"===G(geoflo.options.controls);if(!e&&geoflo.options.controls)return!0;var r=!!e&&!geoflo.options.controls[t.type];return!(r||t.dontShow||!geoflo.options.controls)})(e)||(e.show=!1),function(t){if(!n){if(!t.position)throw new Error("The first control needs to have a position");n=t.position}}(e),function(t,e){var o=document.createElement("div"),i=(e.group?e.group.toUpperCase():e.attribution?"ATTR":"NONE")+"_GROUP";t.appendChild(o),o.className=geoflo.statics.constants.classes[i]+" "+e.type,o.style.display=e.show?n.includes("center")?"flex":"block":"none",o.style.margin="0 5px 0 5px",o.addEventListener("mouseover",p),o.addEventListener("mouseleave",l),function(t,e){r=t,"modes"===t.type?(f("select",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_SELECT,key:"s",title:"Select Features",onAdd:function(){geoflo.editMode||geoflo.drawMode?(geoflo.getButtons("edit").remove(),geoflo.getButtons("save").add()):geoflo.hasSelection()?(geoflo.getButtons("save").remove(),geoflo.getButtons("edit").add()):(geoflo.getButtons("save").remove(),geoflo.getButtons("edit").remove(),geoflo.getButtons("undo").remove(),geoflo.getButtons("cancel").remove(),geoflo.getButtons("redo").remove(),geoflo.getButtons("import").add(),geoflo.getButtons("export").add(),geoflo.getButtons("clear").add())},onActivate:function(){return geoflo.noSelect=!1,geoflo.setMode(),!0},onDeactivate:function(){geoflo.noSelect=!0}}),f("edit",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_EDIT,key:"Enter",title:"Edit Feature",dontShow:!0,onAdd:function(){geoflo.getButtons("select").remove(),this.button.classList.remove(geoflo.statics.constants.classes.ACTIVE_BUTTON),this.button.style.display="flex",this.button.style["background-color"]=geoflo.options.colors.secondaryBackground},onActivate:function(){geoflo.editFeature(),geoflo.getButtons("save").add()},onDeactivate:function(){geoflo.currentMode.deactivate()},onRemove:function(t){!geoflo.getButtons("save")&&createSelect(t)}}),f("save",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_FINSIH,key:"Enter",title:"Save Edit",dontShow:!0,onAdd:function(t){geoflo.getButtons("select").remove(),geoflo.getButtons("edit").remove(),geoflo.getButtons("import").remove(),geoflo.getButtons("export").remove(),geoflo.getButtons("clear").remove(),geoflo.getButtons("undo").add(),geoflo.getButtons("cancel").add(),geoflo.getButtons("redo").add(),this.button.style["background-color"]=geoflo.options.colors.secondaryColor},onActivate:function(t){geoflo.options.repeatDraw=!1,geoflo.getButtons("repeat").deactivate(),geoflo.currentMode.handleClick({finish:!0})}})):"options"===t.type?(g("import",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_IMPORT,key:"u",title:"Import Features",onActivate:function(){return geoflo.loadFeatures()}}),g("export",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_EXPORT,key:"d",title:"Export Features",onActivate:function(){return geoflo.saveFeatures()}}),g("clear",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_CLEAR,key:"Delete",title:"Delete Selected or All Features",onActivate:function(){return geoflo.deleteUserData(),geoflo.getButtons("select").add(),!0}}),g("undo",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_UNDO,key:"u",title:"Undo Edit",dontShow:!0,onActivate:function(){return geoflo.currentMode.handleUndo()}}),g("redo",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_REDO,key:"r",title:"Redo Edit",dontShow:!0,onActivate:function(){return geoflo.currentMode.handleRedo()}}),g("cancel",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_CANCEL,key:"Escape",title:"Cancel Edit",dontShow:!0,onActivate:function(){return geoflo.options.repeatDraw=!1,geoflo.getButtons("repeat").deactivate(),geoflo.cancelEdit()}})):"actions"===t.type?(h("snapping",{container:e,name:"snapping",title:"Enable/Disable Snapping",activeClass:geoflo.id+"-snapping-enabled",inactiveClass:geoflo.id+"-snapping-disabled",onActivate:function(){return geoflo.activateSnapping()},onDeactivate:function(){return geoflo.deactivateSnapping()}}),h("pinning",{container:e,name:"pinning",title:"Enable/Disable Pinning",activeClass:geoflo.id+"-pinning-enabled",inactiveClass:geoflo.id+"-pinning-disabled",onActivate:function(){return geoflo.activatePinning()},onDeactivate:function(){return geoflo.deactivatePinning()}}),h("routing",{container:e,name:"routing",title:"Enable/Disable Routing",activeClass:geoflo.id+"-routing-enabled",inactiveClass:geoflo.id+"-routing-disabled",onActivate:function(){return geoflo.activateRouting()},onDeactivate:function(){return geoflo.deactivateRouting()}}),h("exploring",{container:e,name:"exploring",title:"Enable/Disable Exploring",activeClass:geoflo.id+"-exploring-enabled",inactiveClass:geoflo.id+"-exploring-disabled",onActivate:function(){return geoflo.activateExploring()},onDeactivate:function(){return geoflo.deactivateExploring()}}),h("painting",{container:e,name:"painting",title:"Enable/Disable Painting",activeClass:geoflo.id+"-painting-enabled",inactiveClass:geoflo.id+"-painting-disabled",onActivate:function(){return geoflo.activatePainting()},onDeactivate:function(){return geoflo.deactivatePainting()}})):"types"===t.type?(f("polyline",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_LINE,key:"l",title:"Draw Polyline",onActivate:function(){return geoflo.setMode({mode:geoflo.statics.constants.modes.DRAW,type:"Polyline"})},onDeactivate:function(){geoflo.currentMode.deactivate(),geoflo.setMode()}}),f("polygon",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_POLYGON,key:"p",title:"Draw Polygon",onActivate:function(){return geoflo.setMode({mode:geoflo.statics.constants.modes.DRAW,type:"Polygon"})},onDeactivate:function(){geoflo.currentMode.deactivate(),geoflo.setMode()}}),f("rectangle",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_RECTANGLE,key:"r",title:"Draw Rectangle",onActivate:function(){return geoflo.setMode({mode:geoflo.statics.constants.modes.DRAW,type:"Rectangle"})},onDeactivate:function(){geoflo.currentMode.deactivate(),geoflo.setMode()}}),f("circle",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_POINT,key:"o",title:"Draw Circle",onActivate:function(){return geoflo.setMode({mode:geoflo.statics.constants.modes.DRAW,type:"Circle"})},onDeactivate:function(){geoflo.currentMode.deactivate(),geoflo.setMode()}}),f("text",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_TEXT,key:"t",title:"Draw Text",onActivate:function(){return geoflo.setMode({mode:geoflo.statics.constants.modes.DRAW,type:"Text"})},onDeactivate:function(){geoflo.currentMode.deactivate(),geoflo.setMode()}}),f("icon",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_ICON,key:"i",title:"Draw Icon",onActivate:function(){var t,e=(t=z().mark((function t(){return z().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",geoflo.setMode({mode:geoflo.statics.constants.modes.DRAW,type:"Icon"}));case 1:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){H(i,n,o,a,s,"next",t)}function s(t){H(i,n,o,a,s,"throw",t)}a(void 0)}))});function r(){return e.apply(this,arguments)}return r}(),onDeactivate:function(){geoflo.currentMode.deactivate(),geoflo.setMode()}})):"utils"===t.type&&(f("repeat",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_REPEAT,key:"`",title:"Repeat Selected Mode",onClick:function(t,e){geoflo.options.repeatDraw=!geoflo.options.repeatDraw,geoflo.options.repeatDraw?e.activate():e.deactivate()}}),g("zoom",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_ZOOM_IN_FEATURES,key:"x",title:"Zoom to Extent",onActivate:function(){return geoflo.zoomToFeatures()}}),g("refresh",{container:e,className:geoflo.statics.constants.classes.CONTROL_BUTTON_REFRESH,key:"q",title:"Refresh",onActivate:function(){return geoflo.refresh()}}))}(e,o)}(t,e)})),{setActiveButton:y,queueMapClasses:function(t){u=geoflo.Utilities.extend(u,t)},updateMapClasses:function(){if(!geoflo.container)return;var t,e,r=[],n=[];o.forEach((function(t){u[t]!==c[t]&&(r.push(t+"-"+c[t]),null!==u[t]&&n.push(t+"-"+u[t]))})),r.length>0&&(t=geoflo.container.classList).remove.apply(t,r);n.length>0&&(e=geoflo.container.classList).add.apply(e,n);c=geoflo.Utilities.extend(c,u)},removeButtons:function(){Object.keys(i).forEach((function(t){var e=i[t];e.parentNode?e.parentNode.removeChild(e):e&&e.remove(),delete i[t],delete a[t]}))},getButtonOptions:function(){return a},getButtonElements:function(){return i},position:n};function d(t,e){if(!r||!r.buttons[t])return!1;var n=e.position,o=e.button||document.createElement("button");return e.key=geoflo.options.keys&&geoflo.options.keys[t]?geoflo.options.keys[t]:e.key,e.title&&o.setAttribute("title",function(t){return t.title+(t.key?" ("+t.key+")":"")}(e)),e.container.appendChild(o),e.id=t,e.button=o,e.add=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.button.style.display="flex",this.onAdd&&this.onAdd(t)},e.remove=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.button.style.display="none",this.onRemove&&this.onRemove(t)},e.activate=function(){this.button.classList.remove(e.inactiveClass),this.button.classList.add(e.activeClass),this.button.classList.add(geoflo.statics.constants.classes.ACTIVE_BUTTON),this.activated=!0},e.deactivate=function(){o.classList.remove(e.activeClass),o.classList.remove(geoflo.statics.constants.classes.ACTIVE_BUTTON),o.classList.add(e.inactiveClass),this.activated=!1},e.dontShow&&(o.style.display="none"),i[t]=o,a[t]=e,n&&(n=n.includes("right")?"left":n.includes("left")?"right":n.includes("bottom")?"top":n.includes("top")?"bottom":"absolute"),e.container.tooltipPosition=n,o}function f(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=d(t,e);return!!r&&(r.className=geoflo.statics.constants.classes.CONTROL_BUTTON+" "+e.className,r.addEventListener("click",(function(r){if(r.preventDefault(),r.stopPropagation(),e.onClick)return e.onClick(r.target,e);r.target===s?(m(),e.onDeactivate&&e.onDeactivate(e)):e.onActivate(e)&&y(t)}),!0),r)}function h(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=d(t,e);return!!r&&(r.className=""+geoflo.statics.constants.classes.CONTROL_BUTTON,geoflo.options[e.name]&&geoflo.options[e.name].enable?(r.classList.add(e.activeClass),r.classList.add(geoflo.statics.constants.classes.ACTIVE_BUTTON)):r.classList.add(e.inactiveClass),r.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),geoflo.options[e.name]||(geoflo.options[e.name]={}),geoflo.options[e.name].enable?e.onDeactivate&&e.onDeactivate(e):e.onActivate(e)}),!0),r)}function g(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=d(t,e);return!!r&&(r.className=geoflo.statics.constants.classes.ACTION_BUTTON+" "+e.className,"locate"===t&&geoflo.locate&&geoflo.locate.control&&geoflo.locate.control._container.remove(),r.addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),e.onActivate(e)}),!0),r)}function m(){s&&(s.classList.remove(geoflo.statics.constants.classes.ACTIVE_BUTTON),s=null)}function y(t){m();var e=!t&&geoflo.editMode?i.edit:t?"edit"===t?i.select:i[t]:i.select;e&&e&&"trash"!==t&&(e.title.includes("Draw ")?e.title.includes(geoflo.currentMode.type)&&(e.classList.add(geoflo.statics.constants.classes.ACTIVE_BUTTON),s=e):e.classList.add(geoflo.statics.constants.classes.ACTIVE_BUTTON))}}function Z(t){return function(t){if(Array.isArray(t))return J(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return J(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?J(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}const W=function(t){var e=this.geoflo;function r(t,r,o,i){var a,s=function(t,e){var r=[],o={},i=function(t,e){function r(t,e){return new n(t,e)}function n(t,e){var r={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254};if(void 0===t)throw new Error("No latitude given.");if(e&&!r[e])throw new Error("Unknown unit "+e+". Use one of: "+Object.keys(r));var n=e?r[e]:1,o=Math.cos(t*Math.PI/180),i=2*o*o-1,a=2*o*i-o,s=2*o*a-i,c=2*o*s-a;this.kx=n*(111.41513*o-.09455*a+12e-5*c),this.ky=n*(111.13209-.56605*i+.0012*s)}return r.fromTile=function(t,e,r){var o=Math.PI*(1-2*(t+.5)/Math.pow(2,e));return new n(180*Math.atan(.5*(Math.exp(o)-Math.exp(-o)))/Math.PI,r)},r.units={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},n.prototype={equals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},interpolate:function(t,e,r){var n=e[0]-t[0],o=e[1]-t[1];return[t[0]+n*r,t[1]+o*r]},distance:function(t,e){var r=(t[0]-e[0])*this.kx,n=(t[1]-e[1])*this.ky;return Math.sqrt(r*r+n*n)},bearing:function(t,e){var r=(e[0]-t[0])*this.kx,n=(e[1]-t[1])*this.ky;if(!r&&!n)return 0;var o=180*Math.atan2(-n,r)/Math.PI+90;return o>180&&(o-=360),o},destination:function(t,e,r){var n=(90-r)*Math.PI/180;return this.offset(t,Math.cos(n)*e,Math.sin(n)*e)},offset:function(t,e,r){return[t[0]+e/this.kx,t[1]+r/this.ky]},lineDistance:function(t){for(var e=0,r=0;r<t.length-1;r++)e+=this.distance(t[r],t[r+1]);return e},area:function(t){for(var e=0,r=0;r<t.length;r++)for(var n=t[r],o=0,i=n.length,a=i-1;o<i;a=o++)e+=(n[o][0]-n[a][0])*(n[o][1]+n[a][1])*(r?-1:1);return Math.abs(e)/2*this.kx*this.ky},along:function(t,e){var r=0;if(e<=0)return t[0];for(var n=0;n<t.length-1;n++){var o=t[n],i=t[n+1],a=this.distance(o,i);if((r+=a)>e)return this.interpolate(o,i,(e-(r-a))/a)}return t[t.length-1]},pointOnLine:function(t,e){for(var r,n,o,i,a=1/0,s=0;s<t.length-1;s++){var c=t[s][0],u=t[s][1],l=(t[s+1][0]-c)*this.kx,p=(t[s+1][1]-u)*this.ky;if(0!==l||0!==p){var d=((e[0]-c)*this.kx*l+(e[1]-u)*this.ky*p)/(l*l+p*p);d>1?(c=t[s+1][0],u=t[s+1][1]):d>0&&(c+=l/this.kx*d,u+=p/this.ky*d)}var f=(l=(e[0]-c)*this.kx)*l+(p=(e[1]-u)*this.ky)*p;f<a&&(a=f,r=c,n=u,o=s,i=d)}return{point:[r,n],index:o,t:i}},lineSlice:function(t,e,r){var n=this.pointOnLine(r,t),o=this.pointOnLine(r,e);if(n.index>o.index||n.index===o.index&&n.t>o.t){var i=n;n=o,o=i}var a=[n.point],s=n.index+1,c=o.index;!this.equals(r[s],a[0])&&s<=c&&a.push(r[s]);for(var u=s+1;u<=c;u++)a.push(r[u]);return this.equals(r[c],o.point)||a.push(o.point),a},lineSliceAlong:function(t,e,r){for(var n=0,o=[],i=0;i<r.length-1;i++){var a=r[i],s=r[i+1],c=this.distance(a,s);if((n+=c)>t&&0===o.length&&o.push(this.interpolate(a,s,(t-(n-c))/c)),n>=e)return o.push(this.interpolate(a,s,(e-(n-c))/c)),o;n>t&&o.push(s)}return o},bufferPoint:function(t,e){var r=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-r,t[0]+n,t[1]+r]},bufferBBox:function(t,e){var r=e/this.ky,n=e/this.kx;return[t[0]-n,t[1]-r,t[2]+n,t[3]+r]},insideBBox:function(t,e){return t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]}},r(t,e)}(e[1]);return t.forEach((function(t){var a=t.id||t.properties.id;if(void 0===o[a]){o[a]=!0;var s=t.geometry.type;if("LineString"===s)t.geometry.coordinates&&n(i,t.geometry.coordinates,e).forEach((function(t){t.id=a,t.dist=i.distance(t.coords,e),r.push(t)}));else if("Point"===s){var c={id:a,type:"vertex",coords:t.geometry.coordinates,lineEdge:!0};c.dist=i.distance(c.coords,e),r.push(c)}else if("Polygon"===s){if(turf.booleanWithin(turf.point(e),t))return;t.geometry.coordinates.forEach((function(t,o){n(i,t,e).forEach((function(t){t.id=a,t.polygonCoordsArray=o,t.dist=i.distance(t.coords,e),r.push(t)}))}))}}})),r}(t,r),c=null,u=null,l=e.id||"id";return s.forEach((function(t){var e=t.dist;null!==e&&("vertex"===t.type?null===c?c=t:void 0!==i?1e3*e<i&&c&&c.lineEdge&&(c=t):e<=c.dist&&(e===c.dist?c.lineEdge&&(c=t):c=t):e<o&&(null!==u&&e===u.dist&&u[l]!==t[l]&&"linepoint"===u.type&&(t.distance1<=u.distance1&&t.distance2<=u.distance2||t.distance2<=u.distance1&&t.distance1<=u.distance2)&&(u=t),(null===u||e<u.dist)&&(u=t,a=t.border1&&t.border2?{border1:t.border1,border2:t.border2,distance1:t.distance1,distance2:t.distance2}:null)))})),null!==c?null!==u?c.dist<o?Object.assign({borders:null},c):Object.assign({borders:a},u):Object.assign({borders:null},c):null!==u?Object.assign({borders:a},u):null}function n(t,e,r){var n=[],o=t.pointOnLine(e,r),i=o.point,a=o.index,s={type:"linepoint",coords:i},c=e[a],u=e[a+1],l=t.distance(c,r),p=t.distance(u,r),d=!1,f=null;return l<p?(d=0===a,f=c):(d=a+1===e.length-1,f=u),s.border1=c,s.distance1=l,s.border2=u,s.distance2=p,n.push(s),n.push({type:"vertex",coords:f,lineEdge:d}),n}function o(t,r){return e.statics.constants.CIRCUM*Math.cos(t*(Math.PI/180))/Math.pow(2,r+8)}function i(t){return t?(e.Utilities.setProperty(t,"type",e.currentMode.type),e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([t])),t):(e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])),e.snapFeature)}this.type=t.type,this.activate=function(){this.enabled=!0,e.options.snapping.enable=!0},this.deactivate=function(){this.enabled=!1,e.options.snapping.enable=!1,e.updateMeshData([],!0)},this.getClosest=function(t,n){var i=e.options.snapping.distance*Math.pow(2,Math.max(1,19-e.map.getZoom()))/1e5,a=!!e.options.snapping.pixels&&e.options.snapping.pixels*o(t[1],e.map.getZoom()),s=r(n=n?e.getRenderedSnapFeatures({lng:t[0],lat:t[1]},i):[e.hotFeature],t,i,a);return{point:s,coords:t=!!s&&((a||"vertex"===s.type&&s.dist<=i)&&s.coords)}},this.setClosest=function(t,n,i){if(!t||isNaN(t[0])||isNaN(t[1]))return!1;var a=null,s=e.options.snapping.distance*Math.pow(2,Math.max(1,19-e.map.getZoom()))/1e5,c=!!e.options.snapping.pixels&&e.options.snapping.pixels*o(t[1],e.map.getZoom()),u=!1;e.Pinning&&e.Pinning.pinnedFeatures.length&&(u=["case",["any"].concat(Z(e.Pinning.pinnedFeatures.map((function(t){return["==",["get","id"],t.id||t.properties.id]})))),!1,!0]);var l,p=e.getRenderedFeatures({lng:t[0],lat:t[1]},s,u),d=!(!p||!p.length)&&r(p,t,s,c);if(e.closestPoint=d,!p&&!n||!d&&!n)return this.updateFeature(t);if(!d||!d.coords)return a;if(i||!e.lastClick)a=turf.point(d.coords);else{if(Array.isArray(e.lastClick.coords)&&Array.isArray(e.lastClick.coords[0])&&(e.lastClick.coords=e.lastClick.coords[0]),l=turf.distance(turf.point(t),turf.point(e.lastClick.coords)),e.Utilities.isPointEqual(e.lastClick.coords,d.coords)&&l>e.options.snapping.tolerance)return this.updateFeature(t);a=turf.lineString([e.lastClick.coords,d.coords])}return e.fire("snapping.add",{closest:d,snapped:a}),a},this.setFeature=function(t,r){if(e.touchClick)return null;if(!(t=t||e.snapFeature)&&r)return i(turf.point(r));if(!t)return e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])),null;var n=t.geometry.coordinates,o=r||e.lastClick.coords,a=e.firstClick.coords,s="Polygon"===this.type||"Polygon"===t.properties.type;if(!("LineString"===t.geometry.type)||n.length<2)t=i(s?turf.lineString([a,o]):turf.point(o));else if(e.hotFeature){var c=e.hotFeature.geometry.coordinates;s&&n.pop(),c.splice.apply(c,[-1,1].concat(e.Utilities.consumableArray(n)))}else e.hotFeature=turf.lineString(n);return e.Utilities.setProperty(e.hotFeature,"type",this.type),t=i(s?turf.lineString([a,o]):turf.point(o)),e.snapFeature=t,e.snapFeature},this.setVertex=function(){var t=e.Snapping.enabled;e.bypassSnapping&&(t=!1);var r=e.Routing&&e.Routing.enabled;if(e.bypassRouting&&(r=!1),!t)return!1;var n=e.snappedVertex;return!(!n||isNaN(n[0])||isNaN(n[1]))&&(e.snapFeature=this.setClosest(n,!0,!0),r&&(e.snapFeature=e.Routing.getClosest()||e.snapFeature),e.snapFeature?(e.Utilities.setProperty(e.snapFeature,"type",e.currentMode.type),e.map.getSource(e.statics.constants.sources[r?"ROUTE":"SNAP"]).setData(turf.featureCollection([e.snapFeature])),e.hotFeature.geometry.coordinates[e.dragIndex]=e.snapFeature.geometry.coordinates,e.map.getSource(e.statics.constants.sources.HOT).setData(turf.featureCollection([e.hotFeature])),void e.fire("vertex.dragsnap",{feature:e.hotFeature,vertex:turf.point(n)})):e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])))},this.addFeature=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;if(e.map.getSource(e.statics.constants.sources.SNAP).setData(turf.featureCollection([])),e.map.getSource(e.statics.constants.sources.ROUTE).setData(turf.featureCollection([])),!t||n)return!1;r&&(t.properties=e.Utilities.assignDeep(e.Utilities.cloneDeep(r),t.properties)),e.snapFeature=t,e.map.getSource(e.statics.constants.sources[t.properties.routing?"ROUTE":"SNAP"]).setData(turf.featureCollection([e.snapFeature]))},this.updateFeature=function(t){if(e.closestPoint=null,!e.lastClick)return null;if(!e.firstClick||e.mouseIsDown)return null;var r=e.Features.getType(e.hotFeature)||e.currentMode.type;if(e.hotFeature&&"Point"===e.hotFeature.geometry.type)return null;var n=e.hotFeature?e.Utilities.getLastIndexCoords(e.hotFeature):e.lastClick.coords,o=turf.point(t),i=r&&"Polygon"===r&&e.hotFeature?[n,t,e.firstClick.coords]:[n,t],a=turf.lineString(i);a.properties.type=r,a.properties.hint=!0;var s="feet",c=e.Features.convertUnits(e.hotFeature,0,s);return o=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.map.getSource(e.statics.constants.sources.HOTTEXT)._data.features;n.length&&n[n.length-1].properties.mouseLine&&n.pop();return t.properties.units=r.units,t.properties.unit=r.unit,t.properties.text="".concat(r.units," ").concat(r.unit),t.properties.transform="uppercase",t.properties.anchor="top-left",t.properties.mouseLine=!0,n.push(t),e.map.getSource(e.statics.constants.sources.HOTTEXT).setData(turf.featureCollection(n)),t}(o,{units:c+=e.Features.convertUnits(a,0,s),unit:s}),a},e.options.snapping.enable&&this.activate()};function $(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,s=[],c=!0,u=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=i.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw o}}return s}}(t,e)||K(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Y(t){return function(t){if(Array.isArray(t))return Q(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||K(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(t,e){if(t){if("string"==typeof t)return Q(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Q(t,e):void 0}}function Q(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function tt(t){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt(t)}function et(){et=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof y?e:y,a=Object.create(i.prototype),s=new k(n||[]);return o(a,"_invoke",{value:T(t,r,s)}),a}function p(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var d="suspendedStart",f="suspendedYield",h="executing",g="completed",m={};function y(){}function v(){}function b(){}var x={};u(x,a,(function(){return this}));var w=Object.getPrototypeOf,E=w&&w(w(P([])));E&&E!==r&&n.call(E,a)&&(x=E);var L=b.prototype=y.prototype=Object.create(x);function C(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,s){var c=p(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==tt(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(l).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function T(e,r,n){var o=d;return function(i,a){if(o===h)throw Error("Generator is already running");if(o===g){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=M(s,n);if(c){if(c===m)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===d)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=h;var u=p(e,r,n);if("normal"===u.type){if(o=n.done?g:f,u.arg===m)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function M(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,M(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),m;var i=p(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,m;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function F(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function P(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(tt(e)+" is not iterable")}return v.prototype=b,o(L,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:v,configurable:!0}),v.displayName=u(b,c,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,u(t,c,"GeneratorFunction")),t.prototype=Object.create(L),t},e.awrap=function(t){return{__await:t}},C(S.prototype),u(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},C(L),u(L,c,"Generator"),u(L,a,(function(){return this})),u(L,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=P,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var c=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),m},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),F(r),m}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;F(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:P(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),m}},e}function rt(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function nt(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){rt(i,n,o,a,s,"next",t)}function s(t){rt(i,n,o,a,s,"throw",t)}a(void 0)}))}}var ot=new function(){var t=this;this.statics=a,this.options=c,this.dev=this.statics.developer,this.id=this.statics.id,this.modes=[],this.plugins={},this.gamepads={},this.controls=[],this.enabled=!1,this.mobile=/(iphone|ipod|ipad|android|iemobile|blackberry|bada)/.test(window.navigator.userAgent.toLowerCase())||navigator.userAgent.includes("Mac")&&"ontouchend"in document;var e=[],r=[];this.initialize=function(){return this.initialized||(window[this.id]=this,this.initialized=!0),this},this.init=function(){var e=nt(et().mark((function e(r){var n,o,i,a,s,c,u=this,l=arguments;return et().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:{},o=l.length>2?l[2]:void 0,!this.isLoaded){e.next=4;break}return e.abrupt("return",this);case 4:return e.next=6,vt.call(this,n.license);case 6:if(this.license=e.sent,!this.license||!this.license.enabled){e.next=10;break}return e.next=10,mt.call(this);case 10:if(r=r||this.license.accessToken,delete n.license,r){e.next=14;break}return e.abrupt("return",alert("No Mapbox Access Token Provided!"));case 14:if(this.Utilities=new f,a=n.container||this.options.map.container){e.next=18;break}throw new Error("Element id is required in the DOM for the map!");case 18:return e.next=20,st("https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.css");case 20:return e.next=22,it("https://api.mapbox.com/mapbox-gl-js/v3.4.0/mapbox-gl.js");case 22:return e.next=24,it("https://unpkg.com/@turf/turf@7/turf.min.js");case 24:return e.next=26,it("https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js");case 26:return e.next=28,it("https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js");case 28:return e.next=30,it("https://api.mapbox.com/search-js/v1.0.0-beta.18/core.js");case 30:return this.setOptions(n),e.next=33,ut(a);case 33:if(s=e.sent,c=(c=this.options.styles.find((function(t){return t.title===u.options.map.style})))&&c.uri?c.uri:"mapbox://styles/mapbox/dark-v11",this.isReady=!!s,this.isReady){e.next=39;break}throw new Error("Element id is required in the DOM for the map!");case 39:return s.classList.add(this.statics.id),gt.call(this),turf.distanceToDegrees=function(t){return t/111.32},this.mapbox=new mapboxgl.Map({accessToken:r,container:s,style:c,center:this.options.map.center,zoom:this.options.map.zoom,hash:!0,projection:"mercator",extent:this.options.map.extent}),this.viewport=document.createElement("div"),this.viewportHeightOffset=110,this.viewportWidthOffset=20,this.viewportLeft="10px",this.viewportBottom="5%",this.noSelect=n.noSelect||!1,this.mapbox.on("load",(function(e){ft(t,e)})),e.next=52,pt(this);case 52:return e.next=54,this.redraw();case 54:if(this.statics.controls.forEach((function(t){this.controls.push(new q(t))}),this),this.setViewport(),this.setOpacity(this.options.map.opacity),this.fire("sdk.ready",{enabled:this.enabled,map:this.map,ready:this.isLoaded}),!o||"function"!=typeof o){e.next=66;break}if("AsyncFunction"!==o.constructor.name){e.next=65;break}return e.next=62,o.call(this,this);case 62:i=e.sent,e.next=66;break;case 65:i=o.call(this,this);case 66:return i&&i.disable||this.enable(),e.abrupt("return",this);case 68:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),this.enable=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.enabled||(this.mode=t&&"select"!==t?"draw":"select",this.type=t,this.setOptions(e),this.Select=new U(this),this.Draw=new j(this),this.modes=[this.Select,this.Draw],this.enabled=!0,this.setMode({mode:this.mode,type:this.type}),this.fire("map.enable",{enabled:this.enabled,mode:this.mode,type:this.type})),this},this.disable=function(){return this.enabled?(this.modes=[],this.enabled=!1,this.mode=null,this.options=c,this.doubleClickZoom.enable(this.map),this.Layers.removeEventListeners(),this.Events.removeEventListeners(),this.Layers.removeLayers(),this.removeControls(),this.fire("map.disable",{enabled:this.enabled,mode:this.mode}),this):this},this.redraw=nt(et().mark((function t(){return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.Events){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,this.Layers.refresh();case 4:if(this.Events.removeEventListeners(),this.Events.addEventListeners(),this.Features.updateSource(),this.doubleClickZoom.disable(this.map),this.setViewport(),this.map.style.glyphManager.urls[""]="mapbox://fonts/".concat(this.dev,"/{fontstack}/{range}.pbf"),this.fire("map.redraw",{enabled:this.enabled,mode:this.mode}),!this.onReady){t.next=16;break}return t.next=15,this.onReady(this);case 15:delete this.onReady;case 16:case"end":return t.stop()}}),t,this)}))),this.refresh=nt(et().mark((function t(){return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.noRefresh){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,this.redraw();case 4:this.fire("map.refresh",{enabled:this.enabled,mode:this.mode});case 5:case"end":return t.stop()}}),t,this)}))),this.once=function(t,e){return!(!this.map||!t)&&this.map.once(this.id+":"+t,e)},this.on=function(t,e){if(!e.name)throw new Error("Function must have a name!");return!(!this.map||!t)&&this.map.on(this.id+":"+t,e)},this.off=function(t,e){if(!e.name)throw new Error("Function must have a name!");return!(!this.map||!t)&&this.map.off(this.id+":"+t,e)},this.fire=function(t,e){if(!t)throw new Error("Type is required to fire an event!");this.map&&t&&this.map.fire(this.id+":"+t,{detail:e})},this.setOptions=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.Utilities.assignDeep(this.options,t);return this.options=this.Utilities.assignDeep(c,e),this.options},this.setMode=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.mode||(t.mode=this.statics.constants.modes.SELECT),t.type||(t.type="Polyline");var e,r=[],n=null,o=t.mode===this.statics.constants.modes.EDIT;if(this.currentMode&&t.mode===this.mode&&t.type===this.currentMode.type)return this.currentMode;if(o){if(!t.feature)return this.currentMode&&this.currentMode.deactivate(t),this.setMode();t.mode=this.statics.constants.modes.DRAW,t.type=t.type||t.feature.properties.type,this.editing=this.Utilities.cloneDeep(t.feature)}(this.currentMode&&this.currentMode.activated&&this.currentMode.deactivate(t),this.container.classList.forEach((function(t){-1!==t.indexOf("mouse-")&&r.push(t)})),r.length>0)&&(e=this.container.classList).remove.apply(e,r);return this.setMapClass("pointer"),this.modes.forEach((function(e){e.canHandle&&e.canHandle(t.mode)&&(n=e)})),n&&(this.fire("mode.change",{old:this.mode,new:t.mode,mode:n,type:t.type}),this.currentMode=n,this.mode=t.mode,n.activate(t)),this.Snapping=new W(this.currentMode),this.license&&this.license.enabled&&this.premiumModules&&(this.Pinning=new this.premiumModules.Pinning(this.currentMode),this.Routing=new this.premiumModules.Routing(this.currentMode),this.Exploring=new this.premiumModules.Exploring(this.currentMode),this.Painting=new this.premiumModules.Painting(this.currentMode)),this.Layers.moveLayers(),this.currentMode},this.setIcon=function(t){!!this.navigation&&this.navigation._compassIcon,this.Locate&&this.Locate.following},this.setCenterMarker=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.noCenterMarker||!this.mobile||!t.gamepad)return!1;var e,r=this.Locate&&this.Locate.following,n=t.icon||this.statics.logo.icon;return t.remove?!(!this.centerMarker||this.centerMarker.noRemove)&&(this.centerMarker.remove(),delete this.centerMarker):this.centerMarker?(this.centerMarker.setLngLat(this.map.getCenter()).addTo(this.map),(t.transform||t.gamepad)&&this.centerMarker.setPitchAlignment("map"),this.centerMarker):!t.dontAdd&&(this.centerMarkerIcon||((e=document.createElement("div")).className=this.id+"-center-marker",e.style.backgroundImage='url("'.concat(n,'")')),this.centerMarkerIcon=e,this.centerMarker=new mapboxgl.Marker(this.centerMarkerIcon),this.centerMarker.setLngLat(this.map.getCenter()).addTo(this.map).setOffset([0,0]),this.centerMarker.noRemove=t.noRemove,r&&this.centerMarker.setOffset([0,-20]),this.centerMarker)},this.setButtons=function(){return!!this.getButtons("select")&&this.getButtons("select").add()},this.setActiveButton=function(t){if(!this.controls||!this.controls.length)return!1;this.controls.forEach((function(e){e.setActiveButton(t.toLowerCase())}))},this.setTheme=function(){var t=nt(et().mark((function t(e){var r=this;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&"object"===tt(e)){t.next=2;break}return t.abrupt("return",!1);case 2:return this.options.colors=Object.assign(this.options.colors,e),Object.keys(e).forEach((function(t){if(e[t]){var n=r.Utilities.rgba(e[t]);document.documentElement.style.setProperty("--geoflo-".concat(t.replace(/[A-Z]/g,(function(t){return"-".concat(t.toLowerCase())}))),n)}})),t.next=6,this.Layers.refresh();case 6:return this.Features.updateSource(),this.fire("theme.change",{colors:e}),t.abrupt("return",this.getTheme());case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),this.setColors=nt(et().mark((function t(){var e,r=arguments;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]?r[0]:{},t.next=3,this.setTheme(e);case 3:return t.sent,t.abrupt("return",this.getColors());case 5:case"end":return t.stop()}}),t,this)}))),this.setLayers=nt(et().mark((function t(){var e,r,n,o=arguments;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=o.length>1&&void 0!==o[1]?o[1]:{},(n=(e=o.length>0&&void 0!==o[0]?o[0]:[]).map((function(t){var e,r;return t.source||(null===(e=t.details)||void 0===e?void 0:e.source)||(null===(r=t.metadata)||void 0===r?void 0:r.source)}))).length||(r.reset=!0),this.Features.removeLayers(n,r),t.next=7,this.Layers.setCustomLayers(e,r);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}}),t,this)}))),this.setSelectedFeatures=function(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];r.length?(t=e).splice.apply(t,[0,e.length].concat(Y(r))):e=[];this.map.getSource(this.statics.constants.sources.SELECT).setData(turf.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(turf.featureCollection(this.getSelectedFeatures())),this.fire("select.load",{features:turf.featureCollection(this.getSelectedFeatures()),source:this.map.getSource(this.statics.constants.sources.SELECT)})},this.setMeshFeatures=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return!!t.length&&(this.updateMeshData(t,!0),this.Mesh.getFeatures())},this.setMapClass=function(t){if(this.container.classList.forEach((function(t){-1!==t.indexOf("mouse-")&&this.container.classList.remove(t)}),this),!t)return!1;this.container.classList.add("mouse-"+t)},this.setViewport=function(t){var e=t||{position:"absolute",margin:"auto",top:"",left:this.viewportLeft,bottom:this.viewportBottom},r=this.container.getBoundingClientRect().height,n=this.container.getBoundingClientRect().width;return e.height="".concat(Number.parseInt(r)-this.viewportHeightOffset,"px"),e.width="".concat(Number.parseInt(n)-this.viewportWidthOffset,"px"),this.Utilities.extend(this.viewport.style,e),this.setPadding(),this.map.resize(),this.viewport},this.setPadding=function(){var t=this.container.getBoundingClientRect().left-this.viewport.getBoundingClientRect().left,e=this.container.getBoundingClientRect().right-this.viewport.getBoundingClientRect().right,r=this.container.getBoundingClientRect().top-this.viewport.getBoundingClientRect().top,n=this.container.getBoundingClientRect().bottom-this.viewport.getBoundingClientRect().bottom,o=this.container.getBoundingClientRect().width<20;return this.padding={left:o?0:Math.abs(t),right:o?0:Math.abs(e),top:o?0:Math.abs(r),bottom:o?0:Math.abs(n)},this.map.setPadding(this.padding),this.padding},this.setStyle=function(t,e){return!!t&&(this.map.setStyle(t,e),this.map.getStyle())},this.setExtent=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.settingExtent=!0;var n=!t||!t.length,o=r.center;!o&&r.isPoint&&(o=!0),this.setViewport(),e?(this.preventDefault=!0,t=this.options.map.extent?[turf.polygon(this.options.map.extent)]:[]):n&&(t=this.getDrawnFeatures());var i={bearing:r.bearing||this.options.map.bearing||this.map.getBearing(),center:this.options.map.center||this.map.getCenter(),zoom:r.zoom||this.options.map.zoom||this.map.getZoom(),pitch:r.pitch||this.options.map.pitch||this.map.getPitch()};if(!t)return this.map.jumpTo(i);if(t.length){var a=turf.bbox(turf.featureCollection(t));if(o){var s=turf.bboxPolygon(a),c=turf.centroid(s);i.center={lat:c.geometry.coordinates[1],lng:c.geometry.coordinates[0]},i.zoom=r.zoom||this.map.getZoom(),i.pitch=r.pitch||this.map.getPitch(),i.bearing=r.bearing||this.map.getBearing(),this.map.jumpTo(i)}else if(a){var u={padding:this.map.getPadding(),linear:!0};r.bearing&&(u.bearing=r.bearing),r.pitch&&(u.pitch=r.pitch),r.maxZoom&&(u.maxZoom=r.maxZoom),this.map.fitBounds(a,u)}return this.fire("features.zoom",{features:t,center:this.map.getCenter(),bbox:a}),this.settingExtent=!1,this.map}},this.setOpacity=function(t){var e=this,r=this.opacity=Number(t||1);this.map.getStyle().layers.map((function(t){if(!t.id.includes("geoflo")||"background"===t.type){if(t.metadata&&t.metadata.custom)return;"symbol"===t.type?(e.map.setPaintProperty(t.id,"icon-opacity",r),e.map.setPaintProperty(t.id,"text-opacity",r)):e.map.setPaintProperty(t.id,"".concat(t.type,"-opacity"),r)}}))},this.hasControls=function(){return this.controls&&this.controls.length},this.hasSelection=function(){return this.getSelectedFeatures().length>0},this.hasSingleSelection=function(){return 1===this.getSelectedFeatures().length},this.activateSnapping=function(){if(!this.Snapping)return!1;var t=this.getButtons("snapping");return t?(t.activate(),this.Snapping.activate(),this.fire("snapping.activate",{enabled:!0,mesh:this.Mesh,snapping:this.Snapping}),this.Snapping):void 0},this.activatePinning=function(){if(!this.Pinning)return!1;var t=this.getButtons("pinning");return t?(t.activate(),this.activateSnapping(),this.Pinning.activate(),this.fire("pinning.activate",{enabled:!0,pinning:this.Pinning}),this.Pinning):void 0},this.activateRouting=function(){if(!this.Routing)return!1;var t=this.getButtons("routing");return t?(t.activate(),this.activateSnapping(),this.deactivatePainting(),this.Routing.activate(),this.fire("routing.activate",{enabled:!0,routing:this.Routing}),this.Routing):void 0},this.activateExploring=function(){if(!this.Exploring)return!1;var t=this.getButtons("exploring");return t?(t.activate(),this.deactivatePainting(),this.Exploring.activate(),this.fire("exploring.activate",{enabled:!0,exploring:this.Exploring}),this.Exploring):void 0},this.activatePainting=function(){if(!this.Painting)return!1;var t=this.getButtons("painting");return t?(t.activate(),this.deactivateRouting(),this.deactivateExploring(),this.Painting.activate(this.drawMode),this.fire("painting.activate",{enabled:!0,painting:this.Painting}),this.Painting):void 0},this.deactivateSnapping=function(){if(!this.Snapping)return!1;var t=this.getButtons("snapping");return t?(t.deactivate(),this.deleteMeshData(),this.Snapping.deactivate(),this.fire("snapping.deactivate",{enable:!1}),!1):void 0},this.deactivatePinning=function(){if(!this.Pinning)return!1;var t=this.getButtons("pinning");return t?(t.deactivate(),this.Pinning.deactivate(),this.fire("pinning.deactivate",{enable:!1}),!1):void 0},this.deactivateRouting=function(){if(!this.Routing)return!1;var t=this.getButtons("routing");return t?(t.deactivate(),this.Routing.deactivate(),this.fire("routing.deactivate",{enable:!1}),!1):void 0},this.deactivateExploring=function(){if(!this.Exploring)return!1;var t=this.getButtons("exploring");return t?(t.deactivate(),this.deleteMeshData(),this.Exploring.deactivate(),this.fire("exploring.deactivate",{enable:!1}),!1):void 0},this.deactivatePainting=function(){if(!this.Painting)return!1;var t=this.getButtons("painting");return!t||this.mobile&&!this.currentMode.finished&&"draw"===this.currentMode.id&&this.currentMode.type&&"Rectangle"===this.currentMode.type?void 0:(t.deactivate(),this.Painting.deactivate(),this.fire("painting.deactivate",{enable:!1}),!1)},this.getMap=function(){return this.map},this.getModes=function(t){return t?this.modes.find((function(e){if(e.canHandle&&e.canHandle(t))return e})):this.modes},this.getMode=function(){return this.currentMode},this.getColors=function(){return this.options.colors},this.getTheme=function(){var t=this,e=getComputedStyle(document.documentElement),r={};return["primaryColor","primaryBackground","primaryText","primaryBorder","secondaryColor","secondaryBackground","secondaryText","secondaryBorder"].forEach((function(n){var o="--geoflo-".concat(n.replace(/[A-Z]/g,(function(t){return"-".concat(t.toLowerCase())}))),i=e.getPropertyValue(o).trim();r[n]=t.Utilities.hex(i)})),{colors:r}},this.getButtons=function(t){return!!this.hasControls()&&(this.controls.forEach((function(r){var n=r.getButtonOptions();t?!e&&n[t]&&(e=n[t]):(e||(e={}),Object.entries(n).forEach((function(t){var r=t[0],n=t[1];e[r]=n})))})),e);var e},this.getHotFeature=function(){return this.hotFeature},this.getDrawnFeatures=function(){return this.Features.getFeatures()},this.getSnapFeatures=function(){return this.Mesh?this.Mesh.getFeatures():[]},this.getRenderedFeatures=function(t,e,r){var n=[this.getRenderedDrawnFeatures(t,e,r),this.getRenderedSnapFeatures(t,e,r)].flat();return n=n.filter((function(t){return!this.Features.isFeatureHidden(this.Utilities.getFeatureId(t))}),this)},this.getRenderedDrawnFeatures=function(t,e,r){var n,o=this.id,i={layers:[]};if(this.Layers.getLayers().forEach((function(t){t.id.includes(o)&&!t.id.includes("-cold")||this.map.getLayer(t.id)&&i.layers.push(t.id)}),this),e){var a=turf.distanceToDegrees(e);n=[this.map.project([t.lng-a,t.lat-a]),this.map.project([t.lng+a,t.lat+a])]}else{var s=t?this.map.project([t.lng,t.lat]):null;n=s?[[s.x-5,s.y-5],[s.x+5,s.y+5]]:null}r&&(i.filter=r);var c=this.map.queryRenderedFeatures(n,i),u=c.map((function(t){return t.parent||t.properties.parent||t.id||t.properties.id}));return c&&c.length?this.Features.getFeaturesById(u):[]},this.getRenderedSnapFeatures=function(t,e,r){if(!this.Mesh)return[];var n=turf.distanceToDegrees(e),o=[this.map.project([t.lng-n,t.lat-n]),this.map.project([t.lng+n,t.lat+n])],i={layers:[]};this.Layers.getLayers().forEach((function(t){t.id.includes("-mesh-")&&i.layers.push(t.id)})),r&&(i.filter=r);var a=this.map.queryRenderedFeatures(o,i);return a&&a.length?this.Mesh.getFeaturesFromIndex(a):[]},this.getFeatureById=function(t){return!!t&&this.Features.getFeatureById(t)},this.getFeaturesByLayer=function(t,e,r,n){var o,i=[];this.Layers.getLayers().forEach((function(e){e.id.includes(t)&&i.push(e.id)}));var a={layers:i};if(r){var s=turf.distanceToDegrees(r);o=[this.map.project([e.lng-s,e.lat-s]),this.map.project([e.lng+s,e.lat+s])]}else{var c=e?this.map.project([e.lng,e.lat]):null;o=c?[[c.x-5,c.y-5],[c.x+5,c.y+5]]:null}n&&(a.filter=n);var u=this.map.queryRenderedFeatures(o,a),l=u.map((function(t){return t.parent||t.properties.parent||t.id||t.properties.id}));return u&&u.length?this.Features.getFeaturesById(l):[]},this.getSelectedFeatures=function(){return e},this.getSelectedFeatureIds=function(){return this.getSelectedFeatures().map((function(t){return t.parent||t.properties.parent||t.id||t.properties.id}))},this.getSelectedFeaturesBbox=function(){return this.hasSelection()?turf.bbox(turf.featureCollection(this.getSelectedFeatures())):null},this.getSelectedPropertyNames=function(){var t=this.id,e=[];return this.getSelectedFeatures().forEach((function(r){Object.keys(r.properties).forEach((function(r){-1===e.indexOf(r)&&r!==t&&e.push(r)}))})),e},this.getSelectedPropertyValues=function(){var t=this.id,e={};return this.getSelectedFeatures().forEach((function(t){Object.assign(e,t.properties)})),void 0!==e[t]&&delete e[t],e},this.getCommonGeometryType=function(){var t=null;return this.getSelectedFeatures().forEach((function(e){null===t?t=e.geometry.type:e.geometry.type!==t&&(t="illegal")})),"illegal"===t?null:t},this.getControlIds=function(){return this.controls?this.controls.map((function(t){return t.controls.map((function(t){return t.type}))})).flat():[]},this.selectFeature=function(t,e){return!!this.currentMode.selectFeature&&this.currentMode.selectFeature(t,e)},this.editFeature=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.feature||this.getFeatureById(t);if(!r){if(!this.hasSingleSelection())return!1;r=this.getSelectedFeatures()[0]}return r=this.Utilities.clone(r),e.mode="edit",e.id=r.id,e.feature=r,e.type=r.properties.type,this.fire("feature.edit",{feature:r,id:r.id}),this.removeSelection(),this.setMode(e),r},this.cancelEdit=function(t,e){return"draw"===this.currentMode.id&&(e=e||this.editing,this.currentMode.deactivate({cancel:!0,standby:t,feature:e}))},this.saveEdit=function(){return this.currentMode.saveEdit()},this.addFeatures=function(t,e){return t?(t.features&&(t=t.features),Array.isArray(t)||(t=[t]),t.length?(this.Features.addFeatures(t),!e&&this.zoomToFeatures(),this.getDrawnFeatures()):[]):[]},this.addFeaturesToSelected=function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||!t.length)return[];var n=this.getSelectedFeatures();return t=t.filter((function(t){return!n.find((function(e){return e.id===t.id}))})),(e=this.getSelectedFeatures()).push.apply(e,Y(t)),this.setViewport(),this.setButtons(),this.updateFeatures(t),this.Layers.refresh({select:!0}),r.zoom&&this.zoomToFeatures(t,{center:r.center}),r.text&&this.Layers.addTextLayer({select:!0,ids:r.text.ids||this.getSelectedFeatureIds(),field:r.text.field||"text",layout:r.text.layout||{"text-transform":"uppercase","text-size":10,"text-offset":[0,.5]}}),this.getSelectedFeatures()},this.addFeaturesToMesh=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return!!t.length&&(this.updateMeshData(t),t)},this.addControls=function(){var t=this;this.getControlIds().forEach((function(e){t.addControl(e)}))},this.addControl=function(t){if(!t)return!1;var e=this.getControlIds();if(!e.includes(t))throw new Error("Control ".concat(t," not found"),"Controls: ".concat(e.join(", ")));this.controls.forEach((function(e){e.getControl(t)&&e.showControl(t)}))},this.removeSelection=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.removePopup(),!this.hasSelection())return 0;var r=this.Utilities.clone(this.getSelectedFeatures());return this.Features.addFeatures(r),this.getSelectedFeatures().splice(0,r.length),this.map.getSource(this.statics.constants.sources.SELECT).setData(turf.featureCollection([])),this.map.getSource(this.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),this.setButtons(),e.extent&&(this.setViewport(),this.setExtent()),e.removeText&&this.Layers.removeTextLayer(),r.length},this.removeAllFeatures=function(){this.removeSelection(),this.Features.deleteFeatures(),this.map.getSource(this.statics.constants.sources.MESH).setData(turf.featureCollection([])),this.map.getSource(this.statics.constants.sources.SELECT).setData(turf.featureCollection([])),this.map.getSource(this.statics.constants.sources.VERTEX).setData(turf.featureCollection([])),this.Layers.refresh({select:!0}),this.fire("features.removeAll")},this.removeFeatures=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return!1;e.forEach((function(e){t.removeFeature(e)}),this),this.fire("features.remove",{ids:e})},this.removeFeature=function(t){if(!t)return!1;var e=this.Features.removeFeature(t);return this.fire("feature.remove",{id:t}),e},this.removePopup=function(){return this.popup&&this.popup.remove?this.popup.remove():!(!this.currentMode.popup||!this.currentMode.popup.remove)&&this.currentMode.popup.remove()},this.removeControls=function(){var t=this;this.getControlIds().forEach((function(e){t.removeControl(e)}))},this.removeControl=function(t){if(!t)return!1;var e=this.getControlIds();if(!e.includes(t))throw new Error("Control ".concat(t," not found"),"Controls: ".concat(e.join(", ")));this.controls.forEach((function(e){e.getControl(t)&&e.hideControl(t)}))},this.hideFeatures=function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!e.length)return!1;var r={ids:e,features:this.Features.getFeaturesById(e)};return e.forEach((function(e){t.Features.setFeatureState(e,{hidden:!0})}),this),this.fire("features.hide",r),r.features},this.updateMeshData=function(){var t=this,e=arguments.length>1?arguments[1]:void 0;return function(r){t.Mesh&&!e||(t.Mesh=new D([])),t.Mesh.addNewFeatures(r);var n=t.statics.constants.sources.MESH;r=turf.featureCollection(t.Mesh.getFeatures());return t.map.getSource(n).setData(r),t.fire("mesh.update",{features:r}),r}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])},this.updateSelectedProperties=function(t,e){this.getSelectedFeatures().forEach((function(r){var n=r.parent||r.properties.parent||r.id||r.properties.id,o={};e.forEach((function(t){r.properties[t]&&(o[t]=r.properties[t])})),r.properties=Object.assign(o,t,{id:n})}))},this.updateOrientation=function(t){return!!this.Locate&&(this.Locate.update(t),this.Locate.locate)},this.updateFeatures=function(t){return this.Features.updateFeatures(t)},this.saveFeatures=function(e){var r,n,o=this.id;if(e){if(!e.id||!e.name)return window.alert("Layer ID and Name are required!");n=e.name+"-"+e.id,r=turf.featureCollection(this.Features.getFeaturesByLayer(e))}else this.hasSelection()?(n="Selected Features",r=turf.featureCollection(this.getSelectedFeatures())):(n=n="All Features",r=turf.featureCollection(this.getDrawnFeatures()));if(!r.features.length)return window.alert("No Features to Export!");var i=t.Utilities.cloneDeep(r.features);i=i.map((function(t){return t.style={},t.style.stroke=t.properties.style&&t.properties.style.primaryColor?t.properties.style.primaryColor:this.options.colors.primaryColor,t.style["stroke-width"]=3,t.style.fill=t.properties.style&&t.properties.style.secondaryColor?t.properties.style.secondaryColor:this.options.colors.secondaryColor,t.style["fill-opacity"]=1,t.properties.id=t.id,t.properties.unit=t.geometry.unit,t.properties.units=t.geometry.units,delete t.properties.style,delete t.geometry.unit,delete t.geometry.units,t}),this),r=turf.featureCollection(i);var a=new Date,s=o+"_export - "+(a.getMonth()+1)+"."+a.getDate()+"."+a.getFullYear()+"_"+a.getHours()+a.getMinutes(),c=new window.JSZip,u={Id:this.id,Version:this.version,Features:r.features.length};["kmz","gpx","geojson"].forEach((function(t){var e=c.folder(n+" "+t.toUpperCase());switch(t){case"kmz":var o=document.createElement("table"),a=document.createElement("tbody");o.appendChild(a),Object.entries(u).forEach((function(t){var e=t[0],r=t[1],n=document.createElement("tr"),o=document.createElement("th"),i=document.createElement("td");o.textContent=e+": ",i.textContent=r,n.appendChild(o),n.appendChild(i),a.appendChild(n)}));var s=omnivore.toKML(r,{name:"id",simplestyle:!0,description:u.Id,documentName:n,documentDescription:o.innerHTML}),l=new Blob([s],{type:"application/vnd.google-earth.kml+xml"});e.file(n.toLowerCase()+".kml",l);break;case"gpx":i.forEach((function(t){var r=t.id,o=turf.featureCollection([t]),i=omnivore.toGPX(o,{creator:u.Id,featureTitle:function(t){return t.id}});e.file(n.toLowerCase()+"_"+r+".gpx",i)}));break;case"geojson":var p=r;l=new Blob([JSON.stringify(p)],{type:"application/geojson"});e.file(n.toLowerCase()+".geojson",l)}})),c.generateAsync({type:"blob"}).then((function(t){var e=new Blob([t],{type:"application/zip;charset=utf-8"});window.geoflo.fire("features.export",{features:i,blob:e,date:a,name:s});var r=document.createElement("a");r.setAttribute("href",URL.createObjectURL(e)),r.setAttribute("download",s+".zip"),r.click(),URL.revokeObjectURL(r.href)}))},this.loadFeatures=function(){var e=document.createElement("input");e.type="file",e.setAttribute("multiple","multiple"),e.addEventListener("change",(function(e){for(var r=[],n=0;n<e.target.files.length;n++)r.push(e.target.files[n]);for(var o=function(){var e=r[i],n=e.name,o=n.substring(n.lastIndexOf(".")+1,n.length).toLowerCase(),a=new FileReader;a.onloadend=function(){if(a.readyState===FileReader.DONE)try{!function(e,r,n){var o=[];if("geojson"===n||"json"===n)o=JSON.parse(e);else{if(!omnivore[n])return alert("File type not supported: "+n);omnivore[n].parse(e,null,{addData:function(t){o=t}})}o.features&&(o=o.features);Array.isArray(o)||(o=[o]);o.forEach((function(e){e.properties.import=!0,e.source=e.source||e.properties.source||t.statics.constants.sources.COLD})),t.fire("features.import",{features:o,file:e,ext:n,name:r}),t.addFeatures(o)}(a.result,n,o)}catch(t){}},a.readAsText(e)},i=0;i<r.length;i++)o()}),!1),e.click()},this.moveMapAlongLine=function(e){if(e){var r,n=turf.lineDistance(e),o=turf.lineDistance(e);window.requestAnimationFrame((function i(a){r||(r=a);var s=(a-r)/8e4;s>1&&setTimeout((function(){r=0}),1500);var c=turf.along(turf.lineString(e),n*s).geometry.coordinates,u=turf.along(turf.lineString(e),o*s).geometry.coordinates,l=t.map.getFreeCameraOptions();l.position=mapboxgl.MercatorCoordinate.fromLngLat({lng:u[0],lat:u[1]},4e3),l.lookAtPoint({lng:c[0],lat:c[1]}),t.map.setFreeCameraOptions(l),window.requestAnimationFrame(i)}))}},this.refreshMeshData=function(){this.Mesh&&(this.mapMoving||this.fire("snapping.refresh",{features:this.Mesh.getFeatures()}))},this.deleteMeshData=function(){this.updateMeshData([],!0),this.fire("snapping.delete",{features:this.Mesh.getFeatures()})},this.deleteUserData=function(){var t;if(this.hasSingleSelection()){if(!window.confirm("Delete Selected Feature?"))return;var e=this.getSelectedFeatures()[0];t=e.parent||e.properties.parent||e.id||e.properties.id,this.removeSelection(t),this.Features.removeFeature(t),this.Mesh&&this.Mesh.removeFeature(t),this.fire("feature.delete",{features:this.getDrawnFeatures(),id:t,feature:e})}else{if(!window.confirm("Delete All Features?"))return;this.Features.deleteFeatures(),this.fire("features.delete",{features:this.getDrawnFeatures()})}this.hotFeature=null,this.snapFeature=null,this.lastClick=null,this.firstClick=null,this.drawStarted=null,this.map.getSource(this.statics.constants.sources.SNAP).setData(turf.featureCollection([])),this.map.getSource(this.statics.constants.sources.HOT).setData(turf.featureCollection([])),this.map.getSource(this.statics.constants.sources.HOTTEXT).setData(turf.featureCollection([])),this.editMode&&(this.editMode=!1,this.setMode())},this.doubleClickZoom={enable:function(t){setTimeout((function(){t&&t.doubleClickZoom&&t.doubleClickZoom.enable()}),0)},disable:function(t){setTimeout((function(){t&&t.doubleClickZoom&&t.doubleClickZoom.disable()}),0)}},this.hideSelectedFeatures=function(){var t;r.length>0?((t=this.getSelectedFeatures()).push.apply(t,r),r.splice(0,r.length)):this.hasSelection()&&r.push.apply(r,Y(this.getSelectedFeatures().splice(0,this.getSelectedFeatures().length)));this.map.getSource(this.statics.constants.sources.SELECT).setData(turf.featureCollection(this.getSelectedFeatures())),this.map.getSource(this.statics.constants.sources.VERTEX).setData(turf.featureCollection(this.getSelectedFeatures()))},this.combineSelectedFeatures=function(){if(this.mode===this.statics.constants.modes.SELECT&&this.hasSelection()){var e=this.getCommonGeometryType();if("Polygon"===e){var r=[];this.forEachSelectedFeature((function(t){r.push.apply(r,consumableArray(t.geometry.coordinates))})),r.length>0&&(this.Features.addFeatures([turf.polygon(r,this.getSelectedPropertyValues())]),this.removeSelection())}else if("LineString"===e){var n=t.Utilities.combineSameTypeFeatures(this.getSelectedFeatures());n.length>0&&(this.Features.addFeatures([turf.lineString(n,this.getSelectedPropertyValues())]),this.removeSelection())}}},this.moveSelectedFeatures=function(t){if(!this.options.moving||!this.options.moving.enable)return!1;var e=this.options.moving.distance;if(this.mode===this.statics.constants.modes.SELECT&&(this.hasSelection()&&"LineString"===this.getCommonGeometryType())){var r=[];this.forEachSelectedFeature((function(n){r.push(turf.lineOffset(n,e*t))})),this.setSelectedFeatures(r)}},this.moveFeature=function(t,e){if(!this.options.moving||!this.options.moving.enable)return!1;for(var r=this.options.moving.distance,n=[],o=null,i=t.geometry.coordinates,a=0;a<i.length;a++){var s=0,c=null,u=i[a];if(0===a){var l=i[a+1];(s=turf.bearing(u,l)-90)<-180&&(s+=180)}else if(a===i.length-1){c=i[a-1],(s=turf.bearing(u,c)-90)<-180&&(s+=180)}else{c=i[a-1];var p=i[a+1],d=turf.bearing(u,c),f=turf.bearing(u,p),h=0;d<0&&f<0||d>0&&f>0?(h=Math.abs(Math.abs(d)-Math.abs(f)),s=d<0?d-h/2:d+h/2):(h=Math.abs(Math.abs(d)+Math.abs(f)),s=d<0?d-h/2:-1*(h/2-d))}var g=turf.destination(u,e*r,s);if(o&&c){var m=turf.lineString([o.geometry.coordinates,g.geometry.coordinates]);turf.lineIntersect(turf.lineString([c,u]),m).features.length>0&&(g=turf.destination(u,e*-r,s))}n.push(g.geometry.coordinates),o=g}return n},this.forEachSelectedFeature=function(t){return this.getSelectedFeatures().forEach(t),this.getSelectedFeatures()},this.zoomToFeatures=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=t||(this.hasSelection()?this.getSelectedFeatures():this.getDrawnFeatures()),this.setExtent(t,!1,e)},this.createPolygon=function(){if(!this.hasSelection()||this.mode!==this.statics.constants.modes.SELECT)return!1;if("LineString"!==this.getCommonGeometryType())return!1;var e=t.Utilities.combineSameTypeFeatures(this.getSelectedFeatures());e.length>0&&(t.Utilities.isPointEqual(e[0],e[e.length-1])||e.push(e[0]),this.addFeaturesToSelected([turf.polygon([e],this.getSelectedPropertyValues())]),this.removeSelection())},this.initialize()};function it(t){return at.apply(this,arguments)}function at(){return(at=nt(et().mark((function t(e){var r,n,o;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:if(!(r=t.sent).ok){t.next=13;break}return t.next=7,r.text();case 7:n=t.sent,(o=document.createElement("script")).textContent=n,document.head.appendChild(o),t.next=14;break;case 13:case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0);case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)}function st(t){return ct.apply(this,arguments)}function ct(){return(ct=nt(et().mark((function t(e){var r,n,o;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:if(!(r=t.sent).ok){t.next=13;break}return t.next=7,r.text();case 7:n=t.sent,(o=document.createElement("style")).textContent=n,document.head.prepend(o),t.next=14;break;case 13:case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0);case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))).apply(this,arguments)}function ut(t){return lt.apply(this,arguments)}function lt(){return lt=nt(et().mark((function t(e){var r;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=0,t.abrupt("return",new Promise(function(){var t=nt(et().mark((function t(n,o){var i;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=setInterval((function(){var t=document.getElementById(e);return 1e4===r?(clearInterval(i),o(!1)):t?(clearInterval(i),n(t)):r++}),1);case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 2:case"end":return t.stop()}}),t)}))),lt.apply(this,arguments)}function pt(t){return dt.apply(this,arguments)}function dt(){return dt=nt(et().mark((function t(e){return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=nt(et().mark((function t(r,n){var o;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=setInterval((function(){return!!e.isLoaded&&(clearInterval(o),r(e.isLoaded))}),1);case 1:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)}))),dt.apply(this,arguments)}function ft(t,e){if(!e.target||!e.target.getContainer)throw new Error("MapboxGL map object is required!");return t.map=e.target,t.container=t.map._container,t.viewport&&t.container.insertBefore(t.viewport,t.container.firstChild),t.map.off("style.load",ht),t.map.on("style.load",ht),t.options.map.maxPitch&&t.map.setMaxPitch(t.options.map.maxPitch),t.options.map.maxZoom&&t.map.setMaxZoom(t.options.map.maxZoom),t.options.map.minPitch&&t.map.setMinPitch(t.options.map.minPitch),t.options.map.minZoom&&t.map.setMinZoom(t.options.map.minZoom),t.styles=new m({styles:t.options.styles,selected:t.options.map.style}),t.Layers=new O,t.Features=new N,t.locate=new V,t.navigation=new mapboxgl.NavigationControl({visualizePitch:!0,showZoom:!0,showCompass:!0}),t.navigation.hide=function(){t._container.style.display="none"}.bind(t.navigation),t.navigation.show=function(){t._container.style.display="block"}.bind(t.navigation),t.map.addControl(t.navigation,"top-right"),t.mobile||(t.fullscreen=new mapboxgl.FullscreenControl({container:document.querySelector("body")}),t.fullscreen.hide=function(){t._controlContainer.style.display="none"}.bind(t.fullscreen),t.fullscreen.show=function(){t._controlContainer.style.display="block"}.bind(t.fullscreen),t.map.addControl(t.fullscreen,"top-right")),t.map.addControl(t.styles),t.Events=B(t),t.Events.removeEventListeners(),t.Events.addEventListeners(),t.isLoaded=!0,t}function ht(t){setTimeout((function(){ot.redraw()}),500)}function gt(){var t=function(t,e,r){var n=window.document.createElement(t);return void 0!==e&&(n.className=e),r&&r.appendChild(n),n};mapboxgl.Map.prototype._setupContainer=function(){var e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=t("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();var r=this._canvasContainer=t("div","mapboxgl-canvas-container",e);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=t("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);var n=this._controlContainer=t("div","mapboxgl-control-container",e),o=this._controlPositions={};["top-left","top-right","top-center","bottom-left","bottom-right"].forEach((function(e){o[e]=t("div","mapboxgl-ctrl-".concat(e),n)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}}function mt(){return yt.apply(this,arguments)}function yt(){return(yt=nt(et().mark((function t(){var e,r,n,i,a,s,c;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.license&&this.license.name){t.next=2;break}return t.abrupt("return",!1);case 2:return t.next=4,Promise.all([o.e(38).then(o.bind(o,115)),o.e(91).then(o.bind(o,432)),o.e(173).then(o.bind(o,42)),o.e(759).then(o.bind(o,780)),o.e(320).then(o.bind(o,53))]);case 4:e=t.sent,r=$(e,5),n=r[0],i=r[1],a=r[2],s=r[3],c=r[4],ot.premiumModules={Pinning:n.default,Routing:i.default,Exploring:a.default,Painting:s.default,Gaming:c.default},ot.premiumModules.Pinning.prototype.geoflo=ot,ot.premiumModules.Routing.prototype.geoflo=ot,ot.premiumModules.Exploring.prototype.geoflo=ot,ot.premiumModules.Painting.prototype.geoflo=ot,ot.premiumModules.Gaming.prototype.geoflo=ot;case 18:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function vt(t){return bt.apply(this,arguments)}function bt(){return(bt=nt(et().mark((function t(e){var r;return et().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={enabled:!0,name:this.statics.id},t.abrupt("return",r);case 2:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}f.prototype.geoflo=ot,N.prototype.geoflo=ot,O.prototype.geoflo=ot,q.prototype.geoflo=ot,V.prototype.geoflo=ot,D.prototype.geoflo=ot,j.prototype.geoflo=ot,U.prototype.geoflo=ot,m.prototype.geoflo=ot,W.prototype.geoflo=ot})();